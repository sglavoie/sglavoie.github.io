<!doctype html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      type="text/css"
      href="../../../../../theme/css/style.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="../../../../../theme/css/pygments.css"
    />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Sébastien Lavoie" />
    <meta
      name="description"
      content="Posts and writings by Sébastien Lavoie. Customization setups and articles on productivity for developers who like minimalism."
    />
    <meta name="title" property="og:title" content="sglavoie.com" />
    <meta property="og:type" content="Website" />
    <meta
      name="image"
      property="og:image"
      content="../../../../../theme/images/logo_1200x627.png"
    />

     <link
      href="https://www.sglavoie.com/feeds/sglavoie.rss.xml"
      type="application/rss+xml"
      rel="alternate"
      title="sglavoie.com RSS"
    />

    <!-- Favicon -->
    <link rel="apple-touch-icon" href="/theme/favicon/apple-touch-icon.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/theme/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/theme/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="/theme/favicon/site.webmanifest" />
    <link
      rel="mask-icon"
      href="/theme/favicon/safari-pinned-tab.svg"
      color="#5bbad5"
    />
    <link rel="shortcut icon" href="/theme/favicon/favicon.ico" />
    <meta name="msapplication-TileColor" content="#2d89ef" />
    <meta
      name="msapplication-TileImage"
      content="/theme/favicon/mstile-144x144.png"
    />
    <meta
      name="msapplication-config"
      content="/theme/favicon/browserconfig.xml"
    />
    <meta name="theme-color" content="#000000" />
    <meta
      name="msapplication-config"
      content="/theme/favicon/browserconfig.xml"
    />
    <meta name="theme-color" content="#000000" />

<meta name="keywords" content="api, click, python, script" />

<!-- Open graph for social networks -->
<meta name="og:title" property="og:title" content="Has your password been leaked in a major breach? You can find out thanks to Have I Been Pwned?... Or you can use their API and stop worrying about your password being sent through your Web browser!" />
 
    <title>sglavoie.com &ndash; Have You Been&nbsp;Pwned?</title>

    <!-- Enable tracking of web traffic -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-150998392-1"]);
  _gaq.push(["_trackPageview"]);
  (function () {
    var ga = document.createElement("script");
    ga.type = "text/javascript";
    ga.async = true;
    ga.src =
      ("https:" == document.location.protocol ? "https://ssl" : "http://www") +
      ".google-analytics.com/ga.js";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ga, s);
  })();
</script>
   </head>

  <body>
    <aside>
      <div id="user_meta">
        <a href="../../../../..">
          <div>
            <svg
              width="24.348mm"
              height="24.348mm"
              version="1.1"
              viewBox="0 0 24.348095 24.347754"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:cc="http://creativecommons.org/ns#"
              xmlns:dc="http://purl.org/dc/elements/1.1/"
              xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
            >
              <metadata>
                <rdf:RDF>
                  <cc:Work rdf:about="">
                    <dc:format>image/svg+xml</dc:format>
                    <dc:type
                      rdf:resource="http://purl.org/dc/dcmitype/StillImage"
                    />
                    <dc:title />
                  </cc:Work>
                </rdf:RDF>
              </metadata>
              <g transform="translate(81.397 -84.454)">
                <path d="m-57.049 105.9v2.9029h-11.173v-2.9029z" fill="#c0c0c0">
                  <animate
                    attributeName="fill"
                    values="white;grey;white"
                    dur="2s"
                    repeatCount="indefinite"
                  />
                </path>
                <path
                  d="m-72.272 98.481-9.1246 5.7598v-3.548l5.8658-3.5019v-0.09215l-5.8658-3.5019v-3.548l9.1246 5.7598z"
                  fill="#c0c0c0"
                />
                <path
                  transform="scale(.26458)"
                  d="m-273.15 319.2-27.588 14.77 8.498 5.3613 19.09-12.049zm15.309 25.67v44.412h8.8672v-35.635h33.361v-8.7773h-33.783zm25.336 24.66v8.7774h8.0254v10.975h8.8672v-19.752z"
                  fill="#007bff"
                />
              </g>
            </svg>
          </div>
        </a>
        <ul>
            <li><a href="../../../../../category/automation.html">automation</a></li>
          <li><a href="../../../../../category/learnings.html">learnings</a></li>
          <li><a href="../../../../../category/tips-and-tricks.html">tips-and-tricks</a></li>
          <li><a href="../../../../../category/tools.html">tools</a></li>
          <li><a href="../../../../../category/workflow.html">workflow</a></li>
          </ul>
      </div>
    </aside>

    <main>
      <header>
        <p>
          <a href="../../../../..">Home</a> &brvbar;
          <a href="../../../../../archives.html">Archives</a> &brvbar;
          <a href="../../../../../tags.html">Tags</a> &brvbar;
          <a href="../../../../../contact.html">Contact</a> &brvbar;
          <a
            href="https://drive.google.com/file/d/1t6GdZjC13naJXVGe6RinGowZLfkRzjy_/view"
            target="_blank"
            rel="noopener noreferrer"
            >Resume</a
          >
        </p>
      </header>

<article>
  <div class="article_title">
    <h1><a href="../../../../../posts/2019/03/21/have-you-been-pwned/">Have You Been&nbsp;Pwned?</a></h1>
  </div>
  <div class="flex-container">
    <div class="article_meta">
      <div>Posted on: Thu 21 March 2019</div>
      <div>
        Category:
        <a href="../../../../../category/automation.html"
          >automation</a
        >
 &ndash; Tags:         <a href="../../../../../tag/api.html">api</a>,         <a href="../../../../../tag/click.html">click</a>,         <a href="../../../../../tag/python.html">python</a>,         <a href="../../../../../tag/script.html">script</a>        </div>
    </div>
    <div class="article_readtime">
      Estimated read time: 4 minutes
    </div>
  </div>

  <h2 class="toc-title">Table of contents</h2>
  <nav class="toc"><div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#python-to-the-rescue">Python to the rescue</a><ul>
<li><a href="#example-usage">Example usage</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div></nav>
  <div class="article_text">
<hr/>
<h1 id="introduction">Introduction</h1>
<p><a href="https://haveibeenpwned.com/">Have I Been Pwned?</a> has a very simple and
accessible <span class="caps">API</span> that’s perfect to work with as a beginner. There are
different ways to retrieve information and the script below is only
one glimpse into the numerous possibilities available. It is built in
a way that makes it easy to add features and functionality thanks to
<a href="https://github.com/pallets/click">Click</a>, a wonderful <em>“command line
interface toolkit”</em>.</p>
<h1 id="python-to-the-rescue">Python to the rescue</h1>
<p>The following script uses <a href="https://github.com/pallets/click">Click</a>
to build a tiny command-line interface instead of more
traditional tools like <code>argparse</code>. You will also need
<a href="https://github.com/kennethreitz/requests">requests</a> to peek inside the
<span class="caps">API</span>. Both can be obtained as follow in a terminal:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>click<span class="w"> </span>requests
</code></pre></div>
<p>And now, the <em>pièce de résistance</em>.</p>
<div class="highlight"><pre><span></span><code><span class="sd">"""</span>
<span class="sd">Simple script that will take advantage of haveibeenpwned.com's API to</span>
<span class="sd">find out if your password has been breached.</span>
<span class="sd">"""</span>
<span class="c1"># Standard library imports</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="c1"># Third party library imports</span>
<span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">requests</span>


<span class="c1"># Needed to access API</span>
<span class="n">PASS_URL</span> <span class="o">=</span> <span class="s1">'https://api.pwnedpasswords.com/range/'</span>

<span class="c1"># Script information</span>
<span class="n">VERSION</span> <span class="o">=</span> <span class="s1">'0.1.1'</span>
<span class="n">LOGO</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'''</span>
<span class="s1"> __                        __   __</span>
<span class="s1">|  |--.---.-.--.--.-----. |__| |  |--.-----.-----.-----.</span>
<span class="s1">|     |  _  |  |  |  -__| |  | |  _  |  -__|  -__|     |</span>
<span class="s1">|__|__|___._|\___/|_____| |__| |_____|_____|_____|__|__|</span>

<span class="s1">                               __  _____</span>
<span class="s1">.-----.--.--.--.-----.-----.--|  ||__   |</span>
<span class="s1">|  _  |  |  |  |     |  -__|  _  |',  ,-'</span>
<span class="s1">|   __|________|__|__|_____|_____| |--|</span>
<span class="s1">|__|                               '--'  '''</span>


<span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  <span class="c1"># `param` required by `click`</span>
<span class="w">    </span><span class="sd">"""Print information about the program and exit."""</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">context</span><span class="o">.</span><span class="n">resilient_parsing</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">LOGO</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="s2">"Python 3.6+ Checker"</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">'</span>
                <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="p">(</span><span class="s2">"v"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">VERSION</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">pass_to_sha1</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Will convert `password` with SHA-1 algorithm and return the short</span>
<span class="sd">    version with the first five characters and the long version with</span>
<span class="sd">    everything but the first five characters as a tuple."""</span>

    <span class="n">my_password</span> <span class="o">=</span> <span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>  <span class="c1"># converts to byte string</span>

    <span class="n">complete_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">my_password</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">long_hash</span> <span class="o">=</span> <span class="n">complete_hash</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
    <span class="n">short_hash</span> <span class="o">=</span> <span class="n">complete_hash</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">short_hash</span><span class="p">,</span> <span class="n">long_hash</span>


<span class="k">def</span> <span class="nf">check_password</span><span class="p">(</span><span class="n">short_hash</span><span class="p">,</span> <span class="n">long_hash</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Consult haveibeenpwned.com to see how many times the password has</span>
<span class="sd">    been breached."""</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'Please note that only the 5 first characters from your '</span>
                <span class="s1">'SHA-1 ENCRYPTED password are sent to haveibeenpwned.com.'</span><span class="p">,</span>
                <span class="n">fg</span><span class="o">=</span><span class="s1">'yellow'</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PASS_URL</span> <span class="o">+</span> <span class="n">short_hash</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">long_hash</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">num_times</span> <span class="o">=</span> <span class="s1">'occurrences'</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">36</span><span class="p">:])</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'occurence'</span>
            <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'Your password was found!'</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s1">'→ </span><span class="si">{</span><span class="n">line</span><span class="p">[</span><span class="mi">36</span><span class="p">:]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">num_times</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'Your password was NOT found!'</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">'green'</span><span class="p">)</span>


<span class="nd">@click</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s1">'--info'</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callback</span><span class="o">=</span><span class="n">print_info</span><span class="p">,</span>
    <span class="n">expose_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">is_eager</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">"Print some information about the program and exit."</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">version_option</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">VERSION</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"</span><span class="si">%(version)s</span><span class="s2">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hibp</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""A simple command-line interface to make use of</span>
<span class="sd">    haveibeenpwned.com's data.</span>

<span class="sd">    Type `python3 pwned.py usage` for more info (or whatever way you</span>
<span class="sd">    call Python 3)."""</span>


<span class="nd">@hibp</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">usage</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Give examples on how to use this script."""</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'Examples:'</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'python3 pwned.py check --help for more info.'</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">'green'</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'python3 pwned.py check -p MyPasswordHere'</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">'yellow'</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'python3 pwned.py check --password MyPasswordHere'</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">'green'</span><span class="p">)</span>

    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'For more complicated passwords, you have to use quotes and '</span><span class="p">,</span>
                <span class="n">fg</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'escape symbols with </span><span class="se">\\</span><span class="s1"> where appropriate:'</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'python3 pwned.py check -p "as0d9</span><span class="se">\\</span><span class="s1">"asg0</span><span class="se">\'\'</span><span class="s1">A=)SYD"'</span><span class="p">,</span>
                <span class="n">fg</span><span class="o">=</span><span class="s1">'green'</span><span class="p">)</span>


<span class="nd">@hibp</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s1">'-p'</span><span class="p">,</span>
    <span class="s1">'--password'</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">"Reveal if match exists with `password`."</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Tell if your password has been breached."""</span>
    <span class="k">if</span> <span class="n">password</span><span class="p">:</span>
        <span class="n">short_hash</span><span class="p">,</span> <span class="n">long_hash</span> <span class="o">=</span> <span class="n">pass_to_sha1</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">check_password</span><span class="p">(</span><span class="n">short_hash</span><span class="p">,</span> <span class="n">long_hash</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">'Run `pwned.py check --help` for more info.'</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">hibp</span><span class="p">()</span>
</code></pre></div>
<h2 id="example-usage">Example usage</h2>
<p><a href="../../../../../images/posts/0011_have-i-been-pwned/have_i_been_pwned_script.png"><img alt="have_i_been_pwned_script" class="max-size-img-post" src="../../../../../images/posts/0011_have-i-been-pwned/have_i_been_pwned_script.png"/></a></p>
<h1 id="conclusion">Conclusion</h1>
<p>If you are familiar with Python,
you can easily make sense of how this little tool works by
reading its code. You can also have a look at this <a href="https://github.com/sglavoie/dev-helpers/tree/main/haveibeenpwnwed_password_checker">repository on
GitHub</a> if you want
to fork it or reuse it any other way you wish. I have personally found
it much easier to work with <a href="https://github.com/pallets/click">Click</a>
instead of <code>argparse</code> and <code>optparse</code>. I haven’t got to try
<a href="https://github.com/docopt/docopt">docopt</a> yet, but it is almost equally
as popular as Click on GitHub at the time of this writing and its
Pythonic way makes it another great option to consider.</p></div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_identifier = "posts/2019/03/21/have-you-been-pwned/";
      (function () {
        var dsq = document.createElement("script");
        dsq.type = "text/javascript";
        dsq.async = true;
        dsq.src = "//sglavoie.disqus.com/embed.js";
        (
          document.getElementsByTagName("head")[0] ||
          document.getElementsByTagName("body")[0]
        ).appendChild(dsq);
      })();
    </script>
  </div>
</article>
  
      <div id="ending_message">
        <p>
          &copy; Sébastien Lavoie. Built with
          <a
            href="https://www.python.org/"
            target="_blank"
            rel="noopener noreferrer"
            >Python</a
          >
          using
          <a
            href="http://getpelican.com"
            target="_blank"
            rel="noopener noreferrer"
            >Pelican</a
          >
          <span class="badge">v4.8.0</span>. Theme adapted from
          Giulio Fidente on
          <a
            href="https://github.com/gfidente/pelican-svbhack"
            target="_blank"
            rel="noopener noreferrer"
            >GitHub</a
          >. <a href="https://www.sglavoie.com/feeds/sglavoie.rss.xml">RSS feed</a>.
        </p>
      </div>
    </main>
  </body>
</html>