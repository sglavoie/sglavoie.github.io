<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link
      rel="preload"
      href="/theme/css/fonts/lato-regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/lato-bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/ubuntu-regular-webfont.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/ubuntu-bold-webfont.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/ubuntu-regular-italic-webfont.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/ubuntu-bold-italic-webfont.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/SourceCodePro-Regular.ttf.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/SourceCodePro-Bold.ttf.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/SourceCodePro-It.ttf.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/SourceCodePro-BoldIt.ttf.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link rel="preload" as="style" href="/theme/css/main.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/theme/css/styles.css"
    />
    <link href="/theme/css/sweetalert2.css" rel="stylesheet" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Sébastien Lavoie" />
    <meta
      name="description"
      content="Posts and writings by Sébastien Lavoie. Customization setups and articles on productivity for developers who like minimalism."
    />
    <meta name="title" property="og:title" content="sglavoie.com" />
    <meta property="og:type" content="Website" />
    <meta
      name="image"
      property="og:image"
      content="../../../../../theme/images/logo_1200x627.png"
    />

    <link
      href="https://www.sglavoie.com/feeds/sglavoie.atom.xml"
      type="application/atom+xml"
      rel="alternate"
      title="sglavoie.com Atom"
    />
     <link
      href="https://www.sglavoie.com/feeds/sglavoie.rss.xml"
      type="application/rss+xml"
      rel="alternate"
      title="sglavoie.com RSS"
    />

    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      href="/theme/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/theme/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/theme/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="/theme/favicon/site.webmanifest" />
    <link
      rel="mask-icon"
      href="/theme/favicon/safari-pinned-tab.svg"
      color="#5bbad5"
    />
    <link rel="shortcut icon" href="/theme/favicon/favicon.ico" />
    <meta name="msapplication-TileColor" content="#2d89ef" />
    <meta
      name="msapplication-TileImage"
      content="/theme/favicon/mstile-144x144.png"
    />
    <meta
      name="msapplication-config"
      content="/theme/favicon/browserconfig.xml"
    />
    <meta name="theme-color" content="#232323" />
    <meta
      name="msapplication-config"
      content="/theme/favicon/browserconfig.xml"
    />
    <meta name="theme-color" content="#232323" />

<meta name="keywords" content="best practices, books, go" />

<!-- Open graph for social networks -->
<meta name="og:title" property="og:title" content="Learning Go is a book that teaches idiomatic Go style and best practices through concrete examples. It covers fundamental features like types and control flow, as well as more advanced topics like concurrency and reflection. The goal is to help readers write clear, readable, robust Go code. I think it succeeded at that!" />
 
    <title>sglavoie.com &ndash; Book summary: Learning Go – An Idiomatic Approach to Real-World Go&nbsp;Programming</title>
  </head>

  <body>
    <div id="pageContainer">
      <svg
        id="search-icon"
        width="2em"
        height="2em"
        fill="none"
        viewBox="0 0 24 24"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
      >
        <path
          d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z"
          stroke="#ffffff"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <aside id="sidebar">
        <a id="websiteLogo" href="../../../../..">
          <svg
            aria-labelledby="sglavoie.com's logo"
            class="svgLogo"
            width="100px"
            height="100px"
            version="1.1"
            viewBox="0 0 24.348095 24.347754"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:cc="http://creativecommons.org/ns#"
            xmlns:dc="http://purl.org/dc/elements/1.1/"
            xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
          >
            <title id="svgTitle">sglavoie.com's logo</title>
            <desc id="svgDesc">The website's logo.</desc>
            <metadata>
              <rdf:RDF>
                <cc:Work rdf:about="">
                  <dc:format>image/svg+xml</dc:format>
                  <dc:type
                    rdf:resource="http://purl.org/dc/dcmitype/StillImage"
                  />
                  <dc:title />
                </cc:Work>
              </rdf:RDF>
            </metadata>
            <g transform="translate(81.397 -84.454)">
              <path d="m-57.049 105.9v2.9029h-11.173v-2.9029z" fill="#c0c0c0">
                <animate
                  attributeName="fill"
                  values="white;grey;white"
                  dur="2s"
                  repeatCount="indefinite"
                />
              </path>
              <path
                d="m-72.272 98.481-9.1246 5.7598v-3.548l5.8658-3.5019v-0.09215l-5.8658-3.5019v-3.548l9.1246 5.7598z"
                fill="#c0c0c0"
              />
              <path
                transform="scale(.26458)"
                d="m-273.15 319.2-27.588 14.77 8.498 5.3613 19.09-12.049zm15.309 25.67v44.412h8.8672v-35.635h33.361v-8.7773h-33.783zm25.336 24.66v8.7774h8.0254v10.975h8.8672v-19.752z"
                fill="#007bff"
              />
            </g>
          </svg>
        </a>

        <nav id="navCategories">
          <ul>
              <li>
              <a href="../../../../../category/automation.html"
                >automation
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
            <li>
              <a href="../../../../../category/learnings.html"
                >learnings
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
            <li>
              <a href="../../../../../category/tips-and-tricks.html"
                >tips-and-tricks
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
            <li>
              <a href="../../../../../category/tools.html"
                >tools
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
            <li>
              <a href="../../../../../category/workflow.html"
                >workflow
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
           </ul>
        </nav>
      </aside>

      <aside id="pageNavigation">
        <nav>
          <ul>
            <li>
              <a href="../../../../.."
                ><svg
                  class="navigation-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M18.5 3H16C15.7239 3 15.5 3.22386 15.5 3.5V3.55891L19 6.35891V3.5C19 3.22386 18.7762 3 18.5 3Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M10.75 9.5C10.75 8.80964 11.3097 8.25 12 8.25C12.6904 8.25 13.25 8.80964 13.25 9.5C13.25 10.1904 12.6904 10.75 12 10.75C11.3097 10.75 10.75 10.1904 10.75 9.5Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M20.75 10.9605L21.5315 11.5857C21.855 11.8444 22.3269 11.792 22.5857 11.4685C22.8444 11.1451 22.792 10.6731 22.4685 10.4143L14.3426 3.91362C12.9731 2.81796 11.027 2.81796 9.65742 3.91362L1.53151 10.4143C1.20806 10.6731 1.15562 11.1451 1.41438 11.4685C1.67313 11.792 2.1451 11.8444 2.46855 11.5857L3.25003 10.9605V21.25H2.00003C1.58581 21.25 1.25003 21.5858 1.25003 22C1.25003 22.4142 1.58581 22.75 2.00003 22.75H22C22.4142 22.75 22.75 22.4142 22.75 22C22.75 21.5858 22.4142 21.25 22 21.25H20.75V10.9605ZM9.25003 9.5C9.25003 7.98122 10.4812 6.75 12 6.75C13.5188 6.75 14.75 7.98122 14.75 9.5C14.75 11.0188 13.5188 12.25 12 12.25C10.4812 12.25 9.25003 11.0188 9.25003 9.5ZM12.0494 13.25C12.7143 13.25 13.2871 13.2499 13.7459 13.3116C14.2375 13.3777 14.7088 13.5268 15.091 13.909C15.4733 14.2913 15.6223 14.7625 15.6884 15.2542C15.7462 15.6842 15.7498 16.2146 15.75 16.827C15.75 16.8679 15.75 16.9091 15.75 16.9506L15.75 21.25H14.25V17C14.25 16.2717 14.2484 15.8009 14.2018 15.454C14.1581 15.1287 14.0875 15.0268 14.0304 14.9697C13.9733 14.9126 13.8713 14.842 13.546 14.7982C13.1991 14.7516 12.7283 14.75 12 14.75C11.2717 14.75 10.8009 14.7516 10.4541 14.7982C10.1288 14.842 10.0268 14.9126 9.9697 14.9697C9.9126 15.0268 9.84199 15.1287 9.79826 15.454C9.75162 15.8009 9.75003 16.2717 9.75003 17V21.25H8.25003L8.25003 16.9506C8.24999 16.2858 8.24996 15.7129 8.31163 15.2542C8.37773 14.7625 8.52679 14.2913 8.90904 13.909C9.29128 13.5268 9.76255 13.3777 10.2542 13.3116C10.7129 13.2499 11.2858 13.25 11.9507 13.25H12.0494Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M10.75 9.5C10.75 8.80964 11.3097 8.25 12 8.25C12.6904 8.25 13.25 8.80964 13.25 9.5C13.25 10.1904 12.6904 10.75 12 10.75C11.3097 10.75 10.75 10.1904 10.75 9.5Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
                Home</a
              >
            </li>
            <li>
              <a href="../../../../../archives.html"
                ><svg
                  class="navigation-icon"
                  fill="hsl(211, 100%, 95%)"
                  width="0.8em"
                  height="1em"
                  viewBox="0 0 16 16"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M3 6v8h10V6H3zM1 6H0V0h16v6h-1v10H1V6zm4 2h6v2H5V8zM2 2v2h12V2H2z"
                    fill-rule="evenodd"
                  />
                </svg>
                Archives</a
              >
            </li>
            <li>
              <a href="../../../../../tags.html"
                ><svg
                  class="navigation-icon"
                  fill="hsl(211, 100%, 95%)"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z"
                  />
                </svg>
                Tags</a
              >
            </li>
            <li>
              <a href="../../../../../contact.html"
                ><svg
                  class="navigation-icon"
                  fill="hsl(211, 100%, 95%)"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M4,21a1,1,0,0,0,1,1H19a1,1,0,0,0,1-1V3a1,1,0,0,0-1-1H5A1,1,0,0,0,4,3ZM12,7.5a2,2,0,1,1-2,2A2,2,0,0,1,12,7.5ZM8.211,16.215a4,4,0,0,1,7.578,0A.993.993,0,0,1,14.83,17.5H9.18A1,1,0,0,1,8.211,16.215Z"
                  />
                </svg>
                Contact</a
              >
            </li>
            <li>
              <a
                href="/resume"
                target="_blank"
                rel="noopener noreferrer"
                ><svg
                  class="navigation-icon"
                  fill="hsl(211, 100%, 95%)"
                  width="1em"
                  height="1em"
                  viewBox="0 0 846.66 846.66"
                  style="
                    shape-rendering: geometricPrecision;
                    text-rendering: geometricPrecision;
                    image-rendering: optimizeQuality;
                    fill-rule: evenodd;
                    clip-rule: evenodd;
                  "
                  version="1.1"
                  xml:space="preserve"
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                >
                  <g id="Layer_x0020_1">
                    <path
                      class="fil0"
                      d="M305.08 127c-27.16,0 -27.16,-41.29 0,-41.29l60.83 0 0 -54.93c0,-11.4 9.25,-20.64 20.65,-20.64l190.32 0c11.4,0 20.65,9.24 20.65,20.64l0 54.93 106.1 0c11.4,0 20.65,9.25 20.65,20.65l0 709.52c0,11.4 -9.25,20.64 -20.65,20.64l-560.6 0c-11.4,0 -20.65,-9.24 -20.65,-20.64l0 -709.52c0,-11.4 9.25,-20.65 20.65,-20.65l67.88 0c27.15,0 27.15,41.29 0,41.29l-47.24 0 0 668.23 519.32 0 0 -668.23c-125.97,0 -251.94,0 -377.91,0zm102.12 -41.29l149.04 0 0 -34.28 -149.04 0 0 34.28zm-191.92 480.71c-27.15,0 -27.15,-41.29 0,-41.29l188.46 0c27.16,0 27.16,41.29 0,41.29l-188.46 0zm0 156.73c-27.15,0 -27.15,-41.29 0,-41.29l188.46 0c27.16,0 27.16,41.29 0,41.29l-188.46 0zm0 -78.36c-27.15,0 -27.15,-41.29 0,-41.29l188.46 0c27.16,0 27.16,41.29 0,41.29l-188.46 0zm294.81 -101.94l121.29 0c11.4,0 20.64,9.25 20.64,20.65l0 121.28c0,11.4 -9.24,20.65 -20.64,20.65l-121.29 0c-11.4,0 -20.64,-9.25 -20.64,-20.65l0 -121.28c0,-11.4 9.24,-20.65 20.64,-20.65zm100.64 41.29l-79.99 0 0 80 79.99 0 0 -80zm-243.28 -252.09c13.62,0.23 24.62,-11.16 24.62,-24.62 0,-13.72 -10.9,-24.63 -24.62,-24.63 -13.69,0 -24.62,10.94 -24.62,24.63 0,13.48 10.98,24.85 24.62,24.62zm20.65 37.98l0 59.74c47.81,-9.73 82.31,-51.95 82.31,-100.88 0,-56.87 -46.09,-102.96 -102.96,-102.96 -56.86,0 -102.95,46.09 -102.95,102.96 0,48.93 34.49,91.15 82.31,100.88l0 -59.75c-26.78,-8.89 -45.28,-34.08 -45.28,-62.59 0,-36.3 29.62,-65.92 65.92,-65.92 36.29,0 65.92,29.63 65.92,65.92 0,28.49 -18.49,53.73 -45.27,62.6zm-20.65 -185.39c79.67,0 144.25,64.58 144.25,144.25 0,79.66 -64.58,144.24 -144.25,144.24 -79.66,0 -144.24,-64.58 -144.24,-144.24 0,-79.67 64.58,-144.25 144.24,-144.25z"
                    />
                  </g>
                </svg>
                Resume</a
              >
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Content area -->
      <main>
<article data-pagefind-body>
  <div class="article_title">
    <h1><a href="../../../../../posts/2023/10/20/book-summary-learning-go-idiomatic-approach-real-world-go-programming/">Book summary: Learning Go – An Idiomatic Approach to Real-World Go&nbsp;Programming</a></h1>
  </div>
  <div class="meta_container_hrs">
    <hr />
    <div class="meta_container">
      <div class="article_meta">
        <div>
          Posted on <strong>October 20, 2023</strong> in
          <span id="category-article">
            <a href="../../../../../category/learnings.html"
              ><svg
                class="article-category-icon"
                width="1em"
                height="1em"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  opacity="1"
                  d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                  fill="hsl(211, 100%, 95%)"
                />
                <path
                  opacity="1"
                  d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                  fill="hsl(211, 100%, 95%)"
                />
                <path
                  d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                  fill="hsl(211, 100%, 95%)"
                />
                <path
                  d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                  fill="hsl(211, 100%, 95%)"
                />
              </svg>
              learnings</a
            >
          </span>
        </div>
        <div>
          <time class="modified" datetime="2024-05-28T20:11:00-06:00">
            Modified on <strong>May 28, 2024</strong>
          </time>
        </div>
        <div class="article_tags">
           <a href="../../../../../tag/best-practices.html"
            ><svg
              class="tag-icon"
              fill="hsl(211, 100%, 95%)"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z"
              />
            </svg>
            best practices</a
          >          <a href="../../../../../tag/books.html"
            ><svg
              class="tag-icon"
              fill="hsl(211, 100%, 95%)"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z"
              />
            </svg>
            books</a
          >          <a href="../../../../../tag/go.html"
            ><svg
              class="tag-icon"
              fill="hsl(211, 100%, 95%)"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z"
              />
            </svg>
            go</a
          >         </div>
      </div>
      <div class="article_readtime">
        <span class="readtime_tilde">~</span
        ><span class="readtime_minutes">66</span>
        minutes to read
      </div>
    </div>
    <hr />
  </div>

  <h2 class="toc-title">Table of contents</h2>
  <nav class="toc"><div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#setting-up-your-go-environment">Setting Up Your Go Environment</a></li>
<li><a href="#predeclared-types-and-declarations">Predeclared Types and Declarations</a><ul>
<li><a href="#predeclared-types">Predeclared types</a></li>
<li><a href="#var-vs">var vs. :=</a></li>
<li><a href="#const">const</a></li>
<li><a href="#unused-variables">Unused variables</a></li>
<li><a href="#naming-variables-and-constants">Naming Variables and Constants</a></li>
</ul>
</li>
<li><a href="#composite-types">Composite Types</a><ul>
<li><a href="#arrays">Arrays</a></li>
<li><a href="#slices">Slices</a><ul>
<li><a href="#len">len</a></li>
<li><a href="#append">append</a></li>
<li><a href="#capacity">Capacity</a></li>
<li><a href="#make">make</a></li>
<li><a href="#emptying-a-slice">Emptying a slice</a></li>
<li><a href="#declaring-a-slice">Declaring a slice</a></li>
<li><a href="#slicing-slices">Slicing slices</a></li>
<li><a href="#slices-can-share-data">Slices can share data</a></li>
<li><a href="#converting-arrays-to-slices">Converting Arrays to Slices</a></li>
<li><a href="#converting-slices-to-arrays">Converting Slices to Arrays</a></li>
<li><a href="#copy">copy</a></li>
</ul>
</li>
<li><a href="#strings-and-runes-and-bytes">Strings and Runes and Bytes</a></li>
<li><a href="#maps">Maps</a><ul>
<li><a href="#reading-and-writing-maps">Reading and writing maps</a></li>
<li><a href="#comma-ok-idiom">Comma Ok idiom</a></li>
<li><a href="#deleting-from-a-map">Deleting from a map</a></li>
<li><a href="#using-maps-as-sets">Using maps as sets</a></li>
</ul>
</li>
<li><a href="#structs">Structs</a><ul>
<li><a href="#anonymous-structs">Anonymous structs</a></li>
<li><a href="#comparing-and-converting-structs">Comparing and converting structs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#blocks-shadows-and-control-structures">Blocks, Shadows, and Control Structures</a><ul>
<li><a href="#blocks">Blocks</a></li>
<li><a href="#shadowing-variables">Shadowing Variables</a></li>
<li><a href="#if-statements">if statements</a></li>
<li><a href="#for-loops">for loops</a><ul>
<li><a href="#complete-for-statement">Complete for statement</a></li>
<li><a href="#condition-only-for-statement">Condition-only for Statement</a></li>
<li><a href="#infinite-for-statement">Infinite for Statement</a></li>
<li><a href="#break-and-continue">break and continue</a></li>
<li><a href="#for-range-loop">for-range loop</a><ul>
<li><a href="#iterating-over-maps">Iterating over maps</a></li>
<li><a href="#iterating-over-strings">Iterating over strings</a></li>
<li><a href="#for-range-value-is-a-copy">for-range value is a copy</a></li>
</ul>
</li>
<li><a href="#for-loop-labels">for loop labels</a></li>
<li><a href="#the-right-for-statement">The right for statement</a></li>
</ul>
</li>
<li><a href="#expression-switch-statements">Expression switch statements</a></li>
<li><a href="#blank-switch-statements">Blank switch statements</a></li>
<li><a href="#if-or-switch">if or switch?</a></li>
<li><a href="#goto">goto</a></li>
</ul>
</li>
<li><a href="#functions">Functions</a><ul>
<li><a href="#declaring-and-calling-them">Declaring and calling them</a></li>
<li><a href="#functions-are-values">Functions are values</a><ul>
<li><a href="#closures">Closures</a></li>
<li><a href="#defer">defer</a></li>
<li><a href="#go-is-call-by-value">Go is “call by value”</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#pointers">Pointers</a></li>
<li><a href="#types-methods-and-interfaces">Types, Methods, and Interfaces</a><ul>
<li><a href="#methods">Methods</a><ul>
<li><a href="#pointer-receivers-and-value-receivers">Pointer Receivers and Value Receivers</a></li>
<li><a href="#methods-are-also-functions">Methods are also functions</a></li>
<li><a href="#functions-vs-methods">Functions vs. methods</a></li>
<li><a href="#type-declarations-are-not-inheritance">Type declarations are not inheritance</a></li>
<li><a href="#types-serve-as-executable-documentation">Types serve as executable documentation</a></li>
<li><a href="#use-iota-for-enumeration-sparingly">Use iota for enumeration (sparingly)</a></li>
<li><a href="#embedding-for-composition">Embedding for composition</a></li>
<li><a href="#interfaces">Interfaces</a></li>
<li><a href="#take-interfaces-and-return-structs">Take interfaces and return structs</a></li>
<li><a href="#empty-interfaces">Empty interfaces</a></li>
<li><a href="#type-assertions-and-type-switches">Type assertions and type switches</a></li>
<li><a href="#function-types-are-a-bridge-to-interfaces">Function types are a bridge to interfaces</a></li>
<li><a href="#implicit-interfaces-make-dependency-injection-easier">Implicit Interfaces Make Dependency Injection Easier</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#generics">Generics</a><ul>
<li><a href="#generics-reduce-repetitive-code-and-increase-type-safety">Generics Reduce Repetitive Code and Increase Type Safety</a><ul>
<li><a href="#generic-functions-abstract-algorithms">Generic Functions Abstract Algorithms</a></li>
</ul>
</li>
<li><a href="#generics-and-interfaces">Generics and interfaces</a></li>
</ul>
</li>
<li><a href="#errors">Errors</a><ul>
<li><a href="#sentinel-errors">Sentinel errors</a></li>
<li><a href="#wrapping-errors">Wrapping errors</a></li>
<li><a href="#is-and-as">Is and As</a></li>
<li><a href="#wrapping-errors-with-defer">Wrapping Errors with defer</a></li>
<li><a href="#panic-and-recover">Panic and recover</a></li>
<li><a href="#getting-a-stack-trace-from-an-error">Getting a Stack Trace from an Error</a></li>
</ul>
</li>
<li><a href="#modules-packages-and-imports">Modules, Packages, and Imports</a><ul>
<li><a href="#gomod">go.mod</a></li>
<li><a href="#building-packages">Building packages</a><ul>
<li><a href="#imports-and-exports">Imports and exports</a></li>
<li><a href="#creating-and-accessing-packages">Creating and accessing packages</a></li>
<li><a href="#naming-packages">Naming packages</a></li>
<li><a href="#organizing-a-module">Organizing a module</a></li>
<li><a href="#overriding-a-packages-name">Overriding a package’s name</a></li>
<li><a href="#package-comments-and-godoc">Package comments and godoc</a></li>
<li><a href="#internal-package">Internal package</a></li>
<li><a href="#the-init-function">The init function</a></li>
<li><a href="#circular-dependencies">Circular dependencies</a></li>
<li><a href="#api-renaming-and-organizing"><span class="caps">API</span> renaming and organizing</a></li>
</ul>
</li>
<li><a href="#working-with-modules">Working with modules</a><ul>
<li><a href="#importing-third-party-code">Importing third-party code</a></li>
<li><a href="#working-with-versions">Working with versions</a></li>
<li><a href="#updating-to-compatible-versions">Updating to compatible versions</a></li>
<li><a href="#updating-to-incompatible-versions">Updating to incompatible versions</a></li>
<li><a href="#vendoring">Vendoring</a></li>
<li><a href="#pkggodev">pkg.go.dev</a></li>
</ul>
</li>
<li><a href="#publishing-modules">Publishing modules</a></li>
<li><a href="#versioning-modules">Versioning modules</a></li>
<li><a href="#module-proxy-servers">Module proxy servers</a><ul>
<li><a href="#specifying-a-module-proxy-server">Specifying a module proxy server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#concurrency-in-go">Concurrency in Go</a><ul>
<li><a href="#when-to-use-concurrency">When to use concurrency</a></li>
<li><a href="#goroutines">Goroutines</a></li>
<li><a href="#channels">Channels</a><ul>
<li><a href="#reading-writing-buffering">Reading, writing, buffering</a></li>
<li><a href="#for-range-and-channels">for-range and channels</a></li>
<li><a href="#closing-a-channel">Closing a channel</a></li>
<li><a href="#how-channels-behave">How channels behave</a></li>
<li><a href="#select">select</a></li>
</ul>
</li>
<li><a href="#concurrency-practices-and-patterns">Concurrency practices and patterns</a><ul>
<li><a href="#keep-apis-concurrency-free">Keep APIs concurrency-free</a></li>
<li><a href="#goroutines-for-loops-and-varying-variables">Goroutines, for loops, and varying variables</a></li>
<li><a href="#always-clean-up-your-goroutines">Always clean up your goroutines</a></li>
<li><a href="#done-channel-pattern"><span class="dquo">“</span>Done channel pattern”</a></li>
<li><a href="#using-a-cancel-function-to-terminate-a-goroutine">Using a cancel function to terminate a goroutine</a></li>
<li><a href="#when-to-use-buffered-and-unbuffered-channels">When to use buffered and unbuffered channels</a></li>
<li><a href="#backpressure">Backpressure</a></li>
<li><a href="#turning-off-a-case-in-a-select">Turning off a case in a select</a></li>
<li><a href="#time-out-code">Time out code</a></li>
<li><a href="#using-waitgroups">Using WaitGroups</a></li>
<li><a href="#running-code-exactly-once">Running code exactly once</a></li>
</ul>
</li>
<li><a href="#when-to-use-mutexes-instead-of-channels">When to use mutexes instead of channels</a></li>
<li><a href="#atomics">Atomics</a></li>
</ul>
</li>
<li><a href="#the-standard-library">The Standard Library</a><ul>
<li><a href="#io-and-friends">io and Friends</a></li>
<li><a href="#time">time</a><ul>
<li><a href="#monotonic-time">Monotonic time</a></li>
<li><a href="#timers-and-timeouts">Timers and timeouts</a></li>
</ul>
</li>
<li><a href="#encoding-and-json">Encoding and <span class="caps">JSON</span></a><ul>
<li><a href="#use-struct-tags-to-add-metadata">Use struct tags to add metadata</a></li>
<li><a href="#unmarshalling-and-marshalling">Unmarshalling and marshalling</a></li>
<li><a href="#json-readers-and-writers"><span class="caps">JSON</span>, readers, and writers</a></li>
<li><a href="#encoding-and-decoding-json-streams">Encoding and Decoding <span class="caps">JSON</span> Streams</a></li>
<li><a href="#custom-json-parsing">Custom <span class="caps">JSON</span> Parsing</a></li>
<li><a href="#nethttp">net/http</a></li>
<li><a href="#client">Client</a></li>
<li><a href="#server">Server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#the-context">The Context</a><ul>
<li><a href="#cancellation">Cancellation</a></li>
<li><a href="#timers">Timers</a></li>
<li><a href="#values">Values</a></li>
</ul>
</li>
<li><a href="#writing-tests">Writing Tests</a><ul>
<li><a href="#basics-of-testing">Basics of testing</a><ul>
<li><a href="#reporting-failure">Reporting failure</a></li>
<li><a href="#setting-up-and-tearing-down">Setting up and tearing down</a></li>
<li><a href="#storing-sample-test-data">Storing sample test data</a></li>
<li><a href="#caching-test-results">Caching test results</a></li>
<li><a href="#testing-your-public-api">Testing your public <span class="caps">API</span></a></li>
<li><a href="#use-go-cmp-to-compare-test-results">Use go-cmp to compare test results</a></li>
</ul>
</li>
<li><a href="#table-tests">Table tests</a></li>
<li><a href="#checking-code-coverage">Checking code coverage</a></li>
<li><a href="#benchmarks">Benchmarks</a></li>
<li><a href="#stubs">Stubs</a></li>
<li><a href="#httptest">httptest</a></li>
<li><a href="#integration-tests-and-build-tags">Integration tests and build tags</a></li>
<li><a href="#finding-concurrency-problems-with-the-race-checker">Finding concurrency problems with the race checker</a></li>
</ul>
</li>
<li><a href="#here-there-be-dragons-reflect-unsafe-and-cgo">Here There Be Dragons: Reflect, Unsafe, and Cgo</a><ul>
<li><a href="#reflection-to-work-with-types-at-runtime">Reflection to work with types at runtime</a><ul>
<li><a href="#types-kinds-and-values">Types, kinds, and values</a></li>
<li><a href="#making-new-values">Making new values</a></li>
<li><a href="#use-reflection-to-check-if-an-interfaces-value-is-nil">Use reflection to check if an interface’s value is nil</a></li>
<li><a href="#use-reflection-to-write-a-data-marshaler">Use reflection to write a data marshaler</a></li>
<li><a href="#build-functions-with-reflection-to-automate-repetitive-tasks">Build functions with reflection to automate repetitive tasks</a></li>
<li><a href="#you-can-build-structs-with-reflection-but-dont">You can build structs with reflection, but don’t</a></li>
</ul>
</li>
<li><a href="#unsafe-is-unsafe">unsafe… is unsafe</a><ul>
<li><a href="#use-unsafe-to-convert-external-binary-data">Use unsafe to convert external binary data</a></li>
<li><a href="#unsafe-strings-and-slices">unsafe strings and slices</a></li>
</ul>
</li>
<li><a href="#cgo-is-for-integration-not-performance">cgo is for integration, not performance</a></li>
</ul>
</li>
<li><a href="#a-look-at-the-future-generics-in-go">A Look at the Future: Generics in Go</a><ul>
<li><a href="#generics-reduce-repetitive-code-and-increase-type-safety_1">Generics reduce repetitive code and increase type safety</a></li>
<li><a href="#use-type-lists-to-specify-operators">Use type lists to specify operators</a></li>
</ul>
</li>
<li><a href="#salient-takeaways">Salient takeaways</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#resources-and-references">Resources and references</a><ul>
<li><a href="#articles">Articles</a></li>
<li><a href="#books">Books</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#other-open-source-projects-referenced">Other open source projects referenced</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#videos">Videos</a></li>
</ul>
</li>
</ul>
</div></nav>
  <div class="article_text">
<hr/>
<h1 id="introduction">Introduction</h1>
<p>Go is a modern programming language developed by Google that has gained immense popularity in recent years. It is a statically typed, compiled language that combines aspects of imperative and object-oriented programming. Go aims to provide simplicity, performance, and reliability.</p>
<p>In his book, Jon provides a comprehensive introduction to Go programming. The book focuses on teaching idiomatic Go code by using concrete examples and focusing on how experienced Go developers structure their code. It covers fundamental language features like primitive types, control structures, and composite types. It also dives into more advanced topics like concurrency through goroutines and channels, writing tests, and using reflection.</p>
<p>This summary highlights the key takeaways from each chapter. It aims to provide an overview of the core concepts and best practices for writing clear, readable, robust Go code. It’s written from the perspective of a developer who has experience with other programming languages like Python, Java, and TypeScript but practically none in Go.</p>
<hr/>
<h1 id="setting-up-your-go-environment">Setting Up Your Go Environment</h1>
<ul>
<li>Use <code>golint</code> to enforce the right coding style of a project.</li>
<li>Use <code>go version</code> to check the version of Go installed.</li>
<li>Use <code>go vet</code> to find errors that may not be detected by the compiler, such as having the wrong number of arguments passed to a <code>Printf</code> call.</li>
<li>A common idiom to run multiple commands at once when building a project is to rely on a <code>Makefile</code> like this:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="na">.DEFAULT_GOAL</span><span class="w"> </span><span class="p">:</span><span class="err">=</span><span class="w"> </span><span class="no">build</span>

<span class="nl">fmt:</span>
<span class="w">    </span><span class="nf">go</span><span class="w"> </span><span class="no">fmt</span><span class="w"> </span><span class="p">.</span><span class="err">/</span><span class="no">...</span>
<span class="nl">.PHONY:</span><span class="nf">fmt</span>

<span class="nl">lint:</span><span class="w"> </span><span class="nf">fmt</span>
<span class="w">    </span><span class="nf">golint</span><span class="w"> </span><span class="p">.</span><span class="err">/</span><span class="no">...</span>
<span class="nl">.PHONY:</span><span class="nf">lint</span>

<span class="nl">vet:</span><span class="w"> </span><span class="nf">fmt</span>
<span class="w">    </span><span class="nf">go</span><span class="w"> </span><span class="no">vet</span><span class="w"> </span><span class="p">.</span><span class="err">/</span><span class="no">...</span>
<span class="nl">.PHONY:</span><span class="nf">vet</span>

<span class="nl">build:</span><span class="w"> </span><span class="nf">vet</span>
<span class="w">    </span><span class="nf">go</span><span class="w"> </span><span class="no">build</span><span class="w"> </span><span class="no">hello.go</span>
<span class="nl">.PHONY:</span><span class="nf">build</span>
</code></pre></div>
<p>Typing <code>make</code> will run <code>fmt</code>, then <code>vet</code>, then <code>build</code> since the default task is <code>build</code>, which requires <code>vet</code> to have run first, which in turn requires <code>fmt</code> to have run first, which in turn has no dependency, so <code>fmt</code> runs and the chain continues.</p>
<ul>
<li>Testing whether a new version of Go works for existing programs compiled on an older version is straightforward:</li>
</ul>
<div class="highlight"><pre><span></span><code>go<span class="w"> </span>get<span class="w"> </span>golang.org/dl/go.1.x.y<span class="w">  </span><span class="c1"># replace x.y</span>
go1.x.y<span class="w"> </span>download

<span class="c1"># try out the changes</span>
go1.x.y<span class="w"> </span>build

<span class="c1"># If all good, remove this secondary version</span>
go1.x.y<span class="w"> </span>env<span class="w"> </span>GOROOT
/.../.../go1.x.y
rm<span class="w"> </span>-rf<span class="w"> </span><span class="k">$(</span>go1.x.y<span class="w"> </span>env<span class="w"> </span>GOROOT<span class="k">)</span>
rm<span class="w"> </span><span class="k">$(</span>go<span class="w"> </span>env<span class="w"> </span>GOPATH<span class="k">)</span>/bin/go1.x.y

<span class="c1"># Install new version as wanted...</span>
</code></pre></div>
<hr/>
<h1 id="predeclared-types-and-declarations">Predeclared Types and Declarations</h1>
<h2 id="predeclared-types">Predeclared types</h2>
<ul>
<li>Zero value<ul>
<li>Assigned to a variable that is declared with no initial value (doesn’t lead to bugs like in C or C++).</li>
</ul>
</li>
<li>Literals<ul>
<li>These express different bases, such as <code>0b</code> (binary), <code>0o</code> (octal) or <code>0x</code> (hexadecimal). As in other languages like Python or Java, underscores can be used to express large numbers by separating digits (e.g., <code>1_000_000</code>).</li>
<li>Floating point literals look like <code>6.03e23</code>.</li>
<li>Rune literals are represented with single quotes (no double quotes accepted). The most common ones are <code>('\n')</code>, tab <code>('\t')</code>, single quote <code>('\'')</code>, double quote <code>('\"')</code> and backslash <code>('\\')</code>. Other bases are supported but should be limited to specific contexts (e.g., bit filters for base two).</li>
<li>String literals can be written with double quotes, where everything must be escaped.</li>
<li>Raw string literals use backticks instead of double quotes and can be used to insert any character except a backtick. They support multiline expressions.</li>
</ul>
</li>
<li>Boolean<ul>
<li>The type is <code>bool</code> and the default zero value is <code>false</code>.</li>
</ul>
</li>
<li>Numeric types<ul>
<li>Integers<ul>
<li><code>int8</code> (aliased <code>byte</code>, which is much more common), <code>int16</code>, <code>int32</code>, <code>int64</code>, <code>uint8</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code>.</li>
<li>The zero value is 0.</li>
<li>Use the minimum size when needed for specific applications.</li>
<li>Use <code>int64</code> and <code>uint64</code> for library functions (suggested back when generics weren’t available).</li>
<li>Otherwise, just use <code>int</code>. Other types should be considered a premature optimization until proven otherwise.</li>
<li>Variables can be modified like so: <code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code> and <code>%=</code>.</li>
<li>Available comparisons are: <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, and <code>&lt;=</code>.</li>
<li>Bit manipulations<ul>
<li>Shifts: <code>&lt;&lt;</code> (left), <code>&gt;&gt;</code> (right)</li>
<li>Logical bit masks: <code>&amp;</code> (<code>AND</code>), <code>|</code> (<code>OR</code>), <code>^</code> (<code>XOR</code>), <code>&amp;^</code> (<code>AND NOT</code>)</li>
<li>These operators can be used to modify a variable as well: <code>&amp;=</code>, <code>|=</code>, <code>^=</code>, <code>&amp;^=</code>, <code>&lt;&lt;=</code>, <code>&gt;&gt;=</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Floating point types<ul>
<li><code>float32</code>, <code>float64</code>.</li>
<li>The zero value is 0.</li>
<li>If using a floating point number, opt for <code>float64</code> unless a profiler shows significant improvement with <code>float32</code> and the precision is good enough (6-7 decimal places).</li>
<li>Strict equality (or inequality) should not be done on floating point numbers: check the variance instead (less than epsilon).</li>
</ul>
</li>
<li>Complex types<ul>
<li><code>complex64</code> uses <code>float32</code> to represent real and imaginary parts, while <code>complex128</code> uses <code>float64</code>, using the <code>complex</code> built-in function and <code>real</code> and <code>image</code> functions to extract the relevant parts.</li>
<li>As with floating point numbers, use the epsilon technique to check for equality.</li>
</ul>
</li>
<li>Strings and runes<ul>
<li>The zero value is an empty string.</li>
<li>Strings are immutable.</li>
<li>Strings can be checked for equality or compared for ordering (<code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, or <code>&lt;=</code>) and can be concatenated with the <code>+</code> operator.</li>
<li>The <code>rune</code> type represents a single code point, equivalent to <code>int32</code>.</li>
</ul>
</li>
<li>Explicit type conversion<ul>
<li>All type conversions are explicit.</li>
<li>There is no concept of “truthiness” (e.g., <code>if 2: print("ok")</code> is valid in Python).</li>
</ul>
</li>
</ul>
<h2 id="var-vs"><code>var</code> vs. <code>:=</code></h2>
<p><code>var</code> is more verbose but flexible:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w">           </span><span class="c1">// because the default type is `int`</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="w">           </span><span class="c1">// no value =&gt; it will be the zero value</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">// multiple assignments</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="kt">int</span><span class="w">        </span><span class="c1">// multiple assignments, zero values</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">"hi"</span><span class="w">  </span><span class="c1">// different default types</span>

<span class="c1">// Declaration list</span>
<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nx">z</span><span class="w"> </span><span class="kt">string</span>
<span class="p">)</span>
</code></pre></div>
<p>Type inference can be performed within a function:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// These statements are equivalent</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span>
<span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="c1">// invalid syntax outside a function</span>
</code></pre></div>
<p>Avoid <code>:=</code> in the following situations:</p>
<ul>
<li>When explicitly initializing a <em>zero value</em>, like <code>var x int</code>.</li>
<li>To avoid a <em>type conversion</em>, by writing <code>var x byte = 8</code> instead of <code>x := byte(8)</code>.</li>
<li>To avoid “<em>shadowing</em>” a variable, as <code>:=</code> can be used to assign to existing variables. Create new variables with <code>var</code>.</li>
<li>Non-constant package-level variables are a bad idea. If they’re unused, they go unnoticed without raising compile-time errors.</li>
</ul>
<h2 id="const"><code>const</code></h2>
<ul>
<li>Variables cannot be declared as immutable.</li>
<li>Constants are a way of giving names to literals.</li>
<li>Inside a function, it is clear when a variable is being modified.</li>
<li>If a constant is typed (e.g., <code>const typedVar int = 1</code>), then it can only be assigned to that type, <code>int</code> in this case.</li>
<li>If a constant is untyped (e.g., <code>const untypedVar = 2</code>), then it can be assigned to suitable numerical types.</li>
</ul>
<h2 id="unused-variables">Unused variables</h2>
<ul>
<li>Unused declared local variables result in a compile-time error.</li>
</ul>
<h2 id="naming-variables-and-constants">Naming Variables and Constants</h2>
<ul>
<li>Even though many Unicode characters can be used, they should be avoided to maintain clarity.</li>
<li>Go uses camelCase.</li>
<li>The less scope a variable has, the shorter its name should be (<code>k</code> and <code>v</code> are accepted for key/value, just like <code>i</code> and <code>j</code> to use indices when iterating in loops).</li>
<li>It is common to use the first letter of a type as the variable name (e.g., <code>i</code> for integers, <code>f</code> for floats, <code>b</code> for boolean). If the code is hard to understand, it’s a sign the function is trying to do too much.</li>
</ul>
<hr/>
<h1 id="composite-types">Composite Types</h1>
<h2 id="arrays">Arrays</h2>
<ul>
<li>They are rarely used directly.</li>
<li>They can be compared (<code>==</code> and <code>!=</code>).</li>
<li>Their length is retrieved with the built-in <code>len</code> function.</li>
<li>Negative indexing is a compile-time error.</li>
<li>Out-of-bounds indexing results in a <strong>panic</strong> at runtime.</li>
<li>Unless there’s a very specific need to use a given size of array (e.g., for a cryptographic library), <em>avoid them</em>.</li>
<li>They exist basically to <em>provide slices</em>.<ul>
<li>There are a few ways of declaring arrays:</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// indicate the size and type</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="w"> </span><span class="c1">// 3 integers assigned to the zero value</span>

<span class="c1">// array literal</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">}</span><span class="w"> </span><span class="c1">// values specified</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">}</span><span class="w"> </span><span class="c1">// equivalent</span>

<span class="c1">// sparse array:</span>
<span class="c1">// indicate few values at specific locations</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">}</span>

<span class="c1">// Get and set values</span>
<span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div>
<h2 id="slices">Slices</h2>
<ul>
<li>The zero value for a slice is <code>nil</code>, which represents the lack of a value for some type. <code>nil</code> itself has no type.</li>
<li>The size of the array is not specified, making it a slice: <code>var x = []int{10, 20, 30}</code>. This is a slice literal.</li>
<li>Can be used like a sparse array: <code>var x = []int{1, 5: 4, 6, 10: 100, 15}</code>.</li>
<li>Multidimensional arrays can be simulated: <code>var x [][]int</code>.</li>
<li>Reads and assignments are the same as with arrays, using square brackets.</li>
<li>Slices can be created without assigning initial values: <code>var x []int</code>.</li>
<li>Slices aren’t comparable, except to check if it is nil (<code>x == nil</code>).</li>
<li>They’re useful for <em>sequential data</em>.</li>
</ul>
<h3 id="len"><code>len</code></h3>
<ul>
<li>A <code>nil</code> slice returns <code>0</code> (<code>len(x)</code>).</li>
</ul>
<h3 id="append"><code>append</code></h3>
<p>It it used to grow slices:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
<span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// returns a slice</span>
<span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="c1">// more than one value</span>

<span class="c1">// append to another slice with `...`</span>
<span class="c1">// Similar to the spread operator in JavaScript,</span>
<span class="c1">// but it goes after the value to spread</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">}</span>
<span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>
<h3 id="capacity">Capacity</h3>
<ul>
<li>It increases automatically as needed. It doubles under 1,024 items, then it increases by at least 25%.</li>
<li><code>cap</code> returns the current capacity of the slice.</li>
<li>It is better when possible to allocate the needed size upfront to avoid resizing the arrays.</li>
</ul>
<h3 id="make"><code>make</code></h3>
<ul>
<li>It can be used to create a slice that already has a capacity specified.<ul>
<li><code>x := make([]int, 5)</code>: length and capacity of 5 (all zero values). Using <code>append</code> here would add new values to the end of the slice, after the zero values!</li>
<li><code>x := make([]int, 0, 10)</code> creates an empty slice with a capacity of 10 and after <code>x = append(x, 5,6,7,8)</code>, it contains <code>[5 6 7 8]</code>.</li>
</ul>
</li>
</ul>
<h3 id="emptying-a-slice">Emptying a slice</h3>
<ul>
<li>Available since Go 1.21 with the built-in <code>clear</code> function.</li>
<li>This sets all elements of the slice to their zero value.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// [1 2 3 4]</span>
<span class="nx">clear</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// [0 0 0 0]</span>

<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"a"</span><span class="p">,</span><span class="w"> </span><span class="s">"b"</span><span class="p">,</span><span class="w"> </span><span class="s">"c"</span><span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// [a b c]</span>
<span class="nx">clear</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// [   ] (empty strings)</span>
</code></pre></div>
<h3 id="declaring-a-slice">Declaring a slice</h3>
<ul>
<li>Slice literals<ul>
<li>An empty slice literal declares a slice that is non-nil: <code>var x = []int{}</code>. This is useful to convert to <span class="caps">JSON</span>.</li>
<li>Useful with some initial values or when the values don’t change.</li>
</ul>
</li>
</ul>
<h3 id="slicing-slices">Slicing slices</h3>
<p>These work with square brackets:</p>
<div class="highlight"><pre><span></span><code><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span><span class="w"> </span><span class="c1">// [1 2 3 4]</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="w">             </span><span class="c1">// [1 2]</span>
<span class="nx">z</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="w">             </span><span class="c1">// [2 3 4]</span>
<span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="w">            </span><span class="c1">// [2 3]</span>
<span class="nx">e</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[:]</span><span class="w">              </span><span class="c1">// [1 2 3 4]</span>
</code></pre></div>
<h3 id="slices-can-share-data">Slices can share data</h3>
<div class="highlight"><pre><span></span><code><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="nx">z</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1">// These are bidirectional changes!</span>
<span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span><span class="w">  </span><span class="c1">// affects `x`, `y` and `z`</span>
<span class="nx">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="w">  </span><span class="c1">// affects `x` and `y`</span>
<span class="nx">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span><span class="w">  </span><span class="c1">// affects `x` and `z`</span>

<span class="c1">// Result:</span>
<span class="c1">// x: [10 20 30 4]</span>
<span class="c1">// y: [10 20]</span>
<span class="c1">// z: [20 30 4]</span>
</code></pre></div>
<p><code>append</code> can lead to unintuitive results, overwriting existing values:</p>
<div class="highlight"><pre><span></span><code><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w">    </span><span class="c1">// length 0, capacity 5</span>
<span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="c1">// x is now [1 2 3 4]</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="w">                </span><span class="c1">// [1 2], length 2, capacity 5</span>
<span class="nx">z</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="w">                </span><span class="c1">// [3 4], length 2, capacity 3</span>

<span class="nx">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
<span class="c1">// x is now [1 2 30 40], length 4, capacity 5!</span>
<span class="c1">// y is now [1 2 30 40 50], length 5, capacity 5</span>
<span class="c1">// z is now [30 40], length 2, capacity 3</span>

<span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span>
<span class="c1">// x is now [1 2 30 40 60], length 5, capacity 5</span>
<span class="c1">// y is now [1 2 30 40 60], length 5, capacity 5!</span>
<span class="c1">// z is still [30 40], length 2, capacity 3</span>

<span class="nx">z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">)</span>
<span class="c1">// x is now [1 2 30 40 70], length 5, capacity 5!</span>
<span class="c1">// y is now [1 2 30 40 70], length 5, capacity 5!</span>
<span class="c1">// z is now [30 40 70], length 3, capacity 3</span>
</code></pre></div>
<p>One way to avoid this issue is to use <em>full slice expressions</em> to indicate the capacity of the sub-slices:</p>
<div class="highlight"><pre><span></span><code><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="w">  </span><span class="c1">// take a slice of x, up to index 2, with a capacity of 2</span>
<span class="nx">z</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="c1">// take a slice of x, from index 2 to 4, with a capacity of 2</span>

<span class="nx">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
<span class="c1">// x is still [1 2 3 4], length 4, capacity 5</span>
<span class="c1">// y is now [1 2 30 40 50], length 5, capacity 6</span>
<span class="c1">// z is still [3 4], length 2, capacity 2</span>

<span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span>
<span class="c1">// x is now [1 2 3 4 60], length 5, capacity 5</span>
<span class="c1">// y is still [1 2 30 40 50], length 5, capacity 6</span>
<span class="c1">// z is still [3 4], length 2, capacity 2</span>

<span class="nx">z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">)</span>
<span class="c1">// x is still [1 2 3 4 60], length 5, capacity 5</span>
<span class="c1">// y is still [1 2 30 40 50], length 5, capacity 6</span>
<span class="c1">// z is now [3 4 70], length 3, capacity 4</span>
</code></pre></div>
<h3 id="converting-arrays-to-slices">Converting Arrays to Slices</h3>
<ul>
<li>Arrays can be sliced, though memory will be shared as when slicing a slice.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">}</span><span class="w"> </span><span class="c1">// [5 6 7 8]</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="w">              </span><span class="c1">// [5 6]</span>
<span class="nx">z</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="w">              </span><span class="c1">// [7 8]</span>
<span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="w">               </span><span class="c1">// [10 6 7 8]</span>
<span class="c1">// y and z are now [10 6] and [7 8]</span>
</code></pre></div>
<h3 id="converting-slices-to-arrays">Converting Slices to Arrays</h3>
<ul>
<li>Data in the slice is copied to new memory (slices and arrays remain independent).</li>
<li>A slice converted into a pointer to an array will share the same underlying data and memory address.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span><span class="w"> </span><span class="c1">// [1 2 3 4]</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="w">                 </span><span class="c1">// y is a slice, not a copy</span>
<span class="nx">z</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">    </span><span class="c1">// [0 0 0 0]</span>
<span class="nb">copy</span><span class="p">(</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w">             </span><span class="c1">// copy(dst, src)</span>
<span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="w">              </span><span class="c1">// [10 2 3 4]</span>
<span class="c1">// y is now [10 2 3 4]</span>
<span class="c1">// z is now [1 2 3 4]</span>
</code></pre></div>
<h3 id="copy"><code>copy</code></h3>
<ul>
<li>It creates a slice that is independent from the original slice.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// It can copy the whole slice if the lengths are the same</span>
<span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span><span class="w">    </span><span class="c1">// [1 2 3 4]</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">       </span><span class="c1">// [0 0 0 0]</span>
<span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">copy</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w">         </span><span class="c1">// num=4, copy(dst, src)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span><span class="w">       </span><span class="c1">// [1 2 3 4] 4</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w">            </span><span class="c1">// [1 2 3 4]</span>

<span class="c1">// It can copy a subset of the slice</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">       </span><span class="c1">// [0 0]</span>
<span class="nx">num</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">copy</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w">          </span><span class="c1">// num=2, copy(dst, src)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="w">            </span><span class="c1">// [1 2]</span>

<span class="c1">// It can copy from a subset from any position</span>
<span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span><span class="w">    </span><span class="c1">// [1 2 3 4]</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">       </span><span class="c1">// [0 0]</span>
<span class="nb">copy</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span><span class="w">            </span><span class="c1">// copy(dst, src)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="w">            </span><span class="c1">// [3 4]</span>

<span class="nx">num</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">copy</span><span class="p">(</span><span class="nx">x</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="w">  </span><span class="c1">// put the last 3 values at the beginning</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w">            </span><span class="c1">// [2 3 4 4], overwriting</span>

<span class="c1">// It also works with arrays</span>
<span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span><span class="w">    </span><span class="c1">// slice, [1 2 3 4]</span>
<span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">}</span><span class="w">   </span><span class="c1">// array, [5 6 7 8]</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">       </span><span class="c1">// [0 0]</span>
<span class="nb">copy</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">[:])</span><span class="w">             </span><span class="c1">// first 2 values of d into y</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="w">            </span><span class="c1">// [5 6]</span>
<span class="nb">copy</span><span class="p">(</span><span class="nx">d</span><span class="p">[:],</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w">             </span><span class="c1">// copy x into d</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w">            </span><span class="c1">// [1 2 3 4]</span>
</code></pre></div>
<h2 id="strings-and-runes-and-bytes">Strings and Runes and Bytes</h2>
<ul>
<li>Strings are arrays of bytes.</li>
<li>Single characters can be extracted from a string with an <em>index expression</em>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">"hello"</span>
<span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w">                 </span><span class="c1">// c is a byte, not a rune</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w">            </span><span class="c1">// 104</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%T\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w">     </span><span class="c1">// uint8 (i.e., byte)</span>

<span class="c1">// Need to be careful with indexing</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"Hello 😄"</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w">       </span><span class="c1">// could have expected 7, but it's 10</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nx">s</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span><span class="w"> </span><span class="c1">// He ���: the emoji is 4 bytes long</span>
</code></pre></div>
<h2 id="maps">Maps</h2>
<ul>
<li>The built-in map type is a <em>hash map</em> (implemented as an array).</li>
<li>The zero value for a map is <code>nil</code>.</li>
<li>Writing to a <code>nil</code> map results in a runtime panic.</li>
<li><code>len</code> on a map returns the number of key/value pairs.</li>
<li>Maps are not comparable (but they can check against <code>nil</code>).</li>
<li>The key must be comparable: it cannot be a slice, map or function.</li>
<li>Maps are good when the order of the keys doesn’t matter: use a slice when it does.</li>
<li>All the values must be of the same type, but <em>the keys can be of different types</em>.</li>
<li>Avoid using them as input parameters to functions (use a struct instead to be self-documenting).</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">nilMap</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="c1">//             ^      ^</span>
<span class="c1">//      key type      value type</span>

<span class="c1">// map literal: length of 0</span>
<span class="nx">myMap</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{}</span><span class="w">  </span><span class="c1">// allows reads and writes</span>

<span class="c1">// Non-empty map</span>
<span class="nx">reposByOrg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">    </span><span class="s">"dbeaver"</span><span class="p">:</span><span class="w">   </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"dbeaver"</span><span class="p">,</span><span class="w"> </span><span class="s">"cloudbeaver"</span><span class="p">,</span><span class="w"> </span><span class="s">"team-edition-deploy"</span><span class="p">},</span>
<span class="w">    </span><span class="s">"slidevjs"</span><span class="p">:</span><span class="w">  </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"slidev"</span><span class="p">,</span><span class="w"> </span><span class="s">"slidev-vscode"</span><span class="p">,</span><span class="w"> </span><span class="s">"themes"</span><span class="p">},</span>
<span class="w">    </span><span class="s">"ReactiveX"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"RxJava"</span><span class="p">,</span><span class="w"> </span><span class="s">"rxjs"</span><span class="p">,</span><span class="w"> </span><span class="s">"RxGo"</span><span class="p">},</span><span class="w"> </span><span class="c1">// comma at the end here too</span>
<span class="p">}</span>

<span class="c1">// With a default size</span>
<span class="nx">myValues</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">][]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// length 0, capacity 10, can grow beyond 10</span>
</code></pre></div>
<h3 id="reading-and-writing-maps">Reading and writing maps</h3>
<div class="highlight"><pre><span></span><code><span class="nx">reposByOrgStars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{}</span><span class="w">    </span><span class="c1">// length 0, can grow, string to integer</span>
<span class="nx">reposByOrgStars</span><span class="p">[</span><span class="s">"dbeaver"</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="w">        </span><span class="c1">// write</span>
<span class="nx">reposByOrgStars</span><span class="p">[</span><span class="s">"slidevjs"</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="w">      </span><span class="c1">// write</span>
<span class="nx">reposByOrgStars</span><span class="p">[</span><span class="s">"ReactiveX"</span><span class="p">]</span><span class="o">++</span><span class="w">         </span><span class="c1">// read, increment, write (0 -&gt; 1)</span>
<span class="c1">// reposByOrgStars["slidevjs"] := 100  // invalid syntax</span>
</code></pre></div>
<h3 id="comma-ok-idiom">Comma Ok idiom</h3>
<ul>
<li>One can get the value of a key and a boolean indicating whether the key exists or not:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reposByOrgStars</span><span class="p">[</span><span class="s">"dbeaver"</span><span class="p">]</span><span class="w">  </span><span class="c1">// 10 true</span>
<span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">reposByOrgStars</span><span class="p">[</span><span class="s">"notfound"</span><span class="p">]</span><span class="w">  </span><span class="c1">// 0 false</span>
</code></pre></div>
<h3 id="deleting-from-a-map">Deleting from a map</h3>
<ul>
<li><code>delete</code> removes a key/value pair from a map:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nb">delete</span><span class="p">(</span><span class="nx">reposByOrgStars</span><span class="p">,</span><span class="w"> </span><span class="s">"ReactiveX"</span><span class="p">)</span>

<span class="c1">// It is safe to delete a key that doesn't exist</span>
<span class="nb">delete</span><span class="p">(</span><span class="nx">reposByOrgStars</span><span class="p">,</span><span class="w"> </span><span class="s">"notfound"</span><span class="p">)</span><span class="w">  </span><span class="c1">// it returns nothing</span>

<span class="c1">// It is safe to delete a key from a nil map</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">nilMap</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="nb">delete</span><span class="p">(</span><span class="nx">nilMap</span><span class="p">,</span><span class="w"> </span><span class="s">"notfound"</span><span class="p">)</span>

<span class="c1">// It is safe to delete a key from an empty map</span>
<span class="nx">emptyMap</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{}</span>
<span class="nb">delete</span><span class="p">(</span><span class="nx">emptyMap</span><span class="p">,</span><span class="w"> </span><span class="s">"notfound"</span><span class="p">)</span>
</code></pre></div>
<h3 id="using-maps-as-sets">Using maps as sets</h3>
<ul>
<li>Go doesn’t have a built-in set type.</li>
<li>A map can be used as a set by using the key as the value and the value as a boolean:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">mySet</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{}</span>
<span class="nx">mySet</span><span class="p">[</span><span class="s">"hello"</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="nx">mySet</span><span class="p">[</span><span class="s">"world"</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="nx">mySet</span><span class="p">[</span><span class="s">"hello"</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="c1">// no error, but it's still a set</span>
</code></pre></div>
<ul>
<li>This works because if the value isn’t found, the zero value is returned, which is <code>false</code> for booleans.</li>
<li>To use operations like <code>union</code>, <code>intersection</code> and <code>difference</code>, the most convenient solution is to use a third-party library.</li>
<li>Structs can also be used as sets as they’re more memory efficient, but more clumsy to use as they make use of the <em>comma ok idiom</em>.</li>
</ul>
<h2 id="structs">Structs</h2>
<ul>
<li>Good when there is related data that needs to be grouped together.</li>
<li>They are defined with the <code>type</code> keyword.</li>
<li>No commas are needed between fields.</li>
<li>They can be defined inside or outside of a function. If inside a function, they can only be used inside that function.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">age</span><span class="w">       </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">firstName</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">lastName</span><span class="w">  </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="nx">user</span><span class="w">      </span><span class="c1">// zero value for a struct is all zero values for its fields</span>
<span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">18</span>
<span class="nx">u</span><span class="p">.</span><span class="nx">firstName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"Bob"</span>
<span class="nx">u</span><span class="p">.</span><span class="nx">lastName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"Michigan"</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span><span class="w">  </span><span class="c1">// {18 Bob Michigan}</span>

<span class="c1">// Assignments can also be done with a struct literal</span>
<span class="nx">bob</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">{}</span><span class="w">   </span><span class="c1">// also initializes all fields to zero values</span>

<span class="c1">// With initial values</span>
<span class="nx">jeremy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">{</span>
<span class="w">    </span><span class="mi">49</span><span class="p">,</span><span class="w">         </span><span class="c1">// must match the order of the fields</span>
<span class="w">    </span><span class="s">"Jeremy"</span><span class="p">,</span><span class="w">   </span><span class="c1">// all fields must be specified</span>
<span class="w">    </span><span class="s">"Stretchy"</span><span class="p">,</span>
<span class="p">}</span><span class="w">               </span><span class="c1">// {49 Jeremy Stretchy}</span>

<span class="c1">// With this style, fields can be left out:</span>
<span class="nx">otherUser</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">{</span>
<span class="w">    </span><span class="nx">age</span><span class="p">:</span><span class="w">       </span><span class="mi">32</span><span class="p">,</span><span class="w">        </span><span class="c1">// using the field name...</span>
<span class="w">    </span><span class="nx">firstName</span><span class="p">:</span><span class="w"> </span><span class="s">"Sweaty"</span><span class="p">,</span><span class="w">  </span><span class="c1">// cannot indicate other fields without the field name</span>
<span class="w">    </span><span class="c1">// lastName is zero value, i.e., empty string</span>
<span class="p">}</span>

<span class="c1">// Accessing a field:</span>
<span class="nx">jeremy</span><span class="p">.</span><span class="nx">firstName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"Jer"</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">jeremy</span><span class="p">.</span><span class="nx">firstName</span><span class="p">)</span><span class="w"> </span><span class="c1">// Jer</span>
</code></pre></div>
<h3 id="anonymous-structs">Anonymous structs</h3>
<ul>
<li>They are useful when a struct is only used in one place.</li>
<li>Useful when <a href="https://en.wikipedia.org/wiki/Marshalling_(computer_science)">marshalling</a> and unmarshalling data.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">computer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">operatingSystem</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">chip</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}{</span>
<span class="w">    </span><span class="nx">operatingSystem</span><span class="p">:</span><span class="w"> </span><span class="s">"macOS"</span><span class="p">,</span>
<span class="w">    </span><span class="nx">chip</span><span class="p">:</span><span class="w"> </span><span class="s">"Apple M2 Ultra"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="comparing-and-converting-structs">Comparing and converting structs</h3>
<ul>
<li>Contrary to regular structs, they can be compared.</li>
</ul>
<hr/>
<h1 id="blocks-shadows-and-control-structures">Blocks, Shadows, and Control Structures</h1>
<h2 id="blocks">Blocks</h2>
<ul>
<li>A block is a place where declarations are made.</li>
<li>The top-level block is the <em>package</em> block.</li>
<li>The import statements are in the <em>file</em> block.</li>
</ul>
<h2 id="shadowing-variables">Shadowing Variables</h2>
<ul>
<li>There is a “global” block, the <em>universe</em> block, which contains the built-in functions and types. Careful: those keywords can be shadowed!</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<span class="w">        </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">5</span><span class="w">  </span><span class="c1">// shadowing</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// x is still 10 here (outer block)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// x is shadowed while y is declared!</span>
<span class="w">        </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w">  </span><span class="c1">// 5 20</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w">         </span><span class="c1">// 10</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">"shadowing fmt package"</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">fmt</span><span class="p">)</span><span class="w">       </span><span class="c1">// undefined!</span>
<span class="p">}</span>
</code></pre></div>
<p>Linters typically won’t catch shadowing, but we can install <code>shadow</code>:</p>
<div class="highlight"><pre><span></span><code>go<span class="w"> </span>install<span class="w"> </span>golang.org/x/tools/go/analysis/passes/shadow/cmd/shadow@latest
</code></pre></div>
<p>And we can make it part of the <code>Makefile</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nf">lint</span><span class="o">:</span><span class="w"> </span><span class="n">fmt</span>
<span class="w">    </span>golint<span class="w"> </span>./...
<span class="w">    </span>shadow<span class="w"> </span>./...
<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">lint</span>
</code></pre></div>
<h2 id="if-statements"><code>if</code> statements</h2>
<ul>
<li>The condition must be a boolean expression.</li>
<li>The usual flow is <code>if ... {...} else if ... { ... } else { ... }</code>.</li>
<li>There are no parentheses around the condition.</li>
<li>Variables can be scoped to the <code>if</code> statement (they’ll be available in <code>else if</code> and <code>else</code> blocks as well). Only use that feature to define new variables!</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"That's too low"</span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"That's too big:"</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"That's a good number:"</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// n is not available here!</span>
</code></pre></div>
<h2 id="for-loops"><code>for</code> loops</h2>
<ul>
<li>It is the only looping construct in the language.</li>
<li>It can be used in four different ways to accomplish all looping needs.</li>
<li>It uses no parentheses.</li>
</ul>
<h3 id="complete-for-statement">Complete <code>for</code> statement</h3>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>The initialization statement is executed once before the loop starts. It must use the <code>:=</code> operator. It can shadow variables.</li>
<li>The second statement is the condition. It must be a boolean expression. It is checked before each iteration as well as before the loops starts.</li>
<li>The third statement is the post statement. It is executed after each iteration. It would usually be used to increment a counter.</li>
</ul>
<h3 id="condition-only-for-statement">Condition-only <code>for</code> Statement</h3>
<div class="highlight"><pre><span></span><code><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">    </span><span class="nx">i</span><span class="o">++</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>This is a statement that only has a condition. It is equivalent to a <code>while</code> loop in other languages.</li>
</ul>
<h3 id="infinite-for-statement">Infinite <code>for</code> Statement</h3>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>This is a statement that has no condition. It is equivalent to a <code>while true</code> loop in other languages.</li>
</ul>
<h3 id="break-and-continue"><code>break</code> and <code>continue</code></h3>
<ul>
<li>There is no <code>do... while</code> construct as in other languages like C, Java or JavaScript.</li>
<li><code>do... while</code> indicates how to <em>stay</em> in the loop while <code>for</code> indicates how to <em>leave</em> the loop.</li>
<li><code>break</code> exits the loop.</li>
<li><code>continue</code> skips the rest of the loop and goes to the next iteration. Use it to avoid nesting loops.</li>
<li><code>break</code> and <code>continue</code> can be used with labels to break out of nested loops.</li>
</ul>
<h3 id="for-range-loop"><code>for-range</code> loop</h3>
<div class="highlight"><pre><span></span><code><span class="nx">odds</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">odds</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Here, <code>i</code> (<code>0</code> to <code>4</code>) is the index of the iterator construct and <code>v</code> (<code>1, 3 ... 9</code>) is the value.</li>
<li><code>i</code> is usually used for arrays, slices and strings, while <code>k</code> is used for maps.</li>
<li>As in other languages like Python, use an underscore (<code>_</code>) to ignore a value. The index or key can be ignored this way.</li>
<li>If the key is needed but not the value, leave the value out: <code>for k := range myMap { ... }</code>. This is useful when using a map as a set.</li>
</ul>
<h4 id="iterating-over-maps">Iterating over maps</h4>
<div class="highlight"><pre><span></span><code><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">"a"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">"c"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">"b"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Loop"</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="c1">// order will differ</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span><span class="w"> </span><span class="c1">// will be in ascending order to help with debugging</span>
</code></pre></div>
<ul>
<li>For security reasons (hash DoS), the order of the keys is randomized. If the order is important, use a slice of keys instead.</li>
</ul>
<h4 id="iterating-over-strings">Iterating over strings</h4>
<ul>
<li>Go iterates over the Unicode code points (runes), not the bytes.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">samples</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"hello"</span><span class="p">,</span><span class="w"> </span><span class="s">"worl∂!"</span><span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">sample</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">samples</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">sample</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">()</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">Output:</span>
<span class="cm">0 104 h        // index, rune, string(rune)</span>
<span class="cm">1 101 e</span>
<span class="cm">2 108 l</span>
<span class="cm">3 108 l</span>
<span class="cm">4 111 o</span>
<span class="cm">               // first string is 5 runes long</span>
<span class="cm">0 119 w</span>
<span class="cm">1 111 o</span>
<span class="cm">2 114 r</span>
<span class="cm">3 108 l</span>
<span class="cm">4 8706 ∂       // this is a single rune: it occupies 3 bytes</span>
<span class="cm">7 33 !         // index 7! The second string is 8 runes long</span>
<span class="cm">*/</span>
</code></pre></div>
<h4 id="for-range-value-is-a-copy"><code>for-range</code> value is a copy</h4>
<ul>
<li>Modifying the value variable doesn’t change the original value.</li>
<li><code>break</code> and <code>continue</code> are also available in this form.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">odds</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">odds</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">v</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span>
<span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">odds</span><span class="p">)</span><span class="w"> </span><span class="c1">// [1 3 5 7 9]</span>
</code></pre></div>
<h3 id="for-loop-labels"><code>for</code> loop labels</h3>
<ul>
<li>While their use is rare, they can be used to break out of nested loops.</li>
<li>The label is indented to the same level as the containing block.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nx">samples</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"hello"</span><span class="p">,</span><span class="w"> </span><span class="s">"worl∂!"</span><span class="p">}</span>
<span class="nx">outer</span><span class="p">:</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">sample</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">samples</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">sample</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">'l'</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">continue</span><span class="w"> </span><span class="nx">outer</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="cm">/* Output:</span>
<span class="cm">0 104 h</span>
<span class="cm">1 101 e</span>
<span class="cm">2 108 l</span>
<span class="cm">0 119 w</span>
<span class="cm">1 111 o</span>
<span class="cm">2 114 r</span>
<span class="cm">3 108 l</span>
<span class="cm">*/</span>
</code></pre></div>
<p>This code will skip the remaining letters of both words once the first <code>l</code> is printed out for each one.</p>
<h3 id="the-right-for-statement">The right <code>for</code> statement</h3>
<ul>
<li><code>for-range</code> is the proper way to iterate over strings to get runes.</li>
<li>A complete <code>for</code> statement is good when not iterating through all the items in a collection (except for strings since runes aren’t necessarily one byte long).</li>
<li>The condition-only <code>for</code> statement is used to replace <code>while</code> loops.</li>
<li>Infinite loops can simulate a <code>do... while</code> construct and can be used to create the iterator pattern.</li>
</ul>
<h2 id="expression-switch-statements">Expression <code>switch</code> statements</h2>
<ul>
<li>They don’t use parentheses.</li>
<li>Used to check for equality.</li>
<li>Scoped variables can be declared (e.g., <code>word</code> is scoped to all cases).</li>
<li>All cases are part of the same block (only the switch statement itself is a block surrounded by braces).</li>
<li>No need for <code>break</code> statements. It can be used, but may indicate a code smell.</li>
<li><code>break</code> can be useful if the <code>switch</code> statement is inside a loop.</li>
<li>There is a <code>fallthrough</code> keyword to go to the next case (<em>not recommended</em>).</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">words</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Go"</span><span class="p">,</span><span class="w"> </span><span class="s">"Ada"</span><span class="p">,</span><span class="w"> </span><span class="s">"COBOL"</span><span class="p">,</span><span class="w"> </span><span class="s">"C++"</span><span class="p">,</span><span class="w"> </span><span class="s">"Python"</span><span class="p">,</span><span class="w"> </span><span class="s">"Clojure"</span><span class="p">,</span><span class="w"> </span><span class="s">"WebAssembly"</span><span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">word</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">words</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">word</span><span class="p">);</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span><span class="w">                            </span><span class="c1">// catches multiple matches</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span><span class="w"> </span><span class="s">"is a short name!"</span><span class="p">)</span><span class="w">   </span><span class="c1">// Go, Ada, C++</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">5</span><span class="p">:</span>
<span class="w">        </span><span class="nx">wordLen</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">word</span><span class="p">)</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span><span class="w"> </span><span class="s">"is the right length:"</span><span class="p">,</span><span class="w"> </span><span class="nx">wordLen</span><span class="p">)</span><span class="w">  </span><span class="c1">// COBOL</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">:</span><span class="w">  </span><span class="c1">// empty case, nothing happens: Python, Clojure</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span><span class="w"> </span><span class="s">"is a long name!"</span><span class="p">)</span><span class="w">    </span><span class="c1">// WebAssembly</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Inside a loop</span>
<span class="nx">loop</span><span class="p">:</span><span class="w"> </span><span class="c1">// label</span>
<span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">i</span><span class="o">%</span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="s">"is even"</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">i</span><span class="o">%</span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="s">"is divisible by 3 but not 2"</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">i</span><span class="o">%</span><span class="mi">7</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"exit the loop!"</span><span class="p">)</span>
<span class="w">        </span><span class="k">break</span><span class="w"> </span><span class="nx">loop</span><span class="w">  </span><span class="c1">// break out of the loop, not just the switch statement</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="s">"is boring"</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="blank-switch-statements">Blank <code>switch</code> statements</h2>
<ul>
<li>Instead of checking for equality, they check for any boolean comparison.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">x</span><span class="o">%</span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="s">"is even"</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">6</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="s">"is large"</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">6</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Got it!"</span><span class="p">)</span><span class="w"> </span><span class="c1">// this is the one that will be executed</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="s">"Not it..."</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="if-or-switch"><code>if</code> or <code>switch</code>?</h2>
<ul>
<li><code>switch</code> should be used when there is some relationship between comparable elements. It is more concise and makes the comparisons more obvious.</li>
</ul>
<h2 id="goto"><code>goto</code></h2>
<ul>
<li>It should generally be avoided.</li>
<li>It can be used to replace boolean flags, such as in <a href="https://cs.opensource.google/go/go/+/refs/tags/go1.21.2:src/strconv/atof.go">this non-trivial example</a> from the standard library.</li>
</ul>
<hr/>
<h1 id="functions">Functions</h1>
<h2 id="declaring-and-calling-them">Declaring and calling them</h2>
<ul>
<li>Go has no classes, but it has methods (see <a href="#chapter-7-types-methods-and-interfaces">chapter 7</a>).</li>
<li>Types are mandatory.</li>
<li>The <code>return</code> keyword is mandatory (except for <code>main</code>) if the function has a return type.</li>
<li>Nothing goes between the input parameters and the start of the block if there’s no return type.</li>
<li>Go has no named or optional input parameters: you can pass structs instead. In practice, that probably means the function is trying to do too much if you need this feature.</li>
<li>Go supports variadic parameters (e.g., the <code>fmt.Println</code> function) with <code>...</code> right before the type: they are used as a slice inside the function.</li>
<li>Functions can return multiple values. They must all be returned, comma-separated. Unlike Python which uses tuples, Go uses the comma to separate the individual values.</li>
<li>The error is always the last parameter a function will return. If no error occurred, it will be <code>nil</code>.</li>
<li>Indicate ignored values (possibly all) with an underscore. A notable exception is <code>fmt.Println</code> which returns two values that aren’t usually used.</li>
<li>Named values can be returned. They make shadowing possible and should be used sparingly.</li>
<li>Blank returns can be returned with named values, but they make it harder to understand how data flows.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">div</span><span class="p">(</span><span class="nx">numerator</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">denominator</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="c1">//   ^   ^                          ^    ^</span>
<span class="c1">//   |   input parameter            |    return type</span>
<span class="c1">//   Function name                  parameter type</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">denominator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">numerator</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">denominator</span>
<span class="p">}</span>

<span class="c1">// The following is equivalent when the types are the same</span>
<span class="c1">// func div(numerator, denominator int) int ...</span>

<span class="c1">// variadic parameter</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">addTo</span><span class="p">(</span><span class="nx">base</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="w"> </span><span class="o">...</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">out</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">vals</span><span class="p">))</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">vals</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">out</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">out</span><span class="p">,</span><span class="w"> </span><span class="nx">base</span><span class="o">+</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">out</span>
<span class="p">}</span>
<span class="c1">// fmt.Println(addTo(1, 2, 3, 4))</span>
<span class="c1">// a := []int{4, 3}</span>
<span class="c1">// fmt.Println(addTo(3, a...))</span>
<span class="c1">// fmt.Println(addTo(3, []int{4, 5}...))</span>

<span class="c1">// named return values</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">divAndRemainder</span><span class="p">(</span><span class="nx">numerator</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">denominator</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">remainder</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h2 id="functions-are-values">Functions are values</h2>
<ul>
<li>Functions can be defined as types, e.g., <code>type aFuncType func(int, int) int</code>.</li>
<li>Anonymous functions can be defined inside other functions and called immediately (<span class="caps">IIFE</span>). This comes in handy when using <a href="#defer"><code>defer</code></a> and <a href="#chapter-10-concurrency-in-go">Goroutines</a>.</li>
</ul>
<h3 id="closures">Closures</h3>
<ul>
<li>Closures are used to create functions that have access to variables that are outside of their scope.</li>
<li>Functions can be passed as parameters to other functions.</li>
<li>Functions can return functions.</li>
<li>They are useful with <code>sort.Search</code> and <code>sort.Slice</code>.</li>
</ul>
<p>An example of closure is with the <code>sort.Slice</code> function:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">"fmt"</span>
<span class="w">    </span><span class="s">"sort"</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">FirstName</span><span class="w"> </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">LastName</span><span class="w">  </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">Age</span><span class="w">       </span><span class="kt">int</span>
<span class="w">        </span><span class="nx">HasPet</span><span class="w">    </span><span class="kt">bool</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">people</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">Person</span><span class="p">{</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Pat"</span><span class="p">,</span><span class="w"> </span><span class="s">"Patterson"</span><span class="p">,</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Tracy"</span><span class="p">,</span><span class="w"> </span><span class="s">"Bobbert"</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Fred"</span><span class="p">,</span><span class="w"> </span><span class="s">"Fredson"</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Bob"</span><span class="p">,</span><span class="w"> </span><span class="s">"Tracier"</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Alice"</span><span class="p">,</span><span class="w"> </span><span class="s">"Anderson"</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">people</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// `people` is captured by the closure</span>
<span class="w">    </span><span class="nx">sort</span><span class="p">.</span><span class="nx">Slice</span><span class="p">(</span><span class="nx">people</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// If one person has a pet and the other doesn't,</span>
<span class="w">        </span><span class="c1">// prioritize the one with the pet.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">people</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">HasPet</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">people</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">HasPet</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">people</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">HasPet</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// If both have pets, sort by LastName.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">people</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">HasPet</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">people</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">HasPet</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">people</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">LastName</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">people</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">LastName</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Otherwise, sort by age in ascending order.</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">people</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Age</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">people</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">Age</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">people</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// This returns:</span>
<span class="c1">// - People that have pets first</span>
<span class="c1">// - If both have pets, sort by last name in ascending order</span>
<span class="c1">// - If neither have pets, sort by age in ascending order</span>

<span class="c1">// Unsorted:</span>
<span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Pat</span><span class="w"> </span><span class="nx">Patterson</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Tracy</span><span class="w"> </span><span class="nx">Bobbert</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Fred</span><span class="w"> </span><span class="nx">Fredson</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Bob</span><span class="w"> </span><span class="nx">Tracier</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Alice</span><span class="w"> </span><span class="nx">Anderson</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span>
<span class="p">]</span>

<span class="c1">// Sorted:</span>
<span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Alice</span><span class="w"> </span><span class="nx">Anderson</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Fred</span><span class="w"> </span><span class="nx">Fredson</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Pat</span><span class="w"> </span><span class="nx">Patterson</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Bob</span><span class="w"> </span><span class="nx">Tracier</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span><span class="nx">Tracy</span><span class="w"> </span><span class="nx">Bobbert</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<p>A function that returns a function:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">withTwo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getResult</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="nx">withThree</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getResult</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"i="</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="s">"withTwo (2 + i):"</span><span class="p">,</span><span class="w"> </span><span class="nx">withTwo</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span><span class="w"> </span><span class="s">"withThree (3 + i):"</span><span class="p">,</span><span class="w"> </span><span class="nx">withThree</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">getResult</span><span class="p">(</span><span class="nx">initialValue</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">subsequent</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">initialValue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">subsequent</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Output:</span>
<span class="c1">// i= 0 withTwo (2 + i): 2 withThree (3 + i): 3</span>
<span class="c1">// i= 1 withTwo (2 + i): 3 withThree (3 + i): 4</span>
<span class="c1">// i= 2 withTwo (2 + i): 4 withThree (3 + i): 5</span>
</code></pre></div>
<h3 id="defer"><code>defer</code></h3>
<ul>
<li>This is used to perform the cleanup code, such as closing a file, after a function has returned. This is similar to the <code>finally</code> block in Java or Python but it executes at the very end of the function, not as part of a <code>try...except</code> block.</li>
<li>It delays the execution of a function until the surrounding function returns.</li>
<li>They run in <span class="caps">LIFO</span> (last in, first out) order.</li>
<li>The code that runs after <code>defer</code> is literally the last thing that runs before the function returns, so what is put there is immediately “called” (e.g., <code>defer close()</code>) but will run until later.</li>
<li>It helps reduce depth of nesting, which, along with “lack of structure”, are two of the most important factors that contribute to code complexity (see <a href="https://link.springer.com/article/10.1007/s10664-017-9508-2">this paper</a>).</li>
</ul>
<h3 id="go-is-call-by-value">Go is “call by value”</h3>
<ul>
<li>Go always makes a copy of the value before passing it to a function.</li>
<li>Maps and slices behave differently because they are implemented with pointers.</li>
</ul>
<hr/>
<h1 id="pointers">Pointers</h1>
<ul>
<li><em>A pointer is a variable that holds the address of a value in memory</em>.</li>
<li>The zero value of a pointer is <code>nil</code>.</li>
<li><code>&amp;</code> is the <em>address-of operator</em>. It goes before the variable name to get its address.</li>
<li><code>*</code> is the <em>indirection operator</em> (dereference). It goes before a pointer to get the value it points to.</li>
<li>Dereferencing a <code>nil</code> pointer will result in a runtime panic.</li>
<li>Types with an <code>*</code> are pointers to that type (“pointer type”).</li>
<li><code>new</code> is a built-in function that allocates memory for a type and returns a pointer to it.</li>
<li>To turn a constant into a pointer, use a helper function that takes a value and returns a pointer to it.</li>
<li>A pointer is used to indicate that a parameter is mutable, i.e., that the function can modify the original value.</li>
<li>To update the value of a pointer inside a function, dereference it and assign it a new value.</li>
<li>Value types should be preferred when returning from functions.</li>
<li>Use a pointer as a return type when there is a need to return a modified data structure or when the data being passed around is very large (at least 1 <span class="caps">MB</span>).</li>
<li>Slices can be used as buffers when iterating over files to avoid allocating memory in each iteration of the loop.</li>
<li>The garbage collector will free memory that is no longer used. Go favors low latency over high throughput.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">x</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w">   </span><span class="c1">// 10 0xc0000b4008</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// 0xc0000b4008 10</span>

<span class="c1">// The zero value of a pointer is nil</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="c1">// nil</span>

<span class="c1">// Dereferencing a nil pointer will result in a runtime panic</span>
<span class="c1">// fmt.Println(*z) // panic: runtime error: invalid memory address or nil pointer dereference</span>

<span class="c1">// new allocates memory for a type and returns a pointer to it</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 0xc0000b4010</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 0</span>

<span class="c1">// To turn a constant into a pointer, use a helper function that takes a value</span>
<span class="c1">// and returns a pointer to it</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">intPtr</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">i</span>
<span class="p">}</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">intPtr</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1">// A pointer is used to indicate that a parameter is mutable</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">addOne</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">*</span><span class="nx">x</span><span class="o">++</span>
<span class="p">}</span>
<span class="nx">addOne</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="c1">// 11</span>

<span class="c1">// To update the value of a pointer inside a function, dereference it and assign it a new value</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">updatePointer</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">*</span><span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span>
<span class="p">}</span>
<span class="nx">updatePointer</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="c1">// 2</span>
</code></pre></div>
<hr/>
<h1 id="types-methods-and-interfaces">Types, Methods, and Interfaces</h1>
<ul>
<li>Types can be declared at any level, including at the package level.</li>
</ul>
<h2 id="methods">Methods</h2>
<ul>
<li>Method names cannot be overloaded.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">FirstName</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">LastName</span><span class="w">  </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">       </span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">String</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="c1">//    ^</span>
<span class="c1">//    p is a receiver of the String method</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"%s %s, age %d"</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">FirstName</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">LastName</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">Age</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="s">"Domi"</span><span class="p">,</span><span class="w"> </span><span class="s">"Noes"</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span><span class="w">  </span><span class="c1">// Domi Noes, age 42</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pointer-receivers-and-value-receivers">Pointer Receivers and Value Receivers</h3>
<ul>
<li>Use a <em>pointer receiver</em> when the method needs to modify the receiver.</li>
<li>Use a <em>pointer receiver</em> when <code>nil</code> must be handled.</li>
<li>A <em>value receiver</em> is used when the method doesn’t need to modify the receiver.</li>
<li>If a type has a pointer receiver, all methods should have pointer receivers for consistency.</li>
<li>Usually, there’s no need for getters and setters when using structs: just use the fields directly.</li>
<li>Pointer receiver methods should check for <code>nil</code> values.</li>
</ul>
<h3 id="methods-are-also-functions">Methods are also functions</h3>
<ul>
<li>We can use a <em>method value</em> to turn a method into a function.</li>
<li>A <em>method expression</em> is used to turn a method into a function that takes the receiver as the first parameter.</li>
<li>They can be use for dependency injection.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Using a method value</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="s">"Domi"</span><span class="p">,</span><span class="w"> </span><span class="s">"Noes"</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">}</span>
<span class="w">    </span><span class="nx">f</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">String</span><span class="w">     </span><span class="c1">// using an instance of the struct</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">f</span><span class="p">())</span><span class="w">  </span><span class="c1">// Domi Noes, age 42</span>
<span class="p">}</span>

<span class="c1">// Using a method expression</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="s">"Domi"</span><span class="p">,</span><span class="w"> </span><span class="s">"Noes"</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">}</span>
<span class="w">    </span><span class="nx">f</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">.</span><span class="nx">String</span><span class="w"> </span><span class="c1">// using the type itself</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span><span class="w">  </span><span class="c1">// Domi Noes, age 42</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="functions-vs-methods">Functions vs. methods</h3>
<ul>
<li>Use a function when there is no need to modify the receiver.</li>
<li>Use a method with a struct receiver when there is a need to modify data at runtime.</li>
</ul>
<h3 id="type-declarations-are-not-inheritance">Type declarations are not inheritance</h3>
<ul>
<li>Declaring a type based on another type is not inheritance: there is no hierarchy.</li>
<li>Type conversion is used to convert a value from one type to another.</li>
</ul>
<h3 id="types-serve-as-executable-documentation">Types serve as executable documentation</h3>
<ul>
<li>They can be used to make code more readable and self-documenting.</li>
<li>A <code>Percentage</code> type can be used to make it clear what a value is instead of an <code>int</code>.</li>
</ul>
<h3 id="use-iota-for-enumeration-sparingly">Use iota for enumeration (sparingly)</h3>
<ul>
<li>Go does not have an enumeration type.</li>
<li><code>iota</code> is a built-in constant generator that starts at <code>0</code> and increments by <code>1</code> for each subsequent constant.</li>
<li><code>iota</code> can be used to create a set of constants that are related to each other.</li>
<li>It should be used for “internal” purposes only, when the constants are referred to by name — not by value.</li>
<li>It is useful to differentiate between sets of values, not to rely explicitly on the values themselves.</li>
<li>If the first value in the constant block (with value <code>0</code>) is not really initialized or the value <code>0</code> does not make sense, it can be named with an <code>_</code> to skip <code>0</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Color</span><span class="w"> </span><span class="kt">int</span>

<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">Red</span><span class="w"> </span><span class="nx">Color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">iota</span>
<span class="w">    </span><span class="nx">Green</span>
<span class="w">    </span><span class="nx">Blue</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Red</span><span class="p">,</span><span class="w"> </span><span class="nx">Green</span><span class="p">,</span><span class="w"> </span><span class="nx">Blue</span><span class="p">)</span><span class="w"> </span><span class="c1">// 0 1 2</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="embedding-for-composition">Embedding for composition</h3>
<ul>
<li>Types can be embedded to encourage composition.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">FirstName</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">LastName</span><span class="w">  </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">       </span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Employee</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Person</span><span class="w">         </span><span class="c1">// embedded field</span>
<span class="w">    </span><span class="nx">EmployeeID</span><span class="w"> </span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">e</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Employee</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Person</span><span class="p">:</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span>
<span class="w">            </span><span class="nx">FirstName</span><span class="p">:</span><span class="w"> </span><span class="s">"Domi"</span><span class="p">,</span>
<span class="w">            </span><span class="nx">LastName</span><span class="p">:</span><span class="w">  </span><span class="s">"Noes"</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Age</span><span class="p">:</span><span class="w">       </span><span class="mi">42</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">EmployeeID</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">FirstName</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">LastName</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Age</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">EmployeeID</span><span class="p">)</span><span class="w"> </span><span class="c1">// Domi Noes 42 12345</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="interfaces">Interfaces</h3>
<ul>
<li>Interfaces are declared as a type with the <code>interface</code> keyword.</li>
<li>The methods defined in an interface are the methods that a type must implement to be considered an implementation of that interface: this is referred to as the <em>method set</em>.</li>
<li>They can be declared in any block.</li>
<li>They usually end with <code>er</code> (e.g., <code>Stringer</code>, <code>Reader</code>, <code>Writer</code>).</li>
<li>They are implemented implicitly.</li>
<li>Go is a blend of duck typing (e.g., dynamic behavior in Python) and structural typing (Java interfaces).</li>
<li>Use built-in interfaces from the standard library as much as possible.</li>
<li>Just like structs, interfaces can be embedded.</li>
<li>Interfaces are the only abstract type in Go.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Switching between the logic providers is as simple as changing the type of the L field.</span>
<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">LogicProvider</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">LogicProvider2</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lp</span><span class="w"> </span><span class="nx">LogicProvider2</span><span class="p">)</span><span class="w"> </span><span class="nx">Process</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"LogicProvider2: Process"</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lp</span><span class="w"> </span><span class="nx">LogicProvider2</span><span class="p">)</span><span class="w"> </span><span class="nx">Rework</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lp</span><span class="w"> </span><span class="nx">LogicProvider</span><span class="p">)</span><span class="w"> </span><span class="nx">Process</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lp</span><span class="w"> </span><span class="nx">LogicProvider</span><span class="p">)</span><span class="w"> </span><span class="nx">Rework</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"LogicProvider1: Rework"</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Logic</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Process</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Rework</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Client</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">L</span><span class="w"> </span><span class="nx">Logic</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">Client</span><span class="p">)</span><span class="w"> </span><span class="nx">Program</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">"data"</span>
<span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">L</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">L</span><span class="p">.</span><span class="nx">Rework</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">c1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Client</span><span class="p">{</span>
<span class="w">        </span><span class="nx">L</span><span class="p">:</span><span class="w"> </span><span class="nx">LogicProvider</span><span class="p">{},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">c1</span><span class="p">.</span><span class="nx">Program</span><span class="p">()</span>

<span class="w">    </span><span class="nx">c2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Client</span><span class="p">{</span>
<span class="w">        </span><span class="nx">L</span><span class="p">:</span><span class="w"> </span><span class="nx">LogicProvider2</span><span class="p">{},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">c2</span><span class="p">.</span><span class="nx">Program</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// Output:</span>
<span class="c1">// LogicProvider1: Rework</span>
<span class="c1">// LogicProvider2: Process</span>
</code></pre></div>
<h3 id="take-interfaces-and-return-structs">Take interfaces and return structs</h3>
<ul>
<li>Returning interfaces increases coupling.</li>
<li>It is better to return structs and take interfaces as parameters.</li>
</ul>
<h3 id="empty-interfaces">Empty interfaces</h3>
<ul>
<li>If an interface is <code>nil</code>, invoking a method on it will result in a runtime panic.</li>
<li>An empty interface matches any type, because it requires implementing no methods.</li>
<li>They can be used when receiving data from an external source (e.g., a database or <span class="caps">JSON</span>) and the type is unknown.</li>
<li>Using <code>interface{}</code> is a code smell: it should be used sparingly.</li>
</ul>
<h3 id="type-assertions-and-type-switches">Type assertions and type switches</h3>
<ul>
<li>Use the <em>comma ok</em> idiom to avoid a type assertion from panicking.</li>
<li>Type assertions are checked at runtime.</li>
<li>Type conversions are checked at compile time.</li>
<li>A type switch is used to check the type of an interface.</li>
<li>In the case of errors, use <code>errors.Is</code> and <code>errors.As</code> to test for specific errors.</li>
<li>Add a <code>default</code> case to switch statements to catch unexpected types.</li>
<li>It can be safer to keep interfaces unexported.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">42</span>
<span class="w">    </span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">ok1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">ok1</span><span class="p">)</span><span class="w">      </span><span class="c1">// 42 true</span>
<span class="w">    </span><span class="nx">v2</span><span class="p">,</span><span class="w"> </span><span class="nx">ok2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="p">.(</span><span class="kt">string</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v2</span><span class="p">,</span><span class="w"> </span><span class="nx">ok2</span><span class="p">)</span><span class="w">      </span><span class="c1">// "" false</span>

<span class="w">    </span><span class="c1">// type switch</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">int</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"int"</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span><span class="w"> </span><span class="c1">// int 42</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">string</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"string"</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">float64</span><span class="p">,</span><span class="w"> </span><span class="kt">float32</span><span class="p">:</span><span class="w">    </span><span class="c1">// check both at once</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"float"</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"unknown"</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// type assertion using optional interface</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="p">.(</span><span class="nx">MySpecificInterface</span><span class="p">);</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// myInterface satisfies MySpecificInterface</span>
<span class="w">        </span><span class="nx">s</span><span class="p">.</span><span class="nx">SpecificMethod</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="function-types-are-a-bridge-to-interfaces">Function types are a bridge to interfaces</h3>
<ul>
<li>Functions can implement interfaces.</li>
<li>Go uses this to implement the <code>http.Handler</code> interface.</li>
<li>Small interfaces are encouraged.</li>
<li>If a function can depend on many other functions, it is better to use a struct with methods.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">HandlerFunc</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="nx">HandlerFunc</span><span class="p">)</span><span class="w"> </span><span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">f</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span><span class="w"> </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">"Hello, world!"</span><span class="p">)</span>
<span class="w">    </span><span class="p">}))</span>
<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">":8080"</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>An actual, basic <span class="caps">HTTP</span> server:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">"fmt"</span>
<span class="w">    </span><span class="s">"net/http"</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">HandlerFunc</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="nx">HandlerFunc</span><span class="p">)</span><span class="w"> </span><span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">f</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span><span class="w"> </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">p</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">"Hello, world!"</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
<span class="w">    </span><span class="p">}))</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">":8080"</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="implicit-interfaces-make-dependency-injection-easier">Implicit Interfaces Make Dependency Injection Easier</h3>
<ul>
<li><span class="dquo">“</span>[…] <em>code should explicitly specify the functionality it needs to perform its task</em>“.</li>
<li>If a type has methods that match an interface’s signature, it implicitly satisfies that interface.</li>
<li>Go’s implicit interfaces make dependency injection easier.</li>
<li>Interfaces are used to decouple code.</li>
<li>The client’s code should not be responsible for creating the dependencies it needs.</li>
<li>The client’s code defines the interfaces and can customize the method set it needs.</li>
</ul>
<p>Here is an example of an implicit interface:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Talker</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Say</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Dog implicitly implements the Talker interface</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Dog</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="nx">Dog</span><span class="p">)</span><span class="w"> </span><span class="nx">Say</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">"Woof!"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Speak</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="nx">Talker</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Say</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Dog</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">Speak</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w">  </span><span class="c1">// Woof!</span>
<span class="p">}</span>
</code></pre></div>
<p>And an example demonstrating dependency injection:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">"fmt"</span>
<span class="p">)</span>

<span class="c1">// Logger is an implicit interface with a Log method</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Logger</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Log</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// SimpleLogger implicitly satisfies Logger by implementing Log</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">SimpleLogger</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">sl</span><span class="w"> </span><span class="nx">SimpleLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Log</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// AdvancedLogger implicitly satisfies Logger by implementing Log</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">AdvancedLogger</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">al</span><span class="w"> </span><span class="nx">AdvancedLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Log</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"ADVANCED: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// CompositeLogger combines SimpleLogger and AdvancedLogger</span>
<span class="c1">// Again, it implicitly satisfies Logger by implementing Log</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CompositeLogger</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">loggers</span><span class="w"> </span><span class="p">[]</span><span class="nx">Logger</span>
<span class="p">}</span>

<span class="c1">// Log messages with multiple loggers</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cl</span><span class="w"> </span><span class="nx">CompositeLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Log</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">cl</span><span class="p">.</span><span class="nx">loggers</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="s">"[CompositeLogger] "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Greeter contains logic to greet</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Greeter</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="w"> </span><span class="nx">Logger</span><span class="w"> </span><span class="c1">// Logger is injected</span>
<span class="p">}</span>

<span class="c1">// NewGreeter injects dependencies and returns a new Greeter</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewGreeter</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="nx">Logger</span><span class="p">)</span><span class="w"> </span><span class="nx">Greeter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Greeter</span><span class="p">{</span><span class="nx">logger</span><span class="p">:</span><span class="w"> </span><span class="nx">l</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Greet uses the Logger to log a greeting</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">g</span><span class="w"> </span><span class="nx">Greeter</span><span class="p">)</span><span class="w"> </span><span class="nx">Greet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="s">"Hello, dependency injection and implicit interface!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">SimpleLogger</span><span class="p">{}</span><span class="w">       </span><span class="c1">// Create Logger</span>
<span class="w">    </span><span class="nx">greeter1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewGreeter</span><span class="p">(</span><span class="nx">logger1</span><span class="p">)</span><span class="w"> </span><span class="c1">// Inject Logger into Greeter</span>
<span class="w">    </span><span class="nx">greeter1</span><span class="p">.</span><span class="nx">Greet</span><span class="p">()</span><span class="w">                </span><span class="c1">// Use Greeter</span>
<span class="w">    </span><span class="c1">// Logs:</span>
<span class="w">    </span><span class="c1">// Hello, dependency injection and implicit interface!</span>

<span class="w">    </span><span class="nx">logger2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">AdvancedLogger</span><span class="p">{}</span><span class="w">     </span><span class="c1">// Create Logger</span>
<span class="w">    </span><span class="nx">greeter2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewGreeter</span><span class="p">(</span><span class="nx">logger2</span><span class="p">)</span><span class="w"> </span><span class="c1">// Inject Logger into Greeter</span>
<span class="w">    </span><span class="nx">greeter2</span><span class="p">.</span><span class="nx">Greet</span><span class="p">()</span><span class="w">                </span><span class="c1">// Use Greeter</span>
<span class="w">    </span><span class="c1">// Logs:</span>
<span class="w">    </span><span class="c1">// ADVANCED: Hello, dependency injection and implicit interface!</span>

<span class="w">    </span><span class="nx">logger3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">CompositeLogger</span><span class="p">{</span><span class="nx">loggers</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">Logger</span><span class="p">{</span><span class="nx">SimpleLogger</span><span class="p">{},</span><span class="w"> </span><span class="nx">AdvancedLogger</span><span class="p">{}}}</span>
<span class="w">    </span><span class="nx">greeter3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewGreeter</span><span class="p">(</span><span class="nx">logger3</span><span class="p">)</span><span class="w"> </span><span class="c1">// Inject CompositeLogger into Greeter</span>
<span class="w">    </span><span class="nx">greeter3</span><span class="p">.</span><span class="nx">Greet</span><span class="p">()</span><span class="w">                </span><span class="c1">// Use Greeter</span>
<span class="w">    </span><span class="c1">// Logs:</span>
<span class="w">    </span><span class="c1">// [CompositeLogger] Hello, dependency injection and implicit interface!</span>
<span class="w">    </span><span class="c1">// ADVANCED: [CompositeLogger] Hello, dependency injection and implicit interface!</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h1 id="generics">Generics</h1>
<h2 id="generics-reduce-repetitive-code-and-increase-type-safety">Generics Reduce Repetitive Code and Increase Type Safety</h2>
<ul>
<li>Generics are “type parameters” that allow one to write functions and data structures that can work with any type.</li>
<li>They reduce repetitive code and increase type safety.</li>
</ul>
<h3 id="generic-functions-abstract-algorithms">Generic Functions Abstract Algorithms</h3>
<ul>
<li>Generic functions can be used to abstract algorithms.</li>
<li>They can be used to write functions that work with any type.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Max returns the maximum of two values</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Max</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">any</span><span class="p">](</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="nx">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="generics-and-interfaces">Generics and interfaces</h2>
<ul>
<li>Generics can be used with interfaces.</li>
<li>They can be used to write functions that work with any type that satisfies an interface.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Stringer is an interface with a String method</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Stringer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">String</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Print calls the String method on a value that satisfies the Stringer interface</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Print</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="nx">Stringer</span><span class="p">](</span><span class="nx">s</span><span class="w"> </span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h1 id="errors">Errors</h1>
<ul>
<li><em>Go does not have exceptions</em>.</li>
<li>Errors are values.</li>
<li>They are the last return value of a function (by convention).</li>
<li>The <code>error</code> interface is defined in the standard library.</li>
<li>The <code>errors</code> package is used to create errors.</li>
<li>The <code>fmt</code> package is used to print errors.</li>
<li>The <code>errors.Is</code> function is used to check for specific errors.</li>
<li>The <code>errors.As</code> function is used to check for specific errors and get the underlying error.</li>
<li>The <code>errors.Unwrap</code> function is used to get the underlying error, but <code>errors.Is</code> and <code>errors.As</code> are more commonly used for this.</li>
<li>The <code>errors.New</code> function is used to create errors.</li>
<li>The <code>errors.Errorf</code> function is used to create errors with formatting.</li>
<li>When a function returns an error, it is expected that the caller will check for it.</li>
<li>If a function does not return an error, its value will be <code>nil</code>, because it is the zero value for interfaces.</li>
<li>Error messages should not be capitalized or end with punctuation, nor contain newline.</li>
<li>Because all values must be read, errors cannot be ignored implicitly.</li>
<li>Because the main code is unindented and the error handling code is indented, the code’s purpose is easier to follow.</li>
</ul>
<h2 id="sentinel-errors">Sentinel errors</h2>
<ul>
<li>Sentinel errors are errors that are predefined and can be checked for equality.</li>
<li>They are defined at the package level.</li>
<li>They start with <code>Err</code> (except for <code>io.EOF</code>).</li>
<li>They should be treated as read-only.</li>
<li>They are used to indicate it is not possible to continue processing (e.g., <code>ErrFormat</code> for <span class="caps">ZIP</span> files).</li>
<li>Whenever possible, use existing sentinel errors from the standard library.</li>
</ul>
<h2 id="wrapping-errors">Wrapping errors</h2>
<ul>
<li>To give additional context to an error, wrap it with <code>fmt.Errorf</code>.</li>
<li>A series of errors can be wrapped with <code>fmt.Errorf</code> and <code>errors.Unwrap</code>: these are called <em>error chains</em>.</li>
<li>If context is not required, a brand new error can be created with <code>errors.New</code> or <code>errors.Errorf</code>.</li>
<li>The <code>%v</code> verb can be used to print the error chain without wrapping the error (e.g., <code>fmt.Errorf("internal failure: %v", err)</code>).</li>
</ul>
<h2 id="is-and-as"><code>Is</code> and <code>As</code></h2>
<ul>
<li>Use <code>errors.Is</code> to check for specific errors.</li>
<li>Use <code>errors.As</code> to check for specific errors and get the underlying error.</li>
<li><code>errors.As</code> can take as the second parameter a pointer to a variable of the type of the error we are looking for, but just as well it can take a pointer to an interface.</li>
</ul>
<h2 id="wrapping-errors-with-defer">Wrapping Errors with defer</h2>
<ul>
<li>Using named return values and <code>defer</code> can make error handling easier because the error can be formatted only once at the end of the function.</li>
</ul>
<h2 id="panic-and-recover">Panic and recover</h2>
<ul>
<li>A <strong>panic</strong> is used to indicate that the program cannot continue (e.g., out of memory error or trying to read beyond the end of a slice).</li>
<li>When a panic occurs, the program stops executing and the stack is unwound, running all deferred functions until the <code>main</code> function is reached.</li>
<li><code>panic</code> and <code>recover</code> are not intended to be used for error handling.</li>
<li>It is better to explicitly handle errors than to use <code>panic</code> and <code>recover</code> because it is not clear when calling <code>recover</code> what failed exactly.</li>
</ul>
<h2 id="getting-a-stack-trace-from-an-error">Getting a Stack Trace from an Error</h2>
<ul>
<li>Go doesn’t provide a stack trace by default outside of a <code>panic</code> state.</li>
<li><code>%+v</code> can be used to print the stack trace with <code>fmt.Printf</code>.</li>
<li>Pass the <code>-trimpath</code> flag to <code>go build</code> to remove the absolute path from the stack trace, which otherwise shows full paths to files.</li>
</ul>
<hr/>
<h1 id="modules-packages-and-imports">Modules, Packages, and Imports</h1>
<ul>
<li>The module is the root of the package tree. It can be defined in <code>go.mod</code> or inferred from the directory structure. For a GitHub repository, it is inferred from the <span class="caps">URL</span> as in <code>module github.com/{USER}/{PROJECT}</code>.</li>
<li>Keep a single module per repository.</li>
</ul>
<h2 id="gomod"><code>go.mod</code></h2>
<ul>
<li>Use <code>go mod init MODULE_PATH</code> to create a new module (<code>go.mod</code> file).</li>
<li>The module path is case-sensitive.</li>
<li>The minimum version of Go required to build the module can be specified with <code>go mod init MODULE_PATH GO_VERSION</code> and it appears in the <code>go.mod</code> file below the module declaration.</li>
<li>There can be a <code>require</code> directive for each dependency.</li>
<li>There are also two optional sections: <code>replace</code> and <code>exclude</code>.<ul>
<li><code>replace</code> is used to replace a dependency with a local version.</li>
<li><code>exclude</code> is used to exclude a dependency from the build.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Example of a go.mod file</span>
<span class="nx">module</span><span class="w"> </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="p">{</span><span class="nx">USER</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="nx">PROJECT</span><span class="p">}</span>

<span class="k">go</span><span class="w"> </span><span class="mf">1.</span><span class="nx">xx</span>

<span class="nx">require</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="p">{</span><span class="nx">OTHER_USER</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="nx">OTHER_PROJECT</span><span class="p">}</span><span class="w"> </span><span class="nx">v0</span><span class="mf">.0.0</span><span class="o">-</span><span class="mi">20200921021027</span><span class="o">-</span><span class="mi">5</span><span class="nx">abc380940ae</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">shopspring</span><span class="o">/</span><span class="nx">decimal</span><span class="w"> </span><span class="nx">v1</span><span class="mf">.2.0</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="building-packages">Building packages</h2>
<h3 id="imports-and-exports">Imports and exports</h3>
<ul>
<li>Import statements allow accessing exported constants, variables, functions and types from another package.</li>
<li><em>An exported identifier starts with a capital letter</em>. It cannot be accessed from another package without an import statement.</li>
</ul>
<h3 id="creating-and-accessing-packages">Creating and accessing packages</h3>
<ul>
<li>The first line of the file should be <code>package {PACKAGE_NAME}</code>. It’s a <em>package clause</em>.</li>
<li>Next is the import section.<ul>
<li>Importing from the standard library doesn’t require a path.</li>
<li>Any other imports require a path, using the module path as a prefix and appending the path to the package.</li>
<li>Not using any identifier from a path will result in a compiler error. Hence, all code included in the build will be used.</li>
<li>It is best to always use absolute paths for clarity.</li>
<li>The name of a package is determined by its package clause, <em>not by the path</em> being imported. In general, the package name should match the last element of the path.</li>
<li>The <code>main</code> package cannot be imported as it is the entrypoint of the application.</li>
</ul>
</li>
<li>Package names are in the file block: the package name is the same for all files in the same directory and must be present.</li>
</ul>
<h3 id="naming-packages">Naming packages</h3>
<ul>
<li>The package name should be descriptive.</li>
<li>Avoid <code>util</code> and <code>common</code> packages. Create more packages with fewer functions instead.</li>
<li>Don’t include the name of the package in functions, as this will be disambiguated by the package name when importing.</li>
</ul>
<h3 id="organizing-a-module">Organizing a module</h3>
<ul>
<li>There is no official structure.</li>
<li>The <code>cmd</code> directory is used for executables. There can be multiple executables produced by different applications from a module.</li>
<li>When there are a bunch of files at the root to manage deployment and testing, it is a good pattern to put all packages inside a <code>pkg</code> directory.<ul>
<li>Inside <code>pkg</code>, limit dependencies between packages by organizing the code according to the functionality it provides.</li>
<li>A good primer on the topic is <a href="https://www.youtube.com/watch?v=oL6JBUk6tj0">GopherCon 2018: Kat Zien - How Do You Structure Your Go Apps</a>.</li>
</ul>
</li>
</ul>
<h3 id="overriding-a-packages-name">Overriding a package’s name</h3>
<ul>
<li>When names collide, you can use an alias to rename a package.<ul>
<li>In the standard library, both <code>"crypto/rand"</code> and <code>"math/rand"</code> are imported as <code>"rand"</code>, but they can be disambiguated with an alias such as <code>crand "crypto/rand"</code>.</li>
</ul>
</li>
<li>Using the <code>.</code> alias is discouraged because it makes it harder to understand where a function is coming from as it will import all exported identifiers from the current namespace (same idea as <code>import * from ...</code> in Python).</li>
<li>Package names can be shadowed, which renders it inaccessible. Always resolve conflicts by using an alias instead.</li>
</ul>
<h3 id="package-comments-and-godoc">Package comments and <code>godoc</code></h3>
<ul>
<li>Comments must be placed right above the item to be documented.</li>
<li>Comments start with <code>//</code> and can be multiline.</li>
<li>A blank line with <code>//</code> is used to create paragraphs.</li>
<li>Preformatted text can be inserted with indentation.</li>
<li>Comments before the package clause create package-level documentation.<ul>
<li>If the package has a lot of documentation, it is better to put it in a separate file called <code>doc.go</code>.</li>
</ul>
</li>
<li>Comments should start with the name of the item being documented.</li>
</ul>
<h3 id="internal-package">Internal package</h3>
<ul>
<li>Use the <code>internal</code> directory to create packages that are only accessible from the parent and sibling packages.</li>
<li>Trying to access an <code>internal</code> package from outside the module will result in a compiler error.</li>
</ul>
<h3 id="the-init-function">The <code>init</code> function</h3>
<ul>
<li>If there is an <code>init</code> function in a package, it runs as soon as the package is referenced by another package.</li>
<li>It has not input or output parameters and can only cause side-effects within the package.</li>
<li>There can be multiple <code>init</code> functions in a package, even in the same file, although this setup is discouraged.</li>
<li>A blank import can be used to run the <code>init</code> function of a package without using any of its exported identifiers, e.g., <code>import _ "github.com/lib/pq"</code>. Explicit is better than implicit: this is an obsolete pattern.</li>
</ul>
<h3 id="circular-dependencies">Circular dependencies</h3>
<ul>
<li>They are <strong>not allowed</strong> to keep the code readable and the compiler fast.</li>
<li>If two packages depend on each other, they should probably be merged into a single package.</li>
<li>If two packages with circular dependencies are still preferred, it may be possible to move only the culprits into a separate package so that both packages can import them.</li>
</ul>
<h3 id="api-renaming-and-organizing"><span class="caps">API</span> renaming and organizing</h3>
<ul>
<li>To avoid breaking a function name, a new method can be added with the new name, calling the old one.</li>
<li>Constants can be re-declared with the same types, but with a different name.</li>
<li>To rename exported types, we can create an alias such as <code>type Bar = Foo</code>. In this case, new methods should still be added to the original type to preserve backward compatibility.</li>
<li>Caution: a field name cannot be changed without breaking backward compatibility.</li>
</ul>
<h2 id="working-with-modules">Working with modules</h2>
<h3 id="importing-third-party-code">Importing third-party code</h3>
<ul>
<li><code>go.mod</code> is used to manage dependencies.</li>
<li><code>go.mod</code> is automatically populated when a <code>go</code> command runs and a dependency is required (e.g., <code>go build</code>, <code>go list</code>, <code>go run</code>, <code>go test</code>).</li>
<li><code>go.sum</code> is used to verify the integrity of the dependencies.</li>
<li><code>god.mod</code> and <code>go.sum</code> should both be committed to version control.</li>
</ul>
<h3 id="working-with-versions">Working with versions</h3>
<ul>
<li><code>go list</code> is used to list dependencies used by a project.<ul>
<li>By default, it lists packages used.</li>
<li>The <code>-m</code> flag is used to list modules used.</li>
<li>Appending the <code>-versions</code> flag to the previous command lists all versions of the dependencies.</li>
</ul>
</li>
<li><code>go get</code> can be used to downgrade or upgrade a dependency (e.g., <code>go get github.com/{USER}/{PROJECT}@v1.0.0</code>).<ul>
<li>It can also be used to add a new dependency.</li>
<li>It can be used to remove a dependency by adding the <code>-u</code> flag.</li>
<li>Changes will be reflected in <code>go.mod</code> and <code>go.sum</code>.</li>
</ul>
</li>
<li>Dependencies might be shown with <code>// indirect</code> next to them. This means that the dependency is not used directly by the project, but by one of its dependencies.<ul>
<li>It can be added when the project uses that dependency directly with a newer version than what is declared in the dependency’s <code>go.mod</code> file.</li>
</ul>
</li>
<li>Go follows semantic versioning (<em>SemVer</em>).</li>
<li>There is an <em>import compatibility rule</em>: all minor and patch versions should remain compatible and if not, this is considered a bug.<ul>
<li>Instead of importing multiple versions of the same library as with <code>npm</code>, Go will import the highest version of the library that satisfies the requirements.</li>
</ul>
</li>
</ul>
<h3 id="updating-to-compatible-versions">Updating to compatible versions</h3>
<ul>
<li>Use <code>go get -u=patch DEPENDENCY_PATH</code> to update to the latest compatible patch version.</li>
<li><code>go get -u DEPENDENCY_PATH</code> will update to the most recent compatible version.</li>
</ul>
<h3 id="updating-to-incompatible-versions">Updating to incompatible versions</h3>
<ul>
<li>Go follows the <em>semantic import versioning</em> rule: for all major versions greater than <code>1</code>, the major version is included in the import path, e.g., <code>"github.com/{USER}/{PROJECT}/v2"</code>.</li>
<li>Once a new major version is used in the project, <code>go build</code> will update the <code>go.mod</code> file to use the new major version.</li>
<li>Older versions may still be present in <code>go.mod</code>: <code>go mod tidy</code> can be used to remove them.</li>
</ul>
<h3 id="vendoring">Vendoring</h3>
<ul>
<li><code>go mod vendor</code> is used to create a <code>vendor</code> directory with all the dependencies to ensure reproducible builds.</li>
<li>It dramatically increases the size of the project in version control.</li>
</ul>
<h3 id="pkggodev"><code>pkg.go.dev</code></h3>
<ul>
<li>It automatically indexes Go projects.</li>
<li>It is used to search for packages and their documentation.</li>
<li>It publishes the godocs, license, <code>README</code>, the module’s dependencies and which other open source projects depend on it.</li>
</ul>
<h2 id="publishing-modules">Publishing modules</h2>
<ul>
<li>Go favors permissive licenses (e.g., <span class="caps">MIT</span>, <span class="caps">BSD</span>, Apache).</li>
<li>There is no need for a central repository, as Go uses the module path to find the module.</li>
</ul>
<h2 id="versioning-modules">Versioning modules</h2>
<ul>
<li>Minor and patch versions should be compatible and are easy to manage.</li>
<li>Major versions are slightly more difficult to manage. For instance, let’s go from <code>v1</code> to <code>v2</code>.<ul>
<li>Create a directory to put all the old code in, named <code>v2</code>, including <code>README</code> and <code>LICENSE</code> files.</li>
<li>Create a branch.<ul>
<li>Name the branch <code>v1</code> if the old code goes in it.</li>
<li>Name the branch <code>v2</code> if the new code goes in it.</li>
</ul>
</li>
<li>Make sure the module path in <code>go.mod</code> ends with <code>/v2</code>.</li>
<li>Update all import paths to use the new module path.</li>
<li>Create a tag for the new version.<ul>
<li>Name the tag <code>v2.0.0</code>.</li>
<li>Tag the <code>main</code> branch if the new code goes in it.</li>
<li>Otherwise, tag the <code>v2</code> branch.</li>
</ul>
</li>
</ul>
</li>
<li>If breaking changes might be introduced while on the new version, use a pre-release version, e.g., <code>v2.0.0-alpha.1</code>.</li>
<li>The open source project <a href="https://github.com/marwan-at-work/mod"><code>mod</code></a> can be used to automate this process.</li>
<li>The Go Blog has a <a href="https://go.dev/blog/v2-go-modules">post</a> on the topic.</li>
</ul>
<h2 id="module-proxy-servers">Module proxy servers</h2>
<ul>
<li>Google manages a module proxy server that fetches all versions of all publicly available modules.</li>
<li>Google also maintains a <em>sum database</em>, which stores the checksums of all the modules.</li>
<li>Modules are only installed from the proxy server if they are not already present in the local cache and if the checksums match.</li>
</ul>
<h3 id="specifying-a-module-proxy-server">Specifying a module proxy server</h3>
<ul>
<li>The <code>GOPROXY</code> environment variable can be used to specify a module proxy server. To use GoCenter, set it to <code>GOPROXY=https://gocenter.io</code>.</li>
<li>If the <code>GOPROXY</code> environment variable is set to <code>direct</code>, the module proxy server will not be used and the module will be downloaded directly from the source.</li>
<li>Projects such as <a href="https://github.com/gomods/athens"><code>athens</code></a> can be used to create a local module proxy server.</li>
</ul>
<hr/>
<h1 id="concurrency-in-go">Concurrency in Go</h1>
<h2 id="when-to-use-concurrency">When to use concurrency</h2>
<ul>
<li><em>Concurrency is not parallelism</em>.</li>
<li>Concurrency is useful <em>when there are multiple tasks that can be executed independently</em>.</li>
<li>Concurrency brings benefits <em>when a process takes a long time to complete</em>.</li>
<li>Read <a href="https://www.oreilly.com/library/view/the-art-of/9780596802424/">The Art of Concurrency</a> for more information.</li>
<li>The book <a href="https://www.oreilly.com/library/view/concurrency-in-go/9781491941294/">Concurrency in Go</a> is also a great resource.</li>
</ul>
<h2 id="goroutines">Goroutines</h2>
<ul>
<li><span class="dquo">“</span><em>Goroutines are lightweight processes managed by the Go runtime</em>“.</li>
<li>Because Go manages goroutines, they are cheap to create and destroy (no need to create system-level resources).</li>
<li>They are memory efficient because they are allocated on the stack with small initial sizes.</li>
<li>Switching between goroutines is fast because it is managed by the Go runtime within a process.</li>
<li>Go optimizes how work is distributed across goroutines.<ul>
<li>For more details on this, watch <a href="https://www.youtube.com/watch?v=YHRO5WQGh0k">GopherCon 2018: Kavya Joshi - The Scheduler Saga</a>.</li>
</ul>
</li>
<li>A goroutine starts by calling a function with the <code>go</code> keyword in front of it.</li>
</ul>
<h2 id="channels">Channels</h2>
<ul>
<li>Channels are <em>used to communicate between goroutines</em>.</li>
<li>They are a built-in type that require the <code>make</code> function to create them, e.g., <code>ch := make(chan int)</code>.</li>
<li>The zero value of a channel is <code>nil</code>.</li>
<li>They are passed as parameters to functions as a pointer.</li>
</ul>
<h3 id="reading-writing-buffering">Reading, writing, buffering</h3>
<ul>
<li>The <code>&lt;-</code> operator is used to send and receive data from a channel. <em>It indicates the direction of the data flow</em>.</li>
<li>A function parameter can specify the direction of the channel, e.g., <code>func f(ch &lt;-chan int)</code> will make it so that the channel can only be read from. Likewise, <code>func f(ch chan&lt;- int)</code> will make it so that the channel can only be written to.</li>
<li>By default, channels are <em>unbuffered</em>, meaning that they can only hold one value at a time. They should be used most of the time.</li>
<li>A channel can be buffered by specifying the buffer size when creating it. E.g., <code>ch := make(chan int, 10)</code>.</li>
<li><code>len(ch)</code> is used to get the number of elements in the channel.</li>
<li><code>cap(ch)</code> is used to get the capacity of the channel.</li>
<li>The capacity of a channel cannot be changed after it is created.</li>
</ul>
<h3 id="for-range-and-channels"><code>for-range</code> and channels</h3>
<ul>
<li><code>for-range</code> can be used to read from a channel until it is closed, or until a <code>break</code> or <code>return</code> statement is encountered.</li>
<li>There is a single variable declared for the channel, which is the value read from the channel.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="nx">v</span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">ch</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="closing-a-channel">Closing a channel</h3>
<ul>
<li>Close a channel with <code>close(ch)</code>.</li>
<li>Writing to a closed channel will result in a runtime panic.</li>
<li>Attempting to read from a closed unbuffered channel will return the zero value of the channel’s type.</li>
<li>Reading from a closed buffered channel will return the remaining values in the channel until it is empty, then it will return the zero value of the channel’s type.</li>
<li>To know if a channel is closed, use the second return value of the receive operation with the <em>comma ok</em> idiom, e.g., <code>v, ok := &lt;-ch</code>.<ul>
<li><code>ok</code> will be <code>true</code> if the channel is open and <code>false</code> if it is closed.</li>
</ul>
</li>
</ul>
<h3 id="how-channels-behave">How channels behave</h3>
<ul>
<li>They pause the execution of the goroutine until a value is available to read from the channel.</li>
<li>They pause the execution of the goroutine until a value can be written to the channel.</li>
<li>A <code>panic</code> will occur if a value is written to a closed channel or when trying to close a closed channel or a <code>nil</code> channel.</li>
<li>Make the writer responsible for closing the channel.</li>
</ul>
<h3 id="select"><code>select</code></h3>
<ul>
<li><em>Starvation</em> is when a goroutine is waiting for a resource that is never available.</li>
<li>It looks very similar to a <code>switch</code> statement.</li>
<li>A <code>case</code> in a <code>select</code> statement is executed when the channel is ready to be read from or written to.</li>
<li>If multiple <code>case</code> statements are ready, one is chosen at random — with <code>switch</code>, the first match is always chosen. This solves the starvation problem since all cases are checked at once.</li>
<li><code>select</code> also deals with deadlock issues: if all channels are blocked, it will execute the <code>default</code> case.</li>
<li><code>select</code> is often used in a loop to keep reading from a channel until it is closed.<ul>
<li>Having a <code>default</code> case inside a loop for a <code>select</code> is most certainly not what is intended as it will run constantly.</li>
</ul>
</li>
</ul>
<h2 id="concurrency-practices-and-patterns">Concurrency practices and patterns</h2>
<h3 id="keep-apis-concurrency-free">Keep APIs concurrency-free</h3>
<ul>
<li>Never expose channels or mutexes in an <span class="caps">API</span>. If a channel is exposed, the user will have to manage it, know whether it is buffered or not, closed or not or <code>nil</code>. The user could also trigger deadlocks.</li>
</ul>
<h3 id="goroutines-for-loops-and-varying-variables">Goroutines, for loops, and varying variables</h3>
<ul>
<li>Instead of shadowing variables in a <code>for</code> loop, pass them as parameters to the goroutine.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Don't do this</span>
<span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="c1">// shadowing</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="p">}()</span>
<span class="p">}</span>

<span class="c1">// Do this instead</span>
<span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">val</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// value captured by the closure</span>
<span class="w">        </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="p">}(</span><span class="nx">v</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="always-clean-up-your-goroutines">Always clean up your goroutines</h3>
<ul>
<li>If a goroutine is not cleaned up, it will keep running until the program exits: this is called a “<em>goroutine leak</em>“.</li>
</ul>
<h3 id="done-channel-pattern"><span class="dquo">“</span>Done channel pattern”</h3>
<ul>
<li>If multiple goroutines are running, it is useful to have a way to signal them to stop.</li>
<li>A channel (named <code>done</code>) can be used to signal the goroutines to stop.</li>
</ul>
<h3 id="using-a-cancel-function-to-terminate-a-goroutine">Using a cancel function to terminate a goroutine</h3>
<ul>
<li>A cancel function can be used to terminate a goroutine.</li>
<li>It is a function that performs a cleanup and closes a channel.</li>
</ul>
<h3 id="when-to-use-buffered-and-unbuffered-channels">When to use buffered and unbuffered channels</h3>
<ul>
<li>Buffered channels are useful when limiting the number of goroutines that can access a resource at the same time, when limiting the amount of work that gets queued up or when the number of goroutines is known.</li>
<li>Buffered channels are good to gather results from multiple goroutines when a deterministic order is not required.</li>
</ul>
<h3 id="backpressure">Backpressure</h3>
<ul>
<li>Backpressure is a way to signal to a goroutine that it should slow down.</li>
<li>It is implemented with buffered channels.</li>
</ul>
<h3 id="turning-off-a-case-in-a-select">Turning off a case in a <code>select</code></h3>
<ul>
<li>Setting a variable’s channel to <code>nil</code> will turn off the case in a <code>select</code> statement.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">in</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">in</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="c1">// kills the case</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// ... other cases ...</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">done</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="time-out-code">Time out code</h3>
<ul>
<li>Use <code>time.After</code> to time out code.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="c1">// this requires context cancellation to free up resources</span>
<span class="c1">// if the function is not finished before the timeout,</span>
<span class="c1">// else it will keep processing in the background</span>
<span class="k">case</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">):</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"timed out"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="using-waitgroups">Using <code>WaitGroups</code></h3>
<ul>
<li>The <em>done channel pattern</em> works well when waiting for a single goroutine to finish.</li>
<li>When waiting for multiple goroutines to finish, use a <code>sync.WaitGroup</code>.</li>
<li><code>Add</code> is used to add a goroutine to the wait group.</li>
<li><code>Done</code> is used to signal that a goroutine is done.</li>
<li><code>Wait</code> is used to wait for all goroutines to finish.</li>
<li>Use them when some cleanup is required after all goroutines are done.</li>
<li><a href="https://pkg.go.dev/golang.org/x/sync/errgroup"><code>ErrGroup</code></a> can be used to wait for multiple goroutines to finish and return an error if one of them fails.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// The wait group is passed with a closure</span>
<span class="w">        </span><span class="c1">// Otherwise it would need to be passed as a pointer</span>
<span class="w">        </span><span class="c1">// So all goroutines share the same instance</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">val</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span><span class="w"> </span><span class="c1">// called even if panic</span>
<span class="w">            </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">}(</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">ch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="running-code-exactly-once">Running code exactly once</h3>
<ul>
<li><code>once.Do</code> is used to run code exactly once.</li>
<li>It can be found in the <code>sync</code> package.</li>
<li>It needn’t be initialized, as the zero value is usable.</li>
<li>It is best to use the minimum amount of concurrency possible.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">once</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Once</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">once</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Only once"</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nx">once</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Only once"</span><span class="p">)</span><span class="w"> </span><span class="c1">// will not be printed</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="when-to-use-mutexes-instead-of-channels">When to use mutexes instead of channels</h2>
<ul>
<li>Mutex stands for <em>mutual exclusion</em>.</li>
<li>Mutexes limit access to a resource to a single goroutine at a time with a locking mechanism (<code>Lock</code> and <code>Unlock</code>, which must be used carefully to avoid creating deadlocks, especially in functions implemented recursively).</li>
<li>They require to do more bookkeeping than channels.</li>
<li>They should never be copied, just like <code>sync.WaitGroup</code> and <code>sync.Once</code>.</li>
<li>Use mutexes <em>when there is a shared resource that needs to be protected</em>, such as a field in a struct.</li>
<li><code>RWMutex</code> is used when there are multiple readers and a single writer. The <em>critical section</em> is protected by a write lock, while the read lock is used to read the resource by multiple goroutines.</li>
<li>Sometimes, performance issues with channels can be solved by using mutexes instead.</li>
</ul>
<h2 id="atomics">Atomics</h2>
<ul>
<li>Atomics are used to perform atomic operations on integers and pointers.</li>
<li>They are more niche than mutexes and channels and as such, they are not covered in this introductory summary on Go.</li>
</ul>
<hr/>
<h1 id="the-standard-library">The Standard Library</h1>
<ul>
<li>It is battery-included, just like Python.</li>
</ul>
<h2 id="io-and-friends"><code>io</code> and Friends</h2>
<ul>
<li><code>io</code> is used to read (<code>io.Reader</code>) and write (<code>io.Writer</code>) data.</li>
<li><code>io.Closer</code> is used to close a resource.</li>
<li>Read (<code>io.ReaderAt</code>) and write (<code>io.WriterAt</code>) data at a specific offset.</li>
<li><code>io.Seeker</code> is used to seek to a specific offset.</li>
<li>There are other combinations to define more explicitly the code’s intent (<code>ReadWriter</code>, <code>ReadCloser</code>, <code>WriteCloser</code>, <code>ReadWriteCloser</code>, <code>ReadSeeker</code>, <code>WriteSeeker</code>, <code>ReadWriteSeeker</code>).</li>
<li>The <code>io</code> package is a great example of the power of interfaces through simple abstractions.</li>
<li><code>Reader</code>, <code>Writer</code>, and <code>Scanner</code> from the <code>bufio</code> package are used to read and write data more efficiently on larger datasets.</li>
</ul>
<h2 id="time"><code>time</code></h2>
<ul>
<li><code>time</code> is used to work with dates and times.</li>
<li><code>time.Time</code> is used to represent a date and time. It includes the usual constants for days of the week, months, etc.</li>
<li><code>time.Duration</code> is used to represent a duration.</li>
<li><code>time.Parse</code> is used to parse a string into a <code>time.Time</code> value.</li>
<li><code>time.Format</code> is used to format a <code>time.Time</code> value into a string.</li>
<li><code>time.Now</code> is used to get the current time.</li>
<li><code>time.Sleep</code> is used to pause the execution of a goroutine for a specified duration.</li>
<li><code>time.After</code> is used to create a channel that will receive a value after a specified duration.</li>
<li><code>time.Tick</code> is used to create a channel that will receive a value at regular intervals.</li>
<li><code>time.Timer</code> is used to create a timer that will send a value on a channel after a specified duration.</li>
<li><code>time.Ticker</code> is used to create a ticker that will send a value on a channel at regular intervals.</li>
<li><code>time.NewTicker</code> is used to create a new ticker.</li>
<li><code>time.NewTimer</code> is used to create a new timer.</li>
<li><code>time.Since</code> is used to get the time elapsed since a specified time.</li>
<li><code>time.Until</code> is used to get the time until a specified time.</li>
<li><code>time.AfterFunc</code> is used to execute a function after a specified duration.</li>
<li>Use <code>Equal</code> to compare two <code>time.Time</code> values.</li>
</ul>
<h3 id="monotonic-time">Monotonic time</h3>
<ul>
<li>Go uses a monotonic clock to measure time.</li>
<li>A monotonic clock is <em>a clock that counts up from the start of the computer</em>.</li>
</ul>
<h3 id="timers-and-timeouts">Timers and timeouts</h3>
<ul>
<li>Use <code>time.NewTicker</code> to create a ticker that will send a value on a channel at regular intervals.</li>
<li>Use <code>time.NewTimer</code> instead of <code>time.Tick</code>, as it can be stopped and reset.</li>
</ul>
<h2 id="encoding-and-json">Encoding and <span class="caps">JSON</span></h2>
<ul>
<li><span class="dquo">“</span><em>Marshalling</em>” is the process of converting a data structure into a byte stream.</li>
<li><span class="dquo">“</span><em>Unmarshalling</em>” is the process of converting a byte stream into a data structure.</li>
</ul>
<h3 id="use-struct-tags-to-add-metadata">Use struct tags to add metadata</h3>
<ul>
<li>Struct tags are strings written inside backticks that can be added to struct fields to add metadata.</li>
<li>They can span only one line, taking the format <code>`tagName:"tagValue"`</code>.</li>
<li><code>go vet</code> can be used to check for struct tags validity.</li>
<li>If no struct tag is specified, the field name will be used instead.</li>
<li>Use a <code>-</code> (dash) for a field name to ignore it.</li>
<li><code>,omitempty</code> can be added right after the field name to omit a field if it is empty.</li>
<li>While annotations can make the code more declarative and short, they can also make it harder to read and understand. <strong>Go</strong> for readability first.</li>
</ul>
<h3 id="unmarshalling-and-marshalling">Unmarshalling and marshalling</h3>
<ul>
<li><code>json.Unmarshal</code> is used to unmarshal a <span class="caps">JSON</span> byte stream into a data structure.</li>
<li><code>json.Marshal</code> is used to marshal a data structure into a <span class="caps">JSON</span> byte stream.</li>
</ul>
<h3 id="json-readers-and-writers"><span class="caps">JSON</span>, readers, and writers</h3>
<ul>
<li><code>json.Decoder</code> is used to decode a <span class="caps">JSON</span> byte stream into a data structure.</li>
<li><code>json.Encoder</code> is used to encode a data structure into a <span class="caps">JSON</span> byte stream (e.g., encoding a file given an interface: <code>json.NewEncoder(tmpFile).Encode(toFile)</code>).</li>
<li><code>json.NewDecoder</code> is used to create a new decoder (e.g., decoding a file given an interface: <code>json.NewDecoder(tmpFile2).Decode(&amp;fromFile)</code>).</li>
<li><code>json.NewEncoder</code> is used to create a new encoder.</li>
</ul>
<h3 id="encoding-and-decoding-json-streams">Encoding and Decoding <span class="caps">JSON</span> Streams</h3>
<ul>
<li><code>json.Decoder</code> and <code>json.Encoder</code> can be used to encode and decode <span class="caps">JSON</span> streams.</li>
</ul>
<h3 id="custom-json-parsing">Custom <span class="caps">JSON</span> Parsing</h3>
<ul>
<li><code>json.Unmarshaler</code> is used to implement custom <span class="caps">JSON</span> parsing.</li>
<li><code>json.Marshaler</code> is used to implement custom <span class="caps">JSON</span> marshalling.</li>
</ul>
<h3 id="nethttp"><code>net/http</code></h3>
<ul>
<li>As a modern language, Go has a built-in <span class="caps">HTTP</span> client and server.</li>
<li>Third-party libraries of interest in this space include <a href="https://github.com/go-chi/chi">chi</a> and <a href="https://github.com/gorilla/mux">Gorilla Mux</a> for routing needs and <a href="https://github.com/justinas/alice">alice</a> to deal with middleware chaining.</li>
</ul>
<h3 id="client">Client</h3>
<ul>
<li>Don’t use the default client in production.</li>
<li>Don’t use the functions to make <span class="caps">HTTP</span> requests directly in production as they don’t have timeouts.</li>
</ul>
<h3 id="server">Server</h3>
<ul>
<li><code>http.ListenAndServe</code> is used to start a server.</li>
<li>The <em>middleware pattern</em> is used to add functionality to a server, so as to check for authentication, logging, etc.</li>
</ul>
<hr/>
<h1 id="the-context">The Context</h1>
<ul>
<li>Context is not a new feature: it is an instance that meets the <code>context.Context</code> interface and gets passed around as the first argument to functions, which is usually named <code>ctx</code>.</li>
<li><code>context.TODO</code> is used when a context is required but there is no context available. It shouldn’t be used in production.</li>
</ul>
<h2 id="cancellation">Cancellation</h2>
<ul>
<li><code>context.WithCancel</code> is used to create a context that can be cancelled.</li>
<li>When a cancellable context is created, a <code>cancel</code> function is returned. It is used to cancel the context and it <strong>must</strong> be called (at least once) using <code>defer</code>.</li>
</ul>
<h2 id="timers">Timers</h2>
<p>A server can do a few things to manage its load:</p>
<ul>
<li>It can limit the number of concurrent requests it accepts.<ul>
<li>It can be done by limiting the number of goroutines.</li>
</ul>
</li>
<li>It can limit the number of requests queued up.<ul>
<li>This can be handled with a buffered channel.</li>
</ul>
</li>
<li>Limit the amount of time a request can take.<ul>
<li>The context can be used to do this.</li>
<li><code>context.WithTimeout</code> is used to create a context that will be cancelled after a specified duration.</li>
<li><code>context.WithDeadline</code> is used to create a context that will be cancelled at a specified time.</li>
</ul>
</li>
<li>Limit the resources a request can use (memory, disk space…).<ul>
<li>There is no built-in solution for this in Go.</li>
</ul>
</li>
</ul>
<h2 id="values">Values</h2>
<ul>
<li><code>context.WithValue</code> is used to create a context with a value.</li>
</ul>
<hr/>
<h1 id="writing-tests">Writing Tests</h1>
<h2 id="basics-of-testing">Basics of testing</h2>
<ul>
<li>The <code>testing</code> package is used to write tests.</li>
<li><code>go test</code> is used to run tests and generate reports.</li>
<li>Tests are located in files with the suffix <code>_test.go</code> in the same package as the code being tested, so they have access to unexported identifiers.</li>
<li>Test functions start with <code>Test</code> and take a <code>*testing.T</code> parameter. They do not return any value.</li>
<li>The test function name should be descriptive. It can start with <code>Test_</code> to indicate the function under test is unexported.</li>
</ul>
<h3 id="reporting-failure">Reporting failure</h3>
<ul>
<li>Use <code>t.Error</code> or <code>t.Errorf</code> to report a failure and continue the test. Use it to conveniently report as many failures as possible.</li>
<li>Use <code>t.Fatal</code> or <code>t.Fatalf</code> to report a failure and stop the test. Use it when subsequent tests on the same function will fail or trigger a <code>panic</code>.</li>
<li>Use <code>t.Log</code> to log information about the test.</li>
</ul>
<h3 id="setting-up-and-tearing-down">Setting up and tearing down</h3>
<ul>
<li><code>TestMain</code> is used to set up and tear down tests.<ul>
<li>It is called <em>once</em> before and after all tests, not between each test.</li>
<li>Can be used to set up and tear down a database, for instance.</li>
<li>It can be used when package-level variables need to be initialized, although this probably means the code needs refactoring.</li>
<li>It takes a <code>*testing.M</code> parameter. Setup can be done at the beginning, then <code>exitVal := m.Run()</code> is called to run tests, then teardown can be done at the end, returning the exit value with <code>os.Exit(exitVal)</code>.</li>
</ul>
</li>
<li>Individual test functions receive a <code>*testing.T</code> parameter, which has a <code>Cleanup</code> method that can be used to clean up after a test.<ul>
<li>The <code>Cleanup</code> method is similar to the <code>defer</code> statement but can be useful is the cleanup actions are performed for multiple tests from a helper function.</li>
</ul>
</li>
</ul>
<h3 id="storing-sample-test-data">Storing sample test data</h3>
<ul>
<li>A directory named <code>testdata</code> can be created to store sample test data for the package under test, as the package directory is used for the currently working directory.</li>
<li>Each package accesses its own <code>testdata</code> directory, so it is possible to have multiple <code>testdata</code> directories in a project: up to one per package.</li>
</ul>
<h3 id="caching-test-results">Caching test results</h3>
<ul>
<li><code>go test</code> caches test results to speed up subsequent runs.</li>
<li>Tests recompile if the source code or the data in <code>testdata</code> changes.</li>
<li><code>go test -count=1</code> can be used to disable caching.</li>
</ul>
<h3 id="testing-your-public-api">Testing your public <span class="caps">API</span></h3>
<ul>
<li>Create a directory <code>packagename_test</code> to test the public <span class="caps">API</span> of a package, to be found at the same directory level as <code>packagename</code>.</li>
<li>Test files in this case will be named <code>packagename_public_test.go</code>.</li>
<li>Test your public <span class="caps">API</span>, not your implementation.</li>
<li>This is used to test the exported functions and methods, not the unexported ones.</li>
</ul>
<h3 id="use-go-cmp-to-compare-test-results">Use go-cmp to compare test results</h3>
<ul>
<li>It will output the differences between the expected and actual values in a human-readable format.</li>
<li>It can be used to compare for strict equality as well as with custom comparators.</li>
</ul>
<h2 id="table-tests">Table tests</h2>
<ul>
<li>Table tests are used to test a function with multiple inputs and outputs.</li>
<li>Table-driven tests are idiomatic in Go.</li>
<li>A slice of an anonymous struct is used to store the test cases.</li>
<li>The test function iterates over the test cases and runs the test for each of them.</li>
</ul>
<p>Given the following:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">adder</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">"testing"</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAdd</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Table of test cases</span>
<span class="w">    </span><span class="nx">tests</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w">     </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w">     </span><span class="kt">int</span>
<span class="w">        </span><span class="nx">expected</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="p">}{</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Positive integers"</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Negative integers"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Two zeros"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Negative and positive"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">"Two large integers"</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">test</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">test</span><span class="p">.</span><span class="nx">expected</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"Add(%d, %d) = %d; want %d"</span><span class="p">,</span><span class="w"> </span><span class="nx">test</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">test</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">test</span><span class="p">.</span><span class="nx">expected</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The output would look like this:</p>
<div class="highlight"><pre><span></span><code>=== RUN   TestAdd
=== RUN   TestAdd/Positive_integers
--- PASS: TestAdd/Positive_integers (0.00s)
=== RUN   TestAdd/Negative_integers
--- PASS: TestAdd/Negative_integers (0.00s)
=== RUN   TestAdd/Two_zeros
--- PASS: TestAdd/Two_zeros (0.00s)
=== RUN   TestAdd/Negative_and_positive
--- PASS: TestAdd/Negative_and_positive (0.00s)
=== RUN   TestAdd/Two_large_integers
--- PASS: TestAdd/Two_large_integers (0.00s)
--- PASS: TestAdd (0.00s)
PASS
ok    github.com/{USER}/{PROJECT}/adder    0.368s
</code></pre></div>
<h2 id="checking-code-coverage">Checking code coverage</h2>
<ul>
<li>The <code>-cover</code> flag can be used to check code coverage.</li>
<li><code>go test -coverprofile=coverage.out</code> is used to generate a coverage profile.</li>
<li>Go ships with a very cool tool to visualize the coverage profile: <code>go tool cover -html=coverage.out</code>.</li>
</ul>
<h2 id="benchmarks">Benchmarks</h2>
<ul>
<li>The built-in testing framework can be used to write benchmarks.</li>
<li>Benchmarks are functions that start with <code>Benchmark</code> and take a <code>*testing.B</code> parameter.</li>
<li>See <a href="https://jvns.ca/blog/2017/09/24/profiling-go-with-pprof/">Profiling Go programs with pprof</a> for more information on profiling Go programs.</li>
</ul>
<h2 id="stubs">Stubs</h2>
<ul>
<li>We can using function types and interfaces to create stubs.</li>
<li>A test function can implement an interface and be passed to the function under test.</li>
<li>A stub can be defined as a struct that implements the interface and has a field for each method of the interface. E.g., <code>type MathSolverStub struct {}</code>.</li>
<li>When testing larger interfaces, one can define a stub that implements only the methods required for the test.</li>
<li>For mocks, use a mocking library such as <a href="https://github.com/uber-go/mock">gomock</a> or <a href="https://github.com/stretchr/testify">testify</a>.</li>
</ul>
<h2 id="httptest"><code>httptest</code></h2>
<ul>
<li><code>httptest</code> is used to test <span class="caps">HTTP</span> servers without having to start them.</li>
<li>A complete, real-world example is provided in the <a href="https://github.com/learning-go-book/test_examples"><code>test_examples</code> repo</a>.</li>
</ul>
<h2 id="integration-tests-and-build-tags">Integration tests and build tags</h2>
<ul>
<li>Integration tests are used to test the interaction between multiple components.</li>
<li>A build tag is a comment that starts with <code>// +build</code> and is followed by a tag name, found on the first line of a file.</li>
<li>Files with no build tags are included in all builds.</li>
<li>If a file has a build tag like <code>// +build integration</code>, then it can be run with <code>go test -tags=integration -v ./...</code>.</li>
<li>To skip tests that take a long time to run, use <code>t.Skip</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestFileLen</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">testing</span><span class="p">.</span><span class="nx">Short</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">b</span><span class="p">.</span><span class="nx">Skip</span><span class="p">(</span><span class="s">"skipping test in short mode."</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// Skip it when testing in short mode</span>
<span class="c1">// go test -short -v ./...</span>
</code></pre></div>
<h2 id="finding-concurrency-problems-with-the-race-checker">Finding concurrency problems with the race checker</h2>
<ul>
<li>A <em>data race</em> is still possible in Go with its built-in concurrency features if a lock hasn’t been acquired.</li>
<li>Go comes with a race checker for just these cases: <code>go test -race</code>.</li>
<li>Adding “sleep” statements is definitely not the correct approach.</li>
<li>The race checker can also run after building a binary: <code>go build -race</code>. This is useful to detect race condition issues for code that is not covered by tests.</li>
<li>Note that the race checker makes the code about 10 times slower, so use it only when needed.</li>
</ul>
<hr/>
<h1 id="here-there-be-dragons-reflect-unsafe-and-cgo">Here There Be Dragons: Reflect, Unsafe, and Cgo</h1>
<ul>
<li>Theses features are not used that often, but they are useful to know about.</li>
<li>You cannot make make methods with reflection.</li>
<li>It should only be used when there is no other way to do it.</li>
<li>It may increase maintenance cost, because crashes can happen in production due to the lack of type safety (Java <em>cough</em> Script <em>cough</em>).</li>
<li>This summary will only cover their starting point.</li>
</ul>
<h2 id="reflection-to-work-with-types-at-runtime">Reflection to work with types at runtime</h2>
<ul>
<li>This can be used to work with data that didn’t exist at compile time.</li>
<li>Use cases:<ul>
<li>Reading and writing from a database;</li>
<li>Template engines;</li>
<li><code>fmt</code> uses it heavily;</li>
<li><code>errors</code> uses it to implement <code>errors.Is</code> and <code>errors.As</code>;</li>
<li><code>sort</code> uses it to sort slices of arbitrary types;</li>
<li>Marshalling/unmarshalling <span class="caps">JSON</span> and <span class="caps">XML</span>;</li>
<li>Comparing maps or slices for deep equality with <code>reflect.DeepEqual</code>.</li>
</ul>
</li>
</ul>
<h3 id="types-kinds-and-values">Types, kinds, and values</h3>
<ul>
<li>A type is a description of a value’s structure and behavior.</li>
<li>A kind is a description of a type’s behavior.</li>
<li>A value is a representation of a type’s behavior.</li>
<li>A type can have multiple kinds.</li>
<li>A value can have multiple types.</li>
<li><code>reflect.TypeOf</code> is used to get the type of a value.</li>
<li><code>reflect.Type</code> is used to represent a type.</li>
</ul>
<h3 id="making-new-values">Making new values</h3>
<ul>
<li><code>reflect.New</code> is used to create a new value of a type (<code>reflect.Type</code> as input, <code>reflect.Value</code> as output).</li>
</ul>
<h3 id="use-reflection-to-check-if-an-interfaces-value-is-nil">Use reflection to check if an interface’s value is <code>nil</code></h3>
<ul>
<li><code>IsValid</code> is used to check if a value is valid (e.g., <code>iv := reflect.ValueOf(i)</code>, <code>iv.IsValid()</code>, <code>iv.IsNil()</code>).</li>
</ul>
<h3 id="use-reflection-to-write-a-data-marshaler">Use reflection to write a data marshaler</h3>
<ul>
<li><code>reflect.ValueOf</code> is used to get the value of a field.</li>
<li><code>reflect.Type</code> is used to get the type of a field.</li>
<li><code>reflect.StructField</code> is used to get the field’s metadata.</li>
<li><code>reflect.StructTag</code> is used to get the struct tag.</li>
<li>There is a complete example of a <span class="caps">CSV</span> data marshaler <a href="https://go.dev/play/p/3kwe7ag1i1C">on the Go Playground</a>.</li>
</ul>
<h3 id="build-functions-with-reflection-to-automate-repetitive-tasks">Build functions with reflection to automate repetitive tasks</h3>
<ul>
<li><code>reflect.MakeFunc</code> is used to create a function.</li>
<li><code>reflect.ValueOf</code> is used to get the value of a function.</li>
<li><code>reflect.TypeOf</code> is used to get the type of a function.</li>
<li>Reflection makes the program slower.</li>
</ul>
<h3 id="you-can-build-structs-with-reflection-but-dont">You can build structs with reflection, but don’t</h3>
<ul>
<li><code>reflect.StructOf</code> is used to create a struct.</li>
</ul>
<h2 id="unsafe-is-unsafe"><code>unsafe</code>… is unsafe</h2>
<ul>
<li>It allows manipulating memory directly.</li>
<li><code>Sizeof</code> is used to get the size of a type (<em>“returns how many bytes it uses”</em>).</li>
<li><code>Offsetof</code> is used to get the offset of a field (<em>“returns the number of bytes from the start of the struct to the start of the field”</em>).</li>
<li><code>Alignof</code> is used to get the alignment of a field (<em>“returns the byte alignment it requires”</em>).</li>
<li><code>unsafe.Pointer</code> is used to convert a pointer to a pointer of a different type. Pointer arithmetic is possible just like in C or C++.</li>
</ul>
<h3 id="use-unsafe-to-convert-external-binary-data">Use unsafe to convert external binary data</h3>
<ul>
<li><code>unsafe</code> is used to convert external binary data.</li>
<li>It can be use to gain performance when interacting with the system.</li>
<li>It can speed up marshalling and unmarshalling (about twice as fast for simple structs).</li>
</ul>
<h3 id="unsafe-strings-and-slices">unsafe strings and slices</h3>
<ul>
<li><code>reflect.StringHeader</code> is used to get the header of a string.</li>
</ul>
<h2 id="cgo-is-for-integration-not-performance"><code>cgo</code> is for integration, not performance</h2>
<ul>
<li>It is best used to integrate with C libraries.</li>
<li><code>cgo</code> is the <span class="caps">FFI</span> (foreign function interface) of Go.</li>
<li>You can call C functions from Go… and even <em>Go functions from C</em>!</li>
<li>Garbage collection makes it hard to use <code>cgo</code> for performance.</li>
<li>Only use it when there’s no suitable Go library available.</li>
</ul>
<hr/>
<h1 id="a-look-at-the-future-generics-in-go">A Look at the Future: Generics in Go</h1>
<ul>
<li>Go doesn’t convert types implicitly.</li>
<li>For a gentle introduction to the topic, there is <a href="https://go.dev/doc/tutorial/generics">Tutorial: Getting started with generics</a>.</li>
</ul>
<h2 id="generics-reduce-repetitive-code-and-increase-type-safety_1">Generics reduce repetitive code and increase type safety</h2>
<ul>
<li>Generics are akin to “type parameters”.</li>
<li>Without generics, Go has to use <code>interface{}</code> and type assertions.</li>
<li><code>any</code> is used to represent any type.</li>
<li>Generics allow specifying the type of a generic function’s parameters, such as <code>func Sum[T any](a, b T) T { return a + b }</code>.</li>
</ul>
<h2 id="use-type-lists-to-specify-operators">Use type lists to specify operators</h2>
<ul>
<li>A “type list” is a list of types.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">BuiltInOrdered</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int8</span><span class="p">,</span><span class="w"> </span><span class="kt">int16</span><span class="p">,</span><span class="w"> </span><span class="kt">int32</span><span class="p">,</span><span class="w"> </span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">float32</span><span class="p">,</span><span class="w"> </span><span class="kt">float64</span><span class="p">,</span>
<span class="w">        </span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64</span><span class="p">,</span><span class="w"> </span><span class="kt">uintptr</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h1 id="salient-takeaways">Salient takeaways</h1>
<ul>
<li>Go is a <strong>practical</strong> language, valuing clarity of intent and readability (e.g., standard formatting is mandatory). It takes the best of other languages and leaves out the rest.</li>
<li>Comprehensibility and explicitness is more important than conciseness in idiomatic Go.</li>
<li>Go is “<em>call by value</em>“, meaning it makes copies of function parameters before passing them along.</li>
<li>Deployment is a breeze: a single binary file.</li>
<li>Go doesn’t have classes nor inheritance, but it has structs and interfaces.</li>
<li>Professionals use error handling profusely to make their programs more robust.</li>
</ul>
<hr/>
<h1 id="conclusion">Conclusion</h1>
<p>This book achieves its goal of teaching readers how to write idiomatic Go code that leverages the strengths of the language. It focuses on real-world examples and best practices to structure Go code, rather than just explaining language syntax. The book covers a wide range of topics including primitive types, control structures, composite types like arrays and maps, concurrency, reflection, testing, and more.</p>
<p>We covered the key takeaways from each chapter, providing a broad overview of important concepts. While not a replacement for reading the book in its entirety, this summary may serve as a helpful reference guide on the subject. Whether you are just starting with Go or are looking to improve your skills, <a href="https://www.oreilly.com/library/view/learning-go/9781492077206/">Learning Go</a> is an invaluable resource and I highly recommend it!</p>
<hr/>
<h1 id="resources-and-references">Resources and references</h1>
<h2 id="articles">Articles</h2>
<ul>
<li><a href="https://link.springer.com/article/10.1007/s10664-017-9508-2">Evaluating code complexity triggers, use of complexity measures and the influence of code complexity on maintenance time</a>, Springer</li>
<li><a href="https://go.dev/blog/v2-go-modules">Go Modules: v2 and Beyond</a>, go.dev</li>
<li><a href="https://go.dev/doc/devel/release">Go Release History</a>, go.dev</li>
<li><a href="https://en.wikipedia.org/wiki/Marshalling_(computer_science)">Marshalling</a>, Wikipedia</li>
<li><a href="https://jvns.ca/blog/2017/09/24/profiling-go-with-pprof/">Profiling Go programs with pprof</a>, Julia Evans</li>
</ul>
<h2 id="books">Books</h2>
<ul>
<li><a href="https://www.oreilly.com/library/view/concurrency-in-go/9781491941294/">Concurrency in Go</a>, Katherine Cox-Buday, O’Reilly</li>
<li><a href="https://www.oreilly.com/library/view/learning-go/9781492077206/">Learning Go</a>, Jon Bodner, O’Reilly</li>
<li><a href="https://www.oreilly.com/library/view/the-art-of/9780596802424/">The Art of Concurrency</a>, Clay Breshears, O’Reilly</li>
<li><a href="https://www.oreilly.com/library/view/the-go-programming/9780134190570/">The Go Programming Language</a>, Alan <span class="caps">A. A.</span> Donovan and Brian W. Kernighan, Addison-Wesley Professional</li>
</ul>
<h2 id="documentation">Documentation</h2>
<ul>
<li><a href="https://cs.opensource.google/go/go/+/refs/tags/go1.21.2:src/strconv/atof.go"><code>atof.go</code></a>, cs.opensource.google</li>
<li><a href="https://pkg.go.dev/builtin"><code>builtin</code> documentation</a>, pkg.go.dev</li>
<li><a href="https://github.com/golang/go/wiki/CodeReviewComments">CodeReviewComments</a>, GitHub</li>
<li><a href="https://go.dev/doc/effective_go">Effective Go</a>, go.dev</li>
<li><a href="https://pkg.go.dev/golang.org/x/sync/errgroup">ErrGroup</a>, pkg.go.dev</li>
<li><a href="https://gobyexample.com/">Go By Example</a>, gobyexample.com</li>
<li><a href="https://github.com/golang/go/wiki">Go Wiki</a>, GitHub</li>
<li><a href="https://go.dev/doc/code">How to Write Go Code</a>, go.dev</li>
<li><a href="https://pkg.go.dev/std">Standard library documentation</a>, pkg.go.dev</li>
<li><a href="https://go.dev/ref/spec">The Go Programming Language Specification</a>, go.dev</li>
</ul>
<h2 id="other-open-source-projects-referenced">Other open source projects referenced</h2>
<ul>
<li><a href="https://github.com/justinas/alice">Alice</a>, GitHub</li>
<li><a href="https://github.com/go-chi/chi">Chi</a>, GitHub</li>
<li><a href="https://github.com/google/go-cmp">go-cmp</a>, GitHub</li>
<li><a href="https://github.com/gorilla/mux">Gorilla Mux</a>, GitHub</li>
<li><a href="https://github.com/learning-go-book">Learning Go: Code examples</a>, GitHub</li>
<li><a href="https://github.com/marwan-at-work/mod">Mod</a>, GitHub</li>
</ul>
<h2 id="testing">Testing</h2>
<ul>
<li><a href="https://github.com/uber-go/mock">gomock</a>, GitHub</li>
<li><a href="https://jvns.ca/blog/2017/09/24/profiling-go-with-pprof/">Profiling Go programs with pprof</a>, Julia Evans</li>
<li><a href="https://github.com/learning-go-book/test_examples"><code>test_examples</code> repo</a>, GitHub</li>
<li><a href="https://pkg.go.dev/testing"><code>testing</code> package</a>, pkg.go.dev</li>
<li><a href="https://github.com/stretchr/testify">testify</a>, GitHub</li>
</ul>
<h2 id="videos">Videos</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=oL6JBUk6tj0">GopherCon 2018: Kat Zien - How Do You Structure Your Go Apps</a>, YouTube</li>
<li><a href="https://www.youtube.com/watch?v=YHRO5WQGh0k">GopherCon 2018: Kavya Joshi - The Scheduler Saga</a>, YouTube</li>
</ul></div>
</article>
        </main>
    </div>

    <footer>
      <hr />
      <p>
        Built with
        <a
          href="https://www.python.org/"
          target="_blank"
          rel="noopener noreferrer"
          ><svg
            width="1em"
            height="1em"
            viewBox="0 0 32 32"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            class="footer-icon"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M13.0164 2C10.8193 2 9.03825 3.72453 9.03825 5.85185V8.51852H15.9235V9.25926H5.97814C3.78107 9.25926 2 10.9838 2 13.1111L2 18.8889C2 21.0162 3.78107 22.7407 5.97814 22.7407H8.27322V19.4815C8.27322 17.3542 10.0543 15.6296 12.2514 15.6296H19.5956C21.4547 15.6296 22.9617 14.1704 22.9617 12.3704V5.85185C22.9617 3.72453 21.1807 2 18.9836 2H13.0164ZM12.0984 6.74074C12.8589 6.74074 13.4754 6.14378 13.4754 5.40741C13.4754 4.67103 12.8589 4.07407 12.0984 4.07407C11.3378 4.07407 10.7213 4.67103 10.7213 5.40741C10.7213 6.14378 11.3378 6.74074 12.0984 6.74074Z"
              fill="url(#paint0_linear_87_8204)"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M18.9834 30C21.1805 30 22.9616 28.2755 22.9616 26.1482V23.4815L16.0763 23.4815L16.0763 22.7408L26.0217 22.7408C28.2188 22.7408 29.9998 21.0162 29.9998 18.8889V13.1111C29.9998 10.9838 28.2188 9.25928 26.0217 9.25928L23.7266 9.25928V12.5185C23.7266 14.6459 21.9455 16.3704 19.7485 16.3704L12.4042 16.3704C10.5451 16.3704 9.03809 17.8296 9.03809 19.6296L9.03809 26.1482C9.03809 28.2755 10.8192 30 13.0162 30H18.9834ZM19.9015 25.2593C19.1409 25.2593 18.5244 25.8562 18.5244 26.5926C18.5244 27.329 19.1409 27.9259 19.9015 27.9259C20.662 27.9259 21.2785 27.329 21.2785 26.5926C21.2785 25.8562 20.662 25.2593 19.9015 25.2593Z"
              fill="url(#paint1_linear_87_8204)"
            />
            <defs>
              <linearGradient
                id="paint0_linear_87_8204"
                x1="12.4809"
                y1="2"
                x2="12.4809"
                y2="22.7407"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#327EBD" />
                <stop offset="1" stop-color="#1565A7" />
              </linearGradient>
              <linearGradient
                id="paint1_linear_87_8204"
                x1="19.519"
                y1="9.25928"
                x2="19.519"
                y2="30"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#FFDA4B" />
                <stop offset="1" stop-color="#F9C600" />
              </linearGradient>
            </defs>
          </svg>
          Python</a
        >
        using
        <a
          href="http://getpelican.com"
          target="_blank"
          rel="noopener noreferrer"
          ><svg
            fill="hsl(211, 100%, 95%)"
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            role="img"
            xmlns="http://www.w3.org/2000/svg"
            class="footer-icon"
          >
            <title>Pelican icon</title>
            <path
              d="M.9418 0c.342 1.0548 1.8764 2.1857 2.9063 2.6238 1.3134.5583 2.5984.6849 3.7501.8122.895.0963 1.7019.2014 2.3439.4998.1622.0726.3288.148.4688.2499.4586.3364.9464.9876 1.2813 1.4368.7186.9583.5858 1.7451 1.4375 2.2178.089.0492.1683.083.2813.125.271.1018.667.2273.8437-.1563a.788.788 0 00.0625-.1874c-.0712-.229-.321-.4327-.4687-.531-.2618-.171-.3735-.274-.5625-.4685-.3494-.3583-.348-.9508-.5938-1.3744.3092-.131 1.9392-.3597 2.2813-.3124.7313.0326 1.31.0782 1.75.531.1727.1365.2497.2567.4064.3749.011.009.0202.024.0312.0312.6933.5037 1.3388.6705 1.9063.8434.1496.0454.2988.1054.4375.1562.213.0763.4065.1594.5938.281.2222.1474.6089.542.625.8747-.5587-.1783-.207.0323-1.0313-.0312-.4019-.0456-.8058-.0647-1.2187-.0937-.6422-.0454-1.273-.1043-1.8751-.2187-.1002-.0184-.2146-.0388-.3125-.0625-.0766-.0163-.146-.011-.2188-.0312-.0018.0308 0 .0353 0 .0625-.0166.6292.4214.9586-.5938 2.1553-.009.0127-.0204.0167-.0312.0312-.2695.3147-1.657.9163-2.0938 1.0308-1.8593.3728-3.292-.828-5.5315-.2187-.7877.2928-1.3567 1.5756-1.7188 2.5302-.482 1.2677-.8758 2.7956-1.3126 4.3106-.2.6982-.4178 1.4015-.6562 2.0616-.575 1.584-1.3113 2.9428-2.4064 3.717-.1638.1256-.787.41-.8125.6248.404.2037 4.185.056 4.8127 0 2.5033-.2184 3.6468-1.7733 4.4689-3.9045.5659-1.462 1.065-3.9864 2.0313-5.3102.0128-.0182.0183-.015.0313-.0312.1456-.1967.327-.3691.5-.4998.0454-.0347.0775-.0648.125-.0937.0344-.0219.1566-.0592.3438-.0937 1.7357-.3074 9.3491-1.3474 9.844-6.872.051-.5581.0158-1.1588-.0937-1.8117-.0543-.3364-.115-.6653-.2187-1.0308-.2457-.8691-.7981-1.614-1.5313-2.2177-.1926-.16-.405-.3285-.625-.4686-.846-.54-1.8774-.921-2.969-1.1557-.7332-.1582-1.4874-.239-2.25-.25C9.8402.0326 6.3978.2075.9418 0zm1.625 4.2169c.0235.0382.0389.0574.0625.0937C4.2284 6.8382 6.239 6.8135 8.067 7.0281c.666.0782 1.317.1849 1.9063.4686.262.1235.5116.2649.75.4685-.0292-.131-.076-.2564-.125-.3748-.444-1.0763-1.6487-1.6661-2.6875-1.9679-1.3938-.4984-2.4038-.0181-5.344-1.4056zm1.4063 3.186c.0107.0528.0094.0946.0313.1563.2199.6346 1.0403 1.6503 2.0938 1.8741.4567.1636.315.1174 1.0938.0937 1.1406-.0581 1.692-.0793 2.5.25-.02-.0493-.0423-.1091-.0624-.1563C9.0074 8.175 8.2593 8.421 5.8794 8.2464c-1.0188-.3074-1.2587-.3415-1.9063-.8434z"
            />
          </svg>
          Pelican</a
        >, by Sébastien Lavoie.
        <a
          href="https://github.com/sglavoie/sglavoie.github.io/blob/main/LICENSE"
          >MIT Licensed</a
        >.
      </p>
      <p id="rss-feed">
        <a href="https://www.sglavoie.com/feeds/sglavoie.rss.xml"
          ><svg
            width="1em"
            height="1em"
            viewBox="0 0 44 44"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
          >
            <title>RSS Feed</title>
            <desc>Created with Sketch.</desc>
            <defs></defs>
            <g
              id="Icons"
              stroke="none"
              stroke-width="1"
              fill="none"
              fill-rule="evenodd"
            >
              <g
                id="Color-"
                transform="translate(-800.000000, -760.000000)"
                fill="#FF9A00"
              >
                <path
                  d="M800.000471,797.714286 C800.000471,794.243 802.81487,791.428571 806.286118,791.428571 C809.757367,791.428571 812.571765,794.243 812.571765,797.714286 C812.571765,801.185571 809.757367,804 806.286118,804 C802.81487,804 800.000471,801.185571 800.000471,797.714286 Z M844,804 L835.619661,804 C835.619661,784.358714 819.641547,768.380429 800.000471,768.380429 L800.000471,760 C824.261497,760 844,779.738714 844,804 Z M829.333543,804 L820.953204,804 C820.953204,792.446857 811.553019,783.048143 800,783.048143 L800,774.666143 C816.174541,774.666143 829.333543,787.825286 829.333543,804 Z"
                  id="RSS"
                ></path>
              </g>
            </g>
          </svg>
        </a>
      </p>
    </footer>

    <script src="/pagefind/pagefind-ui.js"></script>
    <script src="/theme/scripts/sweetalert2.min.js"></script>
    <script>
      function openSearchModal() {
        Swal.fire({
          title: "<strong>Search</strong>",
          html: `
    <div id="searchWrapper">
      <div id="search"></div>
    </div>`,
          showCancelButton: false,
          focusConfirm: false,
          didOpen: () => {
            new PagefindUI({
              element: "#search",
              showSubResults: true,
              showImages: false,
              debounceTimeoutMs: 100,
            });
            document
              .getElementById("search")
              .getElementsByTagName("input")[0]
              .focus();

            // Re-focus on search input when clear button is clicked
            document
              .getElementsByClassName("pagefind-ui__search-clear")[0]
              .addEventListener("click", function () {
                document
                  .getElementById("search")
                  .getElementsByTagName("input")[0]
                  .focus();
              });
          },
          width: "100%",
          confirmButtonText: "Close",
          position: "top-start",
        });
      }

      document
        .getElementById("search-icon")
        .addEventListener("click", function () {
          openSearchModal();
        });

      // Key press event for the 'F' key
      document.addEventListener("keydown", function (e) {
        // Check if modal is not already focused/open
        if (e.key === "F" && !Swal.isVisible()) {
          openSearchModal();
        }
      });
    </script>
  </body>
</html>