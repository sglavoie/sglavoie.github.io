<!DOCTYPE html>
<html lang="en">
<head>
          <title>Bash History&nbsp;Cleaner | sglavoie.com</title>
        <link href="https://www.sglavoie.com/feeds/sglavoie.rss.xml" type="application/rss+xml" rel="alternate" title="sglavoie.com Full RSS Feed" />

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/theme/images/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/theme/images/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/theme/images/favicon-16x16.png">
        <link rel="manifest" href="/theme/images/site.webmanifest">
        <link rel="mask-icon" href="/theme/images/safari-pinned-tab.svg" color="#5bbad5">
        <link rel="shortcut icon" href="/theme/images/favicon.ico">
        <meta name="msapplication-TileColor" content="#ffc40d">
        <meta name="msapplication-config" content="/theme/images/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">


        <!-- Font Awesome Icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

        <!-- Custom CSS -->
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <link href='/theme/css/base.css' rel='stylesheet' type='text/css'>
        <link href='/theme/css/pygment.css' rel='stylesheet' type='text/css'>






    <meta name="tags" content="bash" />
    <meta name="tags" content="python" />
    <meta name="tags" content="regex" />
    <meta name="tags" content="terminal" />

</head>

<body id="index" class="home">

<nav id="bg-darker" class="navbar navbar-expand-lg navbar-dark">
      <a class="brand-link" href="/">
          <img class="brand-logo hover-img" src="/theme/images/sglavoie.svg" alt="sglavoie.svg">
      </a>
  <button class="navbar-toggler hover-img" type="button" data-toggle="collapse" data-target="#sglavoie-menu" aria-controls="sglavoie-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    Main Menu
  </button>

  <div class="collapse navbar-collapse" id="sglavoie-menu">
      <div class="to-the-right">
          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">

    <li class="nav-item ">
        <a class="nav-link" href="/index.html"><i class="fas fa-home"></i> home</a>
    </li>
    <li class="nav-item ">
        <a class="nav-link" href="/tags.html"><i class="fas fa-hashtag"></i> tags</a>
    </li>
    <li class="nav-item ">
        <a class="nav-link" href="/learning-progress.html"><i class="fas fa-graduation-cap"></i> learning</a>
    </li>
    <li class="nav-item ">
        <a class="nav-link" href="/about.html"><i class="fas fa-info"></i> about</a>
    </li>
          </ul>
      </div>
  </div>
</nav>

<nav id="menu" class="navbar navbar-expand-lg navbar-dark">

  <button class="navbar-toggler hover-img" type="button" data-toggle="collapse" data-target="#sglavoie-menu-second" aria-controls="sglavoie-menu-second" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    Categories
  </button>

  <div class="collapse navbar-collapse" id="sglavoie-menu-second">
      <div id="menu-categories-legend-id" class="menu-categories-legend">
          <a href="/categories.html"><img class="img-categories" src="/theme/images/categories.svg"></a>
      </div>
          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
              <li class="nav-item active">
              </li>
              <li id="submenu-categories-legend" class="nav-item">
            <a class="lowercase-title nav-link-smallest always-white" href="/categories.html">All</a>
              </li>

              <li class="nav-item">
            <a class="lowercase-title always-white nav-link-smaller" href="https://www.sglavoie.com/category/automation.html">automation</a>
              </li>

              <li class="nav-item">
            <a class="lowercase-title always-white nav-link-smaller" href="https://www.sglavoie.com/category/tips-and-tricks.html">tips-and-tricks</a>
              </li>

              <li class="nav-item">
            <a class="lowercase-title always-white nav-link-smaller" href="https://www.sglavoie.com/category/workflow.html">workflow</a>
              </li>
          </ul>
  </div>
</nav>

        <!-- /#menu -->


    <section id="content" class="jumbotron body">
        <header>
            <h2 class="display-4">
                <a href="https://www.sglavoie.com/posts/2018/12/23/bash-history-cleaner/" rel="bookmark"
                    title="Permalink to Bash History Cleaner">Bash History&nbsp;Cleaner</a></h2>
            
        </header>
        <footer class="post-info">
            <i class="fas fa-calendar-alt"></i> <time class="published" datetime="2018-12-23T19:35:00-06:00">
                December 23, 2018
            </time>
             <time class="modified" datetime="2019-01-06T14:37:00-06:00">
                <i class="fas fa-angle-double-right"></i> modified on January 06, 2019
            </time>
            <address class="vcard author">
            </address>
            <div class="category">
                <i class="fas fa-tag"></i> Category: <a class="emphasis post-info-space" href="https://www.sglavoie.com/category/automation.html">automation</a>
            </div>
            <div class="tags">
                <i class="fas fa-hashtag"></i> Tags:
                <a class="emphasis post-info-space" href="https://www.sglavoie.com/tag/bash.html">bash</a>
                <a class="emphasis post-info-space" href="https://www.sglavoie.com/tag/python.html">python</a>
                <a class="emphasis post-info-space" href="https://www.sglavoie.com/tag/regex.html">regex</a>
                <a class="emphasis post-info-space" href="https://www.sglavoie.com/tag/terminal.html">terminal</a>
            </div>
        </footer><!-- /.post-info -->
  <hr class="my-4">
  <div class="card">
      <div class="card-body entry-content">
          <p>This is a Python 3.6+ script that helps to clean the file containing the Bash history commands. It will remove any line matching a specified regular expression and can also remove any line starting with an&nbsp;alias.</p>
<p>The idea behind this small utility was&nbsp;simple:</p>
<ul>
<li>The Bash history file (usually located in <code>~/.bash_history</code>) contains much of the work one ends up doing in the&nbsp;terminal.</li>
<li>The history can grow large over time and it becomes more cumbersome to find interesting information in all that clutter, such as a rarely used command with specific&nbsp;flags.</li>
<li>By removing all superfluous commands that are repeated often and which give no real benefit in certain contexts (such as <code>ls</code>, <code>cd</code>, <code>cat</code>, etc.), the history is much cleaner and easier to navigate and actually becomes much more useful in my&nbsp;opinion.</li>
<li>True, it will be harder to follow the bread crumbs for everything you did, but I haven&#8217;t come across a situation where having access to yet another empty <code>ls</code> or <code>cd</code> has proven necessary and reading <code>.bash_history</code> doesn&#8217;t make for a great narrative story&nbsp;either.</li>
</ul>
<hr>
<h2>Make history in a big&nbsp;way</h2>
<p>I took advantage of the fact that the history can be cleaned with the script you are about to see and set up what is known as an <em>eternal history</em> which, as it sounds like, can grow infinitely big! All you have to do is append the following lines to the file <code>~/.bashrc</code>:</p>
<div class="highlight"><pre><span></span><span class="c1"># Eternal bash history.</span>
<span class="c1"># ---------------------</span>
<span class="c1"># Undocumented feature which sets the size to &quot;unlimited&quot;.</span>
<span class="c1"># http://stackoverflow.com/questions/9457233/unlimited-bash-history</span>
<span class="nb">export</span> <span class="nv">HISTFILESIZE</span><span class="o">=</span>-1
<span class="nb">export</span> <span class="nv">HISTSIZE</span><span class="o">=</span>-1
<span class="nb">export</span> <span class="nv">HISTTIMEFORMAT</span><span class="o">=</span><span class="s2">&quot;[%F %T] &quot;</span>
<span class="c1"># Change the file location because certain bash sessions truncate .bash_history file upon close.</span>
<span class="c1"># http://superuser.com/questions/575479/bash-history-truncated-to-500-lines-on-each-login</span>
<span class="nb">export</span> <span class="nv">HISTFILE</span><span class="o">=</span>~/.bash_eternal_history
<span class="c1"># Force prompt to write history after every command.</span>
<span class="c1"># http://superuser.com/questions/20900/bash-history-loss</span>
<span class="nv">PROMPT_COMMAND</span><span class="o">=</span><span class="s2">&quot;history -a; </span><span class="nv">$PROMPT_COMMAND</span><span class="s2">&quot;</span>
</pre></div>


<hr>
<h2>Bash History&nbsp;Cleaner</h2>
<p>And here is the script in question *. It comes in two files that need to be in the same&nbsp;directory:</p>
<ul>
<li>One is a Python file that needs to be launched from the terminal with Python&nbsp;3.</li>
<li>The other file, <code>settings.json</code>, is a <span class="caps">JSON</span> file used to store the settings of the script, which will be detailed&nbsp;below.</li>
</ul>
<p>* <sub>Improvements to the original script can be found on <a href="https://github.com/sglavoie/python-utilities/tree/master/bash_history_cleaner">Github</a> <i class="fab fa-github-alt"></i>. To keep this article a bit more readable, the original version is shown.</sub> </p>
<h5><code>bash_history_cleaner.py</code></h5>
<div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Python script that helps to clean the file containing the Bash history</span>
<span class="sd">commands.</span>

<span class="sd">Note: Requires Python 3.6+</span>

<span class="sd">It will remove any line matching a specified regular expression and can also</span>
<span class="sd">remove any line starting with an alias.</span>

<span class="sd">Description of available settings in `settings.json`:</span>

<span class="sd">    &quot;home_directory&quot;:   Absolute path to user&#39;s home directory.</span>

<span class="sd">    &quot;history_file&quot;:     Name of file where the history will be cleaned up.</span>

<span class="sd">    &quot;aliases_file&quot;:     Name of file where Bash aliases are set up.</span>

<span class="sd">    &quot;ignore_patterns&quot;:  List of patterns to ignore in `history_file`.</span>
<span class="sd">                        Each line where a pattern is found will be deleted.</span>
<span class="sd">                            → Patterns are specified as regular expressions.</span>

<span class="sd">    &quot;add_aliases&quot;:      Boolean. If set to `true`, aliases from `aliases_file`</span>
<span class="sd">                        will be added to `ignore_patterns`.</span>

<span class="sd">    &quot;aliases_match_greedily&quot;:</span>
<span class="sd">                        Boolean. If set to `true`, any line in `history_file`</span>
<span class="sd">                        starting with an alias in `aliases_file` will be</span>
<span class="sd">                        deleted. If set to `false`, delete line if the alias is</span>
<span class="sd">                        the content of the whole line (with optional space at</span>
<span class="sd">                        the end): `false` matches &quot;^alias$&quot; or &quot;^alias $&quot; only.</span>

<span class="sd">    &quot;backup_history&quot;:   Boolean. If set to `true`, `history_file` will be backed</span>
<span class="sd">                        up in the same directory with a name ending in .bak</span>
<span class="sd">                        based on the current date.</span>

<span class="sd">    &quot;delete_logs_without_confirming&quot;:</span>
<span class="sd">                        Boolean. If set to `true`, script with flag `-c` will</span>
<span class="sd">                        automatically delete all the backup files found for</span>
<span class="sd">                        `history_file`.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="k">def</span> <span class="nf">get_current_path</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Returns the current working directory relative to where this script</span>
<span class="sd">    is being executed.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">user_says_yes</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Check if user input is either &#39;y&#39; or &#39;n&#39;. Returns a boolean.&#39;&#39;&#39;</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Please enter either &#39;y&#39; or &#39;n&#39;.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">choice</span>


<span class="k">def</span> <span class="nf">delete_logs</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">history_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Delete log files in `home_directory` based on `history_file`.&#39;&#39;&#39;</span>

    <span class="c1"># Retrieve a list of all matching log files</span>
    <span class="n">log_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{history_file}_*.bak&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">log_files</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;There is no log file to delete.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Log files found in {settings[&quot;home_directory&quot;]}:&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">log_file</span> <span class="ow">in</span> <span class="n">log_files</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;delete_logs_without_confirming&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">log_file</span> <span class="ow">in</span> <span class="n">log_files</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Log files deleted.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Do you want to delete those log files? [y/n] &quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">user_says_yes</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">log_file</span> <span class="ow">in</span> <span class="n">log_files</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Log files deleted.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Operation aborted.&#39;</span><span class="p">)</span>
    <span class="k">return</span>


<span class="k">def</span> <span class="nf">generate_date_string</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Return date formatted string to backup a file.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="s1">&#39;_%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S.bak&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">load_settings</span><span class="p">(</span><span class="n">settings_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Load settings in the script. Return them as a dictionary.&#39;&#39;&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">settings_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">read_file</span><span class="p">:</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">read_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">settings</span>


<span class="k">def</span> <span class="nf">get_list_aliases</span><span class="p">(</span><span class="n">bash_aliases_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Retrieve the name of all the aliases specified in `bash_aliases_file`.</span>

<span class="sd">    Return aliases as a list of strings formatted as regular expressions.&#39;&#39;&#39;</span>

    <span class="n">match_whole_line</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;aliases_match_greedily&#39;</span><span class="p">])</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bash_aliases_file</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>  <span class="c1"># one alias per line</span>
        <span class="n">aliases_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Get the actual alias in each line</span>
                <span class="c1"># Use negative lookbehind to remove &#39;alias &#39; at the beginning.</span>
                <span class="c1"># Matches anything after that is a dot, digit, underscore</span>
                <span class="c1"># or letter (will stop at the equal sign: alias blah=&#39;...&#39;)</span>
                <span class="n">alias</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?&lt;!not )alias ([\.\w]*)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># If for some reason the alias cannot be extracted, skip it</span>
            <span class="c1"># If search doesn&#39;t match, it&#39;s of type None and won&#39;t work</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">match_whole_line</span><span class="p">:</span>
                <span class="c1"># Match the whole line if it starts with the alias.</span>
                <span class="n">alias</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;^{alias}( )?$|^{alias} .*&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Will match only when alias is the whole content of the line,</span>
                <span class="c1"># followed by optional space.</span>
                <span class="n">alias</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;^{alias}( )?$&#39;</span>

            <span class="c1"># Escape dots in alias</span>
            <span class="n">alias</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">({</span><span class="s2">&quot;.&quot;</span><span class="p">:</span>  <span class="sa">r</span><span class="s2">&quot;\.&quot;</span><span class="p">}))</span>

            <span class="n">aliases_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">aliases_list</span>


<span class="k">def</span> <span class="nf">clean_bash_history</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">history_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Modify in place `history_file` by removing every line where</span>
<span class="sd">    `ignore_patterns` is found.</span>

<span class="sd">    Optionally, add a list of aliases to `ignore_patterns` with</span>
<span class="sd">    `aliases` based on the value of `add_aliases` in settings.json.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;backup_history&#39;</span><span class="p">]:</span>
        <span class="n">backup_str</span> <span class="o">=</span> <span class="n">generate_date_string</span><span class="p">()</span>
        <span class="n">file_input</span> <span class="o">=</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">FileInput</span><span class="p">(</span><span class="n">history_file</span><span class="p">,</span>
                                         <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                         <span class="n">backup</span><span class="o">=</span><span class="n">backup_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_input</span> <span class="o">=</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">FileInput</span><span class="p">(</span><span class="n">history_file</span><span class="p">,</span>
                                         <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">file_input</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
            <span class="n">has_match</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;ignore_patterns&#39;</span><span class="p">]:</span>
                <span class="n">matched</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
                <span class="k">if</span> <span class="n">matched</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="n">has_match</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">break</span>
            <span class="c1"># If no match is found (nothing to ignore), print the line</span>
            <span class="c1"># back into the file. Otherwise, it will be empty.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_match</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Line already has carriage return</span>


<span class="k">def</span> <span class="nf">launch_cleanup</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">history_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">aliases_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Main function that launches the cleanup process.&#39;&#39;&#39;</span>

    <span class="n">bash_aliases</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;add_aliases&#39;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bash_aliases</span> <span class="o">=</span> <span class="n">get_list_aliases</span><span class="p">(</span><span class="n">aliases_file</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

            <span class="c1"># add aliases to list of patterns to ignore</span>
            <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;ignore_patterns&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bash_aliases</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">FileNotFoundError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;File not found: {aliases_file}&quot;</span><span class="p">)</span>
            <span class="n">quit</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">clean_bash_history</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">history_file</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">FileNotFoundError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;File not found: {history_file}&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">SETTINGS_FILE_PATH</span> <span class="o">=</span> <span class="n">get_current_path</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;settings.json&#39;</span>
    <span class="n">SETTINGS</span> <span class="o">=</span> <span class="n">load_settings</span><span class="p">(</span><span class="n">SETTINGS_FILE_PATH</span><span class="p">)</span>
    <span class="n">ALIASES_FILE</span> <span class="o">=</span> <span class="n">SETTINGS</span><span class="p">[</span><span class="s1">&#39;home_directory&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">SETTINGS</span><span class="p">[</span><span class="s1">&#39;aliases_file&#39;</span><span class="p">]</span>
    <span class="n">HISTORY_FILE</span> <span class="o">=</span> <span class="n">SETTINGS</span><span class="p">[</span><span class="s1">&#39;home_directory&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">SETTINGS</span><span class="p">[</span><span class="s1">&#39;history_file&#39;</span><span class="p">]</span>

    <span class="c1"># initiate the parser to check all the arguments passed to the script</span>
    <span class="n">PARSER</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">PARSER</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--clear&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Delete all log files&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>

    <span class="c1"># read arguments from the command line</span>
    <span class="n">ARGUMENTS</span> <span class="o">=</span> <span class="n">PARSER</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">ARGUMENTS</span><span class="o">.</span><span class="n">clear</span><span class="p">:</span>
        <span class="n">delete_logs</span><span class="p">(</span><span class="n">SETTINGS</span><span class="p">,</span> <span class="n">HISTORY_FILE</span><span class="p">)</span>
        <span class="n">quit</span><span class="p">()</span>

    <span class="n">launch_cleanup</span><span class="p">(</span><span class="n">SETTINGS</span><span class="p">,</span> <span class="n">HISTORY_FILE</span><span class="p">,</span> <span class="n">ALIASES_FILE</span><span class="p">)</span>
</pre></div>


<h5><code>settings.json</code></h5>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;home_directory&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/sglavoie&quot;</span><span class="p">,</span>
    <span class="nt">&quot;history_file&quot;</span><span class="p">:</span> <span class="s2">&quot;.bash_eternal_history&quot;</span><span class="p">,</span>
    <span class="nt">&quot;add_aliases&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;aliases_file&quot;</span><span class="p">:</span> <span class="s2">&quot;.bash_aliases&quot;</span><span class="p">,</span>
    <span class="nt">&quot;aliases_match_greedily&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;backup_history&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;delete_logs_without_confirming&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;ignore_patterns&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;^\\#\\d+&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^(\\.\\/)?pip$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^(\\.\\/)?python.*$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^\\.\\.$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^alias&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^cd &quot;</span><span class="p">,</span>
        <span class="s2">&quot;^cd$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^cd..$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^fg$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^df( )?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^du( )?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^exit$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^git branch&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^git checkout master&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^git log$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^git push$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^git status$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^git stauts$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^kill \\d+.*&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^ls -a$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^ls$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^make|make install$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^man &quot;</span><span class="p">,</span>
        <span class="s2">&quot;^pelican( )?$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^pip install -r requirements.txt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^pip.* list|pip.* show$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^source &quot;</span><span class="p">,</span>
        <span class="s2">&quot;^sudo apt-get autoclean|sudo apt-get autoremove$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^sudo apt-get dist-upgrade|sudo apt-get update$&quot;</span><span class="p">,</span>
        <span class="s2">&quot;^which &quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<hr>
<h2>Description of available settings in <code>settings.json</code></h2>
<table>
<thead>
<tr>
<th>Name of setting</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>home_directory</code></td>
<td>Absolute path to user&#8217;s home directory.</td>
</tr>
<tr>
<td><code>history_file</code></td>
<td>Name of file where the history will be cleaned up.</td>
</tr>
<tr>
<td><code>aliases_file</code></td>
<td>Name of file where Bash aliases are set up.</td>
</tr>
<tr>
<td><code>ignore_patterns</code></td>
<td>List of patterns to ignore in <code>history_file</code>. Each line where a pattern is found will be deleted. Patterns are specified as regular expressions.</td>
</tr>
<tr>
<td><code>add_aliases</code></td>
<td>Boolean. If set to <code>true</code>, aliases from <code>aliases_file</code> will be added to <code>ignore_patterns</code>. (Default: <code>true</code>)</td>
</tr>
<tr>
<td><code>aliases_match_greedily</code></td>
<td>Boolean. If set to <code>true</code>, any line in <code>history_file</code> starting with an alias in <code>aliases_file</code> will be deleted. If set to <code>false</code>, delete line if the alias is the content of the whole line (with optional space at the end): <code>false</code> matches &#8220;^alias$&#8221; or &#8220;^alias $&#8221; only.</td>
</tr>
<tr>
<td><code>backup_history</code></td>
<td>Boolean. If set to <code>true</code>, <code>history_file</code> will be backed up in the same directory with a name ending in .bak based on the current date. (Default: <code>true</code>)</td>
</tr>
<tr>
<td><code>delete_logs_without_confirming</code></td>
<td>Boolean. If set to <code>true</code>, script with flag <code>-c</code> will automatically delete all the backup files found for <code>history_file</code>. (Default: <code>false</code>)</td>
</tr>
</tbody>
</table>
<hr>
<h2>Anecdotal evidence of satisfying <span style="white-space: nowrap">performances</span></h2>
<p>Performance-wise, this scans ~8,300 lines per second on my modest Intel Core i5 laptop with files of over 200,000 lines long. Not that I type so much stuff in the terminal: I just duplicated many lines <i class="fas fa-smile"></i>.</p>
<hr>
<h2>Conclusion</h2>
<p>This is a simple solution to an nonexistent problem, but it was in the end very instructive to me nonetheless. You may even find a use for it! Otherwise, you might use the same functions for other files such as logs! If you would like to take a closer look at the source in a more convenient way, you can find the code <a href="https://github.com/sglavoie/python-utilities/tree/master/bash_history_cleaner">available on Github</a> <i class="fab fa-github-alt"></i>.</p>
      </div>
  </div>
        <!-- /.entry-content -->

	<hr>

	<h2 class="display-4"><i class="fas fa-comment-alt"></i> Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
    // Substitute single quotation mark (') for double (") to allow
    // article's title to contain single quotes.
    var disqus_shortname = "sglavoie"; 
    var disqus_title = "Bash History&nbsp;Cleaner";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    </section>
        <div class="footer-borders">
            <footer id="contentinfo" class="body bg-border hover-footer-bg">

        <address class="footer-icons">

            <div class="get-in-touch-icons">

            <ul class="social-footer">

        <li><a href="https://github.com/sglavoie"><img src="/theme/images/footer/github.svg"></a></li>
        <li><a href="https://www.twitter.com/sgdlavoie"><img src="/theme/images/footer/twitter.svg"></a></li>
        <li><a href="https://www.linkedin.com/in/sglavoie"><img src="/theme/images/footer/linkedin.svg"></a></li>
        <li><a href="https://www.hackerrank.com/sglavoie"><img src="/theme/images/footer/hackerrank.svg"></a></li>
        <li><a href="https://stackoverflow.com/users/story/8787680"><img src="/theme/images/footer/stackoverflow.svg"></a></li>

        </div>

      </address>

      <address id="about" class="vcard body">
          Proudly powered by <a href="http://getpelican.com/">Pelican 4.0.1<img class="footer-bottom-icon" src="/theme/images/footer/pelican.svg"></a>,
          which takes great advantage of <a href="http://python.org">Python<img class="footer-bottom-icon" src="/theme/images/footer/python.svg"></a> .

          <div>
              <script type="text/javascript" language="javascript">
                  <!--
// Email obfuscator script 2.1 by Tim Williams, University of Arizona
// Random encryption key feature coded by Andrew Moulden
// This code is freeware provided these four comment lines remain intact
// A wizard to generate this code is at http://www.jottings.com/obfuscator/
{ coded = "Efp9ExWfz@EoU9R5Wf.45D"
    key = "RXmOLk0xFelpj9ihYV4PZ5AGDB3wsKdfUn12WHJgvqNIrCytS8EbQa6zuMc7To"
    shift=coded.length
    link=""
    for (i=0; i<coded.length; i++) {
        if (key.indexOf(coded.charAt(i))==-1) {
            ltr = coded.charAt(i)
            link += (ltr)
        }
        else {     
            ltr = (key.indexOf(coded.charAt(i))-shift+key.length) % key.length
            link += (key.charAt(ltr))
        }
    }
    // Adding inline style to 'img' tag as it seems to be more trustworthy inside this script.
    document.write("<ul class='social-footer'><li><a style='font-weight: normal' href='mailto:"+link+"'>Would you like to email me? "+"<img style='height: 16px; width: auto' src='/theme/images/footer/email.svg'>"+"</a></li></ul>")
}
//-->
              </script><noscript>Sorry, you need Javascript on to email me.</noscript>
          </div>

      <div id="author-footer">
          Copyleft <span class="copy-left">©</span> 2019 | Sébastien Lavoie 

      </div>
      <div id="version-footer">
                v0.5.2
      </div>
                </address>
                
                <!-- /#about -->
            </footer>

        </div>
        <!-- /#contentinfo -->

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


    <!-- Disqus comment counts for each article -->
<script id="dsq-count-scr" src="//sglavoie.disqus.com/count.js" async></script>
</body>
</html>