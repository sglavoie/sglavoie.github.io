<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" type="text/css" href="../../../../../theme/css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../theme/css/pygments.css" />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Sébastien Lavoie" />
    <meta name="description"
        content="Posts and writings by Sébastien Lavoie. Customization setups and articles on productivity for developers who like minimalism." />
    <meta name="title" property="og:title" content="sglavoie.com" />
    <meta property="og:type" content="Website" />
    <meta name="image" property="og:image" content="../../../../../theme/images/logo_1200x627.png" />

     <link href="https://www.sglavoie.com/feeds/sglavoie.rss.xml" type="application/rss+xml" rel="alternate"
        title="sglavoie.com RSS" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" href="/theme/favicon/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/theme/favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/theme/favicon/favicon-16x16.png" />
    <link rel="manifest" href="/theme/favicon/site.webmanifest" />
    <link rel="mask-icon" href="/theme/favicon/safari-pinned-tab.svg" color="#5bbad5" />
    <link rel="shortcut icon" href="/theme/favicon/favicon.ico" />
    <meta name="msapplication-TileColor" content="#2d89ef" />
    <meta name="msapplication-TileImage" content="/theme/favicon/mstile-144x144.png" />
    <meta name="msapplication-config" content="/theme/favicon/browserconfig.xml" />
    <meta name="theme-color" content="#000000" />
    <meta name="msapplication-config" content="/theme/favicon/browserconfig.xml" />
    <meta name="theme-color" content="#000000" />

<meta name="keywords" content="bash, i3, rofi, script, tmux">

<!-- Open graph for social networks -->
<meta name="og:title" property="og:title" content="Open and close projects with tmux sessions in a breeze via two keyboard shortcuts.">

    <title>sglavoie.com &ndash; Managing multiple tmux sessions at&nbsp;once</title>

    <!-- Enable tracking of web traffic -->
<script type="text/javascript">
    var _gaq = _gaq || []
    _gaq.push(['_setAccount', 'UA-150998392-1'])
    _gaq.push(['_trackPageview'])
    ;(function () {
        var ga = document.createElement('script')
        ga.type = 'text/javascript'
        ga.async = true
        ga.src =
            ('https:' == document.location.protocol
                ? 'https://ssl'
                : 'http://www') + '.google-analytics.com/ga.js'
        var s = document.getElementsByTagName('script')[0]
        s.parentNode.insertBefore(ga, s)
    })()
</script>
 </head>

<body>
    <aside>
        <div id="user_meta">
            <a href="../../../../..">
                <div>
                    <svg width="24.348mm" height="24.348mm" version="1.1" viewBox="0 0 24.348095 24.347754"
                        xmlns="http://www.w3.org/2000/svg" xmlns:cc="http://creativecommons.org/ns#"
                        xmlns:dc="http://purl.org/dc/elements/1.1/"
                        xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
                        <metadata>
                            <rdf:RDF>
                                <cc:Work rdf:about="">
                                    <dc:format>image/svg+xml</dc:format>
                                    <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                                    <dc:title />
                                </cc:Work>
                            </rdf:RDF>
                        </metadata>
                        <g transform="translate(81.397 -84.454)">
                            <path d="m-57.049 105.9v2.9029h-11.173v-2.9029z" fill="#c0c0c0">
                                <animate attributeName="fill" values="white;grey;white" dur="2s"
                                    repeatCount="indefinite" />
                            </path>
                            <path
                                d="m-72.272 98.481-9.1246 5.7598v-3.548l5.8658-3.5019v-0.09215l-5.8658-3.5019v-3.548l9.1246 5.7598z"
                                fill="#c0c0c0" />
                            <path transform="scale(.26458)"
                                d="m-273.15 319.2-27.588 14.77 8.498 5.3613 19.09-12.049zm15.309 25.67v44.412h8.8672v-35.635h33.361v-8.7773h-33.783zm25.336 24.66v8.7774h8.0254v10.975h8.8672v-19.752z"
                                fill="#007bff" />
                        </g>
                    </svg>
                </div>
            </a>
            <ul>
                  <li><a href="../../../../../category/automation.html">automation</a></li>
                <li><a href="../../../../../category/learnings.html">learnings</a></li>
                <li><a href="../../../../../category/tips-and-tricks.html">tips-and-tricks</a></li>
                <li><a href="../../../../../category/tools.html">tools</a></li>
                <li><a href="../../../../../category/workflow.html">workflow</a></li>
              </ul>
        </div>
    </aside>

    <main>
        <header>
            <p>
                <a href="../../../../..">Home</a> &brvbar;
                <a href="../../../../../archives.html">Archives</a> &brvbar;
                <a href="../../../../../tags.html">Tags</a> &brvbar;
                <a href="../../../../../contact.html">Contact</a> &brvbar;
                <a href="https://drive.google.com/file/d/1t6GdZjC13naJXVGe6RinGowZLfkRzjy_/view" target="_blank"
                    rel="noopener noreferrer">Resume</a>
            </p>
        </header>

<article>
  <div class="article_title">
    <h1><a href="../../../../../posts/2021/09/19/managing-multiple-tmux-sessions-at-once/">Managing multiple tmux sessions at&nbsp;once</a></h1>
  </div>
  <div class="flex-container">
    <div class="article_meta">
      <div>Posted on: Sun 19 September 2021</div>
      <div>Category: <a href="../../../../../category/workflow.html">workflow</a>
 &ndash; Tags:
        <a href="../../../../../tag/bash.html">bash</a>,        <a href="../../../../../tag/i3.html">i3</a>,        <a href="../../../../../tag/rofi.html">rofi</a>,        <a href="../../../../../tag/script.html">script</a>,        <a href="../../../../../tag/tmux.html">tmux</a>      </div>
    </div>
    <div class="article_readtime">
      Estimated read time: 7 minutes
    </div>
  </div>

  <h2 class="toc-title">Table of contents</h2>
  </div>
  <nav class="toc">
    <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-this-all-about">What is this all about?</a></li>
<li><a href="#1-configuring-projects-to-launch-tmux-sessions">1. Configuring projects to launch tmux sessions</a></li>
<li><a href="#2-script-to-open-projects">2. Script to open projects</a></li>
<li><a href="#3-script-to-close-projects">3. Script to close projects</a></li>
<li><a href="#example-workflow">Example workflow</a></li>
<li><a href="#conclusion">Conclusion</a><ul>
<li><a href="#more-resources-and-references">More resources and references</a></li>
</ul>
</li>
</ul>
</div>
  </nav>
  <div class="article_text">
    
<hr/>
<h1 id="introduction">Introduction</h1>
<p>Released back in 2007, <a href="https://github.com/tmux/tmux/wiki">tmux</a> keeps being amazing! Because I have never bothered automating anything to make its use simpler, it took some time for it to become a working environment I enjoy for everyday use. This is a thing of the past: thanks to Oleksandr Kocherhin from <a href="https://monsterlessons-academy.com/">Monsterlessons Academy</a>, who shared his tmux workflow in his YouTube video titled <a href="https://www.youtube.com/watch?v=GuH7pw9LejY">Best Terminal Application for Web Development</a>, I saw a few automation opportunities I thought were worth tackling.</p>
<p>In this post, I’m sharing a little tip about managing tmux sessions that was inspired from the mentioned video. I am using <a href="https://i3wm.org/">i3wm</a> on Linux, but you can adapt this with any desktop environment as long as you can trigger the execution of programs with a keyboard shortcut in one way or another. I will be using Rofi and the <code>find</code> command, which you can find on Unix systems. If you would rather use dmenu instead of Rofi with this script, <a href="../../../../../posts/2019/11/10/using-dmenu-to-optimize-common-tasks/">this article can serve as a reference</a>. Enough said, let’s get to it.</p>
<hr/>
<h1 id="what-is-this-all-about">What is this all about?</h1>
<p>The idea is simple: have a few keyboard shortcuts to manage tmux sessions. That means being able to open new sessions and being able to kill them too. I kept this setup very simple on purpose but of course some improvements could be made. For instance, it could be nice to know which projects have already been opened so that the script doesn’t prompt you with a list of projects that include projects that you have already launched, but I haven’t found the need so far to deal with this potential issue as I tend to only work on a couple of projects during the course of a given day.</p>
<p>In summary, here is what we want to achieve in this post:</p>
<ul>
<li>Configure projects so that when we want to open them, they will be set up in the right directory with servers running, etc.;</li>
<li>Open a tmux session with a keyboard shortcut, listing all projects that were configured in the previous step;</li>
<li>Kill any opened tmux session with another keyboard shortcut.</li>
</ul>
<p>That’s it!</p>
<h1 id="1-configuring-projects-to-launch-tmux-sessions">1. Configuring projects to launch tmux sessions</h1>
<p>Firstly, we need to create new files to open our projects in the way we want. Basically, we need to create a file, let’s call it <code>.tmux</code>, and put it at the root of the project we’re interested in working with tmux. Then, we need to put some instructions that will be run with the shell (e.g. Bash or Zsh) so that tmux commands will be run automatically for us and let us “attach” to the session once all the necessary actions are performed. That means we need to make that file executable. In the terminal, this would be done as follows, assuming the project’s folder is the current working directory:</p>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>.tmux
</code></pre></div>
<p>At last, we want to give some orders to tmux so that when we execute that file, it will open our project in a pre-configured state so we’re ready to go. This will need to be customized depending on your needs, but here is a simple example to illustrate what could happen. So, we could put the following inside the <code>.tmux</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="nb">set</span><span class="w"> </span>-e

<span class="k">if</span><span class="w"> </span>tmux<span class="w"> </span>has-session<span class="w"> </span>-t<span class="o">=</span>my-project<span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>tmux<span class="w"> </span>attach<span class="w"> </span>-t<span class="w"> </span>my-project
<span class="w">    </span><span class="nb">exit</span>
<span class="k">fi</span>

tmux<span class="w"> </span>new-session<span class="w"> </span>-d<span class="w"> </span>-s<span class="w"> </span>my-project<span class="w"> </span>-n<span class="w"> </span>nvim<span class="w"> </span>-x<span class="w"> </span><span class="k">$(</span>tput<span class="w"> </span>cols<span class="k">)</span><span class="w"> </span>-y<span class="w"> </span><span class="k">$(</span>tput<span class="w"> </span>lines<span class="k">)</span>

<span class="c1"># Neovim</span>
tmux<span class="w"> </span>send-keys<span class="w"> </span>-t<span class="w"> </span>my-project:nvim<span class="w"> </span><span class="s2">"n"</span><span class="w"> </span>Enter

<span class="c1"># Servers</span>
tmux<span class="w"> </span>new-window<span class="w"> </span>-t<span class="w"> </span>my-project<span class="w"> </span>-n<span class="w"> </span>servers
tmux<span class="w"> </span>send-keys<span class="w"> </span>-t<span class="w"> </span>my-project:servers<span class="w"> </span><span class="s2">"cd frontend &amp;&amp; yarn start"</span><span class="w"> </span>Enter

tmux<span class="w"> </span>split-window<span class="w"> </span>-t<span class="w"> </span><span class="m">2</span><span class="w"> </span>-v<span class="w"> </span>-p<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="c1"># split it into two halves</span>
tmux<span class="w"> </span>send-keys<span class="w"> </span>-t<span class="w"> </span>my-project:servers<span class="w"> </span><span class="s2">"cd backend &amp;&amp; ap &amp;&amp; uvicorn main:app --reload"</span><span class="w"> </span>Enter

tmux<span class="w"> </span>attach<span class="w"> </span>-t<span class="w"> </span>my-project:nvim
</code></pre></div>
<p>Here is what is happening:</p>
<ul>
<li>If our project, named <code>my-project</code>, has a tmux session already running, then we “attach” to it and nothing more is done.</li>
<li>Otherwise, the session is created in “detached” mode so we can run a few commands smoothly and later attach to the created session.</li>
<li>With the <code>-n</code> flag, we name the window to be created (here, the first window is <code>nvim</code>).</li>
<li>Then, we “send” keys to the session, to that newly created <code>nvim</code> window. In this case, we send a single keystroke <code>n</code>, which is just an alias for executing Neovim.</li>
<li>In a new window named <code>servers</code>, we send keys to execute the frontend server.</li>
<li>Then, we split the second window we just created vertically and we run the commands needed to launch the backend server, again making use of Bash aliases for convenience.</li>
<li>Finally, we attach to the session and we open the first window <code>nvim</code>, ready to work.</li>
</ul>
<p>And just like this, what takes quite a few steps to do manually can be automated in one go when setting up the environment at the beginning of a working bout. Now, it could be convenient to create a generic template for the above script to use when creating new projects, especially if those tend to be short-lived and share some properties (e.g. maybe they all need to launch some kind of server in the background).</p>
<h1 id="2-script-to-open-projects">2. Script to open projects</h1>
<p>Firstly, we need a way to list and open all “known” projects. This is achieved in this example very simply with the <code>find</code> command as well as with the help of <code>rofi</code>. The script in question is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Get the path to the `.tmux` file to execute using `find` and `rofi`</span>
<span class="nv">PROJECT</span><span class="o">=</span><span class="sb">`</span>find<span class="w"> </span><span class="nv">$HOME</span>/dev<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="se">\(</span><span class="w"> </span>-name<span class="w"> </span>node_modules<span class="w"> </span>-o<span class="w"> </span>-name<span class="w"> </span>.venv<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>-path<span class="w"> </span>name<span class="w"> </span><span class="se">\)</span><span class="w"> </span>-prune<span class="w"> </span>-false<span class="w"> </span>-o<span class="w"> </span>-name<span class="w"> </span><span class="s1">'.tmux'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="p">|</span><span class="w"> </span>rofi<span class="w"> </span>-i<span class="w"> </span>-dmenu<span class="w"> </span>-theme<span class="w"> </span>purple<span class="w"> </span>-font<span class="w"> </span><span class="s1">'JetBrainsMono 14'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-width<span class="w"> </span><span class="m">90</span><span class="w"> </span>-show<span class="w"> </span>window<span class="sb">`</span>

<span class="c1"># Get the full directory path to the `.tmux` file, excluding the filename</span>
<span class="nv">PROJECT_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$PROJECT</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>dirname<span class="w"> </span><span class="s2">"{}"</span><span class="sb">`</span>

<span class="c1"># If $PROJECT is empty (e.g. pressing Esc at the prompt), don't do anything</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-z<span class="w"> </span><span class="s2">"</span><span class="nv">$PROJECT</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>kitty<span class="w"> </span>--directory<span class="w"> </span><span class="s2">"</span><span class="nv">$PROJECT_DIR</span><span class="s2">"</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">"</span><span class="nv">$PROJECT</span><span class="s2">"</span>
<span class="k">fi</span>
</code></pre></div>
<p>So, what this does is this:</p>
<ul>
<li>It finds all the directories where a <code>.tmux</code> file exists, excluding non-useful folders like <code>node_modules</code>. The <code>-prune</code> flag is passed to avoid recursion further inside a directory once a <code>.tmux</code> file is found. The results of <code>find</code> are “piped” into <code>rofi</code>, which displays the results. User selection is then stored in the <code>PROJECT</code> variable.</li>
<li>Once a file is selected, the full path without the filename is extracted and stored in the <code>PROJECT_DIR</code> variable.</li>
<li>Finally, all that is left to do is check if the user selected a project and if so, run it with the desired terminal from the correct directory. This will be different for most terminal emulators: here, an example is shown with the <a href="https://sw.kovidgoyal.net/kitty/">kitty terminal</a>.</li>
</ul>
<hr/>
<h1 id="3-script-to-close-projects">3. Script to close projects</h1>
<p>Here, we are concerned with the sessions that are now opened and that we might want to close. In a similar fashion as what we did to open projects, we want to kill them with a script that will run Rofi and do the job silently in the background. One such script that will get us there is shown below:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Get the name of all running sessions</span>
<span class="nv">TMUX_SESSIONS</span><span class="o">=</span><span class="sb">`</span>tmux<span class="w"> </span>ls<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="w"> </span>-d<span class="w"> </span><span class="s2">":"</span><span class="sb">`</span>

<span class="c1"># No listed session, then notify about it</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">"</span><span class="nv">$TMUX_SESSIONS</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>notify-send<span class="w"> </span><span class="s2">"No active tmux session found"</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<span class="k">fi</span>

<span class="c1"># Show all running sessions with Rofi and store the selection in a variable</span>
<span class="nv">SESSION</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$TMUX_SESSIONS</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>rofi<span class="w"> </span>-sep<span class="w"> </span><span class="s1">' '</span><span class="w"> </span>-i<span class="w"> </span>-dmenu<span class="w"> </span>-theme<span class="w"> </span>purple<span class="w"> </span>-font<span class="w"> </span><span class="s1">'JetBrainsMono 14'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-width<span class="w"> </span><span class="m">90</span><span class="w"> </span>-show<span class="w"> </span>window<span class="sb">`</span>

<span class="c1"># Kill the selected session</span>
tmux<span class="w"> </span>kill-session<span class="w"> </span>-t<span class="w"> </span><span class="nv">$SESSION</span>
</code></pre></div>
<p>In this case, the usage is quite straightforward: only running sessions are shown, so it’s just a matter of choosing the one we want to kill or pressing the <code>Escape</code> key to abort the Rofi pop-up.</p>
<hr/>
<h1 id="example-workflow">Example workflow</h1>
<p>It’s a matter of setting up keyboard shortcuts to run the scripts to open and kill projects. For instance, one such configuration for the <code>i3</code> window manager would be as follows:</p>
<div class="highlight"><pre><span></span><code>bindsym<span class="w"> </span><span class="nv">$mod</span>+Mod1+p<span class="w">    </span><span class="nv">$exec</span><span class="w"> </span>~/path/to/projects-start.sh
bindsym<span class="w"> </span><span class="nv">$mod</span>+Mod1+k<span class="w">    </span><span class="nv">$exec</span><span class="w"> </span>~/path/to/projects-kill.sh
</code></pre></div>
<ul>
<li>A simple shortcut lets us choose sessions to open.</li>
<li>Next, if we decide to kill a session at some point, we have another shortcut to do that.</li>
</ul>
<hr/>
<h1 id="conclusion">Conclusion</h1>
<p>Far from being a perfect solution (although it already feels comfortable as a main driver), this workflow initiates what I think can lead to substantial optimizations when it comes to using tmux. There’s room for improvement when a user selects an already opened session: ideally, we would just switch to that session automatically. These details need to be implemented based on the window manager that’s being used, but suffice to say, it can be done! In any case, I hope this may give you a semblance of inspiration to take this idea to the next level. There are tools to help with session persistence, such as <a href="https://github.com/tmux-plugins/tmux-resurrect">tmux-resurrect</a>, but that’s a topic for another time.</p>
<h2 id="more-resources-and-references">More resources and references</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=GuH7pw9LejY">Best Terminal Application for Web Development</a>, original inspiration for this workflow. — Monsterlessons Academy, YouTube.</li>
<li><a href="https://github.com/tmux/tmux/wiki">The tmux wiki</a>, GitHub.</li>
<li><a href="https://github.com/tmux-plugins/tmux-resurrect">tmux-resurrect</a>, GitHub.</li>
</ul>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_identifier = "posts/2021/09/19/managing-multiple-tmux-sessions-at-once/";
      (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//sglavoie.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  </div>

</article>
  
        <div id="ending_message">
            <p>
                &copy; Sébastien Lavoie. Built with
                <a href="https://www.python.org/" target="_blank" rel="noopener noreferrer">Python</a>
                using
                <a href="http://getpelican.com" target="_blank" rel="noopener noreferrer">Pelican</a>
                <span class="badge">v4.8.0</span>. Theme adapted from Giulio Fidente on
                <a href="https://github.com/gfidente/pelican-svbhack" target="_blank"
                    rel="noopener noreferrer">GitHub</a>.
                <a href="https://www.sglavoie.com/feeds/sglavoie.rss.xml">RSS feed</a>.
            </p>
        </div>
    </main>
</body>

</html>