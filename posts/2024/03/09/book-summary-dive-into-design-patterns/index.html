<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link
      rel="preload"
      href="/theme/css/fonts/lato-regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/lato-bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/ubuntu-regular-webfont.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/ubuntu-bold-webfont.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/ubuntu-regular-italic-webfont.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/ubuntu-bold-italic-webfont.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/SourceCodePro-Regular.ttf.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/SourceCodePro-Bold.ttf.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/SourceCodePro-It.ttf.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/theme/css/fonts/SourceCodePro-BoldIt.ttf.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link rel="preload" as="style" href="/theme/css/main.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/theme/css/styles.css"
    />
    <link href="/theme/css/sweetalert2.css" rel="stylesheet" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Sébastien Lavoie" />
    <meta
      name="description"
      content="Posts and writings by Sébastien Lavoie. Customization setups and articles on productivity for developers who like minimalism."
    />
    <meta name="title" property="og:title" content="sglavoie.com" />
    <meta property="og:type" content="Website" />
    <meta
      name="image"
      property="og:image"
      content="../../../../../theme/images/logo_1200x627.png"
    />

    <link
      href="https://www.sglavoie.com/feeds/sglavoie.atom.xml"
      type="application/atom+xml"
      rel="alternate"
      title="sglavoie.com Atom"
    />
     <link
      href="https://www.sglavoie.com/feeds/sglavoie.rss.xml"
      type="application/rss+xml"
      rel="alternate"
      title="sglavoie.com RSS"
    />

    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      href="/theme/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/theme/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/theme/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="/theme/favicon/site.webmanifest" />
    <link
      rel="mask-icon"
      href="/theme/favicon/safari-pinned-tab.svg"
      color="#5bbad5"
    />
    <link rel="shortcut icon" href="/theme/favicon/favicon.ico" />
    <meta name="msapplication-TileColor" content="#2d89ef" />
    <meta
      name="msapplication-TileImage"
      content="/theme/favicon/mstile-144x144.png"
    />
    <meta
      name="msapplication-config"
      content="/theme/favicon/browserconfig.xml"
    />
    <meta name="theme-color" content="#232323" />
    <meta
      name="msapplication-config"
      content="/theme/favicon/browserconfig.xml"
    />
    <meta name="theme-color" content="#232323" />

<meta name="keywords" content="design-patterns, books, go, oop" />
 
    <title>sglavoie.com &ndash; Book summary: Dive into Design&nbsp;Patterns</title>
  </head>

  <body>
    <div id="pageContainer">
      <span title="Press F to search">
        <svg
          id="search-icon"
          width="2em"
          height="2em"
          fill="none"
          viewBox="0 0 24 24"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <path
            d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z"
            stroke="#ffffff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </span>
      <aside id="sidebar">
        <a id="websiteLogo" href="../../../../..">
          <svg
            aria-labelledby="sglavoie.com's logo"
            class="svgLogo"
            width="100px"
            height="100px"
            version="1.1"
            viewBox="0 0 24.348095 24.347754"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:cc="http://creativecommons.org/ns#"
            xmlns:dc="http://purl.org/dc/elements/1.1/"
            xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
          >
            <title id="svgTitle">sglavoie.com's logo</title>
            <desc id="svgDesc">The website's logo.</desc>
            <metadata>
              <rdf:RDF>
                <cc:Work rdf:about="">
                  <dc:format>image/svg+xml</dc:format>
                  <dc:type
                    rdf:resource="http://purl.org/dc/dcmitype/StillImage"
                  />
                  <dc:title />
                </cc:Work>
              </rdf:RDF>
            </metadata>
            <g transform="translate(81.397 -84.454)">
              <path d="m-57.049 105.9v2.9029h-11.173v-2.9029z" fill="#c0c0c0">
                <animate
                  attributeName="fill"
                  values="white;grey;white"
                  dur="2s"
                  repeatCount="indefinite"
                />
              </path>
              <path
                d="m-72.272 98.481-9.1246 5.7598v-3.548l5.8658-3.5019v-0.09215l-5.8658-3.5019v-3.548l9.1246 5.7598z"
                fill="#c0c0c0"
              />
              <path
                transform="scale(.26458)"
                d="m-273.15 319.2-27.588 14.77 8.498 5.3613 19.09-12.049zm15.309 25.67v44.412h8.8672v-35.635h33.361v-8.7773h-33.783zm25.336 24.66v8.7774h8.0254v10.975h8.8672v-19.752z"
                fill="#007bff"
              />
            </g>
          </svg>
        </a>

        <nav id="navCategories">
          <ul>
              <li>
              <a href="../../../../../category/automation.html"
                >automation
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
            <li>
              <a href="../../../../../category/learnings.html"
                >learnings
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
            <li>
              <a href="../../../../../category/tips-and-tricks.html"
                >tips-and-tricks
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
            <li>
              <a href="../../../../../category/tools.html"
                >tools
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
            <li>
              <a href="../../../../../category/workflow.html"
                >workflow
                <svg
                  class="sidebar-category-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="1"
                    d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    opacity="1"
                    d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
              </a>
            </li>
           </ul>
        </nav>
      </aside>

      <aside id="pageNavigation">
        <nav>
          <ul>
            <li>
              <a href="../../../../.."
                ><svg
                  class="navigation-icon"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M18.5 3H16C15.7239 3 15.5 3.22386 15.5 3.5V3.55891L19 6.35891V3.5C19 3.22386 18.7762 3 18.5 3Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M10.75 9.5C10.75 8.80964 11.3097 8.25 12 8.25C12.6904 8.25 13.25 8.80964 13.25 9.5C13.25 10.1904 12.6904 10.75 12 10.75C11.3097 10.75 10.75 10.1904 10.75 9.5Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M20.75 10.9605L21.5315 11.5857C21.855 11.8444 22.3269 11.792 22.5857 11.4685C22.8444 11.1451 22.792 10.6731 22.4685 10.4143L14.3426 3.91362C12.9731 2.81796 11.027 2.81796 9.65742 3.91362L1.53151 10.4143C1.20806 10.6731 1.15562 11.1451 1.41438 11.4685C1.67313 11.792 2.1451 11.8444 2.46855 11.5857L3.25003 10.9605V21.25H2.00003C1.58581 21.25 1.25003 21.5858 1.25003 22C1.25003 22.4142 1.58581 22.75 2.00003 22.75H22C22.4142 22.75 22.75 22.4142 22.75 22C22.75 21.5858 22.4142 21.25 22 21.25H20.75V10.9605ZM9.25003 9.5C9.25003 7.98122 10.4812 6.75 12 6.75C13.5188 6.75 14.75 7.98122 14.75 9.5C14.75 11.0188 13.5188 12.25 12 12.25C10.4812 12.25 9.25003 11.0188 9.25003 9.5ZM12.0494 13.25C12.7143 13.25 13.2871 13.2499 13.7459 13.3116C14.2375 13.3777 14.7088 13.5268 15.091 13.909C15.4733 14.2913 15.6223 14.7625 15.6884 15.2542C15.7462 15.6842 15.7498 16.2146 15.75 16.827C15.75 16.8679 15.75 16.9091 15.75 16.9506L15.75 21.25H14.25V17C14.25 16.2717 14.2484 15.8009 14.2018 15.454C14.1581 15.1287 14.0875 15.0268 14.0304 14.9697C13.9733 14.9126 13.8713 14.842 13.546 14.7982C13.1991 14.7516 12.7283 14.75 12 14.75C11.2717 14.75 10.8009 14.7516 10.4541 14.7982C10.1288 14.842 10.0268 14.9126 9.9697 14.9697C9.9126 15.0268 9.84199 15.1287 9.79826 15.454C9.75162 15.8009 9.75003 16.2717 9.75003 17V21.25H8.25003L8.25003 16.9506C8.24999 16.2858 8.24996 15.7129 8.31163 15.2542C8.37773 14.7625 8.52679 14.2913 8.90904 13.909C9.29128 13.5268 9.76255 13.3777 10.2542 13.3116C10.7129 13.2499 11.2858 13.25 11.9507 13.25H12.0494Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M10.75 9.5C10.75 8.80964 11.3097 8.25 12 8.25C12.6904 8.25 13.25 8.80964 13.25 9.5C13.25 10.1904 12.6904 10.75 12 10.75C11.3097 10.75 10.75 10.1904 10.75 9.5Z"
                    fill="hsl(211, 100%, 95%)"
                  />
                </svg>
                Home</a
              >
            </li>
            <li>
              <a href="../../../../../archives.html"
                ><svg
                  class="navigation-icon"
                  fill="hsl(211, 100%, 95%)"
                  width="0.8em"
                  height="1em"
                  viewBox="0 0 16 16"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M3 6v8h10V6H3zM1 6H0V0h16v6h-1v10H1V6zm4 2h6v2H5V8zM2 2v2h12V2H2z"
                    fill-rule="evenodd"
                  />
                </svg>
                Archives</a
              >
            </li>
            <li>
              <a href="../../../../../tags.html"
                ><svg
                  class="navigation-icon"
                  fill="hsl(211, 100%, 95%)"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z"
                  />
                </svg>
                Tags</a
              >
            </li>
            <li>
              <a href="../../../../../contact.html"
                ><svg
                  class="navigation-icon"
                  fill="hsl(211, 100%, 95%)"
                  width="1em"
                  height="1em"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M4,21a1,1,0,0,0,1,1H19a1,1,0,0,0,1-1V3a1,1,0,0,0-1-1H5A1,1,0,0,0,4,3ZM12,7.5a2,2,0,1,1-2,2A2,2,0,0,1,12,7.5ZM8.211,16.215a4,4,0,0,1,7.578,0A.993.993,0,0,1,14.83,17.5H9.18A1,1,0,0,1,8.211,16.215Z"
                  />
                </svg>
                Contact</a
              >
            </li>
            <li>
              <a
                href="/resume"
                target="_blank"
                rel="noopener noreferrer"
                ><svg
                  class="navigation-icon"
                  fill="hsl(211, 100%, 95%)"
                  width="1em"
                  height="1em"
                  viewBox="0 0 846.66 846.66"
                  style="
                    shape-rendering: geometricPrecision;
                    text-rendering: geometricPrecision;
                    image-rendering: optimizeQuality;
                    fill-rule: evenodd;
                    clip-rule: evenodd;
                  "
                  version="1.1"
                  xml:space="preserve"
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                >
                  <g id="Layer_x0020_1">
                    <path
                      class="fil0"
                      d="M305.08 127c-27.16,0 -27.16,-41.29 0,-41.29l60.83 0 0 -54.93c0,-11.4 9.25,-20.64 20.65,-20.64l190.32 0c11.4,0 20.65,9.24 20.65,20.64l0 54.93 106.1 0c11.4,0 20.65,9.25 20.65,20.65l0 709.52c0,11.4 -9.25,20.64 -20.65,20.64l-560.6 0c-11.4,0 -20.65,-9.24 -20.65,-20.64l0 -709.52c0,-11.4 9.25,-20.65 20.65,-20.65l67.88 0c27.15,0 27.15,41.29 0,41.29l-47.24 0 0 668.23 519.32 0 0 -668.23c-125.97,0 -251.94,0 -377.91,0zm102.12 -41.29l149.04 0 0 -34.28 -149.04 0 0 34.28zm-191.92 480.71c-27.15,0 -27.15,-41.29 0,-41.29l188.46 0c27.16,0 27.16,41.29 0,41.29l-188.46 0zm0 156.73c-27.15,0 -27.15,-41.29 0,-41.29l188.46 0c27.16,0 27.16,41.29 0,41.29l-188.46 0zm0 -78.36c-27.15,0 -27.15,-41.29 0,-41.29l188.46 0c27.16,0 27.16,41.29 0,41.29l-188.46 0zm294.81 -101.94l121.29 0c11.4,0 20.64,9.25 20.64,20.65l0 121.28c0,11.4 -9.24,20.65 -20.64,20.65l-121.29 0c-11.4,0 -20.64,-9.25 -20.64,-20.65l0 -121.28c0,-11.4 9.24,-20.65 20.64,-20.65zm100.64 41.29l-79.99 0 0 80 79.99 0 0 -80zm-243.28 -252.09c13.62,0.23 24.62,-11.16 24.62,-24.62 0,-13.72 -10.9,-24.63 -24.62,-24.63 -13.69,0 -24.62,10.94 -24.62,24.63 0,13.48 10.98,24.85 24.62,24.62zm20.65 37.98l0 59.74c47.81,-9.73 82.31,-51.95 82.31,-100.88 0,-56.87 -46.09,-102.96 -102.96,-102.96 -56.86,0 -102.95,46.09 -102.95,102.96 0,48.93 34.49,91.15 82.31,100.88l0 -59.75c-26.78,-8.89 -45.28,-34.08 -45.28,-62.59 0,-36.3 29.62,-65.92 65.92,-65.92 36.29,0 65.92,29.63 65.92,65.92 0,28.49 -18.49,53.73 -45.27,62.6zm-20.65 -185.39c79.67,0 144.25,64.58 144.25,144.25 0,79.66 -64.58,144.24 -144.25,144.24 -79.66,0 -144.24,-64.58 -144.24,-144.24 0,-79.67 64.58,-144.25 144.24,-144.25z"
                    />
                  </g>
                </svg>
                Resume</a
              >
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Content area -->
      <main>
<article data-pagefind-body>
  <div class="article_title">
    <h1><a href="../../../../../posts/2024/03/09/book-summary-dive-into-design-patterns/">Book summary: Dive into Design&nbsp;Patterns</a></h1>
  </div>
  <div class="meta_container_hrs">
    <hr />
    <div class="meta_container">
      <div class="article_meta">
        <div>
          Posted on <strong>March 9, 2024</strong> in
          <span id="category-article">
            <a href="../../../../../category/learnings.html"
              ><svg
                class="article-category-icon"
                width="1em"
                height="1em"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  opacity="1"
                  d="M18.6695 2H16.7695C14.5895 2 13.4395 3.15 13.4395 5.33V7.23C13.4395 9.41 14.5895 10.56 16.7695 10.56H18.6695C20.8495 10.56 21.9995 9.41 21.9995 7.23V5.33C21.9995 3.15 20.8495 2 18.6695 2Z"
                  fill="hsl(211, 100%, 95%)"
                />
                <path
                  opacity="1"
                  d="M7.24 13.4302H5.34C3.15 13.4302 2 14.5802 2 16.7602V18.6602C2 20.8502 3.15 22.0002 5.33 22.0002H7.23C9.41 22.0002 10.56 20.8502 10.56 18.6702V16.7702C10.57 14.5802 9.42 13.4302 7.24 13.4302Z"
                  fill="hsl(211, 100%, 95%)"
                />
                <path
                  d="M6.29 10.58C8.6593 10.58 10.58 8.6593 10.58 6.29C10.58 3.9207 8.6593 2 6.29 2C3.9207 2 2 3.9207 2 6.29C2 8.6593 3.9207 10.58 6.29 10.58Z"
                  fill="hsl(211, 100%, 95%)"
                />
                <path
                  d="M17.7099 21.9999C20.0792 21.9999 21.9999 20.0792 21.9999 17.7099C21.9999 15.3406 20.0792 13.4199 17.7099 13.4199C15.3406 13.4199 13.4199 15.3406 13.4199 17.7099C13.4199 20.0792 15.3406 21.9999 17.7099 21.9999Z"
                  fill="hsl(211, 100%, 95%)"
                />
              </svg>
              learnings</a
            >
          </span>
        </div>
        <div class="article_tags">
           <a href="../../../../../tag/design-patterns.html"
            ><svg
              class="tag-icon"
              fill="hsl(211, 100%, 95%)"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z"
              />
            </svg>
            design-patterns</a
          >          <a href="../../../../../tag/books.html"
            ><svg
              class="tag-icon"
              fill="hsl(211, 100%, 95%)"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z"
              />
            </svg>
            books</a
          >          <a href="../../../../../tag/go.html"
            ><svg
              class="tag-icon"
              fill="hsl(211, 100%, 95%)"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z"
              />
            </svg>
            go</a
          >          <a href="../../../../../tag/oop.html"
            ><svg
              class="tag-icon"
              fill="hsl(211, 100%, 95%)"
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z"
              />
            </svg>
            oop</a
          >         </div>
      </div>
      <div class="article_readtime">
        <span class="readtime_tilde">~</span
        ><span class="readtime_minutes">72</span>
        minutes to read
      </div>
    </div>
    <hr />
  </div>

  <h2 class="toc-title">Table of contents</h2>
  <nav class="toc"><div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#a-brief-oop-overview">A brief <span class="caps">OOP</span> overview</a></li>
<li><a href="#introduction-to-design-patterns">Introduction to Design Patterns</a></li>
<li><a href="#software-design-principles">Software Design Principles</a><ul>
<li><a href="#design-principles">Design Principles</a></li>
<li><a href="#solid-principles"><span class="caps">SOLID</span> Principles</a></li>
</ul>
</li>
<li><a href="#catalog-of-design-patterns">Catalog of Design Patterns</a><ul>
<li><a href="#creational-design-patterns">Creational Design Patterns</a><ul>
<li><a href="#factory-method-virtual-constructor">Factory Method (virtual constructor)</a></li>
<li><a href="#abstract-factory">Abstract Factory</a></li>
<li><a href="#builder">Builder</a></li>
<li><a href="#prototype-clone">Prototype (clone)</a></li>
<li><a href="#singleton">Singleton</a></li>
</ul>
</li>
<li><a href="#structural-design-patterns">Structural Design Patterns</a><ul>
<li><a href="#adapter">Adapter</a></li>
<li><a href="#bridge">Bridge</a></li>
<li><a href="#composite-object-tree">Composite (object tree)</a></li>
<li><a href="#decorator-wrapper">Decorator (wrapper)</a></li>
<li><a href="#facade">Facade</a></li>
<li><a href="#flyweight-cache">Flyweight (cache)</a></li>
<li><a href="#proxy">Proxy</a></li>
</ul>
</li>
<li><a href="#behavioral-design-patterns">Behavioral Design Patterns</a><ul>
<li><a href="#chain-of-responsibility-cor-chain-of-command">Chain of Responsibility  (CoR, chain of command)</a></li>
<li><a href="#command-action-transaction">Command (action, transaction)</a></li>
<li><a href="#iterator">Iterator</a></li>
<li><a href="#mediator-intermediary-controller">Mediator (Intermediary, Controller)</a></li>
<li><a href="#memento-snapshot">Memento (Snapshot)</a></li>
<li><a href="#observer-event-subscriber-listener">Observer (Event-Subscriber, Listener)</a></li>
<li><a href="#state">State</a></li>
<li><a href="#strategy">Strategy</a></li>
<li><a href="#template-method">Template method</a></li>
<li><a href="#visitor">Visitor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#resources-and-references">Resources and references</a></li>
</ul>
</div></nav>
  <div class="article_text">
<hr/>
<h1 id="introduction">Introduction</h1>
<p>In the vast expanse of software engineering, design patterns and principles stand as lighthouses, guiding developers through the complex process of crafting robust, scalable, and maintainable software. Among these patterns, the Object-Oriented Programming (<em><span class="caps">OOP</span></em>) principles, Software Design Principles, and various design patterns provide a framework that seasoned and novice developers alike can leverage to solve common software design challenges. This article constitutes a book summary of <a href="https://refactoring.guru/design-patterns/book">Dive into Design Patterns</a> written by <a href="https://refactoring.guru">Alexander Shvets</a>. Beautifully illustrated, it delves into the core aspects of <span class="caps">OOP</span>, explores essential software design principles, and unveils a catalog of design patterns categorized into <em>Creational</em>, <em>Structural</em>, and <em>Behavioral</em> patterns. Here, each section is crafted to mimic the same structure as the book to offer a concise yet (hopefully) comprehensive overview, equipped with examples and analogies to illuminate these concepts further.</p>
<hr/>
<h1 id="a-brief-oop-overview">A brief <span class="caps">OOP</span> overview</h1>
<ul>
<li>Class attributes are called fields.</li>
<li>Methods define the behavior of a class.</li>
<li>Fields and methods are the members of their class.</li>
<li>Objects are concrete instances of a class.</li>
<li>Class hierarchies<ul>
<li><code>Parent = superclass</code> — inherit from parent.</li>
</ul>
</li>
<li>Abstraction: models the behaviors of a real-world object.</li>
<li>Encapsulation<ul>
<li>Hide parts of state and behaviors, interfacing with a simpler abstraction (e.g., starting a car engine doesn’t require knowing anything about mechanics).</li>
<li>Private fields and methods are hidden outside of a class.</li>
<li>Protected fields and methods are also hidden outside of a class but accessible to subclasses.</li>
</ul>
</li>
<li>Interfaces look like classes with methods only.</li>
<li>Inheritance (arrow with empty triangle head, going from subclass to parent class)<ul>
<li>Build subclasses on top of superclasses.</li>
<li>Allows code reuse.</li>
<li>Subclasses automatically share the same interface as their parent class.</li>
<li>One class inherits interface and implementation of another and can extend it. It can be treated as the superclass and depends on it.</li>
</ul>
</li>
<li>Polymorphism<ul>
<li>The real type of an object is not required to be known to use it (e.g., if a class inherits from Animal and implements an abstract method <code>makeSound</code>, then we can call <code>makeSound</code> on that class regardless of what type of animal this is).</li>
</ul>
</li>
<li>Relations between objects<ul>
<li>Dependency (dashed lined with arrow)</li>
<li>Code that depends on interfaces or abstract classes lead to weaker dependency between classes.</li>
<li>One class can affect the code from another class.</li>
<li>Association (simple arrow pointing to the object being used, bi-direction allowed)</li>
<li>When an object uses or interacts with another.</li>
<li>One class knows about the other and uses it.</li>
<li>Aggregation (line with empty diamond at the con­tain­er end, an arrow at the end point­ing toward the component)</li>
<li>One object “has” a collection of others and serves as a container (e.g., a department has many professors).</li>
<li>One class is made of another one and depends on it.</li>
<li>The component can exist without the container.</li>
<li>Composition (drawn like an aggregation, filling in the diamond)</li>
<li>Specific kind of aggregation, where the component can only exist as part of the container.</li>
<li>Like aggregation, but the first class also manages the life cycle of the class it depends on.</li>
<li>Implementation</li>
<li>One class defines methods from an interface. The class can be treated as the interface and depends on it.</li>
</ul>
</li>
</ul>
<hr/>
<h1 id="introduction-to-design-patterns">Introduction to Design Patterns</h1>
<ul>
<li>Design patterns are solutions to common problems.</li>
<li>A pattern is a general concept for solving a particular problem.</li>
<li>A pattern is more high-level than an algorithm.</li>
<li>Architectural patterns are high-level. They are used to design the architecture of an entire application and can usually be implemented in any programming language.</li>
<li>Creational patterns are a way to increase flexibility and code reuse with object creation mechanisms.</li>
<li>Structural patterns are a way of assembling objects/classes into larger structures, keeping structures flexible and efficient.</li>
<li>Behavioral patterns deal with effective communication and assignment of responsibilities between objects.</li>
</ul>
<hr/>
<h1 id="software-design-principles">Software Design Principles</h1>
<p>Features of good software design include:</p>
<ul>
<li>Code reuse</li>
<li>Extensibility</li>
</ul>
<h2 id="design-principles">Design Principles</h2>
<ul>
<li>Encapsulate what varies.<ul>
<li>Minimize the effect caused by changes.</li>
</ul>
</li>
<li>Program to an interface, not an implementation.<ul>
<li>A design can be seen as flexible when it doesn’t break if it can be extended without breaking existing code.</li>
</ul>
</li>
<li>Favor composition over inheritance.<ul>
<li>Problems:<ul>
<li>A subclass must implement all abstract methods from the superclass even if they’re not used.</li>
<li>Behavior of overridden methods must remain compatible with the base class.</li>
<li>The superclass is not well encapsulated, because all subclasses are aware of its implementation details. Furthermore, if a subclass needs to be extended, the superclass might be modified to accommodate this need.</li>
<li>Changes in the superclass can break the subclasses, leading to tight coupling.</li>
<li>It can lead to the creation of many hierarchies of classes to combine them over multiple dimensions.</li>
</ul>
</li>
<li>Inheritance represents the “is a” relationship, while composition represents a “has a” relationship.</li>
</ul>
</li>
</ul>
<h2 id="solid-principles"><span class="caps">SOLID</span> Principles</h2>
<ul>
<li><strong>Single-responsibility principle</strong>: <em>“a class should have just one reason to change”</em>.</li>
<li><strong>Open-closed principle</strong>: classes should be open for extension but closed for modification.</li>
<li><strong>Liskov Sub­sti­tu­tion Prin­ci­ple</strong>: when extending a class, you should be able to pass objects of the subclass in place of objects of the parent class without breaking the client code.<ul>
<li>Para­me­ter types in a method of a sub­class should match or be more abstract than para­me­ter types in the method of the super­class.</li>
<li>The return type in a method of a sub­class should match or be a sub­type of the return type in the method of the super­class.</li>
<li>A method in a sub­class shouldn’t throw types of exceptions which the base method isn’t expect­ed to throw.</li>
<li>A sub­class shouldn’t strength­en pre-conditions, e.g. if a parameter requires an <code>int</code>, the subclass shouldn’t restrict the <code>int</code> to be positive.</li>
<li>A sub­class shouldn’t weak­en post-conditions, e.g. if a database connection is expected to be closed in a class, don’t leave it open in a subclass.</li>
<li>Invariants of a super­class must be pre­served. For this, it’s safer to add fields to a class rather than modify existing ones.</li>
<li>A sub­class shouldn’t change val­ues of private fields of the super­class, this is possible e.g. in Python or JavaScript where private members aren’t even protected.</li>
</ul>
</li>
<li><strong>Interface Segregation Principle</strong><ul>
<li>Clients shouldn’t be forced to depend on meth­ods they do not use, trim the fat off of big interfaces.</li>
</ul>
</li>
<li><strong>Dependency Inversion Principle</strong><ul>
<li>High-level class­es shouldn’t depend on low-level class­es. Both should depend on abstractions. Abstractions shouldn’t depend on details. Details should depend on abstractions.</li>
</ul>
</li>
</ul>
<hr/>
<h1 id="catalog-of-design-patterns">Catalog of Design Patterns</h1>
<h2 id="creational-design-patterns">Creational Design Patterns</h2>
<p>These patterns deal with object creation mechanisms, trying to create objects in a manner suitable to the situation.</p>
<h3 id="factory-method-virtual-constructor">Factory Method (virtual constructor)</h3>
<ul>
<li>Analogy<ul>
<li>The hiring process (factory method) of a company (client) may differ for each department (concrete creator), which will hire employees (products of the concrete creator).</li>
</ul>
</li>
<li>When to use it<ul>
<li><em><span class="dquo">“</span>[…] you don’t know before­hand the exact types and dependencies of the objects your code should work with”</em>.</li>
<li>To pro­vide users of your library or frame­work with a way to extend its inter­nal components.</li>
<li>To save sys­tem resources by reusing exist­ing objects instead of rebuild­ing them each time.</li>
</ul>
</li>
<li>Implementation<ul>
<li>Define an interface that all products will implement.</li>
<li>Add a factory method to the creator class.</li>
<li>In the creator’s code, replace direct calls to product constructors with calls to the factory method.</li>
<li>The factory method might need a parameter to decide which product type to create.</li>
<li>Initially, the factory method might have a switch or similar logic to decide which product to instantiate.</li>
<li>Create subclasses of the creator for each product type, overriding the factory method to handle specific product creation.</li>
<li>Either create more subclasses or use a parameter in the factory method to specify the product type if there are many product types.</li>
</ul>
</li>
<li>Pros<ul>
<li>No tight coupling between the creator and the concrete products.</li>
<li><strong>Single Responsibility Principle</strong>: the creator is responsible for creating products, and the products are responsible for their own creation.</li>
<li><strong>Open/Closed Principle</strong>: you can introduce new product types without changing the existing code.</li>
</ul>
</li>
<li>Cons<ul>
<li>The code might become more complicated than it should be.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Abstract Factory</strong> is a more complex version of <strong>Factory Method</strong>.</li>
<li><strong>Factory Method</strong> is a specialization of <strong>Template Method</strong>.</li>
<li><strong>Prototype</strong> doesn’t require subclassing, but it’s not always possible to use it with a <strong>Factory Method</strong>.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Vehicle is the product</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Vehicle</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Brake</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="w"> </span><span class="nx">Drive</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// VehicleFactory is the abstract factory</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">VehicleFactory</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">CreateVehicle</span><span class="p">(</span><span class="nx">vehicleType</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">Vehicle</span>
<span class="p">}</span>

<span class="c1">// CheapVehicleFactory is a concrete factory producing cheap stuff</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CheapVehicleFactory</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">CheapVehicleFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateVehicle</span><span class="p">(</span><span class="nx">vehicleType</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">Vehicle</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="nx">vehicleType</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="s">"Car"</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CheapCar</span><span class="p">{}</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="s">"Bike"</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CheapBike</span><span class="p">{}</span>
<span class="w"> </span><span class="k">default</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// NiceVehicleFactory is a concrete factory producing nice stuff</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">NiceVehicleFactory</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">NiceVehicleFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateVehicle</span><span class="p">(</span><span class="nx">vehicleType</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">Vehicle</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="nx">vehicleType</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="s">"Car"</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">NiceCar</span><span class="p">{}</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="s">"Bike"</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">NiceBike</span><span class="p">{}</span>
<span class="w"> </span><span class="k">default</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// CheapCar is a concrete product implementing the Vehicle interface that's not so reliable</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CheapCar</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// NiceCar is a concrete product implementing the Vehicle interface that's more likely to work</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">NiceCar</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// CheapBike is what it is</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CheapBike</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// NiceBike is nice</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">NiceBike</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CheapCar</span><span class="p">)</span><span class="w"> </span><span class="nx">Brake</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Squeeeeeeeak..."</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">NiceCar</span><span class="p">)</span><span class="w"> </span><span class="nx">Brake</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Shhh."</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CheapCar</span><span class="p">)</span><span class="w"> </span><span class="nx">Drive</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Vroom poof poof vroom poof poof vroom"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">NiceCar</span><span class="p">)</span><span class="w"> </span><span class="nx">Drive</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"VROOOOOM"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">CheapBike</span><span class="p">)</span><span class="w"> </span><span class="nx">Brake</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"iiiiiiiiik"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">NiceBike</span><span class="p">)</span><span class="w"> </span><span class="nx">Brake</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"(silence)"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">CheapBike</span><span class="p">)</span><span class="w"> </span><span class="nx">Drive</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"kwik kwik kwik"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">NiceBike</span><span class="p">)</span><span class="w"> </span><span class="nx">Drive</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"(silence)"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">produceVehicles</span><span class="p">(</span><span class="nx">factory</span><span class="w"> </span><span class="nx">VehicleFactory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">car</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">CreateVehicle</span><span class="p">(</span><span class="s">"Car"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Car:"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"drive:"</span><span class="p">,</span><span class="w"> </span><span class="nx">car</span><span class="p">.</span><span class="nx">Drive</span><span class="p">())</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"stop: "</span><span class="p">,</span><span class="w"> </span><span class="nx">car</span><span class="p">.</span><span class="nx">Brake</span><span class="p">())</span>

<span class="w"> </span><span class="nx">bike</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">CreateVehicle</span><span class="p">(</span><span class="s">"Bike"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Bike:"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"ride: "</span><span class="p">,</span><span class="w"> </span><span class="nx">bike</span><span class="p">.</span><span class="nx">Drive</span><span class="p">())</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"brake:"</span><span class="p">,</span><span class="w"> </span><span class="nx">bike</span><span class="p">.</span><span class="nx">Brake</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">momsGarage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CheapVehicleFactory</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">uncleBobsMansion</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">NiceVehicleFactory</span><span class="p">{}</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Cheap Vehicles\n-----------------"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">produceVehicles</span><span class="p">(</span><span class="nx">momsGarage</span><span class="p">)</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nNice Vehicles\n---------------"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">produceVehicles</span><span class="p">(</span><span class="nx">uncleBobsMansion</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">   Cheap Vehicles</span>
<span class="cm">   -----------------</span>
<span class="cm">   Car:</span>
<span class="cm">   drive: Vroom poof poof vroom poof poof vroom</span>
<span class="cm">   stop:  Squeeeeeeeak...</span>
<span class="cm">   Bike:</span>
<span class="cm">   ride:  kwik kwik kwik</span>
<span class="cm">   brake: iiiiiiiiik</span>

<span class="cm">   Nice Vehicles</span>
<span class="cm">   ---------------</span>
<span class="cm">   Car:</span>
<span class="cm">   drive: VROOOOOM</span>
<span class="cm">   stop:  Shhh.</span>
<span class="cm">   Bike:</span>
<span class="cm">   ride:  (silence)</span>
<span class="cm">   brake: (silence)</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="abstract-factory">Abstract Factory</h3>
<ul>
<li>Analogy<ul>
<li>A car manufacturing company has different (abstract) factories in different parts of the world to produce vehicle whose requirements are adapted to the local needs.</li>
</ul>
</li>
<li>When to use it<ul>
<li>It can create families of related or dependent objects without the need to specify their concrete classes.</li>
<li>It makes the system independent from how the objects are created.</li>
<li>It can be used where the set of objects may change dynamically while keeping the same functionality.</li>
</ul>
</li>
<li>Implementation<ul>
<li>Define the abstract factory interface.</li>
<li>Create concrete factory classes.</li>
<li>Define the product interfaces.</li>
<li>Create concrete product classes.</li>
<li>Use the factory.</li>
</ul>
</li>
<li>Pros<ul>
<li>Isolation from concrete classes.</li>
<li>Can swap product families.</li>
<li>Makes products consistent.</li>
</ul>
</li>
<li>Cons<ul>
<li>More complex than the <strong>Factory Method</strong> pattern.</li>
<li>More difficult to extend, having the need to change many interfaces.</li>
<li>Works best with sets of families that don’t change too much or too often.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li>It can use the <strong>Factory Method</strong> to create the products.</li>
<li><strong>Builder</strong> allows constructing more complex objects one step at a time.</li>
<li><strong>Prototype</strong> can be used when creating products by cloning prototypes.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Product interfaces</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Car</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Drive</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Bicycle</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Ride</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Concrete products</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">MercedesCar</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BMWCar</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CannondaleBicycle</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">SpecializedBicycle</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">MercedesCar</span><span class="p">)</span><span class="w"> </span><span class="nx">Drive</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Driving Mercedes"</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">BMWCar</span><span class="p">)</span><span class="w"> </span><span class="nx">Drive</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Driving BMW"</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">CannondaleBicycle</span><span class="p">)</span><span class="w"> </span><span class="nx">Ride</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Riding Cannondale"</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">SpecializedBicycle</span><span class="p">)</span><span class="w"> </span><span class="nx">Ride</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Riding Specialized"</span>
<span class="p">}</span>

<span class="c1">// Abstract factory</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">VehicleFactory</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">CreateCar</span><span class="p">()</span><span class="w"> </span><span class="nx">Car</span>
<span class="w"> </span><span class="nx">CreateBicycle</span><span class="p">()</span><span class="w"> </span><span class="nx">Bicycle</span>
<span class="p">}</span>

<span class="c1">// Concrete factories</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">MercedesFactory</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BMWFactory</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">SpecializedFactory</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">MercedesFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateCar</span><span class="p">()</span><span class="w"> </span><span class="nx">Car</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MercedesCar</span><span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Let's assume Mercedes make Cannondale bicycles</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">MercedesFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateBicycle</span><span class="p">()</span><span class="w"> </span><span class="nx">Bicycle</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CannondaleBicycle</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">BMWFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateCar</span><span class="p">()</span><span class="w"> </span><span class="nx">Car</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BMWCar</span><span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Let's assume BMW also makes Specialized bicycles</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">BMWFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateBicycle</span><span class="p">()</span><span class="w"> </span><span class="nx">Bicycle</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SpecializedBicycle</span><span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Let's assume Specialized makes its own bicycles</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">SpecializedFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateBicycle</span><span class="p">()</span><span class="w"> </span><span class="nx">Bicycle</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SpecializedBicycle</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">produceVehicles</span><span class="p">(</span><span class="nx">factory</span><span class="w"> </span><span class="nx">VehicleFactory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">car</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">CreateCar</span><span class="p">()</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">car</span><span class="p">.</span><span class="nx">Drive</span><span class="p">())</span>

<span class="w"> </span><span class="nx">bicycle</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">CreateBicycle</span><span class="p">()</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">bicycle</span><span class="p">.</span><span class="nx">Ride</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">mercedesFactory</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MercedesFactory</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">bmwFactory</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BMWFactory</span><span class="p">{}</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Mercedes vehicles:"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">produceVehicles</span><span class="p">(</span><span class="nx">mercedesFactory</span><span class="p">)</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nBMW vehicles:"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">produceVehicles</span><span class="p">(</span><span class="nx">bmwFactory</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// This doesn't work because SpecializedFactory doesn't implement CreateCar()</span>
<span class="w"> </span><span class="c1">// produceVehicles(&amp;SpecializedFactory{})</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Mercedes vehicles:</span>
<span class="cm">  Driving Mercedes</span>
<span class="cm">  Riding Cannondale</span>

<span class="cm">  BMW vehicles:</span>
<span class="cm">  Driving BMW</span>
<span class="cm">  Riding Specialized</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="builder">Builder</h3>
<ul>
<li>Analogy<ul>
<li>There are many ways to build a house, so it may be simpler and will be more flexible piecing the different requirements together rather than trying to find a pre-made house tailored to one’s needs.</li>
</ul>
</li>
<li>When to use it<ul>
<li>When there’s a need for complex objects that can be built step by step (e.g., a text-to-speech [<span class="caps">TTS</span>] service may have dozens of options to set the pitch, speed, volume gain, etc. but many settings can be left at their default value).</li>
<li>This pattern also works well when there are many optional components. In a <span class="caps">TTS</span> service, this could mean hooking up the result to post-process the audio, perform a <span class="caps">TTS</span> on multiple services at once, etc.</li>
</ul>
</li>
<li>Implementation<ul>
<li>Define a Product class, which must have the common construction steps among all available products.</li>
<li>There must be a Builder interface to define the methods used to construct the objects.</li>
<li>Concrete builders are needed to implement the Builder interface in different ways (e.g., a wall builder for a wooden cabin vs. a brick house).</li>
<li>There can be an optional Director class, which makes it easier to use to builders (e.g., for houses, there could be a MakeCabin method to call the appropriate builders in order to get the expected result, which is done in a single call to the Director instead of possibly chaining many invocations of a concrete builder).</li>
<li>To use it, the client creates a Builder, passes the Builder to the Director to construct the product and the product is obtained from the Builder (e.g., Builder.getResult).</li>
</ul>
</li>
<li>Pros<ul>
<li>It is flexible.</li>
<li>It is reusable.</li>
<li>It encapsulates complex construction logic inside the Builder.</li>
</ul>
</li>
<li>Cons<ul>
<li>For simpler objects, it can make the code unnecessarily convoluted.</li>
<li>Can be a bit painful to work with if many different products need to be created and used all at once.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Factory Method</strong> and <strong>Abstract Factory</strong> are simpler and create objects in a single step. The <strong>Builder</strong> is more complex but allows more control over the construction process.</li>
<li>While <strong>Builder</strong> builds a complex object one step at a time, <strong>Prototype</strong> clones objects.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Candy is the Product</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Candy</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Sugar</span><span class="w">     </span><span class="kt">int</span>
<span class="w"> </span><span class="nx">Flavor</span><span class="w">    </span><span class="kt">string</span>
<span class="w"> </span><span class="nx">Color</span><span class="w">     </span><span class="kt">string</span>
<span class="w"> </span><span class="nx">Packaging</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// CandyBuilder is the abstract Builder interface</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CandyBuilder</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">SetSugar</span><span class="p">(</span><span class="nx">sugar</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="nx">CandyBuilder</span>
<span class="w"> </span><span class="nx">SetFlavor</span><span class="p">(</span><span class="nx">flavor</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">CandyBuilder</span>
<span class="w"> </span><span class="nx">SetColor</span><span class="p">(</span><span class="nx">color</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">CandyBuilder</span>
<span class="w"> </span><span class="nx">SetPackaging</span><span class="p">(</span><span class="nx">packaging</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">CandyBuilder</span>
<span class="w"> </span><span class="nx">Build</span><span class="p">()</span><span class="w"> </span><span class="nx">Candy</span>
<span class="p">}</span>

<span class="c1">// SimpleCandyBuilder is a Concrete Builder</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">SimpleCandyBuilder</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">candy</span><span class="w"> </span><span class="nx">Candy</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewSimpleCandyBuilder</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">SimpleCandyBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SimpleCandyBuilder</span><span class="p">{</span><span class="nx">candy</span><span class="p">:</span><span class="w"> </span><span class="nx">Candy</span><span class="p">{}}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">SimpleCandyBuilder</span><span class="p">)</span><span class="w"> </span><span class="nx">SetSugar</span><span class="p">(</span><span class="nx">sugar</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="nx">CandyBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">candy</span><span class="p">.</span><span class="nx">Sugar</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sugar</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">SimpleCandyBuilder</span><span class="p">)</span><span class="w"> </span><span class="nx">SetFlavor</span><span class="p">(</span><span class="nx">flavor</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">CandyBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">candy</span><span class="p">.</span><span class="nx">Flavor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">flavor</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">SimpleCandyBuilder</span><span class="p">)</span><span class="w"> </span><span class="nx">SetColor</span><span class="p">(</span><span class="nx">color</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">CandyBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">candy</span><span class="p">.</span><span class="nx">Color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">color</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">SimpleCandyBuilder</span><span class="p">)</span><span class="w"> </span><span class="nx">SetPackaging</span><span class="p">(</span><span class="nx">packaging</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">CandyBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">candy</span><span class="p">.</span><span class="nx">Packaging</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">packaging</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">SimpleCandyBuilder</span><span class="p">)</span><span class="w"> </span><span class="nx">Build</span><span class="p">()</span><span class="w"> </span><span class="nx">Candy</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">candy</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">CandyDirector</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">builder</span><span class="w"> </span><span class="nx">CandyBuilder</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewCandyDirector</span><span class="p">(</span><span class="nx">builder</span><span class="w"> </span><span class="nx">CandyBuilder</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">CandyDirector</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CandyDirector</span><span class="p">{</span>
<span class="w">  </span><span class="nx">builder</span><span class="p">:</span><span class="w"> </span><span class="nx">builder</span><span class="p">,</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ConstructPeppermintCandy creates a peppermint candy with green packaging.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">CandyDirector</span><span class="p">)</span><span class="w"> </span><span class="nx">ConstructPeppermintCandy</span><span class="p">()</span><span class="w"> </span><span class="nx">Candy</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">builder</span><span class="p">.</span><span class="nx">SetSugar</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span>
<span class="w">  </span><span class="nx">SetFlavor</span><span class="p">(</span><span class="s">"Peppermint"</span><span class="p">).</span>
<span class="w">  </span><span class="nx">SetColor</span><span class="p">(</span><span class="s">"White"</span><span class="p">).</span>
<span class="w">  </span><span class="nx">SetPackaging</span><span class="p">(</span><span class="s">"Green"</span><span class="p">).</span>
<span class="w">  </span><span class="nx">Build</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// ConstructCaramelCandy creates a caramel candy with yellow packaging.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">CandyDirector</span><span class="p">)</span><span class="w"> </span><span class="nx">ConstructCaramelCandy</span><span class="p">()</span><span class="w"> </span><span class="nx">Candy</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">builder</span><span class="p">.</span><span class="nx">SetSugar</span><span class="p">(</span><span class="mi">15</span><span class="p">).</span>
<span class="w">  </span><span class="nx">SetFlavor</span><span class="p">(</span><span class="s">"Caramel"</span><span class="p">).</span>
<span class="w">  </span><span class="nx">SetColor</span><span class="p">(</span><span class="s">"Brown"</span><span class="p">).</span>
<span class="w">  </span><span class="nx">SetPackaging</span><span class="p">(</span><span class="s">"Yellow"</span><span class="p">).</span>
<span class="w">  </span><span class="nx">Build</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">builder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewSimpleCandyBuilder</span><span class="p">()</span>
<span class="w"> </span><span class="nx">director</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewCandyDirector</span><span class="p">(</span><span class="nx">builder</span><span class="p">)</span>

<span class="w"> </span><span class="nx">peppermintCandy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">director</span><span class="p">.</span><span class="nx">ConstructPeppermintCandy</span><span class="p">()</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Peppermint Candy: %+v\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">peppermintCandy</span><span class="p">)</span>

<span class="w"> </span><span class="nx">caramelCandy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">director</span><span class="p">.</span><span class="nx">ConstructCaramelCandy</span><span class="p">()</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Caramel Candy: %+v\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">caramelCandy</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="c1">// Peppermint Candy: {Sugar:10 Flavor:Peppermint Color:White Packaging:Green}</span>
<span class="w"> </span><span class="c1">// Caramel Candy: {Sugar:15 Flavor:Caramel Color:Brown Packaging:Yellow}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="prototype-clone">Prototype (clone)</h3>
<ul>
<li>Analogy<ul>
<li>Copying genetic information from one cell to another is very complex, while mitotic cell division is efficient and effective.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To create new objects by copying an existing object (the prototype).</li>
<li>New instantiation of a complex object may be inconvenient.</li>
</ul>
</li>
<li>Implementation<ul>
<li>Define an interface with a clone method.</li>
<li>Implement the prototype interface in classes that need to be cloned.</li>
<li>Use the clone method to create new objects.</li>
</ul>
</li>
<li>Pros<ul>
<li>Cloning can be more efficient than creating new instances, especially if instantiation is resource-intensive.</li>
<li>Cloning allows for dynamic creation and composition of instances at runtime, which brings greater flexibility.</li>
<li>Prototypes can be managed and modified at runtime, which makes them dynamic.</li>
</ul>
</li>
<li>Cons<ul>
<li>Deep cloning complex objects with intricate references can be challenging.</li>
<li>It’s not always clear how cloning should behave for each object, especially in complex class hierarchies.</li>
<li>Cloning can lead to unexpected issues, such as shared references, if not handled correctly.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Factory Method</strong> uses a single method to create new objects, <strong>Prototype</strong> does it through cloning.</li>
<li><strong>Abstract Factory</strong> and <strong>Builder</strong> can be combined with <strong>Prototype</strong> when complex objects are required to be built or cloned.</li>
<li>Prototypes are often at odds with <strong>Singletons</strong>, as the <strong>Prototype</strong> pattern involves creating new object instances.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Animal is the prototype interface that all animals must implement</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Animal</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Clone</span><span class="p">()</span><span class="w"> </span><span class="nx">Animal</span>
<span class="w"> </span><span class="nx">GetInfo</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Sheep is a concrete prototype that implements the Animal interface</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Sheep</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<span class="w"> </span><span class="nx">Age</span><span class="w">  </span><span class="kt">int</span>
<span class="p">}</span>

<span class="c1">// Clone creates a new Sheep instance with the same data</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Sheep</span><span class="p">)</span><span class="w"> </span><span class="nx">Clone</span><span class="p">()</span><span class="w"> </span><span class="nx">Animal</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1">// Create a new Sheep instance with the same data</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Sheep</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Age</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// GetInfo returns the sheep's name and age</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Sheep</span><span class="p">)</span><span class="w"> </span><span class="nx">GetInfo</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"Sheep Name: %s, Age: %d"</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Age</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Dog is another concrete prototype that implements the Animal interface</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Dog</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Name</span><span class="w">  </span><span class="kt">string</span>
<span class="w"> </span><span class="nx">Breed</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Clone creates a new Dog instance with the same data</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">Dog</span><span class="p">)</span><span class="w"> </span><span class="nx">Clone</span><span class="p">()</span><span class="w"> </span><span class="nx">Animal</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Dog</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">Breed</span><span class="p">:</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Breed</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// GetInfo returns the dog's name and breed</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">Dog</span><span class="p">)</span><span class="w"> </span><span class="nx">GetInfo</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"Dog Name: %s, Breed: %s"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Breed</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">PrototypeRegistry</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">items</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">Animal</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewPrototypeRegistry</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">PrototypeRegistry</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PrototypeRegistry</span><span class="p">{</span><span class="nx">items</span><span class="p">:</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">Animal</span><span class="p">)}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">PrototypeRegistry</span><span class="p">)</span><span class="w"> </span><span class="nx">Register</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">animal</span><span class="w"> </span><span class="nx">Animal</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">animal</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">PrototypeRegistry</span><span class="p">)</span><span class="w"> </span><span class="nx">Clone</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">Animal</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">animal</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">animal</span><span class="p">.</span><span class="nx">Clone</span><span class="p">(),</span><span class="w"> </span><span class="kc">nil</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"prototype not found: %s"</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">registry</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewPrototypeRegistry</span><span class="p">()</span>
<span class="w"> </span><span class="nx">registry</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="s">"sheep"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Sheep</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">"Dolly"</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">})</span>
<span class="w"> </span><span class="nx">registry</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="s">"dog"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Dog</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">"Fido"</span><span class="p">,</span><span class="w"> </span><span class="nx">Breed</span><span class="p">:</span><span class="w"> </span><span class="s">"Bulldog"</span><span class="p">})</span>

<span class="w"> </span><span class="nx">clonedAnimal</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">registry</span><span class="p">.</span><span class="nx">Clone</span><span class="p">(</span><span class="s">"sheep"</span><span class="p">)</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Error cloning sheep:"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">clonedSheep</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">clonedAnimal</span><span class="p">.(</span><span class="o">*</span><span class="nx">Sheep</span><span class="p">)</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Type assertion failed: not a *Sheep"</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">clonedSheep</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"Molly"</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">clonedSheep</span><span class="p">.</span><span class="nx">GetInfo</span><span class="p">())</span>

<span class="w"> </span><span class="nx">clonedAnimal2</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">registry</span><span class="p">.</span><span class="nx">Clone</span><span class="p">(</span><span class="s">"dog"</span><span class="p">)</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Error cloning dog:"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">clonedDog</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">clonedAnimal2</span><span class="p">.(</span><span class="o">*</span><span class="nx">Dog</span><span class="p">)</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Type assertion failed: not a *Dog"</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">clonedDog</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"Rex"</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">clonedDog</span><span class="p">.</span><span class="nx">GetInfo</span><span class="p">())</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Sheep Name: Molly, Age: 4</span>
<span class="cm">  Dog Name: Rex, Breed: Bulldog</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="singleton">Singleton</h3>
<ul>
<li>Analogy<ul>
<li>The government of a country is (ideally…) a singleton. There is a single group recognized to act as the Government class.</li>
</ul>
</li>
<li>When to use it<ul>
<li>It does two things (not a single responsibility…):<ul>
<li>It ensures that a class has only one instance;</li>
<li>It provides a global point of access to that instance.</li>
</ul>
</li>
<li>It is often used to manage shared resources, such as a database connection.</li>
</ul>
</li>
<li>Implementation<ul>
<li>A private variable in the package holds the instance.</li>
<li>Ensure safe access in concurrent environments (e.g., using <code>sync.Once</code>).</li>
<li>A public function provides global access to the instance.</li>
</ul>
</li>
<li>Pros<ul>
<li>Provides controlled access to a unique instance.</li>
<li>Instance is created only when needed (lazy Initialization).</li>
<li>Easily accessible throughout the application (global access).</li>
</ul>
</li>
<li>Cons<ul>
<li>It can introduce a global state in the application, which is generally discouraged in software design.</li>
<li>Singleton can make unit testing tricky due to its global state.</li>
<li>It needs careful handling in a concurrent environment to avoid multiple instantiations.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Singleton</strong> can be combined with <strong>Factory Method</strong>. The factory method ensures that a single instance is created and returned.</li>
<li><strong>Abstract Factory</strong>, <strong>Builder</strong>, <strong>Prototype</strong>: these patterns are about creating complex objects, which is a different focus from <strong>Singleton</strong>‘s objective of a single instance.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="s">"fmt"</span>
<span class="w"> </span><span class="s">"sync"</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ConfigurationData</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">DatabaseURL</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// ConfigurationManager is a singleton that holds the configuration for the application.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ConfigurationManager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">*</span><span class="nx">ConfigurationData</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">*</span><span class="nx">ConfigurationManager</span>
<span class="w"> </span><span class="nx">once</span><span class="w">     </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Once</span>
<span class="p">)</span>

<span class="c1">// GetInstance returns the singleton instance of the ConfigurationManager.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">GetInstance</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">ConfigurationManager</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">once</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">instance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ConfigurationManager</span><span class="p">{</span>
<span class="w">   </span><span class="nx">config</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ConfigurationData</span><span class="p">{</span>
<span class="w">    </span><span class="nx">DatabaseURL</span><span class="p">:</span><span class="w"> </span><span class="s">"localhost:4321"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Default value</span>
<span class="w">   </span><span class="p">},</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">})</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">instance</span>
<span class="p">}</span>

<span class="c1">// UpdateConfig updates configuration if needed</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">ConfigurationManager</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateConfig</span><span class="p">(</span><span class="nx">newConfig</span><span class="w"> </span><span class="o">*</span><span class="nx">ConfigurationData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">config</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newConfig</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">config1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">GetInstance</span><span class="p">()</span>
<span class="w"> </span><span class="nx">config2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">GetInstance</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">config1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">config2</span><span class="p">)</span><span class="w"> </span><span class="c1">// true</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="structural-design-patterns">Structural Design Patterns</h2>
<p>These patterns focus on ways to compose objects to form larger structures efficiently and flexibly.</p>
<h3 id="adapter">Adapter</h3>
<ul>
<li>Analogy<ul>
<li>An adapter may be needed when traveling abroad to charge devices. While it doesn’t change the device’s functionality, it allows it to work in situations where it would normally be incompatible.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To allow two incompatible interfaces to work together.</li>
<li>Use an existing class that has an incompatible interface with the rest of the code.</li>
</ul>
</li>
<li>Implementation<ul>
<li>Implement a client interface.</li>
<li>An adaptee is a class with an incompatible interface (the one that gets adapted).</li>
<li>An adapter is a class that implements the client interface, translating calls to the adaptee’s interface (the one that adapts the incompatible code).</li>
</ul>
</li>
<li>Pros<ul>
<li>Allows otherwise incompatible interfaces to work together.</li>
<li>Enables the reuse of existing classes without altering their code.</li>
<li>Introduces only a small amount of extra code to bridge the compatibility gap.</li>
</ul>
</li>
<li>Cons<ul>
<li>Can add complexity to the code, especially if there are many adaptions.</li>
<li>The adapter pattern involves an extra layer of abstraction, which can complicate the code and increase overhead.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li>While <strong>Adapter</strong> is used to change an interface, <strong>Decorator</strong> is used to add responsibilities to objects without modifying their interface.</li>
<li>The <strong>Bridge</strong> pattern separates an object’s interface from its implementation so the two can vary independently. <strong>Adapter</strong> is meant to change the interface of an existing object.</li>
<li>A <strong>Façade</strong> provides a simplified interface to a complex subsystem, not necessarily designed for incompatible interfaces, unlike <strong>Adapter</strong>.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Outlet</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">InsertInOutlet</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Pluggable</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">InsertInUSOutlet</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">USPlug</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">USPlugAdapter</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">usPlug</span><span class="w"> </span><span class="nx">Pluggable</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">plug</span><span class="w"> </span><span class="o">*</span><span class="nx">USPlug</span><span class="p">)</span><span class="w"> </span><span class="nx">InsertInUSOutlet</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Inserted in US Outlet"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewUSPlugAdapter</span><span class="p">(</span><span class="nx">usPlug</span><span class="w"> </span><span class="nx">Pluggable</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">USPlugAdapter</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">USPlugAdapter</span><span class="p">{</span><span class="nx">usPlug</span><span class="p">:</span><span class="w"> </span><span class="nx">usPlug</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">adapter</span><span class="w"> </span><span class="o">*</span><span class="nx">USPlugAdapter</span><span class="p">)</span><span class="w"> </span><span class="nx">InsertInOutlet</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">adapter</span><span class="p">.</span><span class="nx">usPlug</span><span class="p">.</span><span class="nx">InsertInUSOutlet</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", adapted to fit an Outlet"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">ChargeDevice</span><span class="p">(</span><span class="nx">outlet</span><span class="w"> </span><span class="nx">Outlet</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">outlet</span><span class="p">.</span><span class="nx">InsertInOutlet</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">usPlug</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">USPlug</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">adaptedPlug</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewUSPlugAdapter</span><span class="p">(</span><span class="nx">usPlug</span><span class="p">)</span>

<span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ChargeDevice</span><span class="p">(</span><span class="nx">adaptedPlug</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="c1">// Inserted in US Outlet, adapted to fit an Outlet</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="bridge">Bridge</h3>
<ul>
<li>Analogy<ul>
<li>A universal remote control bridges the functionality gap between different devices (e.g., it can turn up or down the volume on all devices) with a common interface.</li>
</ul>
</li>
<li>When to use it<ul>
<li>Use it to separate the abstraction (high-level logic) from the implementation (low-level logic), allowing them to be developed independently.</li>
<li>When you want to avoid a permanent binding between the abstraction and its implementation, particularly when they both may vary frequently.</li>
</ul>
</li>
<li>Implementation<ul>
<li>The abstraction interface/class is a higher-level control layer that delegates the work to the implementation layer.</li>
<li>The implementor interface defines the interface for the implementation classes.</li>
<li>Concrete implementations are classes that provide specific implementations of the implementor interface.</li>
<li>An optional refined abstraction can be used to extend the abstraction to provide more control.</li>
</ul>
</li>
<li>Pros<ul>
<li>Abstractions and implementations can be extended independently.</li>
<li>Separates high-level and low-level logic into different classes.</li>
<li>The abstraction and its implementation can be developed and maintained separately.</li>
</ul>
</li>
<li>Cons<ul>
<li>Can increase complexity due to the introduction of additional layers.</li>
<li>More effort is needed to set up the structure, which might not be necessary for simpler cases.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li>The <strong>Bridge</strong> pattern is often compared to the <strong>Adapter</strong> pattern. <strong>Bridge</strong> is designed to separate an interface from its implementation, while <strong>Adapter</strong> is meant to make unrelated classes work together.</li>
<li><strong>Bridge</strong> is often used in a similar way to <strong>Strategy</strong>. <strong>Strategy</strong> typically encapsulates algorithms: <strong>Bridge</strong> separates an interface from its implementation.</li>
<li><strong>Abstract Factory</strong> can work with <strong>Bridge</strong> as it can create instances of different classes that implement the abstract interface.</li>
<li><strong>Builder</strong> can be combined with <strong>Bridge</strong>: builders are the implementations and the director is the abstraction.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// The Device interface (the abstraction) defines the operations that all</span>
<span class="c1">// concrete device implementations must support.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Device</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">TurnOn</span><span class="p">()</span>
<span class="w"> </span><span class="nx">TurnOff</span><span class="p">()</span>
<span class="w"> </span><span class="nx">IsEnabled</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span>
<span class="w"> </span><span class="nx">SetVolume</span><span class="p">(</span><span class="nx">volume</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
<span class="w"> </span><span class="nx">GetVolume</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span>
<span class="p">}</span>

<span class="c1">// TV and Radio are concrete implementations of the Device interface.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">TV</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">isEnabled</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TV</span><span class="p">)</span><span class="w"> </span><span class="nx">TurnOn</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isEnabled</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TV</span><span class="p">)</span><span class="w"> </span><span class="nx">TurnOff</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isEnabled</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TV</span><span class="p">)</span><span class="w"> </span><span class="nx">IsEnabled</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isEnabled</span>
<span class="p">}</span>

<span class="c1">// SetVolume for TV</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TV</span><span class="p">)</span><span class="w"> </span><span class="nx">SetVolume</span><span class="p">(</span><span class="nx">volume</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"TV volume set to %d\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">volume</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// GetVolume for TV</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TV</span><span class="p">)</span><span class="w"> </span><span class="nx">GetVolume</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="c1">// Placeholder</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Radio</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">isEnabled</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Radio</span><span class="p">)</span><span class="w"> </span><span class="nx">TurnOn</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">isEnabled</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Radio</span><span class="p">)</span><span class="w"> </span><span class="nx">TurnOff</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">isEnabled</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Radio</span><span class="p">)</span><span class="w"> </span><span class="nx">IsEnabled</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">isEnabled</span>
<span class="p">}</span>

<span class="c1">// SetVolume for Radio</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Radio</span><span class="p">)</span><span class="w"> </span><span class="nx">SetVolume</span><span class="p">(</span><span class="nx">volume</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"🔉 Radio volume set to %d\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">volume</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// GetVolume for Radio</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Radio</span><span class="p">)</span><span class="w"> </span><span class="nx">GetVolume</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="c1">// Placeholder</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">RemoteControl</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="nx">Device</span>
<span class="w"> </span><span class="nx">name</span><span class="w">   </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewRemoteControl</span><span class="p">(</span><span class="nx">device</span><span class="w"> </span><span class="nx">Device</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">RemoteControl</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"NewRemoteControl"</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">RemoteControl</span><span class="p">{</span><span class="nx">device</span><span class="p">:</span><span class="w"> </span><span class="nx">device</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">name</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">RemoteControl</span><span class="p">)</span><span class="w"> </span><span class="nx">TogglePower</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">device</span><span class="p">.</span><span class="nx">IsEnabled</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="s">"🔴 turning off"</span><span class="p">)</span>
<span class="w">  </span><span class="nx">r</span><span class="p">.</span><span class="nx">device</span><span class="p">.</span><span class="nx">TurnOff</span><span class="p">()</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="s">"🟢 turning on"</span><span class="p">)</span>
<span class="w">  </span><span class="nx">r</span><span class="p">.</span><span class="nx">device</span><span class="p">.</span><span class="nx">TurnOn</span><span class="p">()</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">AdvancedRemoteControl</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="o">*</span><span class="nx">RemoteControl</span><span class="w"> </span><span class="c1">// Embedding RemoteControl to inherit its methods</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewAdvancedRemoteControl</span><span class="p">(</span><span class="nx">device</span><span class="w"> </span><span class="nx">Device</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">AdvancedRemoteControl</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">AdvancedRemoteControl</span><span class="p">{</span><span class="nx">RemoteControl</span><span class="p">:</span><span class="w"> </span><span class="nx">NewRemoteControl</span><span class="p">(</span><span class="nx">device</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AdvancedRemoteControl</span><span class="p">)</span><span class="w"> </span><span class="nx">SetDeviceVolume</span><span class="p">(</span><span class="nx">volume</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">device</span><span class="p">.</span><span class="nx">SetVolume</span><span class="p">(</span><span class="nx">volume</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewTV</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">TV</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TV</span><span class="p">{</span><span class="nx">isEnabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewRadio</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Radio</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Radio</span><span class="p">{</span><span class="nx">isEnabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1">// TV without advanced remote</span>
<span class="w"> </span><span class="nx">tv</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewTV</span><span class="p">()</span>
<span class="w"> </span><span class="nx">remote</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewRemoteControl</span><span class="p">(</span><span class="nx">tv</span><span class="p">,</span><span class="w"> </span><span class="s">"Samsung TV"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">remote</span><span class="p">.</span><span class="nx">TogglePower</span><span class="p">()</span><span class="w"> </span><span class="c1">// Turns TV on</span>
<span class="w"> </span><span class="nx">remote</span><span class="p">.</span><span class="nx">TogglePower</span><span class="p">()</span><span class="w"> </span><span class="c1">// Turns TV off</span>

<span class="w"> </span><span class="c1">// Radio with advanced remote</span>
<span class="w"> </span><span class="nx">radio</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewRadio</span><span class="p">()</span>
<span class="w"> </span><span class="nx">radioRemote</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewAdvancedRemoteControl</span><span class="p">(</span><span class="nx">radio</span><span class="p">,</span><span class="w"> </span><span class="s">"Sony Radio"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">radioRemote</span><span class="p">.</span><span class="nx">TogglePower</span><span class="p">()</span>
<span class="w"> </span><span class="nx">radioRemote</span><span class="p">.</span><span class="nx">SetDeviceVolume</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="w"> </span><span class="nx">radioRemote</span><span class="p">.</span><span class="nx">TogglePower</span><span class="p">()</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  NewRemoteControl Samsung TV</span>
<span class="cm">  Samsung TV turning on</span>
<span class="cm">  Samsung TV turning off</span>
<span class="cm">  NewRemoteControl Sony Radio</span>
<span class="cm">  Sony Radio turning on</span>
<span class="cm">  Radio volume set to 30</span>
<span class="cm">  Sony Radio set volume to 30</span>
<span class="cm">  Sony Radio turning off</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="composite-object-tree">Composite (object tree)</h3>
<ul>
<li>Analogy<ul>
<li>The military is a tree structure where orders come from the top, are passed down the divisions, brigades and so on where the leaves are the actual soldiers.</li>
</ul>
</li>
<li>When to use it<ul>
<li>When you want to work with a tree structure and have to perform operations on both individual elements and groups of elements in the same way.</li>
</ul>
</li>
<li>Implementation<ul>
<li>There is a component interface for individual objects and their compositions which defines operations that can be performed on both.</li>
<li>A leaf represents individual objects in the structure.</li>
<li>A composite represents a composite of objects (a group of <code>Leaf</code> objects) and implements the component interface.</li>
</ul>
</li>
<li>Pros<ul>
<li>Makes it easier to work with complex tree structures by allowing you to treat individual objects and compositions uniformly.</li>
<li>Can add and remove new types of components without changing existing code.</li>
<li>Client code can treat composite structures and individual objects uniformly.</li>
</ul>
</li>
<li>Cons<ul>
<li>Components that do not have much in common end up being overgeneralized.</li>
<li>The implementation can become overly complex if the hierarchy gets too deep or if extensive functionality is required.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Builder</strong> can be used with <strong>Composite</strong> because its construction steps can be recursive.</li>
<li><strong>Chain of Responsibility</strong> passes a request along a chain of objects until one of them handles it, <strong>Composite</strong> arranges objects in a tree structure and works with these structures collectively.</li>
<li><strong>Iterators</strong> can be used to traverse a <strong>Composite</strong> tree.</li>
<li><strong>Visitor</strong> can be used to execute an operation on a whole tree.</li>
<li>Shared leaves from the <strong>Composite</strong> tree can be implemented with <strong>Flyweights</strong> to reduce <span class="caps">RAM</span> usage.</li>
<li><strong>Decorator</strong> only has one component and augments it by wrapping it with new functionality while <strong>Composite</strong> just runs the logic on all child components.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="s">"fmt"</span>
<span class="w"> </span><span class="s">"strings"</span>
<span class="p">)</span>

<span class="c1">// Command is the component interface that all commands must implement.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="nx">Undo</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Document</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// WriteCommand is a leaf that implements the Command component interface.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">WriteCommand</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">document</span><span class="w"> </span><span class="o">*</span><span class="nx">Document</span>
<span class="w"> </span><span class="nx">addition</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// SaveCommand is another leaf.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">SaveCommand</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">document</span><span class="w"> </span><span class="o">*</span><span class="nx">Document</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WriteCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">document</span><span class="p">.</span><span class="nx">content</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">addition</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Document after writing: %s\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">document</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WriteCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Undo writing: %s\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">addition</span><span class="p">)</span>
<span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">document</span><span class="p">.</span><span class="nx">content</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">TrimSuffix</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">document</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">addition</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SaveCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Document saved: %s\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">document</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SaveCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Restore to the last saved point..."</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">CommandManager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">history</span><span class="w"> </span><span class="p">[]</span><span class="nx">Command</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">CommandManager</span><span class="p">)</span><span class="w"> </span><span class="nx">ExecuteCommand</span><span class="p">(</span><span class="nx">cmd</span><span class="w"> </span><span class="nx">Command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">cmd</span><span class="p">.</span><span class="nx">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">history</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">history</span><span class="p">,</span><span class="w"> </span><span class="nx">cmd</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">CommandManager</span><span class="p">)</span><span class="w"> </span><span class="nx">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">cmd</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">history</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="w"> </span><span class="nx">cmd</span><span class="p">.</span><span class="nx">Undo</span><span class="p">()</span>
<span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">history</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">history</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">// CompositeCommand is a composite that implements the Command component interface.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CompositeCommand</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">commands</span><span class="w"> </span><span class="p">[]</span><span class="nx">Command</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CompositeCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">cmd</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">commands</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">cmd</span><span class="p">.</span><span class="nx">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CompositeCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">commands</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">--</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">c</span><span class="p">.</span><span class="nx">commands</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Undo</span><span class="p">()</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CompositeCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">AddCommand</span><span class="p">(</span><span class="nx">cmd</span><span class="w"> </span><span class="nx">Command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">commands</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">commands</span><span class="p">,</span><span class="w"> </span><span class="nx">cmd</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Document</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">write1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">WriteCommand</span><span class="p">{</span><span class="nx">document</span><span class="p">:</span><span class="w"> </span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">addition</span><span class="p">:</span><span class="w"> </span><span class="s">"Hello "</span><span class="p">}</span>
<span class="w"> </span><span class="nx">write2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">WriteCommand</span><span class="p">{</span><span class="nx">document</span><span class="p">:</span><span class="w"> </span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">addition</span><span class="p">:</span><span class="w"> </span><span class="s">"World"</span><span class="p">}</span>
<span class="w"> </span><span class="nx">save</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SaveCommand</span><span class="p">{</span><span class="nx">document</span><span class="p">:</span><span class="w"> </span><span class="nx">doc</span><span class="p">}</span>

<span class="w"> </span><span class="nx">compositeCommand</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CompositeCommand</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">compositeCommand</span><span class="p">.</span><span class="nx">AddCommand</span><span class="p">(</span><span class="nx">write1</span><span class="p">)</span>
<span class="w"> </span><span class="nx">compositeCommand</span><span class="p">.</span><span class="nx">AddCommand</span><span class="p">(</span><span class="nx">write2</span><span class="p">)</span>
<span class="w"> </span><span class="nx">compositeCommand</span><span class="p">.</span><span class="nx">AddCommand</span><span class="p">(</span><span class="nx">save</span><span class="p">)</span>

<span class="w"> </span><span class="nx">commandManager</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CommandManager</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">commandManager</span><span class="p">.</span><span class="nx">ExecuteCommand</span><span class="p">(</span><span class="nx">compositeCommand</span><span class="p">)</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nUndoing Composite Command:"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">commandManager</span><span class="p">.</span><span class="nx">Undo</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"\nFinal Document Content: %s\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Document after writing: Hello</span>
<span class="cm">  Document after writing: Hello World</span>
<span class="cm">  Document saved: Hello World</span>

<span class="cm">  Undoing Composite Command:</span>
<span class="cm">  Restore to the last saved point...</span>
<span class="cm">  Undo writing: World</span>
<span class="cm">  Undo writing: Hello</span>

<span class="cm">  Final Document Content:</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="decorator-wrapper">Decorator (wrapper)</h3>
<ul>
<li>Analogy<ul>
<li>Wearing layers of clothes: without clothes, it’s cold; with a jacket, it’s warmer; with a raincoat on top, it’s warmer and dryer. The same person is “decorated” to be comfortable under different circumstances.</li>
</ul>
</li>
<li>When to use it<ul>
<li>Used to add new functionality to an object dynamically, without altering its structure.</li>
<li>Allows for extending an object’s behavior by wrapping it with additional functionality.</li>
</ul>
</li>
<li>Implementation<ul>
<li>The Component interface defines the interface for objects that can have responsibilities added to them dynamically (e.g., a file with <code>read()</code> and <code>write()</code> methods).</li>
<li>The Concrete component is an object to which additional responsibilities can be attached (e.g., a file with <code>write()</code> could first be compressed or encrypted).</li>
<li>Decorator classes are wrappers that add responsibilities to the component. They implement the same interface as the component they decorate (e.g., taking the <code>File</code> object, there could be EncryptionDecorator and CompressionDecorator).</li>
</ul>
</li>
<li>Pros<ul>
<li>Provides a flexible alternative to subclassing for extending functionality.</li>
<li>Responsibilities can be added and removed at runtime.</li>
<li>Allows for the combination of behaviors by stacking decorators on top of each other.</li>
</ul>
</li>
<li>Cons<ul>
<li>Can lead to complex code structures and debugging difficulties, especially with multiple layers of decorators (order matters!).</li>
<li>Creating an object decorated with multiple layers can require more complex setup code.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li>Unlike <strong>Adapter</strong>, which changes the behavior of an incompatible class to work with another class, <strong>Decorator</strong> doesn’t modify the original object and stacks functionality on top of it. <strong>Decorator</strong> can work recursively, while an <strong>Adapter</strong> can’t.</li>
<li><strong>Adapter</strong> leads to a wrapped object with a different interface. Proxy maintains the same interface. <strong>Decorator</strong> enhances it.</li>
<li><strong>Decorator</strong> is similar to <strong>Chain of Responsibility</strong>. But <strong>Decorator</strong> maintains consistency throughout the request, while a chain can stop at any point and handle multiple independent operations at once.</li>
<li>A <strong>Decorator</strong> is like a <strong>Composite</strong> but with a single component. <strong>Composite</strong> also doesn’t add functionality. Prototype can be useful with these two patterns.</li>
<li><strong>Decorator</strong> lets one change the surface level of an object. <strong>Strategy</strong> lets one change to an entirely different object.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Component is the common interface for both the concrete component and the</span>
<span class="c1">// decorators. It can have multiple layers of decorators.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Component</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Operation</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// ConcreteComponent is a concrete component that implements the Component</span>
<span class="c1">// interface, defining all the operations that can be altered by decorators.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ConcreteComponent</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ConcreteComponent</span><span class="p">)</span><span class="w"> </span><span class="nx">Operation</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"ConcreteComponent"</span>
<span class="p">}</span>

<span class="c1">// Decorator is a base decorator class. It implements the Component interface</span>
<span class="c1">// and has a field for storing a reference to a wrapped object. The default</span>
<span class="c1">// implementation of the wrapped object does the actual work, while the</span>
<span class="c1">// decorator merely delegates to the wrapped object.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Decorator</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">component</span><span class="w"> </span><span class="nx">Component</span>
<span class="p">}</span>

<span class="c1">// Operation Decorator delegates all work to the wrapped component.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">Decorator</span><span class="p">)</span><span class="w"> </span><span class="nx">Operation</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">component</span><span class="p">.</span><span class="nx">Operation</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// ConcreteDecoratorA calls the wrapped object and alter its result in some way.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ConcreteDecoratorA</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Decorator</span>
<span class="p">}</span>

<span class="c1">// Operation Decorators may call parent implementation of the operation, instead of</span>
<span class="c1">// calling the wrapped object directly, simplifying extension of decorator classes.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">ConcreteDecoratorA</span><span class="p">)</span><span class="w"> </span><span class="nx">Operation</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"ConcreteDecoratorA("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Decorator</span><span class="p">.</span><span class="nx">Operation</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" + AddedBehaviorA)"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewConcreteDecoratorA</span><span class="p">(</span><span class="nx">component</span><span class="w"> </span><span class="nx">Component</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">ConcreteDecoratorA</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ConcreteDecoratorA</span><span class="p">{</span><span class="nx">Decorator</span><span class="p">{</span><span class="nx">component</span><span class="p">:</span><span class="w"> </span><span class="nx">component</span><span class="p">}}</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ConcreteDecoratorB</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Decorator</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">ConcreteDecoratorB</span><span class="p">)</span><span class="w"> </span><span class="nx">Operation</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">pre</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">"PreBehaviorB | "</span>
<span class="w"> </span><span class="nx">base</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Decorator</span><span class="p">.</span><span class="nx">Operation</span><span class="p">()</span><span class="w"> </span><span class="c1">// Delegate to base Operation</span>
<span class="w"> </span><span class="nx">post</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">" | PostBehaviorB"</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">pre</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"ConcreteDecoratorB("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">base</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">")"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">post</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewConcreteDecoratorB</span><span class="p">(</span><span class="nx">component</span><span class="w"> </span><span class="nx">Component</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">ConcreteDecoratorB</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ConcreteDecoratorB</span><span class="p">{</span><span class="nx">Decorator</span><span class="p">{</span><span class="nx">component</span><span class="p">:</span><span class="w"> </span><span class="nx">component</span><span class="p">}}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">decoratedComponent</span><span class="w"> </span><span class="nx">Component</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ConcreteComponent</span><span class="p">{}</span>

<span class="w"> </span><span class="nx">decoratedComponent</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">NewConcreteDecoratorA</span><span class="p">(</span><span class="nx">decoratedComponent</span><span class="p">)</span>
<span class="w"> </span><span class="nx">decoratedComponent</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">NewConcreteDecoratorB</span><span class="p">(</span><span class="nx">decoratedComponent</span><span class="p">)</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">decoratedComponent</span><span class="p">.</span><span class="nx">Operation</span><span class="p">())</span>
<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="c1">// PreBehaviorB | ConcreteDecoratorB(ConcreteDecoratorA(ConcreteComponent + AddedBehaviorA)) | PostBehaviorB</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="facade">Facade</h3>
<ul>
<li>Analogy<ul>
<li>Placing an order by phone is easy (call and get it delivered), but a bunch of operations must happen in the background (warehouse, packaging, suppliers, etc.), which the client has no direct knowledge of.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To provide a simplified interface to a complex subsystem. It doesn’t encapsulate the subsystem but offers an easier or more coherent interface for clients to interact with.</li>
<li>Useful when dealing with a large body of code, such as a library or a framework.</li>
</ul>
</li>
<li>Implementation<ul>
<li>A Facade interface defines an interface that abstracts the complex functionalities of the subsystem.</li>
<li>Subsystem classes are the complex parts of the subsystem that the facade will simplify.</li>
<li>A Facade class implements the facade interface and interacts with the subsystem classes on behalf of the client.</li>
</ul>
</li>
<li>Pros<ul>
<li>Simplifies the interface for complex subsystems, making them easier to use.</li>
<li>Clients are isolated from the complexities of the subsystem, reducing dependencies and making the system easier to use and maintain.</li>
<li>Clients can work with a single unified interface instead of a set of complex and potentially confusing interfaces.</li>
</ul>
</li>
<li>Cons<ul>
<li>The facade might limit access to certain features of the subsystem that advanced users might need.</li>
<li>If not designed carefully, the facade can end up doing too much, becoming overly complex (a “God Object”).</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li>The <strong>Adapter</strong> pattern changes the interface of an existing object; the <strong>Facade</strong> provides a simplified interface to a complex subsystem. The <strong>Facade</strong> doesn’t wrap the subsystem to change its interface but provides a simpler one.</li>
<li>The <strong>Facade</strong> simplifies access to a complex system; the <strong>Decorator</strong> adds behavior to objects. They are both used to simplify client interactions but achieve this in different ways.</li>
<li>Often, a <strong>Facade</strong> is implemented as a <strong>Singleton</strong> because usually one facade object is enough to manage the underlying systems.</li>
<li><strong>Abstract Fac­to­ry</strong> can be an alternative when the main goal is to hide the way the sub­sys­tem objects are cre­at­ed in the client code.</li>
<li><strong>Facade</strong> makes a single object to represent a whole system while <strong>Flyweight</strong> makes lots of little objects.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="c1">// Example of a facade pattern</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="s">"fmt"</span>
<span class="w"> </span><span class="s">"strings"</span>
<span class="p">)</span>

<span class="c1">// TV is subsystem 1</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">TV</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">isOn</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TV</span><span class="p">)</span><span class="w"> </span><span class="nx">TurnOn</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"❌ TV is already on"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"TV is on"</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TV</span><span class="p">)</span><span class="w"> </span><span class="nx">TurnOff</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"❌ TV is already off"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"TV is off"</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// SoundSystem is subsystem 2</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">SoundSystem</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">isOn</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SoundSystem</span><span class="p">)</span><span class="w"> </span><span class="nx">TurnOn</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"❌ SoundSystem is already on"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"SoundSystem is on"</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SoundSystem</span><span class="p">)</span><span class="w"> </span><span class="nx">TurnOff</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">s</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"❌ SoundSystem is already off"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"SoundSystem is off"</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// DVDPlayer is subsystem 3</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">DVDPlayer</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">isOn</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">DVDPlayer</span><span class="p">)</span><span class="w"> </span><span class="nx">Play</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"❌ DVD is already playing"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"DVD is playing"</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">DVDPlayer</span><span class="p">)</span><span class="w"> </span><span class="nx">Stop</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"❌ DVD is already stopped"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"DVD stopped"</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// HomeTheaterFacade provides a simplified interface to a complex subsystem</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">HomeTheaterFacade</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">tv</span><span class="w">          </span><span class="o">*</span><span class="nx">TV</span>
<span class="w"> </span><span class="nx">soundSystem</span><span class="w"> </span><span class="o">*</span><span class="nx">SoundSystem</span>
<span class="w"> </span><span class="nx">dvdPlayer</span><span class="w">   </span><span class="o">*</span><span class="nx">DVDPlayer</span>
<span class="p">}</span>

<span class="c1">// NewHomeTheaterFacade is a constructor for HomeTheaterFacade</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewHomeTheaterFacade</span><span class="p">(</span><span class="nx">tv</span><span class="w"> </span><span class="o">*</span><span class="nx">TV</span><span class="p">,</span><span class="w"> </span><span class="nx">soundSystem</span><span class="w"> </span><span class="o">*</span><span class="nx">SoundSystem</span><span class="p">,</span><span class="w"> </span><span class="nx">dvdPlayer</span><span class="w"> </span><span class="o">*</span><span class="nx">DVDPlayer</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">HomeTheaterFacade</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">HomeTheaterFacade</span><span class="p">{</span>
<span class="w">  </span><span class="nx">tv</span><span class="p">:</span><span class="w">          </span><span class="nx">tv</span><span class="p">,</span>
<span class="w">  </span><span class="nx">soundSystem</span><span class="p">:</span><span class="w"> </span><span class="nx">soundSystem</span><span class="p">,</span>
<span class="w">  </span><span class="nx">dvdPlayer</span><span class="p">:</span><span class="w">   </span><span class="nx">dvdPlayer</span><span class="p">,</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// WatchMovie is a facade method</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">*</span><span class="nx">HomeTheaterFacade</span><span class="p">)</span><span class="w"> </span><span class="nx">WatchMovie</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">tv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">soundSystem</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">dvdPlayer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"❌ home theater is not properly set up"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewOperationResponse</span><span class="p">()</span>
<span class="w"> </span><span class="nx">tvResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">tvErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">tv</span><span class="p">.</span><span class="nx">TurnOn</span><span class="p">()</span>
<span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">AddResponse</span><span class="p">(</span><span class="nx">tvResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">tvErr</span><span class="p">)</span>
<span class="w"> </span><span class="nx">soundSystemResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">soundSystemErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">soundSystem</span><span class="p">.</span><span class="nx">TurnOn</span><span class="p">()</span>
<span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">AddResponse</span><span class="p">(</span><span class="nx">soundSystemResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">soundSystemErr</span><span class="p">)</span>
<span class="w"> </span><span class="nx">dvdResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">dvdErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">dvdPlayer</span><span class="p">.</span><span class="nx">Play</span><span class="p">()</span>
<span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">AddResponse</span><span class="p">(</span><span class="nx">dvdResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">dvdErr</span><span class="p">)</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// StopMovie is a facade method</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">*</span><span class="nx">HomeTheaterFacade</span><span class="p">)</span><span class="w"> </span><span class="nx">StopMovie</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewOperationResponse</span><span class="p">()</span>
<span class="w"> </span><span class="nx">dvdResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">dvdErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">dvdPlayer</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>
<span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">AddResponse</span><span class="p">(</span><span class="nx">dvdResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">dvdErr</span><span class="p">)</span>
<span class="w"> </span><span class="nx">soundSystemResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">soundSystemErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">soundSystem</span><span class="p">.</span><span class="nx">TurnOff</span><span class="p">()</span>
<span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">AddResponse</span><span class="p">(</span><span class="nx">soundSystemResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">soundSystemErr</span><span class="p">)</span>
<span class="w"> </span><span class="nx">tvResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">tvErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">tv</span><span class="p">.</span><span class="nx">TurnOff</span><span class="p">()</span>
<span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">AddResponse</span><span class="p">(</span><span class="nx">tvResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">tvErr</span><span class="p">)</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">OperationResponse</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Responses</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>
<span class="w"> </span><span class="nx">Errors</span><span class="w">    </span><span class="p">[]</span><span class="kt">error</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewOperationResponse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">OperationResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">OperationResponse</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">OperationResponse</span><span class="p">)</span><span class="w"> </span><span class="nx">AddResponse</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">""</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">o</span><span class="p">.</span><span class="nx">Responses</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">Responses</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">o</span><span class="p">.</span><span class="nx">Errors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">Errors</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">OperationResponse</span><span class="p">)</span><span class="w"> </span><span class="nx">String</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1">// Combine all responses and errors into a single string, don't display nil errors</span>
<span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">responseStrings</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>
<span class="w"> </span><span class="nx">responseStrings</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">responseStrings</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">Responses</span><span class="o">...</span><span class="p">)</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">responseStrings</span><span class="p">,</span><span class="w"> </span><span class="s">"\n"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">mapErrorsToStrings</span><span class="p">(</span><span class="nx">errors</span><span class="w"> </span><span class="p">[]</span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">errorStrings</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">errors</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">errorStrings</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">errorStrings</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">errorStrings</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">tv</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TV</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">soundSystem</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SoundSystem</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">dvdPlayer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">DVDPlayer</span><span class="p">{}</span>

<span class="w"> </span><span class="nx">faultyHomeTheater</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewHomeTheaterFacade</span><span class="p">(</span><span class="nx">tv</span><span class="p">,</span><span class="w"> </span><span class="nx">soundSystem</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Trying to watch a movie with a faulty home theater..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">faultyMovie</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">faultyHomeTheater</span><span class="p">.</span><span class="nx">WatchMovie</span><span class="p">()</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">faultyMovie</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">homeTheater</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewHomeTheaterFacade</span><span class="p">(</span><span class="nx">tv</span><span class="p">,</span><span class="w"> </span><span class="nx">soundSystem</span><span class="p">,</span><span class="w"> </span><span class="nx">dvdPlayer</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"About to watch a movie with a properly set up home theater..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">movie</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">homeTheater</span><span class="p">.</span><span class="nx">WatchMovie</span><span class="p">()</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">movie</span><span class="p">)</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Someone tries to turn on the TV while it's already on..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tv</span><span class="p">.</span><span class="nx">TurnOn</span><span class="p">()</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Trying to start the movie again while it's already playing..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">watchMovie</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">homeTheater</span><span class="p">.</span><span class="nx">WatchMovie</span><span class="p">()</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">watchMovie</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Stopping the movie..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">homeTheater</span><span class="p">.</span><span class="nx">StopMovie</span><span class="p">()</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Trying to stop the movie again while it's already stopped..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">homeTheater</span><span class="p">.</span><span class="nx">StopMovie</span><span class="p">()</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Trying to watch a movie with a faulty home theater...</span>
<span class="cm">  ❌ home theater is not properly set up</span>
<span class="cm">  About to watch a movie with a properly set up home theater...</span>
<span class="cm">  TV is on</span>
<span class="cm">  SoundSystem is on</span>
<span class="cm">  DVD is playing</span>
<span class="cm">  Someone tries to turn on the TV while it's already on...</span>
<span class="cm">  ❌ TV is already on</span>
<span class="cm">  Trying to start the movie again while it's already playing...</span>
<span class="cm">  Stopping the movie...</span>
<span class="cm">  Trying to stop the movie again while it's already stopped...</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="flyweight-cache">Flyweight (cache)</h3>
<ul>
<li>Analogy<ul>
<li>A library (flyweight factory) lends books (flyweight objects with intrinsic state) to library members (context in which extrinsic state exists) without creating a resource nightmare (resources are shared as much as possible).</li>
</ul>
</li>
<li>When to use it<ul>
<li>There’s a need to spawn a huge number of similar objects sharing some context.</li>
<li>The intrinsic state can be extracted across different objects. E.g., actual trees of the same type may share attributes like texture and color (intrinsic state) but will have distinct attributes like their <code>(x, y, z)</code> position (extrinsic state).</li>
</ul>
</li>
<li>Implementation<ul>
<li>Separate intrinsic and extrinsic states.<ul>
<li>Get the fields that won’t change (intrinsic state). These are unchanging and unique data points. They are implemented via the Flyweight interface.</li>
<li>The extrinsic state is the contextual data that is unique to each object and cannot be shared.</li>
</ul>
</li>
<li>A concrete flyweight implements the Flyweight interface and stores intrinsic state that can be shared. The extrinsic state is passed as arguments to methods. Fields related to the intrinsic state must be immutable.</li>
<li>A flyweight factory class can be created to avoid re-creating existing objects with a set comprising the exact same attributes. The intrinsic state is passed to the factory.</li>
</ul>
</li>
<li>Pros<ul>
<li>Can save a lot of memory depending on context. This is only relevant when a very large number of objects are needed.</li>
</ul>
</li>
<li>Cons<ul>
<li>While <span class="caps">RAM</span> may decrease, there can be a trade off with <span class="caps">CPU</span> as contextual data may need to be recalculated.</li>
<li>This increases complexity substantially.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li>Shared leaf nodes of a <strong>Composite</strong> tree may be implemented as <strong>Flyweights</strong>.</li>
<li><strong>Flyweight</strong> creates lots of smaller objects, <strong>Facade</strong> creates a single large object representing the whole system.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="s">"fmt"</span>
<span class="w"> </span><span class="s">"strings"</span>
<span class="p">)</span>

<span class="c1">// TextStyle is the flyweight interface</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">TextStyle</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// BoldStyle is a concrete flyweight</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BoldStyle</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">BoldStyle</span><span class="p">)</span><span class="w"> </span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"**"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"**"</span>
<span class="p">}</span>

<span class="c1">// UrgentStyle is a concrete flyweight</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">UrgentStyle</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">UrgentStyle</span><span class="p">)</span><span class="w"> </span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"‼️ "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" ‼️"</span>
<span class="p">}</span>

<span class="c1">// ItalicStyle is a concrete flyweight</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ItalicStyle</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">ItalicStyle</span><span class="p">)</span><span class="w"> </span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"_"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"_"</span>
<span class="p">}</span>

<span class="c1">// BulletStyle is a concrete flyweight</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BulletStyle</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">BulletStyle</span><span class="p">)</span><span class="w"> </span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"* "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">text</span>
<span class="p">}</span>

<span class="c1">// StyleFactory is the flyweight factory</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">StyleFactory</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">styles</span><span class="w">          </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">TextStyle</span>
<span class="w"> </span><span class="nx">compositeStyles</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">CompositeStyle</span><span class="w"> </span><span class="c1">// cache for composite styles</span>
<span class="p">}</span>

<span class="c1">// NewStyleFactory is the flyweight factory constructor</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewStyleFactory</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">StyleFactory</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">StyleFactory</span><span class="p">{</span>
<span class="w">  </span><span class="nx">styles</span><span class="p">:</span><span class="w">          </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">TextStyle</span><span class="p">),</span>
<span class="w">  </span><span class="nx">compositeStyles</span><span class="p">:</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">CompositeStyle</span><span class="p">),</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">StyleFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">GetStyle</span><span class="p">(</span><span class="nx">styleName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">TextStyle</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">styles</span><span class="p">[</span><span class="nx">styleName</span><span class="p">];</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="nx">TextStyle</span>
<span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="nx">styleName</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="s">"bold"</span><span class="p">:</span>
<span class="w">  </span><span class="nx">style</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BoldStyle</span><span class="p">{}</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="s">"italic"</span><span class="p">:</span>
<span class="w">  </span><span class="nx">style</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ItalicStyle</span><span class="p">{}</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="s">"bullet"</span><span class="p">:</span>
<span class="w">  </span><span class="nx">style</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BulletStyle</span><span class="p">{}</span>
<span class="w"> </span><span class="k">default</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"unknown style: %s"</span><span class="p">,</span><span class="w"> </span><span class="nx">styleName</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">styles</span><span class="p">[</span><span class="nx">styleName</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">style</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Extend with the Composite pattern to get multiple styles applied to a text</span>

<span class="c1">// CompositeStyle is the composite class</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CompositeStyle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">styles</span><span class="w"> </span><span class="p">[]</span><span class="nx">TextStyle</span>
<span class="p">}</span>

<span class="c1">// NewCompositeStyle is the composite constructor</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewCompositeStyle</span><span class="p">(</span><span class="nx">styles</span><span class="w"> </span><span class="o">...</span><span class="nx">TextStyle</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">CompositeStyle</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CompositeStyle</span><span class="p">{</span><span class="nx">styles</span><span class="p">:</span><span class="w"> </span><span class="nx">styles</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ApplyStyle is the composite method</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CompositeStyle</span><span class="p">)</span><span class="w"> </span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">styles</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">style</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">text</span>
<span class="p">}</span>

<span class="c1">// AddStyle is the composite method</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CompositeStyle</span><span class="p">)</span><span class="w"> </span><span class="nx">AddStyle</span><span class="p">(</span><span class="nx">style</span><span class="w"> </span><span class="nx">TextStyle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">styles</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">styles</span><span class="p">,</span><span class="w"> </span><span class="nx">style</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">StyleFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">GetCompositeStyle</span><span class="p">(</span><span class="nx">styleNames</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">TextStyle</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">styleNames</span><span class="p">,</span><span class="w"> </span><span class="s">"+"</span><span class="p">)</span><span class="w"> </span><span class="c1">// Create a unique key for the combination</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">composite</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">compositeStyles</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">composite</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">composite</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">NewCompositeStyle</span><span class="p">()</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">styleNames</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">GetStyle</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="c1">// Handle error as appropriate</span>
<span class="w">  </span><span class="nx">composite</span><span class="p">.</span><span class="nx">AddStyle</span><span class="p">(</span><span class="nx">style</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">compositeStyles</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">composite</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">composite</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ConditionalStyle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">condition</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span>
<span class="w"> </span><span class="nx">style</span><span class="w">     </span><span class="nx">TextStyle</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewConditionalStyle</span><span class="p">(</span><span class="nx">condition</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="nx">TextStyle</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">ConditionalStyle</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ConditionalStyle</span><span class="p">{</span><span class="nx">condition</span><span class="p">:</span><span class="w"> </span><span class="nx">condition</span><span class="p">,</span><span class="w"> </span><span class="nx">style</span><span class="p">:</span><span class="w"> </span><span class="nx">style</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ConditionalStyle</span><span class="p">)</span><span class="w"> </span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">condition</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">text</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">factory</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewStyleFactory</span><span class="p">()</span>

<span class="w"> </span><span class="nx">boldStyle</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">GetStyle</span><span class="p">(</span><span class="s">"bold"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">boldStyle</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">))</span>

<span class="w"> </span><span class="nx">italicStyle</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">GetStyle</span><span class="p">(</span><span class="s">"italic"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">italicStyle</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"Go!"</span><span class="p">))</span>

<span class="w"> </span><span class="c1">// Reusing flyweights</span>
<span class="w"> </span><span class="nx">anotherBold</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">GetStyle</span><span class="p">(</span><span class="s">"bold"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">anotherBold</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"Flyweight bold"</span><span class="p">))</span>

<span class="w"> </span><span class="nx">bulletStyle</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">GetStyle</span><span class="p">(</span><span class="s">"bullet"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">bulletStyle</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"Flyweight list"</span><span class="p">))</span>

<span class="w"> </span><span class="c1">// Composite styles</span>
<span class="w"> </span><span class="nx">italicBulletStyle</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">GetCompositeStyle</span><span class="p">(</span><span class="s">"italic"</span><span class="p">,</span><span class="w"> </span><span class="s">"bullet"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">italicBulletStyle</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"Italic bullet"</span><span class="p">))</span>
<span class="w"> </span><span class="nx">bulletItalicStyle</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">GetCompositeStyle</span><span class="p">(</span><span class="s">"bullet"</span><span class="p">,</span><span class="w"> </span><span class="s">"italic"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">bulletItalicStyle</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"Bullet italic that's incorrect..."</span><span class="p">))</span>

<span class="w"> </span><span class="c1">// Apply bold style only if the text contains "important"</span>
<span class="w"> </span><span class="nx">importantCondition</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">"important"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">importantBoldStyle</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewConditionalStyle</span><span class="p">(</span><span class="nx">importantCondition</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BoldStyle</span><span class="p">{})</span>

<span class="w"> </span><span class="c1">// Apply urgent style to text that contains "urgent"</span>
<span class="w"> </span><span class="nx">urgentCondition</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">"urgent"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">urgentStyle</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewConditionalStyle</span><span class="p">(</span><span class="nx">urgentCondition</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">UrgentStyle</span><span class="p">{})</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">importantBoldStyle</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"This is important and should be bold"</span><span class="p">))</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">urgentStyle</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"This is important but not bold"</span><span class="p">))</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">urgentStyle</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"This is urgent"</span><span class="p">))</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">importantBoldStyle</span><span class="p">.</span><span class="nx">ApplyStyle</span><span class="p">(</span><span class="s">"This is urgent but not emphasized"</span><span class="p">))</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  **Hello**</span>
<span class="cm">  _Go!_</span>
<span class="cm">  **Flyweight bold**</span>
<span class="cm">  * Flyweight list</span>
<span class="cm">  * _Italic bullet_</span>
<span class="cm">  _* Bullet italic that's incorrect..._</span>
<span class="cm">  **This is important and should be bold**</span>
<span class="cm">  This is important but not bold</span>
<span class="cm">  ‼️ This is urgent ‼️</span>
<span class="cm">  This is urgent but not emphasized</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="proxy">Proxy</h3>
<ul>
<li>Analogy<ul>
<li>Cash and credit cards are two ways of handling payment.</li>
</ul>
</li>
<li>When to use it<ul>
<li>For lazy initialization (virtual proxy). A heavy service can be instantiated as needed instead of leaving it running.</li>
<li>Similarly, for smart referencing (smart reference proxy). This means that if a heavy service needs to be up and running all the time but no clients are using it, it could be shut down until a client connects.</li>
<li>For access control (protection proxy). For instance, a library implements the Spotify <span class="caps">API</span> but needs to limit access to non-paying users. A proxy interface can be used and internal logic can determine which customers can access the <span class="caps">API</span> at a given time. The Spotify <span class="caps">API</span> remains the same, but custom logic can run before and after its use.</li>
<li>For logging requests. Instead of just calling an <span class="caps">API</span>, the proxy can implement logging and then call the <span class="caps">API</span>.</li>
<li>For caching purposes. Instead of downloading a video over and over again via an <span class="caps">API</span>, the result can be cached.</li>
</ul>
</li>
<li>Implementation<ul>
<li>Create a service Proxy interface that is used by the client (Subject interface). The proxy implements the same interface as the service (RealSubject) and can do stuff on top of it (e.g., data caching or logging).</li>
<li>In most cases, the proxy object does some work and delegates the actual use of the service to the service itself from a field that references that service. The proxy class is instantiated with a reference to the service.</li>
<li>Optionally, a factory method can be used.</li>
<li>Also in option, lazy initialization can be implemented for the service object.</li>
</ul>
</li>
<li>Pros<ul>
<li>The proxy transparently controls all aspects of the service and is indistinguishable from the service from the client’s perspective.</li>
<li>The lifecycle of the service can be managed by the proxy class when appropriate, e.g. to reduce system resources.</li>
<li>The proxy works even when the actual service could be down.</li>
<li>New proxies can be added without changing existing code.</li>
</ul>
</li>
<li>Cons<ul>
<li>Complexity increases as new proxies are added.</li>
<li>It may cause delay in the response from the service if the proxy performs heavy operations.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Adapter</strong> provides a different interface, <strong>Proxy</strong> provides the same interface and <strong>Decorator</strong> provides an enhanced version of the interface.</li>
<li><strong>Proxy</strong> is indistinguishable from the original service, whereas <strong>Facade</strong> may be a simplified interface.</li>
<li><strong>Decorator</strong> is controlled by the client, while <strong>Proxy</strong> manages the whole lifecycle of the service.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// RealDocument is the real object that the proxy will represent</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">RealDocument</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Displayable</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Display</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Editable</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Edit</span><span class="p">(</span><span class="nx">newContent</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Display is the method that the proxy and the real object both implement, implementing the Displayable interface</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">RealDocument</span><span class="p">)</span><span class="w"> </span><span class="nx">Display</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Displaying Document: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">content</span>
<span class="p">}</span>

<span class="c1">// NewRealDocument is a factory method that creates a new RealDocument</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewRealDocument</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">RealDocument</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">RealDocument</span><span class="p">{</span><span class="nx">content</span><span class="p">:</span><span class="w"> </span><span class="nx">content</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ProtectedDocument is the proxy object that will control access to the real object</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ProtectedDocument</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">content</span><span class="w">  </span><span class="kt">string</span>
<span class="w"> </span><span class="nx">document</span><span class="w"> </span><span class="o">*</span><span class="nx">RealDocument</span>
<span class="w"> </span><span class="nx">userRole</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Display is the version that the proxy implements</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">ProtectedDocument</span><span class="p">)</span><span class="w"> </span><span class="nx">Display</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Access attempt by %s role\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">userRole</span><span class="p">)</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">userRole</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">"admin"</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"❌ Access Denied: Insufficient permissions"</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">"Access Denied"</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"✅ Document access granted"</span><span class="p">)</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">document</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"⌛ Loading document content..."</span><span class="p">)</span>
<span class="w">  </span><span class="nx">p</span><span class="p">.</span><span class="nx">document</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">NewRealDocument</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">document</span><span class="p">.</span><span class="nx">Display</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// NewProtectedDocument is a factory method that creates a new ProtectedDocument</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewProtectedDocument</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">userRole</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">ProtectedDocument</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ProtectedDocument</span><span class="p">{</span><span class="nx">content</span><span class="p">:</span><span class="w"> </span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">userRole</span><span class="p">:</span><span class="w"> </span><span class="nx">userRole</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">ShowDocument</span><span class="p">(</span><span class="nx">doc</span><span class="w"> </span><span class="nx">Displayable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">Display</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewRealDocument</span><span class="p">(</span><span class="s">"Top secret stuff."</span><span class="p">)</span>

<span class="w"> </span><span class="nx">adminProxy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewProtectedDocument</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="s">"admin"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">ShowDocument</span><span class="p">(</span><span class="nx">adminProxy</span><span class="p">)</span>

<span class="w"> </span><span class="nx">userProxy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewProtectedDocument</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="s">"read-only"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">ShowDocument</span><span class="p">(</span><span class="nx">userProxy</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Whoever has access to the real object can bypass the proxy</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"By-passing the proxy:"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">ShowDocument</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Access attempt by admin role</span>
<span class="cm">  ✅ Document access granted</span>
<span class="cm">  ⌛ Loading document content...</span>
<span class="cm">  Displaying Document: Top secret stuff.</span>
<span class="cm">  Access attempt by read-only role</span>
<span class="cm">  ❌ Access Denied: Insufficient permissions</span>
<span class="cm">  Access Denied</span>
<span class="cm">  By-passing the proxy:</span>
<span class="cm">  Displaying Document: Top secret stuff.</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="behavioral-design-patterns">Behavioral Design Patterns</h2>
<p>These patterns deal with algorithms and the assignment of responsibilities between objects.</p>
<h3 id="chain-of-responsibility-cor-chain-of-command">Chain of Responsibility  (CoR, chain of command)</h3>
<ul>
<li>Analogy<ul>
<li>A call center answers with a machine, then a generalist tries to solve the issue, then the engineer comes to the rescue.</li>
</ul>
</li>
<li>When to use it<ul>
<li>When an action must pass a series of checks, such that a handler may process the request or pass it down the chain of handlers.</li>
</ul>
</li>
<li>Implementation<ul>
<li>A Handler interface defines the interface for handling requests and may also have a method to set the next handler of the chain.</li>
<li>Concrete handlers implement the Handler interface. These either process the request if they can or pass it down the chain until no more handler is available.</li>
<li>The Client initiates the request to a chain of handlers. The chain can either be pre-defined or the client might do the chaining.</li>
</ul>
</li>
<li>Pros<ul>
<li>Can control the order of request handling.</li>
<li>Can decouple unrelated operations (single responsibility principle). It decouples the sender from the receiver.</li>
<li>New handlers can be added without breaking existing code (open/closed principle).</li>
</ul>
</li>
<li>Cons<ul>
<li>Some requests may not be handled if there are no suitable handlers in the chain.<ul>
<li>When all requests should be handled, a default “catch-all” handler can be implemented to be used at the end of the chain.</li>
<li>Another approach could be to disqualify any request that does not match certain criteria if possible, and stop the chain right at the beginning.</li>
</ul>
</li>
<li>Performance could be an issue if the chain of handlers is lengthy.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Chain of Responsibility</strong> passes a requests in a sequential manner until a handler deals with it.</li>
<li>It is often used with the <strong>Composite</strong> pattern, e.g. in a <span class="caps">GUI</span> application where clicking on a button inside a dialog, which itself is inside a panel, may produce a chain reaction. This is suitable when the data structure forms a tree.</li>
<li>The handlers may be implemented as <strong>Commands</strong>. Or the request itself may arrive as a Command object, where the same operation could be executed in a series of different contexts.</li>
<li>Like <strong>Decorator</strong>, this pattern relies on recursive composition. But a <strong>Decorator</strong> doesn’t stop at any point in the chain and adds behavior on top of an existing object (adds responsibilities) while <strong>Chain of Responsibility</strong> can execute any operation in any of its handlers (passes responsibility along).</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// BaseLogger is the base struct for all loggers</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BaseLogger</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">next</span><span class="w"> </span><span class="nx">Logger</span>
<span class="p">}</span>

<span class="c1">// Logger is the interface that all loggers must implement</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Logger</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Log</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
<span class="w"> </span><span class="nx">SetNext</span><span class="p">(</span><span class="nx">logger</span><span class="w"> </span><span class="nx">Logger</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Different types of log levels</span>
<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="nx">INFO</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w"> </span><span class="nx">DEBUG</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w"> </span><span class="nx">ERROR</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">BaseLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">SetNext</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">Logger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">next</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">BaseLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Next</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">l</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">LoggerImpl</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">BaseLogger</span>
<span class="w"> </span><span class="nx">levels</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">bool</span><span class="w"> </span><span class="c1">// Map to hold allowed log levels</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewLogger</span><span class="p">(</span><span class="nx">levels</span><span class="w"> </span><span class="o">...</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">LoggerImpl</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">levelMap</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">level</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">levels</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">levelMap</span><span class="p">[</span><span class="nx">level</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">LoggerImpl</span><span class="p">{</span><span class="nx">levels</span><span class="p">:</span><span class="w"> </span><span class="nx">levelMap</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">LoggerImpl</span><span class="p">)</span><span class="w"> </span><span class="nx">Log</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">severity</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"[%s] %s\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">severityToString</span><span class="p">(</span><span class="nx">severity</span><span class="p">),</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">Next</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">severityToString</span><span class="p">(</span><span class="nx">severity</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="nx">severity</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="nx">INFO</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">"INFO"</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="nx">DEBUG</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">"DEBUG"</span>
<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="nx">ERROR</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">"ERROR"</span>
<span class="w"> </span><span class="k">default</span><span class="p">:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">"UNKNOWN"</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// DefaultLogger is a logger that logs all unhandled messages</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">DefaultLogger</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Log logs the message and severity level for all unhandled messages</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">DefaultLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Log</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"[DEFAULT] %s (severity: %d)\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// SetNext does nothing for the default logger</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">DefaultLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">SetNext</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">Logger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1">// default catch-all handler with no next logger</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">BuildChain</span><span class="p">(</span><span class="nx">loggers</span><span class="w"> </span><span class="o">...</span><span class="nx">Logger</span><span class="p">)</span><span class="w"> </span><span class="nx">Logger</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">loggers</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">loggers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">SetNext</span><span class="p">(</span><span class="nx">loggers</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">loggers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="c1">// Return the head of the chain</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">infoLogger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewLogger</span><span class="p">(</span><span class="nx">INFO</span><span class="p">)</span>
<span class="w"> </span><span class="nx">debugLogger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewLogger</span><span class="p">(</span><span class="nx">DEBUG</span><span class="p">)</span>
<span class="w"> </span><span class="nx">errorLogger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewLogger</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">)</span>
<span class="w"> </span><span class="nx">defaultLogger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">DefaultLogger</span><span class="p">{}</span>

<span class="w"> </span><span class="c1">// Build the chain</span>
<span class="w"> </span><span class="nx">headLogger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">BuildChain</span><span class="p">(</span><span class="nx">debugLogger</span><span class="p">,</span><span class="w"> </span><span class="nx">infoLogger</span><span class="p">,</span><span class="w"> </span><span class="nx">errorLogger</span><span class="p">,</span><span class="w"> </span><span class="nx">defaultLogger</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Test the chain</span>
<span class="w"> </span><span class="nx">headLogger</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="s">"Info message"</span><span class="p">,</span><span class="w"> </span><span class="nx">INFO</span><span class="p">)</span>
<span class="w"> </span><span class="nx">headLogger</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="s">"Debug message"</span><span class="p">,</span><span class="w"> </span><span class="nx">DEBUG</span><span class="p">)</span>
<span class="w"> </span><span class="nx">headLogger</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="s">"Error message"</span><span class="p">,</span><span class="w"> </span><span class="nx">ERROR</span><span class="p">)</span>
<span class="w"> </span><span class="nx">headLogger</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="s">"Unhandled severity message"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  [INFO] Info message</span>
<span class="cm">  [DEBUG] Debug message</span>
<span class="cm">  [ERROR] Error message</span>
<span class="cm">  [DEFAULT] Unhandled severity message (severity: 0)</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="command-action-transaction">Command (action, transaction)</h3>
<ul>
<li>Analogy<ul>
<li>A kitchen chef receives a command.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To encapsulate a request as an object, allowing for the parameterization of clients with queues, requests, and operations.</li>
<li>Support of undoable operations. It turns a request into a stand-alone object that contains all information about the request. This transformation lets one parameterize methods with different requests, delay or queue a request’s execution, and support undoable operations.</li>
</ul>
</li>
<li>Implementation<ul>
<li>Command Interface: This defines a method for executing a command.</li>
<li>Concrete Command: Implements the command interface and defines the binding between a Receiver object and an action.</li>
<li>Receiver: Performs the actual work when the command’s Execute method is called.</li>
<li>Invoker: Asks the command to carry out the request.</li>
<li>Client: Creates a ConcreteCommand object and sets its receiver.</li>
</ul>
</li>
<li>Pros<ul>
<li>Decouples the classes that invoke the operation from the object that knows how to execute the operation.</li>
<li>New commands can be added without changing existing code (Open/Closed Principle).</li>
<li>Multiple commands can be composed into one by using the Composite pattern.</li>
</ul>
</li>
<li>Cons<ul>
<li>Can introduce additional layers of abstraction, which might complicate simpler operations.</li>
<li>Each new command might require a new concrete class, increasing the number of classes in the system.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Memento</strong> can be used in conjunction with the <strong>Command</strong> pattern to implement undo/redo functionalities, where <strong>Command</strong> stores the state of the Receiver.</li>
<li><strong>Commands</strong> can be composed into a <strong>Composite</strong> command, a macro command that consists of several simpler commands.</li>
<li><strong>Command</strong> encapsulates a request as an object, whereas <strong>Strategy</strong> encapsulates an algorithm.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Command is the command interface: Redo() is implicit</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="nx">Undo</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// BankAccount is the receiver</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BankAccount</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Balance</span><span class="w">    </span><span class="kt">float64</span>
<span class="w"> </span><span class="nx">Difference</span><span class="w"> </span><span class="kt">float64</span>
<span class="w"> </span><span class="nx">Operation</span><span class="w">  </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// DepositCommand and WithdrawCommand are the concrete commands</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">DepositCommand</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="o">*</span><span class="nx">BankAccount</span>
<span class="w"> </span><span class="nx">amount</span><span class="w">  </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// Execute adds the amount to the account balance</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">DepositCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">amount</span>
<span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Difference</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">amount</span>
<span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"deposit"</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">WithdrawCommand</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="o">*</span><span class="nx">BankAccount</span>
<span class="w"> </span><span class="nx">amount</span><span class="w">  </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// Execute subtracts the amount from the account balance</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WithdrawCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">amount</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">w</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Balance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">amount</span>
<span class="w">  </span><span class="nx">w</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Difference</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">amount</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">w</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Difference</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"withdrawal"</span>
<span class="p">}</span>

<span class="c1">// Undo reverses the DepositCommand operation</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">DepositCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Balance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">amount</span>
<span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Difference</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">amount</span>
<span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"undo deposit"</span>
<span class="p">}</span>

<span class="c1">// Undo reverses the WithdrawCommand operation</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WithdrawCommand</span><span class="p">)</span><span class="w"> </span><span class="nx">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">amount</span>
<span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Difference</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">amount</span>
<span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"undo withdrawal"</span>
<span class="p">}</span>

<span class="c1">// CommandManager is the invoker</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CommandManager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">history</span><span class="w">   </span><span class="p">[]</span><span class="nx">Command</span>
<span class="w"> </span><span class="nx">redoStack</span><span class="w"> </span><span class="p">[]</span><span class="nx">Command</span>
<span class="p">}</span>

<span class="c1">// ExecuteCommand adds the command to the history and executes it</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">CommandManager</span><span class="p">)</span><span class="w"> </span><span class="nx">ExecuteCommand</span><span class="p">(</span><span class="nx">cmd</span><span class="w"> </span><span class="nx">Command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">cmd</span><span class="p">.</span><span class="nx">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="p">,</span><span class="w"> </span><span class="nx">cmd</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Undo reverses the last command</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">CommandManager</span><span class="p">)</span><span class="w"> </span><span class="nx">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">cmd</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="w"> </span><span class="nx">cmd</span><span class="p">.</span><span class="nx">Undo</span><span class="p">()</span>
<span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="c1">// Remove the last command from history</span>
<span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">redoStack</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">,</span><span class="w"> </span><span class="nx">cmd</span><span class="p">)</span><span class="w">    </span><span class="c1">// Add it to the redo stack</span>
<span class="p">}</span>

<span class="c1">// Redo re-executes the last undone command</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">CommandManager</span><span class="p">)</span><span class="w"> </span><span class="nx">Redo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">cmd</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="w"> </span><span class="nx">cmd</span><span class="p">.</span><span class="nx">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">redoStack</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="c1">// Remove the last command from redoStack</span>
<span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">history</span><span class="p">,</span><span class="w"> </span><span class="nx">cmd</span><span class="p">)</span><span class="w">              </span><span class="c1">// Add it back to the history</span>
<span class="p">}</span>

<span class="c1">// PrintSummary shows the account balance and the difference after the operation</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">BankAccount</span><span class="p">)</span><span class="w"> </span><span class="nx">PrintSummary</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">""</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Account balance: $%.2f\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"withdrawal"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Withdrawal not successful. Account balance: $%.2f\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"deposit"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Deposit not successful. Account balance: $%.2f\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"withdrawal"</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Account balance after %s: $%.2f ($%.2f - $%.2f)\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"deposit"</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Account balance after %s: $%.2f ($%.2f + $%.2f)\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"undo withdrawal"</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Account balance after %s: $%.2f ($%.2f + $%.2f)\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"undo deposit"</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Account balance after %s: $%.2f ($%.2f - $%.2f)\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Operation</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Balance</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">Difference</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BankAccount</span><span class="p">{</span><span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span><span class="p">}</span>
<span class="w"> </span><span class="nx">manager</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">CommandManager</span><span class="p">{}</span>

<span class="w"> </span><span class="nx">deposit</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">DepositCommand</span><span class="p">{</span><span class="nx">account</span><span class="p">:</span><span class="w"> </span><span class="nx">account</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">}</span>
<span class="w"> </span><span class="nx">withdraw</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">WithdrawCommand</span><span class="p">{</span><span class="nx">account</span><span class="p">:</span><span class="w"> </span><span class="nx">account</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">}</span>

<span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">PrintSummary</span><span class="p">()</span>

<span class="w"> </span><span class="nx">manager</span><span class="p">.</span><span class="nx">ExecuteCommand</span><span class="p">(</span><span class="nx">deposit</span><span class="p">)</span>
<span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">PrintSummary</span><span class="p">()</span>

<span class="w"> </span><span class="nx">manager</span><span class="p">.</span><span class="nx">ExecuteCommand</span><span class="p">(</span><span class="nx">withdraw</span><span class="p">)</span>
<span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">PrintSummary</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Undoing the last operation..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">manager</span><span class="p">.</span><span class="nx">Undo</span><span class="p">()</span>
<span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">PrintSummary</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Redoing the last operation..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">manager</span><span class="p">.</span><span class="nx">Redo</span><span class="p">()</span>
<span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">PrintSummary</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Undoing the last operation..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">manager</span><span class="p">.</span><span class="nx">Undo</span><span class="p">()</span>
<span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">PrintSummary</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Undoing the last operation..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">manager</span><span class="p">.</span><span class="nx">Undo</span><span class="p">()</span>
<span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">PrintSummary</span><span class="p">()</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Account balance: $100.00</span>
<span class="cm">  Account balance after deposit: $150.00 ($100.00 + $50.00)</span>
<span class="cm">  Account balance after withdrawal: $120.00 ($150.00 - $30.00)</span>
<span class="cm">  Undoing the last operation...</span>
<span class="cm">  Account balance after undo withdrawal: $150.00 ($120.00 + $30.00)</span>
<span class="cm">  Redoing the last operation...</span>
<span class="cm">  Account balance after withdrawal: $120.00 ($150.00 - $30.00)</span>
<span class="cm">  Undoing the last operation...</span>
<span class="cm">  Account balance after undo withdrawal: $150.00 ($120.00 + $30.00)</span>
<span class="cm">  Undoing the last operation...</span>
<span class="cm">  Account balance after undo deposit: $100.00 ($150.00 - $50.00)</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="iterator">Iterator</h3>
<ul>
<li>Analogy<ul>
<li>All roads lead to Rome. There’s more than one way of iterating one’s path through the city.</li>
</ul>
</li>
<li>When to use it<ul>
<li>When there’s a need to provide a way to access a collection of objects in a sequential manner without the need to understand or expose the underlying structure of the collection.</li>
</ul>
</li>
<li>Implementation<ul>
<li>The <strong>Iterator Interface</strong> defines the operations required for iterating over a collection, such as <code>getNext()</code>, <code>hasNext()</code>, and sometimes <code>remove()</code>.</li>
<li>The <strong>Concrete Iterator</strong> implements the <strong>Iterator Interface</strong> and keeps track of the current position in the collection.</li>
<li>The <strong>Aggregate Interface</strong> defines the method to create an iterator.</li>
<li>The <strong>Concrete Aggregate</strong> implements the <strong>Aggregate Interface</strong> and returns an instance of the <strong>Concrete Iterator</strong>.</li>
</ul>
</li>
<li>Pros<ul>
<li>Allows the traversal of elements without exposing the underlying structure (array, tree, graph, etc.).</li>
<li>Enables multiple simultaneous traversals of a collection.</li>
<li>Provides a uniform interface for traversing different types of collections.</li>
</ul>
</li>
<li>Cons<ul>
<li>Can increase the complexity of an application by requiring additional classes and interfaces.</li>
<li>Introduces some overhead to the traversal process, especially if the iterator is feature-rich (like supporting bidirectional traversal).</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Iterators</strong> are often used to traverse <strong>Composite</strong> trees.</li>
<li>With <strong>Factory Method</strong>, it can be used to define a method in the <strong>Aggregate Interface</strong> for creating an iterator.</li>
<li>An <strong>Iterator</strong> can use a <strong>Memento</strong> to capture the state of an iteration.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="s">"fmt"</span>
<span class="w"> </span><span class="s">"slices"</span>
<span class="w"> </span><span class="s">"strconv"</span>
<span class="p">)</span>

<span class="c1">// Book struct represents a book in a collection</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Book</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Title</span><span class="w"> </span><span class="kt">string</span>
<span class="w"> </span><span class="nx">Pages</span><span class="w"> </span><span class="kt">int</span>
<span class="w"> </span><span class="nx">Index</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="c1">// shows the index of the book in the collection</span>
<span class="p">}</span>

<span class="c1">// BookIterator defines the interface for iterating over books</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BookIterator</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">HasNext</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span>
<span class="w"> </span><span class="nx">Next</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Book</span>
<span class="w"> </span><span class="nx">HasPrevious</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w">             </span><span class="c1">// not always there: could be added</span>
<span class="w"> </span><span class="nx">Previous</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Book</span><span class="w">               </span><span class="c1">// not always there: could be added</span>
<span class="w"> </span><span class="nx">Count</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w">                    </span><span class="c1">// The number of books iterated over</span>
<span class="w"> </span><span class="nx">CurrentIndex</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w">             </span><span class="c1">// The current index</span>
<span class="w"> </span><span class="nx">Remove</span><span class="p">(</span><span class="nx">direction</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="c1">// implement safe removal</span>
<span class="w"> </span><span class="nx">Reset</span><span class="p">()</span><span class="w">                        </span><span class="c1">// Reset the iterator</span>
<span class="p">}</span>

<span class="c1">// BookCollection holds a collection of books</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BookCollection</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Books</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Book</span>
<span class="p">}</span>

<span class="c1">// Iterator returns a new BookIterator to iterate over the collection</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">bc</span><span class="w"> </span><span class="o">*</span><span class="nx">BookCollection</span><span class="p">)</span><span class="w"> </span><span class="nx">Iterator</span><span class="p">()</span><span class="w"> </span><span class="nx">BookIterator</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BookCollectionIterator</span><span class="p">{</span>
<span class="w">  </span><span class="nx">bookCollection</span><span class="p">:</span><span class="w"> </span><span class="nx">bc</span><span class="p">,</span>
<span class="w">  </span><span class="nx">currentIndex</span><span class="p">:</span><span class="w">   </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">count</span><span class="p">:</span><span class="w">          </span><span class="mi">0</span><span class="p">,</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// BookCollectionIterator is the concrete iterator for BookCollection</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BookCollectionIterator</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">bookCollection</span><span class="w">   </span><span class="o">*</span><span class="nx">BookCollection</span>
<span class="w"> </span><span class="nx">currentIndex</span><span class="w">     </span><span class="kt">int</span>
<span class="w"> </span><span class="nx">count</span><span class="w">            </span><span class="kt">int</span><span class="w">  </span><span class="c1">// The number of books iterated over</span>
<span class="w"> </span><span class="nx">iterationStarted</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="c1">// Flag to indicate if iteration has started</span>
<span class="p">}</span>

<span class="c1">// HasNext checks if there is a next book in the collection</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="o">*</span><span class="nx">BookCollectionIterator</span><span class="p">)</span><span class="w"> </span><span class="nx">HasNext</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">it</span><span class="p">.</span><span class="nx">iterationStarted</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">iterationStarted</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// HasPrevious checks if there is a previous book in the collection</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="o">*</span><span class="nx">BookCollectionIterator</span><span class="p">)</span><span class="w"> </span><span class="nx">HasPrevious</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">it</span><span class="p">.</span><span class="nx">iterationStarted</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="p">)</span><span class="w"> </span><span class="c1">// Set to length for backward iteration start</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">iterationStarted</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>

<span class="c1">// Next returns the next book in the collection</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="o">*</span><span class="nx">BookCollectionIterator</span><span class="p">)</span><span class="w"> </span><span class="nx">Next</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Book</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"No books in the collection"</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">HasNext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="o">++</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="p">[</span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">]</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Previous returns the previous book in the collection</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="o">*</span><span class="nx">BookCollectionIterator</span><span class="p">)</span><span class="w"> </span><span class="nx">Previous</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Book</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"No books in the collection"</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">HasPrevious</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="o">--</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="p">[</span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">]</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Count returns the number of books iterated over</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="o">*</span><span class="nx">BookCollectionIterator</span><span class="p">)</span><span class="w"> </span><span class="nx">Count</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">count</span>
<span class="p">}</span>

<span class="c1">// CurrentIndex returns the current index</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="o">*</span><span class="nx">BookCollectionIterator</span><span class="p">)</span><span class="w"> </span><span class="nx">CurrentIndex</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span>
<span class="p">}</span>

<span class="c1">// Remove safely removes the current element from the collection</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="o">*</span><span class="nx">BookCollectionIterator</span><span class="p">)</span><span class="w"> </span><span class="nx">Remove</span><span class="p">(</span><span class="nx">direction</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"remove operation out of bounds"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="c1">// Remove the element at currentIndex</span>
<span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">slices</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">bookCollection</span><span class="p">.</span><span class="nx">Books</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">direction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"backward"</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Stay at the same index after removal</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">direction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"forward"</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Decrement currentIndex to adjust for the shift in elements after removal</span>
<span class="w">  </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="o">--</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">panic</span><span class="p">(</span><span class="s">"Invalid direction"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="o">*</span><span class="nx">BookCollectionIterator</span><span class="p">)</span><span class="w"> </span><span class="nx">Reset</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Resetting the iterator"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">currentIndex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">iterationStarted</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">collection</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BookCollection</span><span class="p">{</span>
<span class="w">  </span><span class="nx">Books</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Book</span><span class="p">{</span>
<span class="w">   </span><span class="p">{</span><span class="nx">Title</span><span class="p">:</span><span class="w"> </span><span class="s">"The Go Programming Language"</span><span class="p">,</span><span class="w"> </span><span class="nx">Pages</span><span class="p">:</span><span class="w"> </span><span class="mi">380</span><span class="p">,</span><span class="w"> </span><span class="nx">Index</span><span class="p">:</span><span class="w"> </span><span class="s">"0"</span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span><span class="nx">Title</span><span class="p">:</span><span class="w"> </span><span class="s">"Go in Action"</span><span class="p">,</span><span class="w"> </span><span class="nx">Pages</span><span class="p">:</span><span class="w"> </span><span class="mi">325</span><span class="p">,</span><span class="w"> </span><span class="nx">Index</span><span class="p">:</span><span class="w"> </span><span class="s">"1"</span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span><span class="nx">Title</span><span class="p">:</span><span class="w"> </span><span class="s">"Go Design Patterns"</span><span class="p">,</span><span class="w"> </span><span class="nx">Pages</span><span class="p">:</span><span class="w"> </span><span class="mi">246</span><span class="p">,</span><span class="w"> </span><span class="nx">Index</span><span class="p">:</span><span class="w"> </span><span class="s">"2"</span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Book collection:"</span><span class="p">)</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">Books</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">index</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">index</span><span class="o">+</span><span class="s">"."</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span><span class="w"> </span><span class="s">"-"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Pages</span><span class="p">,</span><span class="w"> </span><span class="s">"pages"</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">iterator</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">Iterator</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nIterating forward, removing big books"</span><span class="p">)</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">HasNext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">book</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"➡️"</span><span class="p">,</span><span class="w"> </span><span class="s">"("</span><span class="o">+</span><span class="nx">book</span><span class="p">.</span><span class="nx">Index</span><span class="o">+</span><span class="s">")"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span><span class="w"> </span><span class="s">"has"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Pages</span><span class="p">,</span><span class="w"> </span><span class="s">"pages, count:"</span><span class="p">,</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Count</span><span class="p">())</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Pages</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">350</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"‼️"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span><span class="w"> </span><span class="s">"is a large book"</span><span class="p">)</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Remove</span><span class="p">(</span><span class="s">"forward"</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Remove operation failed:"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"❌ "</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span><span class="w"> </span><span class="s">"removed"</span><span class="p">)</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Reset</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nIterating backward, removing small books"</span><span class="p">)</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">HasPrevious</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">book</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Previous</span><span class="p">()</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"⬅️"</span><span class="p">,</span><span class="w"> </span><span class="s">"("</span><span class="o">+</span><span class="nx">book</span><span class="p">.</span><span class="nx">Index</span><span class="o">+</span><span class="s">")"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span><span class="w"> </span><span class="s">"still has"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Pages</span><span class="p">,</span><span class="w"> </span><span class="s">"pages, count:"</span><span class="p">,</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Count</span><span class="p">())</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Pages</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">250</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"‼️"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span><span class="w"> </span><span class="s">"is a small book"</span><span class="p">)</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Remove</span><span class="p">(</span><span class="s">"backward"</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Remove operation failed:"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"❌"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span><span class="w"> </span><span class="s">"removed"</span><span class="p">)</span>
<span class="w">    </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span><span class="w"> </span><span class="c1">// Go forward one step, so we don't skip a book</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Reset</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nIterating forward again"</span><span class="p">)</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">HasNext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">book</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"➡️"</span><span class="p">,</span><span class="w"> </span><span class="s">"("</span><span class="o">+</span><span class="nx">book</span><span class="p">.</span><span class="nx">Index</span><span class="o">+</span><span class="s">")"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span><span class="w"> </span><span class="s">"has"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Pages</span><span class="p">,</span><span class="w"> </span><span class="s">"pages, count:"</span><span class="p">,</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Count</span><span class="p">())</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nIterating forward once again without having reset"</span><span class="p">)</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">HasNext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">book</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"➡️"</span><span class="p">,</span><span class="w"> </span><span class="s">"("</span><span class="o">+</span><span class="nx">book</span><span class="p">.</span><span class="nx">Index</span><span class="o">+</span><span class="s">")"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span><span class="w"> </span><span class="s">"has"</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Pages</span><span class="p">,</span><span class="w"> </span><span class="s">"pages, count:"</span><span class="p">,</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Count</span><span class="p">())</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nTotal iteration count:"</span><span class="p">,</span><span class="w"> </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">Count</span><span class="p">())</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Book collection:</span>
<span class="cm">  1. The Go Programming Language - 380 pages</span>
<span class="cm">  2. Go in Action - 325 pages</span>
<span class="cm">  3. Go Design Patterns - 246 pages</span>

<span class="cm">  Iterating forward, removing big books</span>
<span class="cm">  ➡️ (0) The Go Programming Language has 380 pages, count: 1</span>
<span class="cm">  ‼️ The Go Programming Language is a large book</span>
<span class="cm">  ❌ The Go Programming Language removed</span>
<span class="cm">  ➡️ (1) Go in Action has 325 pages, count: 2</span>
<span class="cm">  ➡️ (2) Go Design Patterns has 246 pages, count: 3</span>
<span class="cm">  Resetting the iterator</span>

<span class="cm">  Iterating backward, removing small books</span>
<span class="cm">  ⬅️ (2) Go Design Patterns still has 246 pages, count: 4</span>
<span class="cm">  ‼️ Go Design Patterns is a small book</span>
<span class="cm">  ❌ Go Design Patterns removed</span>
<span class="cm">  ⬅️ (1) Go in Action still has 325 pages, count: 5</span>
<span class="cm">  Resetting the iterator</span>

<span class="cm">  Iterating forward again</span>
<span class="cm">  ➡️ (1) Go in Action has 325 pages, count: 6</span>

<span class="cm">  Iterating forward once again without having reset</span>

<span class="cm">  Total iteration count: 6</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="mediator-intermediary-controller">Mediator (Intermediary, Controller)</h3>
<ul>
<li>Analogy<ul>
<li>The control tower acts as a mediator for aircraft pilots.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To provide a centralized communication medium between different objects in a system.</li>
<li>To promote loose coupling by keeping objects from referring to each other explicitly, allowing their interaction to be managed by the <strong>Mediator</strong>.</li>
<li>Reduce complexities and dependencies between tightly coupled objects communicating directly.</li>
</ul>
</li>
<li>Implementation<ul>
<li>The <strong>Mediator Interface</strong> defines the interface for communication that the concrete mediator will implement.</li>
<li>The <strong>Concrete Mediator</strong> implements the <strong>Mediator Interface</strong> and coordinates communication between colleague objects. It knows and maintains its colleagues.</li>
<li>The Colleague Classes are objects that communicate with each other through the <strong>Mediator</strong>. Each colleague class knows its mediator object and communicates with it, instead of communicating directly with other colleagues.</li>
</ul>
</li>
<li>Pros<ul>
<li>Allows reducing the coupling between classes of objects by centralizing communication in the <strong>Mediator</strong>.</li>
<li>Simplifies maintenance and interaction between classes by having a central point that controls and manages communication.</li>
<li>Centralizes control over how objects interact, making it easier to understand and manage complex communication networks.</li>
</ul>
</li>
<li>Cons<ul>
<li>The mediator can become overly complex (a “God” object) if too many responsibilities are added.</li>
<li>Centralizing too much logic and control in the mediator can introduce a single point of failure in the system.</li>
<li>Finding the right balance in responsibilities between the mediator and its colleagues can be challenging.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li>The <strong>Mediator</strong> pattern can be implemented using the <strong>Observer</strong> pattern, where the mediator acts as an observer and the colleagues as subjects.</li>
<li>The <strong>Mediator</strong> can be seen as a counterpart of the <strong>Facade</strong> pattern. <strong>Facade</strong> defines a simplified interface to a subsystem, <strong>Mediator</strong> centralizes communication between components of the system.</li>
<li><strong>Mediator</strong> can work closely with the <strong>Command</strong> pattern to orchestrate complex operations involving multiple objects.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="s">"fmt"</span>
<span class="w"> </span><span class="s">"math/rand"</span>
<span class="p">)</span>

<span class="c1">// Mediator interface defines the method for sending messages between colleagues</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Mediator</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">colleague</span><span class="w"> </span><span class="nx">Colleague</span><span class="p">)</span>
<span class="w"> </span><span class="nx">Subscribe</span><span class="p">(</span><span class="nx">senderName</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="w"> </span><span class="p">[]</span><span class="nx">Colleague</span><span class="p">)</span>
<span class="w"> </span><span class="nx">Unsubscribe</span><span class="p">(</span><span class="nx">senderName</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="w"> </span><span class="p">[]</span><span class="nx">Colleague</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Colleague interface represents a colleague in the mediator pattern</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Colleague</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<span class="w"> </span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// ConcreteMediator implements the Mediator interface and coordinates communication between colleagues</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ConcreteMediator</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">colleagues</span><span class="w">    </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">Colleague</span>
<span class="w"> </span><span class="nx">subscriptions</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="nx">Colleague</span>
<span class="p">}</span>

<span class="c1">// RegisterColleague adds colleagues to the mediator's list</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">ConcreteMediator</span><span class="p">)</span><span class="w"> </span><span class="nx">RegisterColleague</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">colleague</span><span class="w"> </span><span class="nx">Colleague</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">colleagues</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">m</span><span class="p">.</span><span class="nx">colleagues</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">Colleague</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">colleagues</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">colleague</span>
<span class="p">}</span>

<span class="c1">// Subscribe adds receiver(s) to the list of subscribers for a particular sender</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">ConcreteMediator</span><span class="p">)</span><span class="w"> </span><span class="nx">Subscribe</span><span class="p">(</span><span class="nx">senderName</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="w"> </span><span class="p">[]</span><span class="nx">Colleague</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="nx">Colleague</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">receiver</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">[</span><span class="nx">senderName</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">[</span><span class="nx">senderName</span><span class="p">],</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Unsubscribe removes receiver(s) from the list of subscribers for a particular sender</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">ConcreteMediator</span><span class="p">)</span><span class="w"> </span><span class="nx">Unsubscribe</span><span class="p">(</span><span class="nx">senderName</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="w"> </span><span class="p">[]</span><span class="nx">Colleague</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1">// print the list of receivers about to be removed, converting the receiver slice to a string</span>
<span class="w"> </span><span class="nx">unsub</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">""</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">receiver</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">unsub</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", "</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">unsub</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">unsub</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">unsub</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="c1">// remove the trailing comma and space</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"❌  Unsubscribing"</span><span class="p">,</span><span class="w"> </span><span class="nx">unsub</span><span class="p">,</span><span class="w"> </span><span class="s">"from"</span><span class="p">,</span><span class="w"> </span><span class="nx">senderName</span><span class="p">)</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">receiver</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">[</span><span class="nx">senderName</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">[</span><span class="nx">senderName</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">[</span><span class="nx">senderName</span><span class="p">][:</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">[</span><span class="nx">senderName</span><span class="p">][</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Send sends messages between colleagues, avoiding notifying the sender</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">ConcreteMediator</span><span class="p">)</span><span class="w"> </span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">sender</span><span class="w"> </span><span class="nx">Colleague</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">senderName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sender</span><span class="p">.</span><span class="nx">Name</span><span class="p">()</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">receiver</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">[</span><span class="nx">senderName</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">receiver</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">sender</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Avoid sending message to self</span>
<span class="w">   </span><span class="nx">receiver</span><span class="p">.</span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ComponentAlice is a colleague that can send and receive messages through the mediator</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ComponentAlice</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">mediator</span><span class="w"> </span><span class="nx">Mediator</span>
<span class="p">}</span>

<span class="c1">// Notify handles messages sent to ComponentAlice</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentAlice</span><span class="p">)</span><span class="w"> </span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"👂 Alice heard:"</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send sends a message via the mediator</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentAlice</span><span class="p">)</span><span class="w"> </span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🔉 Alice talks:"</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentAlice</span><span class="p">)</span><span class="w"> </span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Alice"</span>
<span class="p">}</span>

<span class="c1">// ComponentBob is another colleague similar to ComponentAlice</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ComponentBob</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">mediator</span><span class="w"> </span><span class="nx">Mediator</span>
<span class="p">}</span>

<span class="c1">// Notify handles messages sent to ComponentBob</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentBob</span><span class="p">)</span><span class="w"> </span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🦻 Bob heard:"</span><span class="p">,</span><span class="w"> </span><span class="nx">shuffleString</span><span class="p">(</span><span class="nx">message</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// Send sends a message via the mediator</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentBob</span><span class="p">)</span><span class="w"> </span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"📣 Bob talks:"</span><span class="p">,</span><span class="w"> </span><span class="nx">shuffleString</span><span class="p">(</span><span class="nx">message</span><span class="p">))</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentBob</span><span class="p">)</span><span class="w"> </span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Bob"</span>
<span class="p">}</span>

<span class="c1">// ComponentCharlie is another colleague similar to ComponentAlice</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ComponentCharlie</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">mediator</span><span class="w"> </span><span class="nx">Mediator</span>
<span class="p">}</span>

<span class="c1">// Notify handles messages sent to ComponentCharlie</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentCharlie</span><span class="p">)</span><span class="w"> </span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"👂 Charlie heard:"</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send sends a message via the mediator</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentCharlie</span><span class="p">)</span><span class="w"> </span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🔉 Charlie talks:"</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentCharlie</span><span class="p">)</span><span class="w"> </span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Charlie"</span>
<span class="p">}</span>

<span class="c1">// ComponentDave is another colleague similar to the others</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ComponentDave</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">mediator</span><span class="w"> </span><span class="nx">Mediator</span>
<span class="p">}</span>

<span class="c1">// Notify handles messages sent to ComponentDave</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentDave</span><span class="p">)</span><span class="w"> </span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"👂 Dave heard:"</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send sends a message via the mediator</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentDave</span><span class="p">)</span><span class="w"> </span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🔉 Dave talks:"</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ComponentDave</span><span class="p">)</span><span class="w"> </span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Dave"</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">shuffleString</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1">// Convert string to a slice of runes to handle multi-byte characters</span>
<span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">rune</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>

<span class="w"> </span><span class="nx">rand</span><span class="p">.</span><span class="nx">Shuffle</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="nx">r</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">r</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span><span class="w"> </span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w"> </span><span class="p">})</span>

<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">mediator</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ConcreteMediator</span><span class="p">{}</span>

<span class="w"> </span><span class="nx">alice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ComponentAlice</span><span class="p">{</span><span class="nx">mediator</span><span class="p">}</span>
<span class="w"> </span><span class="nx">bob</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ComponentBob</span><span class="p">{</span><span class="nx">mediator</span><span class="p">}</span>
<span class="w"> </span><span class="nx">charlie</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ComponentCharlie</span><span class="p">{</span><span class="nx">mediator</span><span class="p">}</span>
<span class="w"> </span><span class="nx">dave</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ComponentDave</span><span class="p">{</span><span class="nx">mediator</span><span class="p">}</span>

<span class="w"> </span><span class="nx">mediator</span><span class="p">.</span><span class="nx">RegisterColleague</span><span class="p">(</span><span class="s">"Alice"</span><span class="p">,</span><span class="w"> </span><span class="nx">alice</span><span class="p">)</span>
<span class="w"> </span><span class="nx">mediator</span><span class="p">.</span><span class="nx">RegisterColleague</span><span class="p">(</span><span class="s">"Bob"</span><span class="p">,</span><span class="w"> </span><span class="nx">bob</span><span class="p">)</span>
<span class="w"> </span><span class="nx">mediator</span><span class="p">.</span><span class="nx">RegisterColleague</span><span class="p">(</span><span class="s">"Charlie"</span><span class="p">,</span><span class="w"> </span><span class="nx">charlie</span><span class="p">)</span>
<span class="w"> </span><span class="nx">mediator</span><span class="p">.</span><span class="nx">RegisterColleague</span><span class="p">(</span><span class="s">"Dave"</span><span class="p">,</span><span class="w"> </span><span class="nx">dave</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Nobody is subscribed to anyone yet, so no messages will be received</span>
<span class="w"> </span><span class="nx">alice</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="s">"Anyone here?"</span><span class="p">)</span>

<span class="w"> </span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Subscribe</span><span class="p">(</span><span class="s">"Alice"</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nx">Colleague</span><span class="p">{</span><span class="nx">bob</span><span class="p">,</span><span class="w"> </span><span class="nx">charlie</span><span class="p">,</span><span class="w"> </span><span class="nx">dave</span><span class="p">})</span><span class="w"> </span><span class="c1">// Alice sends to them</span>
<span class="w"> </span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Subscribe</span><span class="p">(</span><span class="s">"Bob"</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nx">Colleague</span><span class="p">{</span><span class="nx">alice</span><span class="p">,</span><span class="w"> </span><span class="nx">charlie</span><span class="p">})</span><span class="w">       </span><span class="c1">// Bob sends to them</span>
<span class="w"> </span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Subscribe</span><span class="p">(</span><span class="s">"Charlie"</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nx">Colleague</span><span class="p">{</span><span class="nx">alice</span><span class="p">,</span><span class="w"> </span><span class="nx">bob</span><span class="p">})</span><span class="w">       </span><span class="c1">// Charlie sends to them</span>
<span class="w"> </span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Subscribe</span><span class="p">(</span><span class="s">"Dave"</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nx">Colleague</span><span class="p">{</span><span class="nx">alice</span><span class="p">})</span><span class="w">               </span><span class="c1">// Dave sends to Alice</span>

<span class="w"> </span><span class="nx">alice</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="s">"Hi, I'm Alice!"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">bob</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="s">"Hi, I'm Bob!"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">charlie</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="s">"Hi, I'm Charlie!"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">dave</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="s">"Hi, I'm Dave!"</span><span class="p">)</span>

<span class="w"> </span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Unsubscribe</span><span class="p">(</span><span class="s">"Alice"</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nx">Colleague</span><span class="p">{</span><span class="nx">bob</span><span class="p">,</span><span class="w"> </span><span class="nx">charlie</span><span class="p">})</span><span class="w"> </span><span class="c1">// Alice no longer sends to them</span>
<span class="w"> </span><span class="nx">alice</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="s">"I'm outta here!"</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  🔉 Alice talks: Anyone here?</span>
<span class="cm">  🔉 Alice talks: Hi, I'm Alice!</span>
<span class="cm">  🦻 Bob heard: ,ciAleI'H mi !</span>
<span class="cm">  👂 Charlie heard: Hi, I'm Alice!</span>
<span class="cm">  👂 Dave heard: Hi, I'm Alice!</span>
<span class="cm">  📣 Bob talks: i B'!bIHmo,</span>
<span class="cm">  👂 Alice heard: Hi, I'm Bob!</span>
<span class="cm">  👂 Charlie heard: Hi, I'm Bob!</span>
<span class="cm">  🔉 Charlie talks: Hi, I'm Charlie!</span>
<span class="cm">  👂 Alice heard: Hi, I'm Charlie!</span>
<span class="cm">  🦻 Bob heard: ' aiemH !CIli,hr</span>
<span class="cm">  🔉 Dave talks: Hi, I'm Dave!</span>
<span class="cm">  👂 Alice heard: Hi, I'm Dave!</span>
<span class="cm">  ❌ Unsubscribing Bob, Charlie from Alice</span>
<span class="cm">  🔉 Alice talks: I'm outta here!</span>
<span class="cm">  👂 Dave heard: I'm outta here!</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="memento-snapshot">Memento (Snapshot)</h3>
<ul>
<li>Analogy<ul>
<li>The “undo” and “redo” buttons of a text editor (save and restore state) or the “rollback” feature of a database.</li>
</ul>
</li>
<li>When to use it<ul>
<li>When there is a need to restore an object back to its previous state (e.g. “undo” or “rollback” operations), without violating encapsulation.</li>
</ul>
</li>
<li>Implementation<ul>
<li><strong>Originator</strong>: The object whose state needs to be saved and restored.</li>
<li><strong>Memento</strong>: An object that encapsulates the state of the originator at a particular time, which is usually immutable once constructed.</li>
<li><strong>Caretaker</strong>: An object that keeps track of the mementos but does not operate on or examine the contents of a memento. It is responsible for knowing when and why to save and restore the originator’s state.</li>
<li>In languages supporting nested classes, the <strong>Memento</strong> can be nested inside the <strong>Originator</strong>.<ul>
<li>This way, the caretaker can’t access the memento directly, and the originator can access the memento’s fields directly.</li>
</ul>
</li>
<li>In other languages like Go which don’t even have classes, the implementation can be based on an intermediate interface.<ul>
<li>This makes the fields of the memento struct public.</li>
<li>There is another approach to restrict access:<ul>
<li><strong>Originator Interface</strong>: This defines the high-level interface for creating a memento and restoring the Originator’s state from a memento. However, it does not expose internal state details.</li>
<li><strong>ConcreteOriginator</strong>: Implements the Originator interface and contains the internal state that needs to be saved and restored. It knows how to save its internal state to a <strong>Memento</strong> and restore it, but these Mementos are opaque to the outside world. In Go, this would be defined in a separate package to restrict access to the internal state.</li>
<li><strong>Memento Interface</strong>: Provides a very restricted interface that might only allow the <strong>Memento</strong> to be passed around but not altered or viewed (no getters for the state, for instance). In Go, this would be an empty struct to prevent any access to the internal state.</li>
<li><strong>ConcreteMemento</strong>: Implements the <strong>Memento</strong> interface and stores the internal state of the <strong>ConcreteOriginator</strong>. The <strong>ConcreteMemento</strong> is typically a private or inner class of the <strong>ConcreteOriginator</strong>, ensuring that only the <strong>ConcreteOriginator</strong> can access the internal state stored within the <strong>Memento</strong>. In Go, this would be a struct with unexported fields and it would be present in the same package as the <strong>ConcreteOriginator</strong>.</li>
<li><strong>Caretaker</strong>: Manages the mementos without knowing their content or structure. It can request a <strong>Memento</strong> from the <strong>Originator</strong> and store it, and it can pass a Memento back to the Originator for state restoration, but it cannot access the state stored inside the Memento.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Pros<ul>
<li>The internal state of the originator is saved externally without breaking encapsulation.</li>
<li>The originator doesn’t need to keep versions of its state, simplifying its code.</li>
<li>It enables the implementation of undo mechanisms in a relatively straightforward manner.</li>
</ul>
</li>
<li>Cons<ul>
<li>It can be resource-intensive if the originator’s state is large or if there are many mementos stored (<em>think of <span class="caps">GIMP</span> or Photoshop when working with large images and a growing undo stack</em>!).</li>
<li>It adds complexity to the code, particularly in managing the lifecycle and permissions of mementos.</li>
<li>The caretaker must manage the lifetimes of mementos carefully to avoid excessive memory use (hidden implementation costs).</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Memento</strong> can be used in conjunction with the <strong>Command</strong> pattern to store state for undoable commands.</li>
<li>It can store the state of an <strong>Iterator</strong>, allowing it to return to a specific point in the iteration.</li>
<li>Both <strong>Memento</strong> and <strong>Prototype</strong> involve creating a copy of an object, but for different purposes: Prototype for creating a duplicate object; Memento for saving state.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Memento is a snapshot of the originator's state</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Memento</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Originator is the object whose state needs to be saved</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">originator</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// setState updates the state of the originator</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">originator</span><span class="p">)</span><span class="w"> </span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">state</span>
<span class="p">}</span>

<span class="c1">// saveStateToMemento saves the current state to a memento</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">originator</span><span class="p">)</span><span class="w"> </span><span class="nx">saveStateToMemento</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Memento</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Memento</span><span class="p">{</span><span class="nx">state</span><span class="p">:</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">state</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// restoreStateFromMemento restores the state from a memento</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">originator</span><span class="p">)</span><span class="w"> </span><span class="nx">restoreStateFromMemento</span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">Memento</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">state</span>
<span class="p">}</span>

<span class="c1">// Caretaker could also be a single stack with an index to move back and forth</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Caretaker</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">undoStack</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Memento</span>
<span class="w"> </span><span class="nx">redoStack</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Memento</span>
<span class="p">}</span>

<span class="c1">// saveState saves the current state of the originator to the undoStack of the caretaker</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Caretaker</span><span class="p">)</span><span class="w"> </span><span class="nx">saveState</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">originator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">saveStateToMemento</span><span class="p">()</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">undoStack</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">undoStack</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="p">)</span><span class="w"> </span><span class="c1">// Save the current state before changing it</span>
<span class="p">}</span>

<span class="c1">// changeState changes the state of the originator and saves the current state to the undoStack of the caretaker</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Caretaker</span><span class="p">)</span><span class="w"> </span><span class="nx">changeState</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">originator</span><span class="p">,</span><span class="w"> </span><span class="nx">newState</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">saveState</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span><span class="w"> </span><span class="c1">// Save the current state before making a change</span>
<span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// undo restores the state of the originator to the previous state, if any</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Caretaker</span><span class="p">)</span><span class="w"> </span><span class="nx">undo</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">originator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">undoStack</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">lastIndex</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">undoStack</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w"> </span><span class="nx">memento</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">undoStack</span><span class="p">[</span><span class="nx">lastIndex</span><span class="p">]</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">undoStack</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">undoStack</span><span class="p">[:</span><span class="nx">lastIndex</span><span class="p">]</span><span class="w"> </span><span class="c1">// Pop from undoStack</span>

<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">redoStack</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">saveStateToMemento</span><span class="p">())</span><span class="w"> </span><span class="c1">// Save the current state to redoStack before undoing</span>
<span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">restoreStateFromMemento</span><span class="p">(</span><span class="nx">memento</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// redo restores the state of the originator to the next state, if any</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Caretaker</span><span class="p">)</span><span class="w"> </span><span class="nx">redo</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">originator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">lastIndex</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w"> </span><span class="nx">memento</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">[</span><span class="nx">lastIndex</span><span class="p">]</span>
<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">redoStack</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">redoStack</span><span class="p">[:</span><span class="nx">lastIndex</span><span class="p">]</span><span class="w"> </span><span class="c1">// Pop from redoStack</span>

<span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">undoStack</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">undoStack</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">saveStateToMemento</span><span class="p">())</span><span class="w"> </span><span class="c1">// Save the current state to undoStack before redoing</span>
<span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">restoreStateFromMemento</span><span class="p">(</span><span class="nx">memento</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">originator</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">originator</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">caretaker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Caretaker</span><span class="p">{}</span>

<span class="w"> </span><span class="c1">// Initial state is saved</span>
<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">saveState</span><span class="p">(</span><span class="nx">originator</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Changes to the originator are made through the Caretaker to ensure states are saved</span>
<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">changeState</span><span class="p">(</span><span class="nx">originator</span><span class="p">,</span><span class="w"> </span><span class="s">"State #1"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">changeState</span><span class="p">(</span><span class="nx">originator</span><span class="p">,</span><span class="w"> </span><span class="s">"State #2"</span><span class="p">)</span>
<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">changeState</span><span class="p">(</span><span class="nx">originator</span><span class="p">,</span><span class="w"> </span><span class="s">"State #3"</span><span class="p">)</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Current State:"</span><span class="p">,</span><span class="w"> </span><span class="nx">originator</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>

<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">undo</span><span class="p">(</span><span class="nx">originator</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"State after undo:"</span><span class="p">,</span><span class="w"> </span><span class="nx">originator</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>

<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">undo</span><span class="p">(</span><span class="nx">originator</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"State after second undo:"</span><span class="p">,</span><span class="w"> </span><span class="nx">originator</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>

<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">undo</span><span class="p">(</span><span class="nx">originator</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"State after third undo:"</span><span class="p">,</span><span class="w"> </span><span class="nx">originator</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>

<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">redo</span><span class="p">(</span><span class="nx">originator</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"State after redo:"</span><span class="p">,</span><span class="w"> </span><span class="nx">originator</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>

<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">redo</span><span class="p">(</span><span class="nx">originator</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"State after second redo:"</span><span class="p">,</span><span class="w"> </span><span class="nx">originator</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>

<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">redo</span><span class="p">(</span><span class="nx">originator</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"State after third redo:"</span><span class="p">,</span><span class="w"> </span><span class="nx">originator</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>

<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">redo</span><span class="p">(</span><span class="nx">originator</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"State after fourth redo:"</span><span class="p">,</span><span class="w"> </span><span class="nx">originator</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>

<span class="w"> </span><span class="nx">caretaker</span><span class="p">.</span><span class="nx">undo</span><span class="p">(</span><span class="nx">originator</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"State after undo:"</span><span class="p">,</span><span class="w"> </span><span class="nx">originator</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Current State: State #3</span>
<span class="cm">  State after undo: State #2</span>
<span class="cm">  State after second undo: State #1</span>
<span class="cm">  State after third undo:</span>
<span class="cm">  State after redo: State #1</span>
<span class="cm">  State after second redo: State #2</span>
<span class="cm">  State after third redo: State #3</span>
<span class="cm">  State after fourth redo: State #3</span>
<span class="cm">  State after undo: State #2</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="observer-event-subscriber-listener">Observer (Event-Subscriber, Listener)</h3>
<ul>
<li>Analogy<ul>
<li>A newspaper publisher (subject) has a list of subscribers (observers) who want to be notified when a new issue is published.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To create a subscription mechanism that allows multiple objects to listen and react to events happening in another object, known as the <em>subject</em>.</li>
<li>For implementing distributed event handling systems, in scenarios where an object needs to notify other objects about its state changes without being dependent on them.</li>
</ul>
</li>
<li>Implementation<ul>
<li><strong>Subject Interface (Publisher)</strong>: Defines the interface for attaching, detaching, and notifying observers. It contains a list of subscribers with methods like <code>subscribe</code>, <code>unsubscribe</code>, and <code>notify</code>.<ul>
<li><strong>Concrete Subject</strong>: Maintains the state of the object and notifies observers when the state changes.</li>
</ul>
</li>
<li><strong>Observer Interface (Subscriber)</strong>: Defines the interface for receiving updates from the <em>subject</em> (usually just an <code>update</code> method).<ul>
<li><strong>Concrete Observers</strong>: Implements the <em>observer interface</em> and keeps a reference to the <em>subject</em> so that they can automatically update themselves in response to state changes.</li>
</ul>
</li>
</ul>
</li>
<li>Pros<ul>
<li>The <em>subject</em> doesn’t need to know anything about the <em>observers</em>, other than they implement the <strong>Observer interface</strong> (loose coupling).</li>
<li>Subscribers/observers can be managed at runtime by the client.</li>
<li>Changes in the <em>subject</em> are effectively broadcasted to all interested observers.</li>
</ul>
</li>
<li>Cons<ul>
<li>If there are many observers or if the updates are frequent, the system can become overwhelmed. Besides, the order of updates could be unpredictable.</li>
<li>Care must be taken to properly manage observer registration and deregistration to avoid memory leaks.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Observer</strong> resembles closely to the <strong>Mediator</strong> pattern. While it can be used to implement distributed event handling systems, <strong>Mediator</strong> is more focused on centralizing communication between objects.</li>
<li>The <strong>Observer</strong> pattern can use the <strong>Singleton</strong> pattern to implement a central registry of observers.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="s">"fmt"</span>
<span class="w"> </span><span class="s">"strconv"</span>
<span class="w"> </span><span class="s">"sync"</span>
<span class="p">)</span>

<span class="c1">// Subject is implemented implicitly by WeatherData: it's not needed here</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Subject</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">RegisterObserver</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">Observer</span><span class="p">)</span>
<span class="w"> </span><span class="nx">RemoveObserver</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">Observer</span><span class="p">)</span>
<span class="w"> </span><span class="nx">NotifyObservers</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// WeatherConditions is the data that will be sent to the observers</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">WeatherConditions</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Humidity</span><span class="w">    </span><span class="kt">float64</span>
<span class="w"> </span><span class="nx">Pressure</span><span class="w">    </span><span class="kt">float64</span>
<span class="w"> </span><span class="nx">Temperature</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// WeatherData is the subject/publisher that will notify the observers/subscribers</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">WeatherData</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">observers</span><span class="w">  </span><span class="p">[]</span><span class="nx">Observer</span>
<span class="w"> </span><span class="nx">conditions</span><span class="w"> </span><span class="nx">WeatherConditions</span>
<span class="p">}</span>

<span class="c1">// RegisterObserver adds an observer to the list of observers</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherData</span><span class="p">)</span><span class="w"> </span><span class="nx">RegisterObserver</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">Observer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// RemoveObserver removes an observer from the list of observers</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherData</span><span class="p">)</span><span class="w"> </span><span class="nx">RemoveObserver</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">Observer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="p">[:</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span>
<span class="w">   </span><span class="k">break</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// NotifyObservers sends the data to all the observers</span>
<span class="c1">// Using goroutines, this will notify in random order</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherData</span><span class="p">)</span><span class="w"> </span><span class="nx">NotifyObservers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">Observer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span><span class="w"> </span><span class="c1">// Ensure the WaitGroup counter decrements</span>
<span class="w">   </span><span class="nx">o</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">conditions</span><span class="p">)</span>
<span class="w">  </span><span class="p">}(</span><span class="nx">observer</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// SetMeasurementsAndNotify sets the weather conditions and notifies the observers</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherData</span><span class="p">)</span><span class="w"> </span><span class="nx">SetMeasurementsAndNotify</span><span class="p">(</span><span class="nx">conditions</span><span class="w"> </span><span class="nx">WeatherConditions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">conditions</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">conditions</span>
<span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">NotifyObservers</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// Observer is the interface that observers must implement</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Observer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Update</span><span class="p">(</span><span class="nx">conditions</span><span class="w"> </span><span class="nx">WeatherConditions</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// CurrentConditionsDisplay is an observer that displays the current conditions</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CurrentConditionsDisplay</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">weatherData</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherData</span>
<span class="p">}</span>

<span class="c1">// NewCurrentConditionsDisplay creates a new CurrentConditionsDisplay and registers it with the WeatherData</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewCurrentConditionsDisplay</span><span class="p">(</span><span class="nx">weatherData</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherData</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">CurrentConditionsDisplay</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">display</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CurrentConditionsDisplay</span><span class="p">{</span><span class="nx">weatherData</span><span class="p">:</span><span class="w"> </span><span class="nx">weatherData</span><span class="p">}</span>
<span class="w"> </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">RegisterObserver</span><span class="p">(</span><span class="nx">display</span><span class="p">)</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">display</span>
<span class="p">}</span>

<span class="c1">// Update is called by the WeatherData when the conditions change</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CurrentConditionsDisplay</span><span class="p">)</span><span class="w"> </span><span class="nx">Update</span><span class="p">(</span><span class="nx">conditions</span><span class="w"> </span><span class="nx">WeatherConditions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"[fancy display] Current conditions: %.2fF degrees, %.2f%% humidity, %.2f pressure\n"</span><span class="p">,</span>
<span class="w">  </span><span class="nx">conditions</span><span class="p">.</span><span class="nx">Temperature</span><span class="p">,</span>
<span class="w">  </span><span class="nx">conditions</span><span class="p">.</span><span class="nx">Humidity</span><span class="p">,</span>
<span class="w">  </span><span class="nx">conditions</span><span class="p">.</span><span class="nx">Pressure</span><span class="p">,</span>
<span class="w"> </span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// TemperatureDisplay is an observer that displays only the temperature</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">TemperatureDisplay</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">weatherData</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherData</span>
<span class="p">}</span>

<span class="c1">// NewTemperatureDisplay creates a new TemperatureDisplay and registers it with the WeatherData</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewTemperatureDisplay</span><span class="p">(</span><span class="nx">weatherData</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherData</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">TemperatureDisplay</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">display</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TemperatureDisplay</span><span class="p">{</span><span class="nx">weatherData</span><span class="p">:</span><span class="w"> </span><span class="nx">weatherData</span><span class="p">}</span>
<span class="w"> </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">RegisterObserver</span><span class="p">(</span><span class="nx">display</span><span class="p">)</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">display</span>
<span class="p">}</span>

<span class="c1">// Update is called by the WeatherData when the conditions change</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TemperatureDisplay</span><span class="p">)</span><span class="w"> </span><span class="nx">Update</span><span class="p">(</span><span class="nx">conditions</span><span class="w"> </span><span class="nx">WeatherConditions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"[simple display] Temperature: %s degrees\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">FormatFloat</span><span class="p">(</span><span class="nx">conditions</span><span class="p">.</span><span class="nx">Temperature</span><span class="p">,</span><span class="w"> </span><span class="sc">'f'</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">weatherData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">WeatherData</span><span class="p">{}</span>

<span class="w"> </span><span class="nx">NewCurrentConditionsDisplay</span><span class="p">(</span><span class="nx">weatherData</span><span class="p">)</span>
<span class="w"> </span><span class="nx">NewTemperatureDisplay</span><span class="p">(</span><span class="nx">weatherData</span><span class="p">)</span>

<span class="w"> </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">SetMeasurementsAndNotify</span><span class="p">(</span><span class="nx">WeatherConditions</span><span class="p">{</span><span class="nx">Temperature</span><span class="p">:</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="nx">Humidity</span><span class="p">:</span><span class="w"> </span><span class="mi">65</span><span class="p">,</span><span class="w"> </span><span class="nx">Pressure</span><span class="p">:</span><span class="w"> </span><span class="mf">30.4</span><span class="p">})</span>
<span class="w"> </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">SetMeasurementsAndNotify</span><span class="p">(</span><span class="nx">WeatherConditions</span><span class="p">{</span><span class="nx">Temperature</span><span class="p">:</span><span class="w"> </span><span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="nx">Humidity</span><span class="p">:</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="nx">Pressure</span><span class="p">:</span><span class="w"> </span><span class="mf">29.2</span><span class="p">})</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  [fancy display] Current conditions: 70.00F degrees, 65.00% humidity, 30.40 pressure</span>
<span class="cm">  [simple display] Temperature: 70 degrees</span>
<span class="cm">  [simple display] Temperature: 68 degrees</span>
<span class="cm">  [fancy display] Current conditions: 68.00F degrees, 70.00% humidity, 29.20 pressure</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="state">State</h3>
<ul>
<li>Analogy<ul>
<li>A smartphone can be in different states: locked, unlocked, charging, etc. For example, when it’s locked, pressing the home button doesn’t do anything, but when it’s unlocked, pressing it goes to the home screen.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To allow an object to alter its behavior when its internal state changes. This pattern encapsulates state-specific behavior within state objects, making an object’s behavior dependent on its state.</li>
<li>For implementing finite state machines in a more organized and maintainable way (i.e., refactor large <code>if-else</code>/<code>switch</code> constructs).</li>
<li>When the number of states is large, and the state-specific behavior changes frequently.</li>
</ul>
</li>
<li>Implementation<ul>
<li><strong>State Interface</strong>: Defines a common interface for all concrete state classes, encapsulating the state-specific behavior.</li>
<li><strong>Concrete State Classes</strong>: Implement the <strong>State interface</strong> and provide the implementation for the state-specific behavior.</li>
<li><strong>Context Class</strong>: Maintains an instance of a <strong>ConcreteState</strong> subclass that defines the current state and delegates state-specific behavior to the current state object.</li>
</ul>
</li>
<li>Pros<ul>
<li><strong>Single Responsibility Principle</strong>: Each state is encapsulated in its own class.</li>
<li><strong>Open/Closed Principle</strong>: It is easy to add new states without changing the context or other states.</li>
<li>Reduces complex conditional logic in the context by encapsulating state-specific behavior.</li>
</ul>
</li>
<li>Cons<ul>
<li>Can lead to an increase in the number of classes and boilerplate code.</li>
<li>The context must carefully manage state objects and transitions, which can get complex.</li>
<li>Overkill for a simple state machine which doesn’t change much.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li>While <strong>Strategy</strong> usually changes the algorithm used by the context (objects being unaware of each other), <strong>State</strong> changes the behavior of the context based on its internal state.</li>
<li><strong>State</strong> can be used to change the behavior of <strong>Commands</strong> based on the state of the system.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="s">"fmt"</span>
<span class="w"> </span><span class="s">"sync"</span>
<span class="w"> </span><span class="s">"time"</span>
<span class="p">)</span>

<span class="c1">// State is the interface for the vending machine states</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">State</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">CancelTransaction</span><span class="p">()</span>
<span class="w"> </span><span class="nx">DispenseItem</span><span class="p">()</span>
<span class="w"> </span><span class="nx">InsertMoney</span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// ReadyState allows item dispensing if there's sufficient balance</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ReadyState</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">machine</span><span class="w"> </span><span class="o">*</span><span class="nx">VendingMachine</span>
<span class="p">}</span>

<span class="c1">// InsertMoney adds money to the vending machine balance</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rs</span><span class="w"> </span><span class="o">*</span><span class="nx">ReadyState</span><span class="p">)</span><span class="w"> </span><span class="nx">InsertMoney</span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"🪙 Inserted $%d\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span>
<span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">amount</span>
<span class="p">}</span>

<span class="c1">// DispenseItem dispenses an item if there's sufficient balance</span>
<span class="c1">// and the machine has items in stock</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rs</span><span class="w"> </span><span class="o">*</span><span class="nx">ReadyState</span><span class="p">)</span><span class="w"> </span><span class="nx">DispenseItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">balance</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">itemPrice</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🚨 Tried to dispense... Insufficient balance!"</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">busyDispensingState</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🥫 Dispensing $2 item..."</span><span class="p">)</span>

<span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="c1">// Simulate the dispensing process</span>

<span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">balance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">itemPrice</span>
<span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">itemCount</span><span class="o">--</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"✅ Item dispensed."</span><span class="p">)</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">balance</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"💵 Returning change of $"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprint</span><span class="p">(</span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">balance</span><span class="p">))</span>
<span class="w">  </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">balance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">itemCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"0️⃣ Out of stock!"</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">outOfStockState</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">readyState</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// CancelTransaction does nothing when the machine is ready</span>
<span class="c1">// and there's no transaction to cancel, and it refunds the balance</span>
<span class="c1">// when there's a pending transaction</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rs</span><span class="w"> </span><span class="o">*</span><span class="nx">ReadyState</span><span class="p">)</span><span class="w"> </span><span class="nx">CancelTransaction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">balance</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"❌ Cancelling transaction, returning $%d\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">balance</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rs</span><span class="p">.</span><span class="nx">machine</span><span class="p">.</span><span class="nx">balance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="k">return</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"⚠️ No transaction to cancel."</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// OutOfStockState prevents item dispensing</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">OutOfStockState</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">machine</span><span class="w"> </span><span class="o">*</span><span class="nx">VendingMachine</span>
<span class="p">}</span>

<span class="c1">// InsertMoney does nothing when the machine is out of stock</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">oos</span><span class="w"> </span><span class="o">*</span><span class="nx">OutOfStockState</span><span class="p">)</span><span class="w"> </span><span class="nx">InsertMoney</span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🔴 Machine out of stock. Money insertion is futile."</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// DispenseItem does nothing when the machine is out of stock</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">oos</span><span class="w"> </span><span class="o">*</span><span class="nx">OutOfStockState</span><span class="p">)</span><span class="w"> </span><span class="nx">DispenseItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🔴 Machine out of stock. Unable to dispense."</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// CancelTransaction does nothing when the machine is out of stock</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">oos</span><span class="w"> </span><span class="o">*</span><span class="nx">OutOfStockState</span><span class="p">)</span><span class="w"> </span><span class="nx">CancelTransaction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🔴 Machine out of stock. No transaction to cancel."</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// BusyDispensingState prevents further item dispensing and money insertion</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BusyDispensingState</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">machine</span><span class="w"> </span><span class="o">*</span><span class="nx">VendingMachine</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="w"> </span><span class="o">*</span><span class="nx">BusyDispensingState</span><span class="p">)</span><span class="w"> </span><span class="nx">BusyDispensing</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🛑 Dispensing..."</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// InsertMoney returns the money when the machine is busy dispensing</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="w"> </span><span class="o">*</span><span class="nx">BusyDispensingState</span><span class="p">)</span><span class="w"> </span><span class="nx">InsertMoney</span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🛑 Busy dispensing. Money insertion is futile."</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// DispenseItem does nothing when the machine is busy dispensing</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="w"> </span><span class="o">*</span><span class="nx">BusyDispensingState</span><span class="p">)</span><span class="w"> </span><span class="nx">DispenseItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🛑 Already dispensing, be patient!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// CancelTransaction does nothing when the machine is busy dispensing</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">bd</span><span class="w"> </span><span class="o">*</span><span class="nx">BusyDispensingState</span><span class="p">)</span><span class="w"> </span><span class="nx">CancelTransaction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"🛑 Busy dispensing. No transaction to cancel."</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// VendingMachine is the context for the state pattern</span>
<span class="c1">// in which all states are defined</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">VendingMachine</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">busyDispensingState</span><span class="w"> </span><span class="nx">State</span>
<span class="w"> </span><span class="nx">readyState</span><span class="w">          </span><span class="nx">State</span>
<span class="w"> </span><span class="nx">outOfStockState</span><span class="w">     </span><span class="nx">State</span>
<span class="w"> </span><span class="nx">currentState</span><span class="w">        </span><span class="nx">State</span>
<span class="w"> </span><span class="nx">itemCount</span><span class="w">           </span><span class="kt">int</span>
<span class="w"> </span><span class="nx">balance</span><span class="w">             </span><span class="kt">int</span>
<span class="w"> </span><span class="nx">itemPrice</span><span class="w">           </span><span class="kt">int</span>
<span class="p">}</span>

<span class="c1">// NewVendingMachine creates a new vending machine</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewVendingMachine</span><span class="p">(</span><span class="nx">itemCount</span><span class="p">,</span><span class="w"> </span><span class="nx">itemPrice</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">VendingMachine</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">vm</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">VendingMachine</span><span class="p">{</span>
<span class="w">  </span><span class="nx">itemCount</span><span class="p">:</span><span class="w"> </span><span class="nx">itemCount</span><span class="p">,</span>
<span class="w">  </span><span class="nx">itemPrice</span><span class="p">:</span><span class="w"> </span><span class="nx">itemPrice</span><span class="p">,</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nx">readyState</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ReadyState</span><span class="p">{</span><span class="nx">machine</span><span class="p">:</span><span class="w"> </span><span class="nx">vm</span><span class="p">}</span>
<span class="w"> </span><span class="nx">outOfStockState</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">OutOfStockState</span><span class="p">{</span><span class="nx">machine</span><span class="p">:</span><span class="w"> </span><span class="nx">vm</span><span class="p">}</span>
<span class="w"> </span><span class="nx">busyDispensingState</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BusyDispensingState</span><span class="p">{</span><span class="nx">machine</span><span class="p">:</span><span class="w"> </span><span class="nx">vm</span><span class="p">}</span>

<span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">busyDispensingState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">busyDispensingState</span>
<span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">readyState</span>
<span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">outOfStockState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">outOfStockState</span>
<span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">readyState</span><span class="p">)</span>

<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">vm</span>
<span class="p">}</span>

<span class="c1">// InsertMoney adds money to the vending machine balance</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">vm</span><span class="w"> </span><span class="o">*</span><span class="nx">VendingMachine</span><span class="p">)</span><span class="w"> </span><span class="nx">InsertMoney</span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">currentState</span><span class="p">.</span><span class="nx">InsertMoney</span><span class="p">(</span><span class="nx">amount</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// DispenseItem dispenses an item if there's sufficient balance</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">vm</span><span class="w"> </span><span class="o">*</span><span class="nx">VendingMachine</span><span class="p">)</span><span class="w"> </span><span class="nx">DispenseItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">currentState</span><span class="p">.</span><span class="nx">DispenseItem</span><span class="p">()</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">itemCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">vm</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">outOfStockState</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// setState changes the current state of the vending machine</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">vm</span><span class="w"> </span><span class="o">*</span><span class="nx">VendingMachine</span><span class="p">)</span><span class="w"> </span><span class="nx">setState</span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="nx">State</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">currentState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">state</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">vm</span><span class="w"> </span><span class="o">*</span><span class="nx">VendingMachine</span><span class="p">)</span><span class="w"> </span><span class="nx">CancelTransaction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"❌ Cancelling transaction..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vm</span><span class="p">.</span><span class="nx">currentState</span><span class="p">.</span><span class="nx">CancelTransaction</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewVendingMachine</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 10 items, $2 each</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Buying 3 items..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">InsertMoney</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">DispenseItem</span><span class="p">()</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">InsertMoney</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">DispenseItem</span><span class="p">()</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">InsertMoney</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">DispenseItem</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nTrying to buy an item with insufficient balance..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">InsertMoney</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">DispenseItem</span><span class="p">()</span><span class="w"> </span><span class="c1">// Fails</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">CancelTransaction</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nBuying 1 item with extra money..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">InsertMoney</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">DispenseItem</span><span class="p">()</span>

<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"\nTrying to dispense multiple times in quick succession won't break the machine..."</span><span class="p">)</span>
<span class="w"> </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">InsertMoney</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<span class="w">   </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">InsertMoney</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">   </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">DispenseItem</span><span class="p">()</span>
<span class="w">   </span><span class="nx">vendingMachine</span><span class="p">.</span><span class="nx">CancelTransaction</span><span class="p">()</span>
<span class="w">  </span><span class="p">}()</span>
<span class="w">  </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Buying 3 items...</span>
<span class="cm">  🪙 Inserted $2</span>
<span class="cm">  🥫 Dispensing $2 item...</span>
<span class="cm">  ✅ Item dispensed.</span>
<span class="cm">  🪙 Inserted $2</span>
<span class="cm">  🥫 Dispensing $2 item...</span>
<span class="cm">  ✅ Item dispensed.</span>
<span class="cm">  🪙 Inserted $5</span>
<span class="cm">  🥫 Dispensing $2 item...</span>
<span class="cm">  ✅ Item dispensed.</span>
<span class="cm">  💵 Returning change of $3</span>

<span class="cm">  Trying to buy an item with insufficient balance...</span>
<span class="cm">  🪙 Inserted $1</span>
<span class="cm">  🚨 Tried to dispense... Insufficient balance!</span>
<span class="cm">  ❌ Cancelling transaction...</span>
<span class="cm">  ❌ Cancelling transaction, returning $1</span>

<span class="cm">  Buying 1 item with extra money...</span>
<span class="cm">  🪙 Inserted $5</span>
<span class="cm">  🥫 Dispensing $2 item...</span>
<span class="cm">  ✅ Item dispensed.</span>
<span class="cm">  💵 Returning change of $3</span>

<span class="cm">  Trying to dispense multiple times in quick succession won't break the machine...</span>
<span class="cm">  🪙 Inserted $5</span>
<span class="cm">  🪙 Inserted $5</span>
<span class="cm">  🥫 Dispensing $2 item...</span>
<span class="cm">  ✅ Item dispensed.</span>
<span class="cm">  💵 Returning change of $8</span>
<span class="cm">  ❌ Cancelling transaction...</span>
<span class="cm">  ⚠️ No transaction to cancel.</span>
<span class="cm">  🪙 Inserted $5</span>
<span class="cm">  🥫 Dispensing $2 item...</span>
<span class="cm">  ✅ Item dispensed.</span>
<span class="cm">  💵 Returning change of $3</span>
<span class="cm">  ❌ Cancelling transaction...</span>
<span class="cm">  ⚠️ No transaction to cancel.</span>
<span class="cm">  🪙 Inserted $5</span>
<span class="cm">  🥫 Dispensing $2 item...</span>
<span class="cm">  ✅ Item dispensed.</span>
<span class="cm">  💵 Returning change of $3</span>
<span class="cm">  ❌ Cancelling transaction...</span>
<span class="cm">  ⚠️ No transaction to cancel.</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="strategy">Strategy</h3>
<ul>
<li>Analogy<ul>
<li>Choosing a transportation method in Google Maps: walking; driving; cycling or public transport. Each method is a strategy selected via a button in the <span class="caps">UI</span>. The goal is to reach a given destination, but the method of transportation can vary, and so will the algorithm calculating the route.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To define a family of algorithms, encapsulate each one, and make them interchangeable (e.g., different text parsers classes implementing the same methods but providing different results).</li>
<li>Strategy lets the algorithm vary independently from clients that use it.</li>
<li>When there are multiple ways of doing something and there’s a need to switch between these methods easily at runtime.</li>
</ul>
</li>
<li>Implementation<ul>
<li><strong>Strategy Interface</strong>: This defines a common interface for all concrete strategies to implement.</li>
<li><strong>Concrete Strategies</strong>: Implement the <strong>Strategy Interface</strong> with specific algorithmic implementations.</li>
<li><strong>Context Class</strong>: Maintains a reference to a strategy object and delegates it the responsibility of executing the algorithm. The context is configured with a <strong>ConcreteStrategy</strong> object and may define an interface that lets the strategy access its data.</li>
</ul>
</li>
<li>Pros<ul>
<li>Allows dynamically changing the behavior of an object.</li>
<li>Encapsulates algorithm implementations from the core business logic.</li>
<li>Promotes the reuse of individual strategies across different contexts.</li>
</ul>
</li>
<li>Cons<ul>
<li>Introduces multiple classes and interfaces, which increases complexity.</li>
<li>Clients must understand how strategies differ (and be aware of their existence) to select the appropriate one.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Factory Method</strong> is often used with <strong>Strategy</strong> to instantiate the appropriate <em>ConcreteStrategy</em>.</li>
<li><strong>State</strong> has a similar structure to <strong>Strategy</strong>. While Strategy changes the behavior of a context, State’s behavior change is more intrinsic to the context’s state.</li>
<li><strong>Command</strong> can be seen as a specialization of <strong>Strategy</strong>, with the strategy being parameterized with actions to execute.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="c1">// Formatter is the strategy interface</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Formatter</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Format</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// MarkdownFormatter formats text with Markdown syntax</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">MarkdownFormatter</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Format formats text with Markdown syntax</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">MarkdownFormatter</span><span class="p">)</span><span class="w"> </span><span class="nx">Format</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"**%s**"</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// HTMLFormatter formats text with HTML tags</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">HTMLFormatter</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Format formats text with HTML tags</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">*</span><span class="nx">HTMLFormatter</span><span class="p">)</span><span class="w"> </span><span class="nx">Format</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"&lt;strong&gt;%s&lt;/strong&gt;"</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// CustomFormatter formats text with custom syntax</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CustomFormatter</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Format formats text with custom syntax</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomFormatter</span><span class="p">)</span><span class="w"> </span><span class="nx">Format</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"[[[ %s ]]]"</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// TextEditor is the context inside which the strategy is used</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">TextEditor</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">formatter</span><span class="w"> </span><span class="nx">Formatter</span>
<span class="p">}</span>

<span class="c1">// SetFormatter sets the formatter</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditor</span><span class="p">)</span><span class="w"> </span><span class="nx">SetFormatter</span><span class="p">(</span><span class="nx">formatter</span><span class="w"> </span><span class="nx">Formatter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">formatter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">formatter</span>
<span class="p">}</span>

<span class="c1">// PublishText publishes the text using the selected formatter</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditor</span><span class="p">)</span><span class="w"> </span><span class="nx">PublishText</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">formatter</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="nx">text</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">editor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TextEditor</span><span class="p">{}</span>

<span class="w"> </span><span class="c1">// Using Markdown formatter</span>
<span class="w"> </span><span class="nx">markdownFormatter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MarkdownFormatter</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nx">SetFormatter</span><span class="p">(</span><span class="nx">markdownFormatter</span><span class="p">)</span>
<span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nx">PublishText</span><span class="p">(</span><span class="s">"Choosing the Markdown strategy"</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Switching to HTML formatter</span>
<span class="w"> </span><span class="nx">htmlFormatter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">HTMLFormatter</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nx">SetFormatter</span><span class="p">(</span><span class="nx">htmlFormatter</span><span class="p">)</span>
<span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nx">PublishText</span><span class="p">(</span><span class="s">"Choosing the HTML strategy"</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Switching to Custom formatter</span>
<span class="w"> </span><span class="nx">customFormatter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CustomFormatter</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nx">SetFormatter</span><span class="p">(</span><span class="nx">customFormatter</span><span class="p">)</span>
<span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nx">PublishText</span><span class="p">(</span><span class="s">"Choosing the Custom strategy"</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  **Choosing the Markdown strategy**</span>
<span class="cm">  &lt;strong&gt;Choosing the HTML strategy&lt;/strong&gt;</span>
<span class="cm">  [[[ Choosing the Custom strategy ]]]</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="template-method">Template method</h3>
<ul>
<li>Analogy<ul>
<li>A recipe for baking a cake: the steps are roughly the same for all cakes, but the ingredients and some steps can vary.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To define the skeleton of an algorithm in the superclass while letting subclasses override specific steps of the algorithm without changing its structure.</li>
<li>When multiple subclasses should implement a similar algorithm with some slight differences in certain steps. Hooks can be used to provide optional parts of the algorithm that subclasses might or might not override.</li>
</ul>
</li>
<li>Implementation<ul>
<li><strong>Abstract Class</strong> / <strong>Interface</strong> with <strong>Template Method</strong>: Defines the template method, which is a method that outlines the algorithm’s steps, some of which can be default implementations (<em>concrete methods</em>) or abstract methods (<em>hooks</em>) that subclasses will override.</li>
<li><strong>Concrete Class</strong>: Implements the abstract methods (hooks) defined in the abstract class, thereby providing specific behavior for the steps that vary between different subclasses.</li>
</ul>
</li>
<li>Pros<ul>
<li>Promotes reusing code by extracting common behavior into a superclass.</li>
<li>Subclasses can override certain steps of the algorithm without changing its structure.</li>
<li>The superclass can control the algorithm’s structure while allowing subclass-specific behavior.</li>
</ul>
</li>
<li>Cons<ul>
<li>Requires <em>inheritance</em>. This is not a problem in languages like Java, but it can be a limitation in languages that don’t have classes, such as Go.</li>
<li>Subclasses can only change certain parts of the algorithm, not the overall structure or order of steps.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li>Both <strong>Template Method</strong> and <strong>Strategy</strong> can encapsulate algorithms. The key difference is that Strategy uses composition to change parts of the algorithm, while Template Method uses inheritance.</li>
<li><strong>Factory Method</strong> is often used as a step in a <strong>Template Method</strong>, particularly when creating objects that need to vary by subclass.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">"fmt"</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">GameAI</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">TakeTurn</span><span class="p">()</span>
<span class="w"> </span><span class="nx">CollectResources</span><span class="p">()</span>
<span class="w"> </span><span class="nx">BuildStructures</span><span class="p">()</span>
<span class="w"> </span><span class="nx">BuildUnits</span><span class="p">()</span>
<span class="w"> </span><span class="nx">Attack</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// BaseAI provides default implementations for some methods and leaves others as hooks.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">BaseAI</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">GameAI</span><span class="w"> </span><span class="c1">// Embedding the interface for polymorphism</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ai</span><span class="w"> </span><span class="o">*</span><span class="nx">BaseAI</span><span class="p">)</span><span class="w"> </span><span class="nx">TakeTurn</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">ai</span><span class="p">.</span><span class="nx">CollectResources</span><span class="p">()</span>
<span class="w"> </span><span class="nx">ai</span><span class="p">.</span><span class="nx">BuildStructures</span><span class="p">()</span>
<span class="w"> </span><span class="nx">ai</span><span class="p">.</span><span class="nx">BuildUnits</span><span class="p">()</span>
<span class="w"> </span><span class="nx">ai</span><span class="p">.</span><span class="nx">Attack</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ai</span><span class="w"> </span><span class="o">*</span><span class="nx">BaseAI</span><span class="p">)</span><span class="w"> </span><span class="nx">CollectResources</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Collecting resources..."</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ai</span><span class="w"> </span><span class="o">*</span><span class="nx">BaseAI</span><span class="p">)</span><span class="w"> </span><span class="nx">BuildStructures</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1">// Default implementation: Do nothing.</span>
<span class="w"> </span><span class="c1">// This acts as a hook method that can be overridden.</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ai</span><span class="w"> </span><span class="o">*</span><span class="nx">BaseAI</span><span class="p">)</span><span class="w"> </span><span class="nx">BuildUnits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1">// Hook method</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">WolfAI</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">BaseAI</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">orc</span><span class="w"> </span><span class="o">*</span><span class="nx">WolfAI</span><span class="p">)</span><span class="w"> </span><span class="nx">BuildStructures</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Building Wolf structures..."</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">orc</span><span class="w"> </span><span class="o">*</span><span class="nx">WolfAI</span><span class="p">)</span><span class="w"> </span><span class="nx">Attack</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Wolves attacking!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">orc</span><span class="w"> </span><span class="o">*</span><span class="nx">WolfAI</span><span class="p">)</span><span class="w"> </span><span class="nx">BuildUnits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Training Wolf units..."</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">wolfAI</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">WolfAI</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">wolfAI</span><span class="p">.</span><span class="nx">BaseAI</span><span class="p">.</span><span class="nx">GameAI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">wolfAI</span><span class="w"> </span><span class="c1">// Link for polymorphism</span>

<span class="w"> </span><span class="nx">wolfAI</span><span class="p">.</span><span class="nx">TakeTurn</span><span class="p">()</span><span class="w"> </span><span class="c1">// Executes the algorithm, with some steps overridden by WolfAI</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Collecting resources...</span>
<span class="cm">  Wolves attacking!</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="visitor">Visitor</h3>
<ul>
<li>Analogy<ul>
<li>A tax auditor visiting different businesses to calculate their taxes.</li>
</ul>
</li>
<li>When to use it<ul>
<li>To separate algorithms from the objects on which they operate, allowing for new operations to be added to these objects without modifying their classes.</li>
<li>When dealing with a fixed set of object structures but needing to extend their functionality dynamically.</li>
</ul>
</li>
<li>Implementation<ul>
<li><strong>Element Interface</strong>: Defines an <code>Accept</code> method that takes a <em>visitor</em> and allows the visitor to perform some operation on the <em>element</em>.</li>
<li><strong>Concrete Element Classes</strong>: Implement the <strong>Element Interface</strong> and define the <code>Accept</code> method. The <code>Accept</code> method calls the <em>visitor</em>‘s method that’s designed to handle the <em>element</em>.</li>
<li><strong>Visitor Interface</strong>: Defines a method for each type of concrete <em>element</em> in the object structure that the <em>visitor</em> can operate on.</li>
<li><strong>Concrete Visitor Classes</strong>: Implement the <strong>Visitor interface</strong>, providing the implementation for each operation on the concrete <em>elements</em>.</li>
</ul>
</li>
<li>Pros<ul>
<li>Keeps algorithm implementations separate from the classes of the objects they operate on.</li>
<li>Makes it easy to add new operations without modifying the classes of the elements.</li>
<li>Each visitor class encapsulates related operations, adhering to the <em>Single Responsibility Principle</em>.</li>
</ul>
</li>
<li>Cons<ul>
<li>Requires changing all visitor classes when a new <em>Element</em> class is added, which can be intrusive.</li>
<li><em>Visitors</em> often need access to the private internals of <em>Elements</em>, which can break encapsulation.</li>
</ul>
</li>
<li>Relation to other patterns<ul>
<li><strong>Visitor</strong> can be used to apply operations over <strong>Composite</strong> structures, making it easy to perform operations on complex tree structures.</li>
<li><strong>Visitor</strong> and <strong>Iterator</strong> can be used together to traverse a complex data structure and perform operations on its elements.</li>
<li><strong>Visitor</strong> is like a powerful version of <strong>Command</strong> pattern, where the visitor can perform multiple operations on the <em>element</em>.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w"> </span><span class="s">"fmt"</span>
<span class="w"> </span><span class="s">"math"</span>
<span class="p">)</span>

<span class="c1">// Shape is the interface that all shapes must implement, which is done</span>
<span class="c1">// implicitly here.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Shape</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Accept</span><span class="p">(</span><span class="nx">visitor</span><span class="w"> </span><span class="nx">Visitor</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Circle is a shape that has a radius.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Circle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Radius</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// Accept allows a visitor to visit the circle.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Circle</span><span class="p">)</span><span class="w"> </span><span class="nx">Accept</span><span class="p">(</span><span class="nx">visitor</span><span class="w"> </span><span class="nx">Visitor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">visitor</span><span class="p">.</span><span class="nx">VisitCircle</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Rectangle is a shape that has a width and height.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Rectangle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Width</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// Accept allows a visitor to visit the rectangle.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="nx">Accept</span><span class="p">(</span><span class="nx">visitor</span><span class="w"> </span><span class="nx">Visitor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">visitor</span><span class="p">.</span><span class="nx">VisitRectangle</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Visitor is the interface that all visitors must implement</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Visitor</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">VisitCircle</span><span class="p">(</span><span class="o">*</span><span class="nx">Circle</span><span class="p">)</span>
<span class="w"> </span><span class="nx">VisitRectangle</span><span class="p">(</span><span class="o">*</span><span class="nx">Rectangle</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// DrawVisitor is a visitor that can draw shapes.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">DrawVisitor</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// VisitCircle draws a circle.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">DrawVisitor</span><span class="p">)</span><span class="w"> </span><span class="nx">VisitCircle</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Circle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Drawing a circle with radius: %.2f\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// VisitRectangle draws a rectangle.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">DrawVisitor</span><span class="p">)</span><span class="w"> </span><span class="nx">VisitRectangle</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Drawing a rectangle with width: %.2f and height: %.2f\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// AreaVisitor is a visitor that can calculate the area of shapes.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">AreaVisitor</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">Area</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// VisitCircle calculates the area of a circle.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AreaVisitor</span><span class="p">)</span><span class="w"> </span><span class="nx">VisitCircle</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Circle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">Area</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span>
<span class="p">}</span>

<span class="c1">// VisitRectangle calculates the area of a rectangle.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AreaVisitor</span><span class="p">)</span><span class="w"> </span><span class="nx">VisitRectangle</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">Area</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nx">circle</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Circle</span><span class="p">{</span><span class="nx">Radius</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<span class="w"> </span><span class="nx">rectangle</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Rectangle</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>

<span class="w"> </span><span class="nx">drawVisitor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">DrawVisitor</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">Accept</span><span class="p">(</span><span class="nx">drawVisitor</span><span class="p">)</span>
<span class="w"> </span><span class="nx">rectangle</span><span class="p">.</span><span class="nx">Accept</span><span class="p">(</span><span class="nx">drawVisitor</span><span class="p">)</span>

<span class="w"> </span><span class="nx">areaVisitor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">AreaVisitor</span><span class="p">{}</span>
<span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">Accept</span><span class="p">(</span><span class="nx">areaVisitor</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Circle Area: %.2f\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">areaVisitor</span><span class="p">.</span><span class="nx">Area</span><span class="p">)</span>

<span class="w"> </span><span class="nx">rectangle</span><span class="p">.</span><span class="nx">Accept</span><span class="p">(</span><span class="nx">areaVisitor</span><span class="p">)</span>
<span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Rectangle Area: %.2f\n"</span><span class="p">,</span><span class="w"> </span><span class="nx">areaVisitor</span><span class="p">.</span><span class="nx">Area</span><span class="p">)</span>

<span class="w"> </span><span class="c1">// Output:</span>
<span class="w"> </span><span class="cm">/*</span>
<span class="cm">  Drawing a circle with radius: 5.00</span>
<span class="cm">  Drawing a rectangle with width: 3.00 and height: 4.00</span>
<span class="cm">  Circle Area: 78.54</span>
<span class="cm">  Rectangle Area: 12.00</span>
<span class="cm"> */</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h1 id="conclusion">Conclusion</h1>
<p>Embarking on the journey through Object-Oriented Programming principles, Software Design Principles, and an array of design patterns, we’ve traversed the most common landscape of structured software design. From the encapsulation and abstraction of <em><span class="caps">OOP</span></em> to the <em><span class="caps">SOLID</span></em> foundations of software design, and through the diverse territories of <em>Creational</em>, <em>Structural</em>, and <em>Behavioral</em> patterns, this book summary serves as a compass for developers navigating the complexities of software architecture. Whether you’re refining your craft or laying the cornerstone of your development career, the insights and patterns presented by Alexander offer a blueprint for building software that stands the test of time, adaptable to the ever-evolving demands of technology and user needs. That was a very enjoyable read: recommended!</p>
<hr/>
<h1 id="resources-and-references">Resources and references</h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Design_Patterns">Design Patterns: Elements of Reusable Object-Oriented Software</a>.</li>
<li><a href="https://staff.cs.utu.fi/~jounsmed/doos_06/material/DesignPrinciplesAndPatterns.pdf">Design Principles and Design Patterns</a>.</li>
<li><a href="https://refactoring.guru/design-patterns/book">Dive into Design Patterns</a>.</li>
<li><a href="https://martinfowler.com/books/eaa.html">Patterns of Enterprise Application Architecture</a>.</li>
<li><a href="https://refactoring.guru">Refactoring Guru</a>.</li>
</ul></div>
</article>
        </main>
    </div>

    <footer>
      <hr />
      <p>
        Built with
        <a
          href="https://www.python.org/"
          target="_blank"
          rel="noopener noreferrer"
          ><svg
            width="1em"
            height="1em"
            viewBox="0 0 32 32"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            class="footer-icon"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M13.0164 2C10.8193 2 9.03825 3.72453 9.03825 5.85185V8.51852H15.9235V9.25926H5.97814C3.78107 9.25926 2 10.9838 2 13.1111L2 18.8889C2 21.0162 3.78107 22.7407 5.97814 22.7407H8.27322V19.4815C8.27322 17.3542 10.0543 15.6296 12.2514 15.6296H19.5956C21.4547 15.6296 22.9617 14.1704 22.9617 12.3704V5.85185C22.9617 3.72453 21.1807 2 18.9836 2H13.0164ZM12.0984 6.74074C12.8589 6.74074 13.4754 6.14378 13.4754 5.40741C13.4754 4.67103 12.8589 4.07407 12.0984 4.07407C11.3378 4.07407 10.7213 4.67103 10.7213 5.40741C10.7213 6.14378 11.3378 6.74074 12.0984 6.74074Z"
              fill="url(#paint0_linear_87_8204)"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M18.9834 30C21.1805 30 22.9616 28.2755 22.9616 26.1482V23.4815L16.0763 23.4815L16.0763 22.7408L26.0217 22.7408C28.2188 22.7408 29.9998 21.0162 29.9998 18.8889V13.1111C29.9998 10.9838 28.2188 9.25928 26.0217 9.25928L23.7266 9.25928V12.5185C23.7266 14.6459 21.9455 16.3704 19.7485 16.3704L12.4042 16.3704C10.5451 16.3704 9.03809 17.8296 9.03809 19.6296L9.03809 26.1482C9.03809 28.2755 10.8192 30 13.0162 30H18.9834ZM19.9015 25.2593C19.1409 25.2593 18.5244 25.8562 18.5244 26.5926C18.5244 27.329 19.1409 27.9259 19.9015 27.9259C20.662 27.9259 21.2785 27.329 21.2785 26.5926C21.2785 25.8562 20.662 25.2593 19.9015 25.2593Z"
              fill="url(#paint1_linear_87_8204)"
            />
            <defs>
              <linearGradient
                id="paint0_linear_87_8204"
                x1="12.4809"
                y1="2"
                x2="12.4809"
                y2="22.7407"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#327EBD" />
                <stop offset="1" stop-color="#1565A7" />
              </linearGradient>
              <linearGradient
                id="paint1_linear_87_8204"
                x1="19.519"
                y1="9.25928"
                x2="19.519"
                y2="30"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#FFDA4B" />
                <stop offset="1" stop-color="#F9C600" />
              </linearGradient>
            </defs>
          </svg>
          Python</a
        >
        using
        <a
          href="http://getpelican.com"
          target="_blank"
          rel="noopener noreferrer"
          ><svg
            fill="hsl(211, 100%, 95%)"
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            role="img"
            xmlns="http://www.w3.org/2000/svg"
            class="footer-icon"
          >
            <title>Pelican icon</title>
            <path
              d="M.9418 0c.342 1.0548 1.8764 2.1857 2.9063 2.6238 1.3134.5583 2.5984.6849 3.7501.8122.895.0963 1.7019.2014 2.3439.4998.1622.0726.3288.148.4688.2499.4586.3364.9464.9876 1.2813 1.4368.7186.9583.5858 1.7451 1.4375 2.2178.089.0492.1683.083.2813.125.271.1018.667.2273.8437-.1563a.788.788 0 00.0625-.1874c-.0712-.229-.321-.4327-.4687-.531-.2618-.171-.3735-.274-.5625-.4685-.3494-.3583-.348-.9508-.5938-1.3744.3092-.131 1.9392-.3597 2.2813-.3124.7313.0326 1.31.0782 1.75.531.1727.1365.2497.2567.4064.3749.011.009.0202.024.0312.0312.6933.5037 1.3388.6705 1.9063.8434.1496.0454.2988.1054.4375.1562.213.0763.4065.1594.5938.281.2222.1474.6089.542.625.8747-.5587-.1783-.207.0323-1.0313-.0312-.4019-.0456-.8058-.0647-1.2187-.0937-.6422-.0454-1.273-.1043-1.8751-.2187-.1002-.0184-.2146-.0388-.3125-.0625-.0766-.0163-.146-.011-.2188-.0312-.0018.0308 0 .0353 0 .0625-.0166.6292.4214.9586-.5938 2.1553-.009.0127-.0204.0167-.0312.0312-.2695.3147-1.657.9163-2.0938 1.0308-1.8593.3728-3.292-.828-5.5315-.2187-.7877.2928-1.3567 1.5756-1.7188 2.5302-.482 1.2677-.8758 2.7956-1.3126 4.3106-.2.6982-.4178 1.4015-.6562 2.0616-.575 1.584-1.3113 2.9428-2.4064 3.717-.1638.1256-.787.41-.8125.6248.404.2037 4.185.056 4.8127 0 2.5033-.2184 3.6468-1.7733 4.4689-3.9045.5659-1.462 1.065-3.9864 2.0313-5.3102.0128-.0182.0183-.015.0313-.0312.1456-.1967.327-.3691.5-.4998.0454-.0347.0775-.0648.125-.0937.0344-.0219.1566-.0592.3438-.0937 1.7357-.3074 9.3491-1.3474 9.844-6.872.051-.5581.0158-1.1588-.0937-1.8117-.0543-.3364-.115-.6653-.2187-1.0308-.2457-.8691-.7981-1.614-1.5313-2.2177-.1926-.16-.405-.3285-.625-.4686-.846-.54-1.8774-.921-2.969-1.1557-.7332-.1582-1.4874-.239-2.25-.25C9.8402.0326 6.3978.2075.9418 0zm1.625 4.2169c.0235.0382.0389.0574.0625.0937C4.2284 6.8382 6.239 6.8135 8.067 7.0281c.666.0782 1.317.1849 1.9063.4686.262.1235.5116.2649.75.4685-.0292-.131-.076-.2564-.125-.3748-.444-1.0763-1.6487-1.6661-2.6875-1.9679-1.3938-.4984-2.4038-.0181-5.344-1.4056zm1.4063 3.186c.0107.0528.0094.0946.0313.1563.2199.6346 1.0403 1.6503 2.0938 1.8741.4567.1636.315.1174 1.0938.0937 1.1406-.0581 1.692-.0793 2.5.25-.02-.0493-.0423-.1091-.0624-.1563C9.0074 8.175 8.2593 8.421 5.8794 8.2464c-1.0188-.3074-1.2587-.3415-1.9063-.8434z"
            />
          </svg>
          Pelican</a
        >, by Sébastien Lavoie.
        <a
          href="https://github.com/sglavoie/sglavoie.github.io/blob/main/LICENSE"
          >MIT Licensed</a
        >.
      </p>
      <p id="rss-feed">
        <a href="https://www.sglavoie.com/feeds/sglavoie.rss.xml"
          ><svg
            width="1em"
            height="1em"
            viewBox="0 0 44 44"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
          >
            <title>RSS Feed</title>
            <desc>Created with Sketch.</desc>
            <defs></defs>
            <g
              id="Icons"
              stroke="none"
              stroke-width="1"
              fill="none"
              fill-rule="evenodd"
            >
              <g
                id="Color-"
                transform="translate(-800.000000, -760.000000)"
                fill="#FF9A00"
              >
                <path
                  d="M800.000471,797.714286 C800.000471,794.243 802.81487,791.428571 806.286118,791.428571 C809.757367,791.428571 812.571765,794.243 812.571765,797.714286 C812.571765,801.185571 809.757367,804 806.286118,804 C802.81487,804 800.000471,801.185571 800.000471,797.714286 Z M844,804 L835.619661,804 C835.619661,784.358714 819.641547,768.380429 800.000471,768.380429 L800.000471,760 C824.261497,760 844,779.738714 844,804 Z M829.333543,804 L820.953204,804 C820.953204,792.446857 811.553019,783.048143 800,783.048143 L800,774.666143 C816.174541,774.666143 829.333543,787.825286 829.333543,804 Z"
                  id="RSS"
                ></path>
              </g>
            </g>
          </svg>
        </a>
      </p>
    </footer>

    <script src="/pagefind/pagefind-ui.js"></script>
    <script src="/theme/scripts/sweetalert2.min.js"></script>
    <script>
      function openSearchModal() {
        Swal.fire({
          title: "<strong>Search</strong>",
          html: `
    <div id="searchWrapper">
      <div id="search"></div>
    </div>`,
          showCancelButton: false,
          focusConfirm: false,
          didOpen: () => {
            new PagefindUI({
              element: "#search",
              showSubResults: true,
              showImages: false,
              debounceTimeoutMs: 100,
            });
            document
              .getElementById("search")
              .getElementsByTagName("input")[0]
              .focus();

            // Re-focus on search input when clear button is clicked
            document
              .getElementsByClassName("pagefind-ui__search-clear")[0]
              .addEventListener("click", function () {
                document
                  .getElementById("search")
                  .getElementsByTagName("input")[0]
                  .focus();
              });
          },
          width: "100%",
          confirmButtonText: "Close",
          position: "top-start",
        });
      }

      document
        .getElementById("search-icon")
        .addEventListener("click", function () {
          openSearchModal();
        });

      // Key press event for the 'F' key
      document.addEventListener("keydown", function (e) {
        // Check if modal is not already focused/open
        if (e.key === "F" && !Swal.isVisible()) {
          openSearchModal();
        }
      });
    </script>
  </body>
</html>